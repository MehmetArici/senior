!function(){window.WebComponents=window.WebComponents||{flags:{}};var e="webcomponents-lite.js",t=document.querySelector('script[src*="'+e+'"]'),n={};if(!n.noOpts){if(location.search.slice(1).split("&").forEach(function(e){var t,o=e.split("=");o[0]&&(t=o[0].match(/wc-(.+)/))&&(n[t[1]]=o[1]||!0)}),t)for(var o,r=0;o=t.attributes[r];r++)"src"!==o.name&&(n[o.name]=o.value||!0);if(n.log&&n.log.split){var i=n.log.split(",");n.log={},i.forEach(function(e){n.log[e]=!0})}else n.log={}}n.register&&(window.CustomElements=window.CustomElements||{flags:{}},window.CustomElements.flags.register=n.register),WebComponents.flags=n}(),function(e){"use strict";function t(e){return void 0!==h[e]}function n(){s.call(this),this._isInvalid=!0}function o(e){return""==e&&n.call(this),e.toLowerCase()}function r(e){var t=e.charCodeAt(0);return t>32&&t<127&&[34,35,60,62,63,96].indexOf(t)==-1?e:encodeURIComponent(e)}function i(e){var t=e.charCodeAt(0);return t>32&&t<127&&[34,35,60,62,96].indexOf(t)==-1?e:encodeURIComponent(e)}function a(e,a,s){function c(e){g.push(e)}var d=a||"scheme start",l=0,u="",w=!1,_=!1,g=[];e:for(;(e[l-1]!=p||0==l)&&!this._isInvalid;){var b=e[l];switch(d){case"scheme start":if(!b||!m.test(b)){if(a){c("Invalid scheme.");break e}u="",d="no scheme";continue}u+=b.toLowerCase(),d="scheme";break;case"scheme":if(b&&v.test(b))u+=b.toLowerCase();else{if(":"!=b){if(a){if(p==b)break e;c("Code point not allowed in scheme: "+b);break e}u="",l=0,d="no scheme";continue}if(this._scheme=u,u="",a)break e;t(this._scheme)&&(this._isRelative=!0),d="file"==this._scheme?"relative":this._isRelative&&s&&s._scheme==this._scheme?"relative or authority":this._isRelative?"authority first slash":"scheme data"}break;case"scheme data":"?"==b?(this._query="?",d="query"):"#"==b?(this._fragment="#",d="fragment"):p!=b&&"\t"!=b&&"\n"!=b&&"\r"!=b&&(this._schemeData+=r(b));break;case"no scheme":if(s&&t(s._scheme)){d="relative";continue}c("Missing scheme."),n.call(this);break;case"relative or authority":if("/"!=b||"/"!=e[l+1]){c("Expected /, got: "+b),d="relative";continue}d="authority ignore slashes";break;case"relative":if(this._isRelative=!0,"file"!=this._scheme&&(this._scheme=s._scheme),p==b){this._host=s._host,this._port=s._port,this._path=s._path.slice(),this._query=s._query,this._username=s._username,this._password=s._password;break e}if("/"==b||"\\"==b)"\\"==b&&c("\\ is an invalid code point."),d="relative slash";else if("?"==b)this._host=s._host,this._port=s._port,this._path=s._path.slice(),this._query="?",this._username=s._username,this._password=s._password,d="query";else{if("#"!=b){var y=e[l+1],E=e[l+2];("file"!=this._scheme||!m.test(b)||":"!=y&&"|"!=y||p!=E&&"/"!=E&&"\\"!=E&&"?"!=E&&"#"!=E)&&(this._host=s._host,this._port=s._port,this._username=s._username,this._password=s._password,this._path=s._path.slice(),this._path.pop()),d="relative path";continue}this._host=s._host,this._port=s._port,this._path=s._path.slice(),this._query=s._query,this._fragment="#",this._username=s._username,this._password=s._password,d="fragment"}break;case"relative slash":if("/"!=b&&"\\"!=b){"file"!=this._scheme&&(this._host=s._host,this._port=s._port,this._username=s._username,this._password=s._password),d="relative path";continue}"\\"==b&&c("\\ is an invalid code point."),d="file"==this._scheme?"file host":"authority ignore slashes";break;case"authority first slash":if("/"!=b){c("Expected '/', got: "+b),d="authority ignore slashes";continue}d="authority second slash";break;case"authority second slash":if(d="authority ignore slashes","/"!=b){c("Expected '/', got: "+b);continue}break;case"authority ignore slashes":if("/"!=b&&"\\"!=b){d="authority";continue}c("Expected authority, got: "+b);break;case"authority":if("@"==b){w&&(c("@ already seen."),u+="%40"),w=!0;for(var L=0;L<u.length;L++){var N=u[L];if("\t"!=N&&"\n"!=N&&"\r"!=N)if(":"!=N||null!==this._password){var M=r(N);null!==this._password?this._password+=M:this._username+=M}else this._password="";else c("Invalid whitespace in authority.")}u=""}else{if(p==b||"/"==b||"\\"==b||"?"==b||"#"==b){l-=u.length,u="",d="host";continue}u+=b}break;case"file host":if(p==b||"/"==b||"\\"==b||"?"==b||"#"==b){2!=u.length||!m.test(u[0])||":"!=u[1]&&"|"!=u[1]?0==u.length?d="relative path start":(this._host=o.call(this,u),u="",d="relative path start"):d="relative path";continue}"\t"==b||"\n"==b||"\r"==b?c("Invalid whitespace in file host."):u+=b;break;case"host":case"hostname":if(":"!=b||_){if(p==b||"/"==b||"\\"==b||"?"==b||"#"==b){if(this._host=o.call(this,u),u="",d="relative path start",a)break e;continue}"\t"!=b&&"\n"!=b&&"\r"!=b?("["==b?_=!0:"]"==b&&(_=!1),u+=b):c("Invalid code point in host/hostname: "+b)}else if(this._host=o.call(this,u),u="",d="port","hostname"==a)break e;break;case"port":if(/[0-9]/.test(b))u+=b;else{if(p==b||"/"==b||"\\"==b||"?"==b||"#"==b||a){if(""!=u){var T=parseInt(u,10);T!=h[this._scheme]&&(this._port=T+""),u=""}if(a)break e;d="relative path start";continue}"\t"==b||"\n"==b||"\r"==b?c("Invalid code point in port: "+b):n.call(this)}break;case"relative path start":if("\\"==b&&c("'\\' not allowed in path."),d="relative path","/"!=b&&"\\"!=b)continue;break;case"relative path":if(p!=b&&"/"!=b&&"\\"!=b&&(a||"?"!=b&&"#"!=b))"\t"!=b&&"\n"!=b&&"\r"!=b&&(u+=r(b));else{"\\"==b&&c("\\ not allowed in relative path.");var O;(O=f[u.toLowerCase()])&&(u=O),".."==u?(this._path.pop(),"/"!=b&&"\\"!=b&&this._path.push("")):"."==u&&"/"!=b&&"\\"!=b?this._path.push(""):"."!=u&&("file"==this._scheme&&0==this._path.length&&2==u.length&&m.test(u[0])&&"|"==u[1]&&(u=u[0]+":"),this._path.push(u)),u="","?"==b?(this._query="?",d="query"):"#"==b&&(this._fragment="#",d="fragment")}break;case"query":a||"#"!=b?p!=b&&"\t"!=b&&"\n"!=b&&"\r"!=b&&(this._query+=i(b)):(this._fragment="#",d="fragment");break;case"fragment":p!=b&&"\t"!=b&&"\n"!=b&&"\r"!=b&&(this._fragment+=b)}l++}}function s(){this._scheme="",this._schemeData="",this._username="",this._password=null,this._host="",this._port="",this._path=[],this._query="",this._fragment="",this._isInvalid=!1,this._isRelative=!1}function c(e,t){void 0===t||t instanceof c||(t=new c(String(t))),this._url=e,s.call(this);var n=e.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,"");a.call(this,n,null,t)}var d=!1;if(!e.forceJURL)try{var l=new URL("b","http://a");l.pathname="c%20d",d="http://a/c%20d"===l.href}catch(u){}if(!d){var h=Object.create(null);h.ftp=21,h.file=0,h.gopher=70,h.http=80,h.https=443,h.ws=80,h.wss=443;var f=Object.create(null);f["%2e"]=".",f[".%2e"]="..",f["%2e."]="..",f["%2e%2e"]="..";var p=void 0,m=/[a-zA-Z]/,v=/[a-zA-Z0-9\+\-\.]/;c.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var e="";return""==this._username&&null==this._password||(e=this._username+(null!=this._password?":"+this._password:"")+"@"),this.protocol+(this._isRelative?"//"+e+this.host:"")+this.pathname+this._query+this._fragment},set href(e){s.call(this),a.call(this,e)},get protocol(){return this._scheme+":"},set protocol(e){this._isInvalid||a.call(this,e+":","scheme start")},get host(){return this._isInvalid?"":this._port?this._host+":"+this._port:this._host},set host(e){!this._isInvalid&&this._isRelative&&a.call(this,e,"host")},get hostname(){return this._host},set hostname(e){!this._isInvalid&&this._isRelative&&a.call(this,e,"hostname")},get port(){return this._port},set port(e){!this._isInvalid&&this._isRelative&&a.call(this,e,"port")},get pathname(){return this._isInvalid?"":this._isRelative?"/"+this._path.join("/"):this._schemeData},set pathname(e){!this._isInvalid&&this._isRelative&&(this._path=[],a.call(this,e,"relative path start"))},get search(){return this._isInvalid||!this._query||"?"==this._query?"":this._query},set search(e){!this._isInvalid&&this._isRelative&&(this._query="?","?"==e[0]&&(e=e.slice(1)),a.call(this,e,"query"))},get hash(){return this._isInvalid||!this._fragment||"#"==this._fragment?"":this._fragment},set hash(e){this._isInvalid||(this._fragment="#","#"==e[0]&&(e=e.slice(1)),a.call(this,e,"fragment"))},get origin(){var e;if(this._isInvalid||!this._scheme)return"";switch(this._scheme){case"data":case"file":case"javascript":case"mailto":return"null"}return e=this.host,e?this._scheme+"://"+e:""}};var w=e.URL;w&&(c.createObjectURL=function(e){return w.createObjectURL.apply(w,arguments)},c.revokeObjectURL=function(e){w.revokeObjectURL(e)}),e.URL=c}}(self),"undefined"==typeof WeakMap&&!function(){var e=Object.defineProperty,t=Date.now()%1e9,n=function(){this.name="__st"+(1e9*Math.random()>>>0)+(t+++"__")};n.prototype={set:function(t,n){var o=t[this.name];return o&&o[0]===t?o[1]=n:e(t,this.name,{value:[t,n],writable:!0}),this},get:function(e){var t;return(t=e[this.name])&&t[0]===e?t[1]:void 0},delete:function(e){var t=e[this.name];return!(!t||t[0]!==e)&&(t[0]=t[1]=void 0,!0)},has:function(e){var t=e[this.name];return!!t&&t[0]===e}},window.WeakMap=n}(),function(e){function t(e){b.push(e),g||(g=!0,m(o))}function n(e){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(e)||e}function o(){g=!1;var e=b;b=[],e.sort(function(e,t){return e.uid_-t.uid_});var t=!1;e.forEach(function(e){var n=e.takeRecords();r(e),n.length&&(e.callback_(n,e),t=!0)}),t&&o()}function r(e){e.nodes_.forEach(function(t){var n=v.get(t);n&&n.forEach(function(t){t.observer===e&&t.removeTransientObservers()})})}function i(e,t){for(var n=e;n;n=n.parentNode){var o=v.get(n);if(o)for(var r=0;r<o.length;r++){var i=o[r],a=i.options;if(n===e||a.subtree){var s=t(a);s&&i.enqueue(s)}}}}function a(e){this.callback_=e,this.nodes_=[],this.records_=[],this.uid_=++y}function s(e,t){this.type=e,this.target=t,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function c(e){var t=new s(e.type,e.target);return t.addedNodes=e.addedNodes.slice(),t.removedNodes=e.removedNodes.slice(),t.previousSibling=e.previousSibling,t.nextSibling=e.nextSibling,t.attributeName=e.attributeName,t.attributeNamespace=e.attributeNamespace,t.oldValue=e.oldValue,t}function d(e,t){return E=new s(e,t)}function l(e){return L?L:(L=c(E),L.oldValue=e,L)}function u(){E=L=void 0}function h(e){return e===L||e===E}function f(e,t){return e===t?e:L&&h(e)?L:null}function p(e,t,n){this.observer=e,this.target=t,this.options=n,this.transientObservedNodes=[]}if(!e.JsMutationObserver){var m,v=new WeakMap;if(/Trident|Edge/.test(navigator.userAgent))m=setTimeout;else if(window.setImmediate)m=window.setImmediate;else{var w=[],_=String(Math.random());window.addEventListener("message",function(e){if(e.data===_){var t=w;w=[],t.forEach(function(e){e()})}}),m=function(e){w.push(e),window.postMessage(_,"*")}}var g=!1,b=[],y=0;a.prototype={observe:function(e,t){if(e=n(e),!t.childList&&!t.attributes&&!t.characterData||t.attributeOldValue&&!t.attributes||t.attributeFilter&&t.attributeFilter.length&&!t.attributes||t.characterDataOldValue&&!t.characterData)throw new SyntaxError;var o=v.get(e);o||v.set(e,o=[]);for(var r,i=0;i<o.length;i++)if(o[i].observer===this){r=o[i],r.removeListeners(),r.options=t;break}r||(r=new p(this,e,t),o.push(r),this.nodes_.push(e)),r.addListeners()},disconnect:function(){this.nodes_.forEach(function(e){for(var t=v.get(e),n=0;n<t.length;n++){var o=t[n];if(o.observer===this){o.removeListeners(),t.splice(n,1);break}}},this),this.records_=[]},takeRecords:function(){var e=this.records_;return this.records_=[],e}};var E,L;p.prototype={enqueue:function(e){var n=this.observer.records_,o=n.length;if(n.length>0){var r=n[o-1],i=f(r,e);if(i)return void(n[o-1]=i)}else t(this.observer);n[o]=e},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(e){var t=this.options;t.attributes&&e.addEventListener("DOMAttrModified",this,!0),t.characterData&&e.addEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.addEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(e){var t=this.options;t.attributes&&e.removeEventListener("DOMAttrModified",this,!0),t.characterData&&e.removeEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.removeEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(e){if(e!==this.target){this.addListeners_(e),this.transientObservedNodes.push(e);var t=v.get(e);t||v.set(e,t=[]),t.push(this)}},removeTransientObservers:function(){var e=this.transientObservedNodes;this.transientObservedNodes=[],e.forEach(function(e){this.removeListeners_(e);for(var t=v.get(e),n=0;n<t.length;n++)if(t[n]===this){t.splice(n,1);break}},this)},handleEvent:function(e){switch(e.stopImmediatePropagation(),e.type){case"DOMAttrModified":var t=e.attrName,n=e.relatedNode.namespaceURI,o=e.target,r=new d("attributes",o);r.attributeName=t,r.attributeNamespace=n;var a=e.attrChange===MutationEvent.ADDITION?null:e.prevValue;i(o,function(e){if(e.attributes&&(!e.attributeFilter||!e.attributeFilter.length||e.attributeFilter.indexOf(t)!==-1||e.attributeFilter.indexOf(n)!==-1))return e.attributeOldValue?l(a):r});break;case"DOMCharacterDataModified":var o=e.target,r=d("characterData",o),a=e.prevValue;i(o,function(e){if(e.characterData)return e.characterDataOldValue?l(a):r});break;case"DOMNodeRemoved":this.addTransientObserver(e.target);case"DOMNodeInserted":var s,c,h=e.target;"DOMNodeInserted"===e.type?(s=[h],c=[]):(s=[],c=[h]);var f=h.previousSibling,p=h.nextSibling,r=d("childList",e.target.parentNode);r.addedNodes=s,r.removedNodes=c,r.previousSibling=f,r.nextSibling=p,i(e.relatedNode,function(e){if(e.childList)return r})}u()}},e.JsMutationObserver=a,e.MutationObserver||(e.MutationObserver=a,a._isPolyfilled=!0)}}(self),function(){function e(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case" ":return"&nbsp;"}}function t(t){return t.replace(u,e)}var n="undefined"==typeof HTMLTemplateElement;/Trident/.test(navigator.userAgent)&&!function(){var e=document.importNode;document.importNode=function(){var t=e.apply(document,arguments);if(t.nodeType===Node.DOCUMENT_FRAGMENT_NODE){var n=document.createDocumentFragment();return n.appendChild(t),n}return t}}();var o=function(){if(!n){var e=document.createElement("template"),t=document.createElement("template");t.content.appendChild(document.createElement("div")),e.content.appendChild(t);var o=e.cloneNode(!0);return 0===o.content.childNodes.length||0===o.content.firstChild.content.childNodes.length}}(),r="template",i=function(){};if(n){var a=document.implementation.createHTMLDocument("template"),s=!0,c=document.createElement("style");c.textContent=r+"{display:none;}";var d=document.head;d.insertBefore(c,d.firstElementChild),i.prototype=Object.create(HTMLElement.prototype),i.decorate=function(e){if(!e.content){e.content=a.createDocumentFragment();for(var n;n=e.firstChild;)e.content.appendChild(n);if(e.cloneNode=function(e){return i.cloneNode(this,e)},s)try{Object.defineProperty(e,"innerHTML",{get:function(){for(var e="",n=this.content.firstChild;n;n=n.nextSibling)e+=n.outerHTML||t(n.data);return e},set:function(e){for(a.body.innerHTML=e,i.bootstrap(a);this.content.firstChild;)this.content.removeChild(this.content.firstChild);for(;a.body.firstChild;)this.content.appendChild(a.body.firstChild)},configurable:!0})}catch(o){s=!1}i.bootstrap(e.content)}},i.bootstrap=function(e){for(var t,n=e.querySelectorAll(r),o=0,a=n.length;o<a&&(t=n[o]);o++)i.decorate(t)},document.addEventListener("DOMContentLoaded",function(){i.bootstrap(document)});var l=document.createElement;document.createElement=function(){"use strict";var e=l.apply(document,arguments);return"template"===e.localName&&i.decorate(e),e};var u=/[&\u00A0<>]/g}if(n||o){var h=Node.prototype.cloneNode;i.cloneNode=function(e,t){var n=h.call(e,!1);return this.decorate&&this.decorate(n),t&&(n.content.appendChild(h.call(e.content,!0)),this.fixClonedDom(n.content,e.content)),n},i.fixClonedDom=function(e,t){if(t.querySelectorAll)for(var n,o,i=t.querySelectorAll(r),a=e.querySelectorAll(r),s=0,c=a.length;s<c;s++)o=i[s],n=a[s],this.decorate&&this.decorate(o),n.parentNode.replaceChild(o.cloneNode(!0),n)};var f=document.importNode;Node.prototype.cloneNode=function(e){var t=h.call(this,e);return e&&i.fixClonedDom(t,this),t},document.importNode=function(e,t){if(e.localName===r)return i.cloneNode(e,t);var n=f.call(document,e,t);return t&&i.fixClonedDom(n,e),n},o&&(HTMLTemplateElement.prototype.cloneNode=function(e){return i.cloneNode(this,e)})}n&&(window.HTMLTemplateElement=i)}(),function(e){"use strict";if(!window.performance||!window.performance.now){var t=Date.now();window.performance={now:function(){return Date.now()-t}}}window.requestAnimationFrame||(window.requestAnimationFrame=function(){var e=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;return e?function(t){return e(function(){t(performance.now())})}:function(e){return window.setTimeout(e,1e3/60)}}()),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(){return window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)}}());var n=function(){var e=document.createEvent("Event");return e.initEvent("foo",!0,!0),e.preventDefault(),e.defaultPrevented}();if(!n){var o=Event.prototype.preventDefault;Event.prototype.preventDefault=function(){this.cancelable&&(o.call(this),Object.defineProperty(this,"defaultPrevented",{get:function(){return!0},configurable:!0}))}}var r=/Trident/.test(navigator.userAgent);if((!window.CustomEvent||r&&"function"!=typeof window.CustomEvent)&&(window.CustomEvent=function(e,t){t=t||{};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,Boolean(t.bubbles),Boolean(t.cancelable),t.detail),n},window.CustomEvent.prototype=window.Event.prototype),!window.Event||r&&"function"!=typeof window.Event){var i=window.Event;window.Event=function(e,t){t=t||{};var n=document.createEvent("Event");return n.initEvent(e,Boolean(t.bubbles),Boolean(t.cancelable)),n},window.Event.prototype=i.prototype}}(window.WebComponents),window.HTMLImports=window.HTMLImports||{flags:{}},function(e){function t(e,t){t=t||p,o(function(){i(e,t)},t)}function n(e){return"complete"===e.readyState||e.readyState===w}function o(e,t){if(n(t))e&&e();else{var r=function(){"complete"!==t.readyState&&t.readyState!==w||(t.removeEventListener(_,r),o(e,t))};t.addEventListener(_,r)}}function r(e){e.target.__loaded=!0}function i(e,t){function n(){c==d&&e&&e({allImports:s,loadedImports:l,errorImports:u})}function o(e){r(e),l.push(this),c++,n()}function i(e){u.push(this),c++,n()}var s=t.querySelectorAll("link[rel=import]"),c=0,d=s.length,l=[],u=[];if(d)for(var h,f=0;f<d&&(h=s[f]);f++)a(h)?(l.push(this),c++,n()):(h.addEventListener("load",o),h.addEventListener("error",i));else n()}function a(e){return u?e.__loaded||e["import"]&&"loading"!==e["import"].readyState:e.__importParsed}function s(e){for(var t,n=0,o=e.length;n<o&&(t=e[n]);n++)c(t)&&d(t)}function c(e){return"link"===e.localName&&"import"===e.rel}function d(e){var t=e["import"];t?r({target:e}):(e.addEventListener("load",r),e.addEventListener("error",r))}var l="import",u=Boolean(l in document.createElement("link")),h=Boolean(window.ShadowDOMPolyfill),f=function(e){return h?window.ShadowDOMPolyfill.wrapIfNeeded(e):e},p=f(document),m={get:function(){var e=window.HTMLImports.currentScript||document.currentScript||("complete"!==document.readyState?document.scripts[document.scripts.length-1]:null);return f(e)},configurable:!0};Object.defineProperty(document,"_currentScript",m),Object.defineProperty(p,"_currentScript",m);var v=/Trident/.test(navigator.userAgent),w=v?"complete":"interactive",_="readystatechange";u&&(new MutationObserver(function(e){for(var t,n=0,o=e.length;n<o&&(t=e[n]);n++)t.addedNodes&&s(t.addedNodes)}).observe(document.head,{childList:!0}),function(){if("loading"===document.readyState)for(var e,t=document.querySelectorAll("link[rel=import]"),n=0,o=t.length;n<o&&(e=t[n]);n++)d(e)}()),t(function(e){window.HTMLImports.ready=!0,window.HTMLImports.readyTime=(new Date).getTime();var t=p.createEvent("CustomEvent");t.initCustomEvent("HTMLImportsLoaded",!0,!0,e),p.dispatchEvent(t)}),e.IMPORT_LINK_TYPE=l,e.useNative=u,e.rootDocument=p,e.whenReady=t,e.isIE=v}(window.HTMLImports),function(e){var t=[],n=function(e){t.push(e)},o=function(){t.forEach(function(t){t(e)})};e.addModule=n,e.initializeModules=o}(window.HTMLImports),window.HTMLImports.addModule(function(e){var t=/(url\()([^)]*)(\))/g,n=/(@import[\s]+(?!url\())([^;]*)(;)/g,o={resolveUrlsInStyle:function(e,t){var n=e.ownerDocument,o=n.createElement("a");return e.textContent=this.resolveUrlsInCssText(e.textContent,t,o),e},resolveUrlsInCssText:function(e,o,r){var i=this.replaceUrls(e,r,o,t);return i=this.replaceUrls(i,r,o,n)},replaceUrls:function(e,t,n,o){return e.replace(o,function(e,o,r,i){var a=r.replace(/["']/g,"");return n&&(a=new URL(a,n).href),t.href=a,a=t.href,o+"'"+a+"'"+i})}};e.path=o}),window.HTMLImports.addModule(function(e){var t={async:!0,ok:function(e){return e.status>=200&&e.status<300||304===e.status||0===e.status},load:function(n,o,r){var i=new XMLHttpRequest;return(e.flags.debug||e.flags.bust)&&(n+="?"+Math.random()),i.open("GET",n,t.async),i.addEventListener("readystatechange",function(e){if(4===i.readyState){var n=null;try{var a=i.getResponseHeader("Location");a&&(n="/"===a.substr(0,1)?location.origin+a:a)}catch(e){console.error(e.message)}o.call(r,!t.ok(i)&&i,i.response||i.responseText,n)}}),i.send(),i},loadDocument:function(e,t,n){this.load(e,t,n).responseType="document"}};e.xhr=t}),window.HTMLImports.addModule(function(e){var t=e.xhr,n=e.flags,o=function(e,t){this.cache={},this.onload=e,this.oncomplete=t,this.inflight=0,this.pending={}};o.prototype={addNodes:function(e){this.inflight+=e.length;for(var t,n=0,o=e.length;n<o&&(t=e[n]);n++)this.require(t);this.checkDone()},addNode:function(e){this.inflight++,this.require(e),this.checkDone()},require:function(e){var t=e.src||e.href;e.__nodeUrl=t,this.dedupe(t,e)||this.fetch(t,e)},dedupe:function(e,t){if(this.pending[e])return this.pending[e].push(t),!0;return this.cache[e]?(this.onload(e,t,this.cache[e]),this.tail(),!0):(this.pending[e]=[t],!1)},fetch:function(e,o){if(n.load&&console.log("fetch",e,o),e)if(e.match(/^data:/)){var r=e.split(","),i=r[0],a=r[1];a=i.indexOf(";base64")>-1?atob(a):decodeURIComponent(a),setTimeout(function(){this.receive(e,o,null,a)}.bind(this),0)}else{var s=function(t,n,r){this.receive(e,o,t,n,r)}.bind(this);t.load(e,s)}else setTimeout(function(){this.receive(e,o,{error:"href must be specified"},null)}.bind(this),0)},receive:function(e,t,n,o,r){this.cache[e]=o;for(var i,a=this.pending[e],s=0,c=a.length;s<c&&(i=a[s]);s++)this.onload(e,i,o,n,r),this.tail();this.pending[e]=null},tail:function(){--this.inflight,this.checkDone()},checkDone:function(){this.inflight||this.oncomplete()}},e.Loader=o}),window.HTMLImports.addModule(function(e){var t=function(e){this.addCallback=e,this.mo=new MutationObserver(this.handler.bind(this))};t.prototype={handler:function(e){for(var t,n=0,o=e.length;n<o&&(t=e[n]);n++)"childList"===t.type&&t.addedNodes.length&&this.addedNodes(t.addedNodes)},addedNodes:function(e){this.addCallback&&this.addCallback(e);for(var t,n=0,o=e.length;n<o&&(t=e[n]);n++)t.children&&t.children.length&&this.addedNodes(t.children)},observe:function(e){this.mo.observe(e,{childList:!0,subtree:!0})}},e.Observer=t}),window.HTMLImports.addModule(function(e){function t(e){return"link"===e.localName&&e.rel===l}function n(e){var t=o(e);return"data:text/javascript;charset=utf-8,"+encodeURIComponent(t)}function o(e){return e.textContent+r(e)}function r(e){var t=e.ownerDocument;t.__importedScripts=t.__importedScripts||0;var n=e.ownerDocument.baseURI,o=t.__importedScripts?"-"+t.__importedScripts:"";return t.__importedScripts++,"\n//# sourceURL="+n+o+".js\n"}function i(e){var t=e.ownerDocument.createElement("style");return t.textContent=e.textContent,a.resolveUrlsInStyle(t),t}var a=e.path,s=e.rootDocument,c=e.flags,d=e.isIE,l=e.IMPORT_LINK_TYPE,u="link[rel="+l+"]",h={documentSelectors:u,importsSelectors:[u,"link[rel=stylesheet]:not([type])","style:not([type])","script:not([type])",'script[type="application/javascript"]','script[type="text/javascript"]'].join(","),map:{link:"parseLink",script:"parseScript",style:"parseStyle"},dynamicElements:[],parseNext:function(){var e=this.nextToParse();e&&this.parse(e)},parse:function(e){if(this.isParsed(e))return void(c.parse&&console.log("[%s] is already parsed",e.localName));var t=this[this.map[e.localName]];t&&(this.markParsing(e),t.call(this,e))},parseDynamic:function(e,t){this.dynamicElements.push(e),t||this.parseNext()},markParsing:function(e){c.parse&&console.log("parsing",e),this.parsingElement=e},markParsingComplete:function(e){e.__importParsed=!0,this.markDynamicParsingComplete(e),e.__importElement&&(e.__importElement.__importParsed=!0,this.markDynamicParsingComplete(e.__importElement)),this.parsingElement=null,c.parse&&console.log("completed",e)},markDynamicParsingComplete:function(e){var t=this.dynamicElements.indexOf(e);t>=0&&this.dynamicElements.splice(t,1)},parseImport:function(e){if(e["import"]=e.__doc,window.HTMLImports.__importsParsingHook&&window.HTMLImports.__importsParsingHook(e),e["import"]&&(e["import"].__importParsed=!0),this.markParsingComplete(e),e.__resource&&!e.__error?e.dispatchEvent(new CustomEvent("load",{bubbles:!1})):e.dispatchEvent(new CustomEvent("error",{bubbles:!1})),e.__pending)for(var t;e.__pending.length;)t=e.__pending.shift(),t&&t({target:e});this.parseNext()},parseLink:function(e){t(e)?this.parseImport(e):(e.href=e.href,this.parseGeneric(e))},parseStyle:function(e){var t=e;e=i(e),t.__appliedElement=e,e.__importElement=t,this.parseGeneric(e)},parseGeneric:function(e){this.trackElement(e),this.addElementToDocument(e)},rootImportForElement:function(e){for(var t=e;t.ownerDocument.__importLink;)t=t.ownerDocument.__importLink;return t},addElementToDocument:function(e){var t=this.rootImportForElement(e.__importElement||e);t.parentNode.insertBefore(e,t)},trackElement:function(e,t){var n=this,o=function(r){e.removeEventListener("load",o),e.removeEventListener("error",o),t&&t(r),n.markParsingComplete(e),n.parseNext()};if(e.addEventListener("load",o),e.addEventListener("error",o),d&&"style"===e.localName){var r=!1;if(e.textContent.indexOf("@import")==-1)r=!0;else if(e.sheet){r=!0;for(var i,a=e.sheet.cssRules,s=a?a.length:0,c=0;c<s&&(i=a[c]);c++)i.type===CSSRule.IMPORT_RULE&&(r=r&&Boolean(i.styleSheet))}r&&setTimeout(function(){e.dispatchEvent(new CustomEvent("load",{bubbles:!1}))})}},parseScript:function(t){var o=document.createElement("script");o.__importElement=t,o.src=t.src?t.src:n(t),e.currentScript=t,this.trackElement(o,function(t){o.parentNode&&o.parentNode.removeChild(o),e.currentScript=null}),this.addElementToDocument(o)},nextToParse:function(){return this._mayParse=[],!this.parsingElement&&(this.nextToParseInDoc(s)||this.nextToParseDynamic())},nextToParseInDoc:function(e,n){if(e&&this._mayParse.indexOf(e)<0){this._mayParse.push(e);for(var o,r=e.querySelectorAll(this.parseSelectorsForNode(e)),i=0,a=r.length;i<a&&(o=r[i]);i++)if(!this.isParsed(o))return this.hasResource(o)?t(o)?this.nextToParseInDoc(o.__doc,o):o:void 0}return n},nextToParseDynamic:function(){return this.dynamicElements[0]},parseSelectorsForNode:function(e){var t=e.ownerDocument||e;return t===s?this.documentSelectors:this.importsSelectors},isParsed:function(e){return e.__importParsed},needsDynamicParsing:function(e){return this.dynamicElements.indexOf(e)>=0},hasResource:function(e){return!t(e)||void 0!==e.__doc}};e.parser=h,e.IMPORT_SELECTOR=u}),window.HTMLImports.addModule(function(e){function t(e){return n(e,a)}function n(e,t){return"link"===e.localName&&e.getAttribute("rel")===t}function o(e){return!!Object.getOwnPropertyDescriptor(e,"baseURI")}function r(e,t){var n=document.implementation.createHTMLDocument(a);n._URL=t;var r=n.createElement("base");r.setAttribute("href",t),n.baseURI||o(n)||Object.defineProperty(n,"baseURI",{value:t});var i=n.createElement("meta");return i.setAttribute("charset","utf-8"),n.head.appendChild(i),n.head.appendChild(r),n.body.innerHTML=e,window.HTMLTemplateElement&&HTMLTemplateElement.bootstrap&&HTMLTemplateElement.bootstrap(n),n}var i=e.flags,a=e.IMPORT_LINK_TYPE,s=e.IMPORT_SELECTOR,c=e.rootDocument,d=e.Loader,l=e.Observer,u=e.parser,h={documents:{},documentPreloadSelectors:s,importsPreloadSelectors:[s].join(","),loadNode:function(e){f.addNode(e)},loadSubtree:function(e){var t=this.marshalNodes(e);f.addNodes(t)},marshalNodes:function(e){return e.querySelectorAll(this.loadSelectorsForNode(e))},loadSelectorsForNode:function(e){var t=e.ownerDocument||e;return t===c?this.documentPreloadSelectors:this.importsPreloadSelectors},loaded:function(e,n,o,a,s){if(i.load&&console.log("loaded",e,n),n.__resource=o,n.__error=a,t(n)){var c=this.documents[e];void 0===c&&(c=a?null:r(o,s||e),c&&(c.__importLink=n,this.bootDocument(c)),this.documents[e]=c),n.__doc=c}u.parseNext()},bootDocument:function(e){this.loadSubtree(e),this.observer.observe(e),u.parseNext()},loadedAll:function(){u.parseNext()}},f=new d(h.loaded.bind(h),h.loadedAll.bind(h));if(h.observer=new l,!document.baseURI){var p={get:function(){var e=document.querySelector("base");return e?e.href:window.location.href},configurable:!0};Object.defineProperty(document,"baseURI",p),Object.defineProperty(c,"baseURI",p)}e.importer=h,e.importLoader=f}),window.HTMLImports.addModule(function(e){var t=e.parser,n=e.importer,o={added:function(e){for(var o,r,i,a,s=0,c=e.length;s<c&&(a=e[s]);s++)o||(o=a.ownerDocument,r=t.isParsed(o)),i=this.shouldLoadNode(a),i&&n.loadNode(a),this.shouldParseNode(a)&&r&&t.parseDynamic(a,i)},shouldLoadNode:function(e){return 1===e.nodeType&&r.call(e,n.loadSelectorsForNode(e))},shouldParseNode:function(e){return 1===e.nodeType&&r.call(e,t.parseSelectorsForNode(e))}};n.observer.addCallback=o.added.bind(o);var r=HTMLElement.prototype.matches||HTMLElement.prototype.matchesSelector||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector}),function(e){function t(){window.HTMLImports.importer.bootDocument(o)}var n=e.initializeModules;e.isIE;if(!e.useNative){n();var o=e.rootDocument;"complete"===document.readyState||"interactive"===document.readyState&&!window.attachEvent?t():document.addEventListener("DOMContentLoaded",t)}}(window.HTMLImports),window.CustomElements=window.CustomElements||{flags:{}},function(e){var t=e.flags,n=[],o=function(e){n.push(e)},r=function(){n.forEach(function(t){t(e)})};e.addModule=o,e.initializeModules=r,e.hasNative=Boolean(document.registerElement),e.isIE=/Trident/.test(navigator.userAgent),e.useNative=!t.register&&e.hasNative&&!window.ShadowDOMPolyfill&&(!window.HTMLImports||window.HTMLImports.useNative)}(window.CustomElements),window.CustomElements.addModule(function(e){function t(e,t){n(e,function(e){return!!t(e)||void o(e,t)}),o(e,t)}function n(e,t,o){var r=e.firstElementChild;if(!r)for(r=e.firstChild;r&&r.nodeType!==Node.ELEMENT_NODE;)r=r.nextSibling;for(;r;)t(r,o)!==!0&&n(r,t,o),r=r.nextElementSibling;return null}function o(e,n){for(var o=e.shadowRoot;o;)t(o,n),o=o.olderShadowRoot}function r(e,t){i(e,t,[])}function i(e,t,n){if(e=window.wrap(e),!(n.indexOf(e)>=0)){n.push(e);for(var o,r=e.querySelectorAll("link[rel="+a+"]"),s=0,c=r.length;s<c&&(o=r[s]);s++)o["import"]&&i(o["import"],t,n);t(e)}}var a=window.HTMLImports?window.HTMLImports.IMPORT_LINK_TYPE:"none";e.forDocumentTree=r,e.forSubtree=t}),window.CustomElements.addModule(function(e){function t(e,t){return n(e,t)||o(e,t)}function n(t,n){return!!e.upgrade(t,n)||void(n&&a(t))}function o(e,t){g(e,function(e){if(n(e,t))return!0})}function r(e){L.push(e),E||(E=!0,setTimeout(i))}function i(){E=!1;for(var e,t=L,n=0,o=t.length;n<o&&(e=t[n]);n++)e();L=[]}function a(e){y?r(function(){s(e)
}):s(e)}function s(e){e.__upgraded__&&!e.__attached&&(e.__attached=!0,e.attachedCallback&&e.attachedCallback())}function c(e){d(e),g(e,function(e){d(e)})}function d(e){y?r(function(){l(e)}):l(e)}function l(e){e.__upgraded__&&e.__attached&&(e.__attached=!1,e.detachedCallback&&e.detachedCallback())}function u(e){for(var t=e,n=window.wrap(document);t;){if(t==n)return!0;t=t.parentNode||t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&t.host}}function h(e){if(e.shadowRoot&&!e.shadowRoot.__watched){_.dom&&console.log("watching shadow-root for: ",e.localName);for(var t=e.shadowRoot;t;)m(t),t=t.olderShadowRoot}}function f(e,n){if(_.dom){var o=n[0];if(o&&"childList"===o.type&&o.addedNodes&&o.addedNodes){for(var r=o.addedNodes[0];r&&r!==document&&!r.host;)r=r.parentNode;var i=r&&(r.URL||r._URL||r.host&&r.host.localName)||"";i=i.split("/?").shift().split("/").pop()}console.group("mutations (%d) [%s]",n.length,i||"")}var a=u(e);n.forEach(function(e){"childList"===e.type&&(N(e.addedNodes,function(e){e.localName&&t(e,a)}),N(e.removedNodes,function(e){e.localName&&c(e)}))}),_.dom&&console.groupEnd()}function p(e){for(e=window.wrap(e),e||(e=window.wrap(document));e.parentNode;)e=e.parentNode;var t=e.__observer;t&&(f(e,t.takeRecords()),i())}function m(e){if(!e.__observer){var t=new MutationObserver(f.bind(this,e));t.observe(e,{childList:!0,subtree:!0}),e.__observer=t}}function v(e){e=window.wrap(e),_.dom&&console.group("upgradeDocument: ",e.baseURI.split("/").pop());var n=e===window.wrap(document);t(e,n),m(e),_.dom&&console.groupEnd()}function w(e){b(e,v)}var _=e.flags,g=e.forSubtree,b=e.forDocumentTree,y=window.MutationObserver._isPolyfilled&&_["throttle-attached"];e.hasPolyfillMutations=y,e.hasThrottledAttached=y;var E=!1,L=[],N=Array.prototype.forEach.call.bind(Array.prototype.forEach),M=Element.prototype.createShadowRoot;M&&(Element.prototype.createShadowRoot=function(){var e=M.call(this);return window.CustomElements.watchShadow(this),e}),e.watchShadow=h,e.upgradeDocumentTree=w,e.upgradeDocument=v,e.upgradeSubtree=o,e.upgradeAll=t,e.attached=a,e.takeRecords=p}),window.CustomElements.addModule(function(e){function t(t,o){if("template"===t.localName&&window.HTMLTemplateElement&&HTMLTemplateElement.decorate&&HTMLTemplateElement.decorate(t),!t.__upgraded__&&t.nodeType===Node.ELEMENT_NODE){var r=t.getAttribute("is"),i=e.getRegisteredDefinition(t.localName)||e.getRegisteredDefinition(r);if(i&&(r&&i.tag==t.localName||!r&&!i["extends"]))return n(t,i,o)}}function n(t,n,r){return a.upgrade&&console.group("upgrade:",t.localName),n.is&&t.setAttribute("is",n.is),o(t,n),t.__upgraded__=!0,i(t),r&&e.attached(t),e.upgradeSubtree(t,r),a.upgrade&&console.groupEnd(),t}function o(e,t){Object.__proto__?e.__proto__=t.prototype:(r(e,t.prototype,t["native"]),e.__proto__=t.prototype)}function r(e,t,n){for(var o={},r=t;r!==n&&r!==HTMLElement.prototype;){for(var i,a=Object.getOwnPropertyNames(r),s=0;i=a[s];s++)o[i]||(Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i)),o[i]=1);r=Object.getPrototypeOf(r)}}function i(e){e.createdCallback&&e.createdCallback()}var a=e.flags;e.upgrade=t,e.upgradeWithDefinition=n,e.implementPrototype=o}),window.CustomElements.addModule(function(e){function t(t,o){var c=o||{};if(!t)throw new Error("document.registerElement: first argument `name` must not be empty");if(t.indexOf("-")<0)throw new Error("document.registerElement: first argument ('name') must contain a dash ('-'). Argument provided was '"+String(t)+"'.");if(r(t))throw new Error("Failed to execute 'registerElement' on 'Document': Registration failed for type '"+String(t)+"'. The type name is invalid.");if(d(t))throw new Error("DuplicateDefinitionError: a type with name '"+String(t)+"' is already registered");return c.prototype||(c.prototype=Object.create(HTMLElement.prototype)),c.__name=t.toLowerCase(),c["extends"]&&(c["extends"]=c["extends"].toLowerCase()),c.lifecycle=c.lifecycle||{},c.ancestry=i(c["extends"]),a(c),s(c),n(c.prototype),l(c.__name,c),c.ctor=u(c),c.ctor.prototype=c.prototype,c.prototype.constructor=c.ctor,e.ready&&v(document),c.ctor}function n(e){if(!e.setAttribute._polyfilled){var t=e.setAttribute;e.setAttribute=function(e,n){o.call(this,e,n,t)};var n=e.removeAttribute;e.removeAttribute=function(e){o.call(this,e,null,n)},e.setAttribute._polyfilled=!0}}function o(e,t,n){e=e.toLowerCase();var o=this.getAttribute(e);n.apply(this,arguments);var r=this.getAttribute(e);this.attributeChangedCallback&&r!==o&&this.attributeChangedCallback(e,o,r)}function r(e){for(var t=0;t<y.length;t++)if(e===y[t])return!0}function i(e){var t=d(e);return t?i(t["extends"]).concat([t]):[]}function a(e){for(var t,n=e["extends"],o=0;t=e.ancestry[o];o++)n=t.is&&t.tag;e.tag=n||e.__name,n&&(e.is=e.__name)}function s(e){if(!Object.__proto__){var t=HTMLElement.prototype;if(e.is){var n=document.createElement(e.tag);t=Object.getPrototypeOf(n)}for(var o,r=e.prototype,i=!1;r;)r==t&&(i=!0),o=Object.getPrototypeOf(r),o&&(r.__proto__=o),r=o;i||console.warn(e.tag+" prototype not found in prototype chain for "+e.is),e["native"]=t}}function c(e){return _(N(e.tag),e)}function d(e){if(e)return E[e.toLowerCase()]}function l(e,t){E[e]=t}function u(e){return function(){return c(e)}}function h(e,t,n){return e===L?f(t,n):M(e,t)}function f(e,t){e&&(e=e.toLowerCase()),t&&(t=t.toLowerCase());var n=d(t||e);if(n){if(e==n.tag&&t==n.is)return new n.ctor;if(!t&&!n.is)return new n.ctor}var o;return t?(o=f(e),o.setAttribute("is",t),o):(o=N(e),e.indexOf("-")>=0&&g(o,HTMLElement),o)}function p(e,t){var n=e[t];e[t]=function(){var e=n.apply(this,arguments);return w(e),e}}var m,v=(e.isIE,e.upgradeDocumentTree),w=e.upgradeAll,_=e.upgradeWithDefinition,g=e.implementPrototype,b=e.useNative,y=["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"],E={},L="http://www.w3.org/1999/xhtml",N=document.createElement.bind(document),M=document.createElementNS.bind(document);m=Object.__proto__||b?function(e,t){return e instanceof t}:function(e,t){if(e instanceof t)return!0;for(var n=e;n;){if(n===t.prototype)return!0;n=n.__proto__}return!1},p(Node.prototype,"cloneNode"),p(document,"importNode"),document.registerElement=t,document.createElement=f,document.createElementNS=h,e.registry=E,e["instanceof"]=m,e.reservedTagList=y,e.getRegisteredDefinition=d,document.register=document.registerElement}),function(e){function t(){i(window.wrap(document)),window.CustomElements.ready=!0;var e=window.requestAnimationFrame||function(e){setTimeout(e,16)};e(function(){setTimeout(function(){window.CustomElements.readyTime=Date.now(),window.HTMLImports&&(window.CustomElements.elapsed=window.CustomElements.readyTime-window.HTMLImports.readyTime),document.dispatchEvent(new CustomEvent("WebComponentsReady",{bubbles:!0}))})})}var n=e.useNative,o=e.initializeModules;e.isIE;if(n){var r=function(){};e.watchShadow=r,e.upgrade=r,e.upgradeAll=r,e.upgradeDocumentTree=r,e.upgradeSubtree=r,e.takeRecords=r,e["instanceof"]=function(e,t){return e instanceof t}}else o();var i=e.upgradeDocumentTree,a=e.upgradeDocument;if(window.wrap||(window.ShadowDOMPolyfill?(window.wrap=window.ShadowDOMPolyfill.wrapIfNeeded,window.unwrap=window.ShadowDOMPolyfill.unwrapIfNeeded):window.wrap=window.unwrap=function(e){return e}),window.HTMLImports&&(window.HTMLImports.__importsParsingHook=function(e){e["import"]&&a(wrap(e["import"]))}),"complete"===document.readyState||e.flags.eager)t();else if("interactive"!==document.readyState||window.attachEvent||window.HTMLImports&&!window.HTMLImports.ready){var s=window.HTMLImports&&!window.HTMLImports.ready?"HTMLImportsLoaded":"DOMContentLoaded";window.addEventListener(s,t)}else t()}(window.CustomElements),function(e){var t=document.createElement("style");t.textContent="body {transition: opacity ease-in 0.2s; } \nbody[unresolved] {opacity: 0; display: block; overflow: hidden; position: relative; } \n";var n=document.querySelector("head");n.insertBefore(t,n.firstChild)}(window.WebComponents);(function(){var n=this,t=n._,r=Array.prototype,e=Object.prototype,u=Function.prototype,i=r.push,a=r.slice,o=r.concat,l=e.toString,c=e.hasOwnProperty,f=Array.isArray,s=Object.keys,p=u.bind,h=function(n){return n instanceof h?n:this instanceof h?void(this._wrapped=n):new h(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports._=h):n._=h,h.VERSION="1.7.0";var g=function(n,t,r){if(t===void 0)return n;switch(null==r?3:r){case 1:return function(r){return n.call(t,r)};case 2:return function(r,e){return n.call(t,r,e)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,i){return n.call(t,r,e,u,i)}}return function(){return n.apply(t,arguments)}};h.iteratee=function(n,t,r){return null==n?h.identity:h.isFunction(n)?g(n,t,r):h.isObject(n)?h.matches(n):h.property(n)},h.each=h.forEach=function(n,t,r){if(null==n)return n;t=g(t,r);var e,u=n.length;if(u===+u)for(e=0;u>e;e++)t(n[e],e,n);else{var i=h.keys(n);for(e=0,u=i.length;u>e;e++)t(n[i[e]],i[e],n)}return n},h.map=h.collect=function(n,t,r){if(null==n)return[];t=h.iteratee(t,r);for(var e,u=n.length!==+n.length&&h.keys(n),i=(u||n).length,a=Array(i),o=0;i>o;o++)e=u?u[o]:o,a[o]=t(n[e],e,n);return a};var v="Reduce of empty array with no initial value";h.reduce=h.foldl=h.inject=function(n,t,r,e){null==n&&(n=[]),t=g(t,e,4);var u,i=n.length!==+n.length&&h.keys(n),a=(i||n).length,o=0;if(arguments.length<3){if(!a)throw new TypeError(v);r=n[i?i[o++]:o++]}for(;a>o;o++)u=i?i[o]:o,r=t(r,n[u],u,n);return r},h.reduceRight=h.foldr=function(n,t,r,e){null==n&&(n=[]),t=g(t,e,4);var u,i=n.length!==+n.length&&h.keys(n),a=(i||n).length;if(arguments.length<3){if(!a)throw new TypeError(v);r=n[i?i[--a]:--a]}for(;a--;)u=i?i[a]:a,r=t(r,n[u],u,n);return r},h.find=h.detect=function(n,t,r){var e;return t=h.iteratee(t,r),h.some(n,function(n,r,u){return t(n,r,u)?(e=n,!0):void 0}),e},h.filter=h.select=function(n,t,r){var e=[];return null==n?e:(t=h.iteratee(t,r),h.each(n,function(n,r,u){t(n,r,u)&&e.push(n)}),e)},h.reject=function(n,t,r){return h.filter(n,h.negate(h.iteratee(t)),r)},h.every=h.all=function(n,t,r){if(null==n)return!0;t=h.iteratee(t,r);var e,u,i=n.length!==+n.length&&h.keys(n),a=(i||n).length;for(e=0;a>e;e++)if(u=i?i[e]:e,!t(n[u],u,n))return!1;return!0},h.some=h.any=function(n,t,r){if(null==n)return!1;t=h.iteratee(t,r);var e,u,i=n.length!==+n.length&&h.keys(n),a=(i||n).length;for(e=0;a>e;e++)if(u=i?i[e]:e,t(n[u],u,n))return!0;return!1},h.contains=h.include=function(n,t){return null==n?!1:(n.length!==+n.length&&(n=h.values(n)),h.indexOf(n,t)>=0)},h.invoke=function(n,t){var r=a.call(arguments,2),e=h.isFunction(t);return h.map(n,function(n){return(e?t:n[t]).apply(n,r)})},h.pluck=function(n,t){return h.map(n,h.property(t))},h.where=function(n,t){return h.filter(n,h.matches(t))},h.findWhere=function(n,t){return h.find(n,h.matches(t))},h.max=function(n,t,r){var e,u,i=-1/0,a=-1/0;if(null==t&&null!=n){n=n.length===+n.length?n:h.values(n);for(var o=0,l=n.length;l>o;o++)e=n[o],e>i&&(i=e)}else t=h.iteratee(t,r),h.each(n,function(n,r,e){u=t(n,r,e),(u>a||u===-1/0&&i===-1/0)&&(i=n,a=u)});return i},h.min=function(n,t,r){var e,u,i=1/0,a=1/0;if(null==t&&null!=n){n=n.length===+n.length?n:h.values(n);for(var o=0,l=n.length;l>o;o++)e=n[o],i>e&&(i=e)}else t=h.iteratee(t,r),h.each(n,function(n,r,e){u=t(n,r,e),(a>u||1/0===u&&1/0===i)&&(i=n,a=u)});return i},h.shuffle=function(n){for(var t,r=n&&n.length===+n.length?n:h.values(n),e=r.length,u=Array(e),i=0;e>i;i++)t=h.random(0,i),t!==i&&(u[i]=u[t]),u[t]=r[i];return u},h.sample=function(n,t,r){return null==t||r?(n.length!==+n.length&&(n=h.values(n)),n[h.random(n.length-1)]):h.shuffle(n).slice(0,Math.max(0,t))},h.sortBy=function(n,t,r){return t=h.iteratee(t,r),h.pluck(h.map(n,function(n,r,e){return{value:n,index:r,criteria:t(n,r,e)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index-t.index}),"value")};var m=function(n){return function(t,r,e){var u={};return r=h.iteratee(r,e),h.each(t,function(e,i){var a=r(e,i,t);n(u,e,a)}),u}};h.groupBy=m(function(n,t,r){h.has(n,r)?n[r].push(t):n[r]=[t]}),h.indexBy=m(function(n,t,r){n[r]=t}),h.countBy=m(function(n,t,r){h.has(n,r)?n[r]++:n[r]=1}),h.sortedIndex=function(n,t,r,e){r=h.iteratee(r,e,1);for(var u=r(t),i=0,a=n.length;a>i;){var o=i+a>>>1;r(n[o])<u?i=o+1:a=o}return i},h.toArray=function(n){return n?h.isArray(n)?a.call(n):n.length===+n.length?h.map(n,h.identity):h.values(n):[]},h.size=function(n){return null==n?0:n.length===+n.length?n.length:h.keys(n).length},h.partition=function(n,t,r){t=h.iteratee(t,r);var e=[],u=[];return h.each(n,function(n,r,i){(t(n,r,i)?e:u).push(n)}),[e,u]},h.first=h.head=h.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:0>t?[]:a.call(n,0,t)},h.initial=function(n,t,r){return a.call(n,0,Math.max(0,n.length-(null==t||r?1:t)))},h.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:a.call(n,Math.max(n.length-t,0))},h.rest=h.tail=h.drop=function(n,t,r){return a.call(n,null==t||r?1:t)},h.compact=function(n){return h.filter(n,h.identity)};var y=function(n,t,r,e){if(t&&h.every(n,h.isArray))return o.apply(e,n);for(var u=0,a=n.length;a>u;u++){var l=n[u];h.isArray(l)||h.isArguments(l)?t?i.apply(e,l):y(l,t,r,e):r||e.push(l)}return e};h.flatten=function(n,t){return y(n,t,!1,[])},h.without=function(n){return h.difference(n,a.call(arguments,1))},h.uniq=h.unique=function(n,t,r,e){if(null==n)return[];h.isBoolean(t)||(e=r,r=t,t=!1),null!=r&&(r=h.iteratee(r,e));for(var u=[],i=[],a=0,o=n.length;o>a;a++){var l=n[a];if(t)a&&i===l||u.push(l),i=l;else if(r){var c=r(l,a,n);h.indexOf(i,c)<0&&(i.push(c),u.push(l))}else h.indexOf(u,l)<0&&u.push(l)}return u},h.union=function(){return h.uniq(y(arguments,!0,!0,[]))},h.intersection=function(n){if(null==n)return[];for(var t=[],r=arguments.length,e=0,u=n.length;u>e;e++){var i=n[e];if(!h.contains(t,i)){for(var a=1;r>a&&h.contains(arguments[a],i);a++);a===r&&t.push(i)}}return t},h.difference=function(n){var t=y(a.call(arguments,1),!0,!0,[]);return h.filter(n,function(n){return!h.contains(t,n)})},h.zip=function(n){if(null==n)return[];for(var t=h.max(arguments,"length").length,r=Array(t),e=0;t>e;e++)r[e]=h.pluck(arguments,e);return r},h.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},h.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=h.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}for(;u>e;e++)if(n[e]===t)return e;return-1},h.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=n.length;for("number"==typeof r&&(e=0>r?e+r+1:Math.min(e,r+1));--e>=0;)if(n[e]===t)return e;return-1},h.range=function(n,t,r){arguments.length<=1&&(t=n||0,n=0),r=r||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=Array(e),i=0;e>i;i++,n+=r)u[i]=n;return u};var d=function(){};h.bind=function(n,t){var r,e;if(p&&n.bind===p)return p.apply(n,a.call(arguments,1));if(!h.isFunction(n))throw new TypeError("Bind must be called on a function");return r=a.call(arguments,2),e=function(){if(!(this instanceof e))return n.apply(t,r.concat(a.call(arguments)));d.prototype=n.prototype;var u=new d;d.prototype=null;var i=n.apply(u,r.concat(a.call(arguments)));return h.isObject(i)?i:u}},h.partial=function(n){var t=a.call(arguments,1);return function(){for(var r=0,e=t.slice(),u=0,i=e.length;i>u;u++)e[u]===h&&(e[u]=arguments[r++]);for(;r<arguments.length;)e.push(arguments[r++]);return n.apply(this,e)}},h.bindAll=function(n){var t,r,e=arguments.length;if(1>=e)throw new Error("bindAll must be passed function names");for(t=1;e>t;t++)r=arguments[t],n[r]=h.bind(n[r],n);return n},h.memoize=function(n,t){var r=function(e){var u=r.cache,i=t?t.apply(this,arguments):e;return h.has(u,i)||(u[i]=n.apply(this,arguments)),u[i]};return r.cache={},r},h.delay=function(n,t){var r=a.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},h.defer=function(n){return h.delay.apply(h,[n,1].concat(a.call(arguments,1)))},h.throttle=function(n,t,r){var e,u,i,a=null,o=0;r||(r={});var l=function(){o=r.leading===!1?0:h.now(),a=null,i=n.apply(e,u),a||(e=u=null)};return function(){var c=h.now();o||r.leading!==!1||(o=c);var f=t-(c-o);return e=this,u=arguments,0>=f||f>t?(clearTimeout(a),a=null,o=c,i=n.apply(e,u),a||(e=u=null)):a||r.trailing===!1||(a=setTimeout(l,f)),i}},h.debounce=function(n,t,r){var e,u,i,a,o,l=function(){var c=h.now()-a;t>c&&c>0?e=setTimeout(l,t-c):(e=null,r||(o=n.apply(i,u),e||(i=u=null)))};return function(){i=this,u=arguments,a=h.now();var c=r&&!e;return e||(e=setTimeout(l,t)),c&&(o=n.apply(i,u),i=u=null),o}},h.wrap=function(n,t){return h.partial(t,n)},h.negate=function(n){return function(){return!n.apply(this,arguments)}},h.compose=function(){var n=arguments,t=n.length-1;return function(){for(var r=t,e=n[t].apply(this,arguments);r--;)e=n[r].call(this,e);return e}},h.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},h.before=function(n,t){var r;return function(){return--n>0?r=t.apply(this,arguments):t=null,r}},h.once=h.partial(h.before,2),h.keys=function(n){if(!h.isObject(n))return[];if(s)return s(n);var t=[];for(var r in n)h.has(n,r)&&t.push(r);return t},h.values=function(n){for(var t=h.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=n[t[u]];return e},h.pairs=function(n){for(var t=h.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=[t[u],n[t[u]]];return e},h.invert=function(n){for(var t={},r=h.keys(n),e=0,u=r.length;u>e;e++)t[n[r[e]]]=r[e];return t},h.functions=h.methods=function(n){var t=[];for(var r in n)h.isFunction(n[r])&&t.push(r);return t.sort()},h.extend=function(n){if(!h.isObject(n))return n;for(var t,r,e=1,u=arguments.length;u>e;e++){t=arguments[e];for(r in t)c.call(t,r)&&(n[r]=t[r])}return n},h.pick=function(n,t,r){var e,u={};if(null==n)return u;if(h.isFunction(t)){t=g(t,r);for(e in n){var i=n[e];t(i,e,n)&&(u[e]=i)}}else{var l=o.apply([],a.call(arguments,1));n=new Object(n);for(var c=0,f=l.length;f>c;c++)e=l[c],e in n&&(u[e]=n[e])}return u},h.omit=function(n,t,r){if(h.isFunction(t))t=h.negate(t);else{var e=h.map(o.apply([],a.call(arguments,1)),String);t=function(n,t){return!h.contains(e,t)}}return h.pick(n,t,r)},h.defaults=function(n){if(!h.isObject(n))return n;for(var t=1,r=arguments.length;r>t;t++){var e=arguments[t];for(var u in e)n[u]===void 0&&(n[u]=e[u])}return n},h.clone=function(n){return h.isObject(n)?h.isArray(n)?n.slice():h.extend({},n):n},h.tap=function(n,t){return t(n),n};var b=function(n,t,r,e){if(n===t)return 0!==n||1/n===1/t;if(null==n||null==t)return n===t;n instanceof h&&(n=n._wrapped),t instanceof h&&(t=t._wrapped);var u=l.call(n);if(u!==l.call(t))return!1;switch(u){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!==+n?+t!==+t:0===+n?1/+n===1/t:+n===+t;case"[object Date]":case"[object Boolean]":return+n===+t}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]===n)return e[i]===t;var a=n.constructor,o=t.constructor;if(a!==o&&"constructor"in n&&"constructor"in t&&!(h.isFunction(a)&&a instanceof a&&h.isFunction(o)&&o instanceof o))return!1;r.push(n),e.push(t);var c,f;if("[object Array]"===u){if(c=n.length,f=c===t.length)for(;c--&&(f=b(n[c],t[c],r,e)););}else{var s,p=h.keys(n);if(c=p.length,f=h.keys(t).length===c)for(;c--&&(s=p[c],f=h.has(t,s)&&b(n[s],t[s],r,e)););}return r.pop(),e.pop(),f};h.isEqual=function(n,t){return b(n,t,[],[])},h.isEmpty=function(n){if(null==n)return!0;if(h.isArray(n)||h.isString(n)||h.isArguments(n))return 0===n.length;for(var t in n)if(h.has(n,t))return!1;return!0},h.isElement=function(n){return!(!n||1!==n.nodeType)},h.isArray=f||function(n){return"[object Array]"===l.call(n)},h.isObject=function(n){var t=typeof n;return"function"===t||"object"===t&&!!n},h.each(["Arguments","Function","String","Number","Date","RegExp"],function(n){h["is"+n]=function(t){return l.call(t)==="[object "+n+"]"}}),h.isArguments(arguments)||(h.isArguments=function(n){return h.has(n,"callee")}),"function"!=typeof/./&&(h.isFunction=function(n){return"function"==typeof n||!1}),h.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},h.isNaN=function(n){return h.isNumber(n)&&n!==+n},h.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"===l.call(n)},h.isNull=function(n){return null===n},h.isUndefined=function(n){return n===void 0},h.has=function(n,t){return null!=n&&c.call(n,t)},h.noConflict=function(){return n._=t,this},h.identity=function(n){return n},h.constant=function(n){return function(){return n}},h.noop=function(){},h.property=function(n){return function(t){return t[n]}},h.matches=function(n){var t=h.pairs(n),r=t.length;return function(n){if(null==n)return!r;n=new Object(n);for(var e=0;r>e;e++){var u=t[e],i=u[0];if(u[1]!==n[i]||!(i in n))return!1}return!0}},h.times=function(n,t,r){var e=Array(Math.max(0,n));t=g(t,r,1);for(var u=0;n>u;u++)e[u]=t(u);return e},h.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},h.now=Date.now||function(){return(new Date).getTime()};var _={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},w=h.invert(_),j=function(n){var t=function(t){return n[t]},r="(?:"+h.keys(n).join("|")+")",e=RegExp(r),u=RegExp(r,"g");return function(n){return n=null==n?"":""+n,e.test(n)?n.replace(u,t):n}};h.escape=j(_),h.unescape=j(w),h.result=function(n,t){if(null==n)return void 0;var r=n[t];return h.isFunction(r)?n[t]():r};var x=0;h.uniqueId=function(n){var t=++x+"";return n?n+t:t},h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var A=/(.)^/,k={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},O=/\\|'|\r|\n|\u2028|\u2029/g,F=function(n){return"\\"+k[n]};h.template=function(n,t,r){!t&&r&&(t=r),t=h.defaults({},t,h.templateSettings);var e=RegExp([(t.escape||A).source,(t.interpolate||A).source,(t.evaluate||A).source].join("|")+"|$","g"),u=0,i="__p+='";n.replace(e,function(t,r,e,a,o){return i+=n.slice(u,o).replace(O,F),u=o+t.length,r?i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":e?i+="'+\n((__t=("+e+"))==null?'':__t)+\n'":a&&(i+="';\n"+a+"\n__p+='"),t}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var a=new Function(t.variable||"obj","_",i)}catch(o){throw o.source=i,o}var l=function(n){return a.call(this,n,h)},c=t.variable||"obj";return l.source="function("+c+"){\n"+i+"}",l},h.chain=function(n){var t=h(n);return t._chain=!0,t};var E=function(n){return this._chain?h(n).chain():n};h.mixin=function(n){h.each(h.functions(n),function(t){var r=h[t]=n[t];h.prototype[t]=function(){var n=[this._wrapped];return i.apply(n,arguments),E.call(this,r.apply(h,n))}})},h.mixin(h),h.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=r[n];h.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==n&&"splice"!==n||0!==r.length||delete r[0],E.call(this,r)}}),h.each(["concat","join","slice"],function(n){var t=r[n];h.prototype[n]=function(){return E.call(this,t.apply(this._wrapped,arguments))}}),h.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return h})}).call(this);(function(root,factory){if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(_,$,exports){root.Backbone=factory(root,exports,_,$)})}else if(typeof exports!=="undefined"){var _=require("underscore");factory(root,exports,_)}else{root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender||root.$)}})(this,function(root,Backbone,_,$){var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;Backbone.VERSION="1.1.2";Backbone.$=$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments)});once._callback=callback;return this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context){this._events=void 0;return this}names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context){retain.push(ev)}}}if(!retain.length)delete this._events[name]}}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;if(!callback&&typeof name==="object")callback=this;if(obj)(listeningTo={})[obj._listenId]=obj;for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);if(remove||_.isEmpty(obj._events))delete this._listeningTo[id]}return this}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==="object"){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest))}return false}if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest))}return false}return true};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);return}};var listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={});var id=obj._listenId||(obj._listenId=_.uniqueId("l"));listeningTo[id]=obj;if(!callback&&typeof name==="object")callback=this;obj[implementation](name,callback,this);return this}});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId("c");this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,"defaults"));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return this.get(attr)!=null},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={}}current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val}else{delete this.changed[attr]}unset?delete current[attr]:current[attr]=val}if(!silent){if(changes.length)this._pending=options;for(var i=0,l=changes.length;i<l;i++){this.trigger("change:"+changes[i],this,current[changes[i]],options)}}if(changing)return this;if(!silent){while(this._pending){options=this._pending;this._pending=false;this.trigger("change",this,options)}}this._pending=false;this._changing=false;return this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}))},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],val=diff[attr]))continue;(changed||(changed={}))[attr]=val}return changed},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);return this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options=_.extend({validate:true},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return false}else{if(!this._validate(attrs,options))return false}if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs)}if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false}if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);method=this.isNew()?"create":options.patch?"patch":"update";if(method==="patch")options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger("destroy",model,model.collection,options)};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger("sync",model,resp,options)};if(this.isNew()){options.success();return false}wrapError(this,options);var xhr=this.sync("delete",this,options);if(!options.wait)destroy();return xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(this.isNew())return base;return base.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},
parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger("invalid",this,error,_.extend(options,{validationError:error}));return false}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options))};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions))},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=models[i]=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}this._removeReference(model,options)}return singular?models[0]:models},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse)models=this.parse(models,options);var singular=!_.isArray(models);models=singular?models?[models]:[]:_.clone(models);var i,l,id,model,attrs,existing,sort;var at=options.at;var targetModel=this.model;var sortable=this.comparator&&at==null&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;for(i=0,l=models.length;i<l;i++){attrs=models[i]||{};if(attrs instanceof Model){id=model=attrs}else{id=attrs[targetModel.prototype.idAttribute||"id"]}if(existing=this.get(id)){if(remove)modelMap[existing.cid]=true;if(merge){attrs=attrs===model?model.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true}models[i]=existing}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);this._addReference(model,options)}model=existing||model;if(order&&(model.isNew()||!modelMap[model.id]))order.push(model);modelMap[model.id]=true}if(remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model)}if(toRemove.length)this.remove(toRemove,options)}if(toAdd.length||order&&order.length){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(i=0,l=toAdd.length;i<l;i++){this.models.splice(at+i,0,toAdd[i])}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;i<l;i++){this.models.push(orderedModels[i])}}}if(sort)this.sort({silent:true});if(!options.silent){for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger("add",model,this,options)}if(sort||order&&order.length)this.trigger("sort",this,options)}return singular?models[0]:models},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i],options)}options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);this.remove(model,options);return model},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){if(obj==null)return void 0;return this._byId[obj]||this._byId[obj.id]||this._byId[obj.cid]},at:function(index){return this.models[index]},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?"find":"filter"](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false}return true})},findWhere:function(attrs){return this.where(attrs,true)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(_.bind(this.comparator,this))}if(!options.silent)this.trigger("sort",this,options);return this},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger("sync",collection,resp,options)};wrapError(this,options);return this.sync("read",this,options)},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp){if(options.wait)collection.add(model,options);if(success)success(model,resp,options)};model.save(null,options);return model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model)return attrs;options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger("invalid",this,model.validationError,options);return false},_addReference:function(model,options){this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;if(!model.collection)model.collection=this;model.on("all",this._onModelEvent,this)},_removeReference:function(model,options){if(this===model.collection)delete model.collection;model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if((event==="add"||event==="remove")&&collection!==this)return;if(event==="destroy")this.remove(model,options);if(model&&event==="change:"+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model}this.trigger.apply(this,arguments)}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy","indexBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view");options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this},delegateEvents:function(events){if(!(events||(events=_.result(this,"events"))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+=".delegateEvents"+this.cid;if(selector===""){this.$el.on(eventName,method)}else{this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,"attributes"));if(this.id)attrs.id=_.result(this,"id");if(this.className)attrs["class"]=_.result(this,"className");var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,false)}else{this.setElement(_.result(this,"el"),false)}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(!options.url){params.url=_.result(model,"url")||urlError()}if(options.data==null&&model&&(method==="create"||method==="update"||method==="patch")){params.contentType="application/json";params.data=JSON.stringify(options.attrs||model.toJSON(options))}if(options.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(options.emulateHTTP&&(type==="PUT"||type==="DELETE"||type==="PATCH")){params.type="POST";if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type);if(beforeSend)return beforeSend.apply(this,arguments)}}if(params.type!=="GET"&&!options.emulateJSON){params.processData=false}if(params.type==="PATCH"&&noXhrPatch){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger("request",model,xhr,options);return xhr};var noXhrPatch=typeof window!=="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var methodMap={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name=""}if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);router.execute(callback,args);router.trigger.apply(router,["route:"+name].concat(args));router.trigger("route",name,args);Backbone.history.trigger("route",router,name,args)});return this},execute:function(callback,args){if(callback)callback.apply(this,args)},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,"routes");var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)");return new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){if(i===params.length-1)return param||null;return param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;var pathStripper=/#.*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=decodeURI(this.location.pathname+this.location.search);var root=this.root.replace(trailingSlash,"");if(!fragment.indexOf(root))fragment=fragment.slice(root.length)}else{fragment=this.getHash()}}return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:"/"},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);this.root=("/"+this.root+"/").replace(rootStripper,"/");if(oldIE&&this._wantsHashChange){var frame=Backbone.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=frame.hide().appendTo("body")[0].contentWindow;this.navigate(fragment)}if(this._hasPushState){Backbone.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!oldIE){Backbone.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=fragment;var loc=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){this.fragment=this.getFragment(null,true);this.location.replace(this.root+"#"+this.fragment);return true}else if(this._hasPushState&&this.atRoot()&&loc.hash){this.fragment=this.getHash().replace(routeStripper,"");this.history.replaceState({},document.title,this.root+this.fragment)}}if(!this.options.silent)return this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);if(this._checkUrlInterval)clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe))}if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()},loadUrl:function(fragment){fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}})},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};var url=this.root+(fragment=this.getFragment(fragment||""));fragment=fragment.replace(pathStripper,"");if(this.fragment===fragment)return;this.fragment=fragment;if(fragment===""&&url!=="/")url=url.slice(0,-1);if(this._hasPushState){this.history[options.replace?"replaceState":"pushState"]({},document.title,url)}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace)}}else{return this.location.assign(url)}if(options.trigger)return this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else{location.hash="#"+fragment}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,"constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger("error",model,resp,options)}};return Backbone});!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l="1.11.3",m=function(a,b){return new m.fn.init(a,b)},n=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,o=/^-ms-/,p=/-([\da-z])/gi,q=function(a,b){return b.toUpperCase()};m.fn=m.prototype={jquery:l,constructor:m,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=m.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return m.each(this,a,b)},map:function(a){return this.pushStack(m.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},m.extend=m.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||m.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(m.isPlainObject(c)||(b=m.isArray(c)))?(b?(b=!1,f=a&&m.isArray(a)?a:[]):f=a&&m.isPlainObject(a)?a:{},g[d]=m.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},m.extend({expando:"jQuery"+(l+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===m.type(a)},isArray:Array.isArray||function(a){return"array"===m.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!m.isArray(a)&&a-parseFloat(a)+1>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==m.type(a)||a.nodeType||m.isWindow(a))return!1;try{if(a.constructor&&!j.call(a,"constructor")&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(k.ownLast)for(b in a)return j.call(a,b);for(b in a);return void 0===b||j.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(b){b&&m.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(o,"ms-").replace(p,q)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=r(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(n,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(r(Object(a))?m.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(g)return g.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=r(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(f=a[b],b=a,a=f),m.isFunction(a)?(c=d.call(arguments,2),e=function(){return a.apply(b||this,c.concat(d.call(arguments)))},e.guid=a.guid=a.guid||m.guid++,e):void 0},now:function(){return+new Date},support:k}),m.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function r(a){var b="length"in a&&a.length,c=m.type(a);return"function"===c||m.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var s=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N=M.replace("w","w#"),O="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+N+"))|)"+L+"*\\]",P=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+O+")*)|.*)\\)|)",Q=new RegExp(L+"+","g"),R=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),S=new RegExp("^"+L+"*,"+L+"*"),T=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),U=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),V=new RegExp(P),W=new RegExp("^"+N+"$"),X={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+O),PSEUDO:new RegExp("^"+P),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,aa=/[+~]/,ba=/'|\\/g,ca=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),da=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},ea=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(fa){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function ga(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],k=b.nodeType,"string"!=typeof a||!a||1!==k&&9!==k&&11!==k)return d;if(!e&&p){if(11!==k&&(f=_.exec(a)))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return H.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName)return H.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=1!==k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute("id"))?s=r.replace(ba,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;while(l--)o[l]=s+ra(o[l]);w=aa.test(a)&&pa(b.parentNode)||b,x=o.join(",")}if(x)try{return H.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function ha(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ia(a){return a[u]=!0,a}function ja(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ka(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function la(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function na(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function oa(a){return ia(function(b){return b=+b,ia(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function pa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=ga.support={},f=ga.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=ga.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=g.documentElement,e=g.defaultView,e&&e!==e.top&&(e.addEventListener?e.addEventListener("unload",ea,!1):e.attachEvent&&e.attachEvent("onunload",ea)),p=!f(g),c.attributes=ja(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ja(function(a){return a.appendChild(g.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(g.getElementsByClassName),c.getById=ja(function(a){return o.appendChild(a).id=u,!g.getElementsByName||!g.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ca,da);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ca,da);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(g.querySelectorAll))&&(ja(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\f]' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ja(function(a){var b=g.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ja(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",P)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===g||a.ownerDocument===v&&t(v,a)?-1:b===g||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,h=[a],i=[b];if(!e||!f)return a===g?-1:b===g?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return la(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)i.unshift(c);while(h[d]===i[d])d++;return d?la(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},g):n},ga.matches=function(a,b){return ga(a,null,null,b)},ga.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return ga(b,n,null,[a]).length>0},ga.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},ga.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},ga.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},ga.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=ga.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=ga.selectors={cacheLength:50,createPseudo:ia,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ca,da),a[3]=(a[3]||a[4]||a[5]||"").replace(ca,da),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||ga.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&ga.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2]
;return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ca,da).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=ga.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(Q," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||ga.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ia(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ia(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?ia(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ia(function(a){return function(b){return ga(a,b).length>0}}),contains:ia(function(a){return a=a.replace(ca,da),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ia(function(a){return W.test(a||"")||ga.error("unsupported lang: "+a),a=a.replace(ca,da).toLowerCase(),function(b){var c;do{if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-")}while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:oa(function(){return[0]}),last:oa(function(a,b){return[b-1]}),eq:oa(function(a,b,c){return[0>c?c+b:c]}),even:oa(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:oa(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:oa(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:oa(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=ma(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=na(b);function qa(){}qa.prototype=d.filters=d.pseudos,d.setFilters=new qa,g=ga.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?ga.error(a):z(a,i).slice(0)};function ra(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function sa(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function ta(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ua(a,b,c){for(var d=0,e=b.length;e>d;d++)ga(a,b[d],c);return c}function va(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function wa(a,b,c,d,e,f){return d&&!d[u]&&(d=wa(d)),e&&!e[u]&&(e=wa(e,f)),ia(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ua(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:va(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=va(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=va(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function xa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=sa(function(a){return a===b},h,!0),l=sa(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[sa(ta(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return wa(i>1&&ta(m),i>1&&ra(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&xa(a.slice(i,e)),f>e&&xa(a=a.slice(e)),f>e&&ra(a))}m.push(c)}return ta(m)}function ya(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++])if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++])o(r,s,g,h);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=F.call(i));s=va(s)}H.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&ga.uniqueSort(i)}return k&&(w=v,j=t),r};return c?ia(f):f}return h=ga.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=xa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,ya(e,d)),f.selector=a}return f},i=ga.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ca,da),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ca,da),aa.test(j[0].type)&&pa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&ra(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,aa.test(a)&&pa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ja(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ja(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ka("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ja(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ka("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ja(function(a){return null==a.getAttribute("disabled")})||ka(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),ga}(a);m.find=s,m.expr=s.selectors,m.expr[":"]=m.expr.pseudos,m.unique=s.uniqueSort,m.text=s.getText,m.isXMLDoc=s.isXML,m.contains=s.contains;var t=m.expr.match.needsContext,u=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,v=/^.[^:#\[\.,]*$/;function w(a,b,c){if(m.isFunction(b))return m.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return m.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(v.test(b))return m.filter(b,a,c);b=m.filter(b,a)}return m.grep(a,function(a){return m.inArray(a,b)>=0!==c})}m.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?m.find.matchesSelector(d,a)?[d]:[]:m.find.matches(a,m.grep(b,function(a){return 1===a.nodeType}))},m.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(m(a).filter(function(){for(b=0;e>b;b++)if(m.contains(d[b],this))return!0}));for(b=0;e>b;b++)m.find(a,d[b],c);return c=this.pushStack(e>1?m.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(w(this,a||[],!1))},not:function(a){return this.pushStack(w(this,a||[],!0))},is:function(a){return!!w(this,"string"==typeof a&&t.test(a)?m(a):a||[],!1).length}});var x,y=a.document,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=m.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||x).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof m?b[0]:b,m.merge(this,m.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:y,!0)),u.test(c[1])&&m.isPlainObject(b))for(c in b)m.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}if(d=y.getElementById(c[2]),d&&d.parentNode){if(d.id!==c[2])return x.find(a);this.length=1,this[0]=d}return this.context=y,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):m.isFunction(a)?"undefined"!=typeof x.ready?x.ready(a):a(m):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),m.makeArray(a,this))};A.prototype=m.fn,x=m(y);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};m.extend({dir:function(a,b,c){var d=[],e=a[b];while(e&&9!==e.nodeType&&(void 0===c||1!==e.nodeType||!m(e).is(c)))1===e.nodeType&&d.push(e),e=e[b];return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),m.fn.extend({has:function(a){var b,c=m(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(m.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=t.test(a)||"string"!=typeof a?m(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&m.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?m.unique(f):f)},index:function(a){return a?"string"==typeof a?m.inArray(this[0],m(a)):m.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(m.unique(m.merge(this.get(),m(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){do{a=a[b]}while(a&&1!==a.nodeType);return a}m.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return m.dir(a,"parentNode")},parentsUntil:function(a,b,c){return m.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return m.dir(a,"nextSibling")},prevAll:function(a){return m.dir(a,"previousSibling")},nextUntil:function(a,b,c){return m.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return m.dir(a,"previousSibling",c)},siblings:function(a){return m.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return m.sibling(a.firstChild)},contents:function(a){return m.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:m.merge([],a.childNodes)}},function(a,b){m.fn[a]=function(c,d){var e=m.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=m.filter(d,e)),this.length>1&&(C[a]||(e=m.unique(e)),B.test(a)&&(e=e.reverse())),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return m.each(a.match(E)||[],function(a,c){b[c]=!0}),b}m.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):m.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(c=a.memory&&l,d=!0,f=g||0,g=0,e=h.length,b=!0;h&&e>f;f++)if(h[f].apply(l[0],l[1])===!1&&a.stopOnFalse){c=!1;break}b=!1,h&&(i?i.length&&j(i.shift()):c?h=[]:k.disable())},k={add:function(){if(h){var d=h.length;!function f(b){m.each(b,function(b,c){var d=m.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),b?e=h.length:c&&(g=d,j(c))}return this},remove:function(){return h&&m.each(arguments,function(a,c){var d;while((d=m.inArray(c,h,d))>-1)h.splice(d,1),b&&(e>=d&&e--,f>=d&&f--)}),this},has:function(a){return a?m.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],e=0,this},disable:function(){return h=i=c=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,c||k.disable(),this},locked:function(){return!i},fireWith:function(a,c){return!h||d&&!i||(c=c||[],c=[a,c.slice?c.slice():c],b?i.push(c):j(c)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},m.extend({Deferred:function(a){var b=[["resolve","done",m.Callbacks("once memory"),"resolved"],["reject","fail",m.Callbacks("once memory"),"rejected"],["notify","progress",m.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return m.Deferred(function(c){m.each(b,function(b,f){var g=m.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&m.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?m.extend(a,d):d}},e={};return d.pipe=d.then,m.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&m.isFunction(a.promise)?e:0,g=1===f?a:m.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&m.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;m.fn.ready=function(a){return m.ready.promise().done(a),this},m.extend({isReady:!1,readyWait:1,holdReady:function(a){a?m.readyWait++:m.ready(!0)},ready:function(a){if(a===!0?!--m.readyWait:!m.isReady){if(!y.body)return setTimeout(m.ready);m.isReady=!0,a!==!0&&--m.readyWait>0||(H.resolveWith(y,[m]),m.fn.triggerHandler&&(m(y).triggerHandler("ready"),m(y).off("ready")))}}});function I(){y.addEventListener?(y.removeEventListener("DOMContentLoaded",J,!1),a.removeEventListener("load",J,!1)):(y.detachEvent("onreadystatechange",J),a.detachEvent("onload",J))}function J(){(y.addEventListener||"load"===event.type||"complete"===y.readyState)&&(I(),m.ready())}m.ready.promise=function(b){if(!H)if(H=m.Deferred(),"complete"===y.readyState)setTimeout(m.ready);else if(y.addEventListener)y.addEventListener("DOMContentLoaded",J,!1),a.addEventListener("load",J,!1);else{y.attachEvent("onreadystatechange",J),a.attachEvent("onload",J);var c=!1;try{c=null==a.frameElement&&y.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!m.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}I(),m.ready()}}()}return H.promise(b)};var K="undefined",L;for(L in m(k))break;k.ownLast="0"!==L,k.inlineBlockNeedsLayout=!1,m(function(){var a,b,c,d;c=y.getElementsByTagName("body")[0],c&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",k.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(d))}),function(){var a=y.createElement("div");if(null==k.deleteExpando){k.deleteExpando=!0;try{delete a.test}catch(b){k.deleteExpando=!1}}a=null}(),m.acceptData=function(a){var b=m.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b};var M=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,N=/([A-Z])/g;function O(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(N,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:M.test(c)?m.parseJSON(c):c}catch(e){}m.data(a,b,c)}else c=void 0}return c}function P(a){var b;for(b in a)if(("data"!==b||!m.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function Q(a,b,d,e){if(m.acceptData(a)){var f,g,h=m.expando,i=a.nodeType,j=i?m.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||m.guid++:h),j[k]||(j[k]=i?{}:{toJSON:m.noop}),("object"==typeof b||"function"==typeof b)&&(e?j[k]=m.extend(j[k],b):j[k].data=m.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[m.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[m.camelCase(b)])):f=g,f}}function R(a,b,c){if(m.acceptData(a)){var d,e,f=a.nodeType,g=f?m.cache:a,h=f?a[m.expando]:m.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){m.isArray(b)?b=b.concat(m.map(b,m.camelCase)):b in d?b=[b]:(b=m.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!P(d):!m.isEmptyObject(d))return}(c||(delete g[h].data,P(g[h])))&&(f?m.cleanData([a],!0):k.deleteExpando||g!=g.window?delete g[h]:g[h]=null)}}}m.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?m.cache[a[m.expando]]:a[m.expando],!!a&&!P(a)},data:function(a,b,c){return Q(a,b,c)},removeData:function(a,b){return R(a,b)},_data:function(a,b,c){return Q(a,b,c,!0)},_removeData:function(a,b){return R(a,b,!0)}}),m.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=m.data(f),1===f.nodeType&&!m._data(f,"parsedAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=m.camelCase(d.slice(5)),O(f,d,e[d])));m._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){m.data(this,a)}):arguments.length>1?this.each(function(){m.data(this,a,b)}):f?O(f,a,m.data(f,a)):void 0},removeData:function(a){return this.each(function(){m.removeData(this,a)})}}),m.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=m._data(a,b),c&&(!d||m.isArray(c)?d=m._data(a,b,m.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=m.queue(a,b),d=c.length,e=c.shift(),f=m._queueHooks(a,b),g=function(){m.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return m._data(a,c)||m._data(a,c,{empty:m.Callbacks("once memory").add(function(){m._removeData(a,b+"queue"),m._removeData(a,c)})})}}),m.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?m.queue(this[0],a):void 0===b?this:this.each(function(){var c=m.queue(this,a,b);m._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&m.dequeue(this,a)})},dequeue:function(a){return this.each(function(){m.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=m.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=m._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var S=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=["Top","Right","Bottom","Left"],U=function(a,b){return a=b||a,"none"===m.css(a,"display")||!m.contains(a.ownerDocument,a)},V=m.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===m.type(c)){e=!0;for(h in c)m.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,m.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(m(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},W=/^(?:checkbox|radio)$/i;!function(){var a=y.createElement("input"),b=y.createElement("div"),c=y.createDocumentFragment();if(b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",k.leadingWhitespace=3===b.firstChild.nodeType,k.tbody=!b.getElementsByTagName("tbody").length,k.htmlSerialize=!!b.getElementsByTagName("link").length,k.html5Clone="<:nav></:nav>"!==y.createElement("nav").cloneNode(!0).outerHTML,a.type="checkbox",a.checked=!0,c.appendChild(a),k.appendChecked=a.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue,c.appendChild(b),b.innerHTML="<input type='radio' checked='checked' name='t'/>",k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,k.noCloneEvent=!0,b.attachEvent&&(b.attachEvent("onclick",function(){k.noCloneEvent=!1}),b.cloneNode(!0).click()),null==k.deleteExpando){k.deleteExpando=!0;try{delete b.test}catch(d){k.deleteExpando=!1}}}(),function(){var b,c,d=y.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(k[b+"Bubbles"]=c in a)||(d.setAttribute(c,"t"),k[b+"Bubbles"]=d.attributes[c].expando===!1);d=null}();var X=/^(?:input|select|textarea)$/i,Y=/^key/,Z=/^(?:mouse|pointer|contextmenu)|click/,$=/^(?:focusinfocus|focusoutblur)$/,_=/^([^.]*)(?:\.(.+)|)$/;function aa(){return!0}function ba(){return!1}function ca(){try{return y.activeElement}catch(a){}}m.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=m.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return typeof m===K||a&&m.event.triggered===a.type?void 0:m.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(E)||[""],h=b.length;while(h--)f=_.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=m.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=m.event.special[o]||{},l=m.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&m.expr.match.needsContext.test(e),namespace:p.join(".")},i),(n=g[o])||(n=g[o]=[],n.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?n.splice(n.delegateCount++,0,l):n.push(l),m.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m.hasData(a)&&m._data(a);if(r&&(k=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=_.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=m.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,n=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=n.length;while(f--)g=n[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(n.splice(f,1),g.selector&&n.delegateCount--,l.remove&&l.remove.call(a,g));i&&!n.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||m.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)m.event.remove(a,o+b[j],c,d,!0);m.isEmptyObject(k)&&(delete r.handle,m._removeData(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,l,n,o=[d||y],p=j.call(b,"type")?b.type:b,q=j.call(b,"namespace")?b.namespace.split("."):[];if(h=l=d=d||y,3!==d.nodeType&&8!==d.nodeType&&!$.test(p+m.event.triggered)&&(p.indexOf(".")>=0&&(q=p.split("."),p=q.shift(),q.sort()),g=p.indexOf(":")<0&&"on"+p,b=b[m.expando]?b:new m.Event(p,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=q.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:m.makeArray(c,[b]),k=m.event.special[p]||{},e||!k.trigger||k.trigger.apply(d,c)!==!1)){if(!e&&!k.noBubble&&!m.isWindow(d)){for(i=k.delegateType||p,$.test(i+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),l=h;l===(d.ownerDocument||y)&&o.push(l.defaultView||l.parentWindow||a)}n=0;while((h=o[n++])&&!b.isPropagationStopped())b.type=n>1?i:k.bindType||p,f=(m._data(h,"events")||{})[b.type]&&m._data(h,"handle"),f&&f.apply(h,c),f=g&&h[g],f&&f.apply&&m.acceptData(h)&&(b.result=f.apply(h,c),b.result===!1&&b.preventDefault());if(b.type=p,!e&&!b.isDefaultPrevented()&&(!k._default||k._default.apply(o.pop(),c)===!1)&&m.acceptData(d)&&g&&d[p]&&!m.isWindow(d)){l=d[g],l&&(d[g]=null),m.event.triggered=p;try{d[p]()}catch(r){}m.event.triggered=void 0,l&&(d[g]=l)}return b.result}},dispatch:function(a){a=m.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(m._data(this,"events")||{})[a.type]||[],k=m.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=m.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,g=0;while((e=f.handlers[g++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,c=((m.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),void 0!==c&&(a.result=c)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(e=[],f=0;h>f;f++)d=b[f],c=d.selector+" ",void 0===e[c]&&(e[c]=d.needsContext?m(c,this).index(i)>=0:m.find(c,this,null,[i]).length),e[c]&&e.push(d);e.length&&g.push({elem:i,handlers:e})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[m.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=Z.test(e)?this.mouseHooks:Y.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new m.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||y),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button,g=b.fromElement;return null==a.pageX&&null!=b.clientX&&(d=a.target.ownerDocument||y,e=d.documentElement,c=d.body,a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&g&&(a.relatedTarget=g===a.target?b.toElement:g),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ca()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===ca()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return m.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return m.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=m.extend(new m.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?m.event.trigger(e,null,b):m.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},m.removeEvent=y.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===K&&(a[d]=null),a.detachEvent(d,c))},m.Event=function(a,b){return this instanceof m.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?aa:ba):this.type=a,b&&m.extend(this,b),this.timeStamp=a&&a.timeStamp||m.now(),void(this[m.expando]=!0)):new m.Event(a,b)},m.Event.prototype={isDefaultPrevented:ba,isPropagationStopped:ba,isImmediatePropagationStopped:ba,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=aa,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=aa,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=aa,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},m.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){m.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!m.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.submitBubbles||(m.event.special.submit={setup:function(){return m.nodeName(this,"form")?!1:void m.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=m.nodeName(b,"input")||m.nodeName(b,"button")?b.form:void 0;c&&!m._data(c,"submitBubbles")&&(m.event.add(c,"submit._submit",function(a){a._submit_bubble=!0}),m._data(c,"submitBubbles",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&m.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return m.nodeName(this,"form")?!1:void m.event.remove(this,"._submit")}}),k.changeBubbles||(m.event.special.change={setup:function(){return X.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(m.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),m.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),m.event.simulate("change",this,a,!0)})),!1):void m.event.add(this,"beforeactivate._change",function(a){var b=a.target;X.test(b.nodeName)&&!m._data(b,"changeBubbles")&&(m.event.add(b,"change._change",function(a){
!this.parentNode||a.isSimulated||a.isTrigger||m.event.simulate("change",this.parentNode,a,!0)}),m._data(b,"changeBubbles",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return m.event.remove(this,"._change"),!X.test(this.nodeName)}}),k.focusinBubbles||m.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){m.event.simulate(b,a.target,m.event.fix(a),!0)};m.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=m._data(d,b);e||d.addEventListener(a,c,!0),m._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=m._data(d,b)-1;e?m._data(d,b,e):(d.removeEventListener(a,c,!0),m._removeData(d,b))}}}),m.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(f in a)this.on(f,b,c,a[f],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=ba;else if(!d)return this;return 1===e&&(g=d,d=function(a){return m().off(a),g.apply(this,arguments)},d.guid=g.guid||(g.guid=m.guid++)),this.each(function(){m.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,m(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=ba),this.each(function(){m.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){m.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?m.event.trigger(a,b,c,!0):void 0}});function da(a){var b=ea.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}var ea="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",fa=/ jQuery\d+="(?:null|\d+)"/g,ga=new RegExp("<(?:"+ea+")[\\s/>]","i"),ha=/^\s+/,ia=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ja=/<([\w:]+)/,ka=/<tbody/i,la=/<|&#?\w+;/,ma=/<(?:script|style|link)/i,na=/checked\s*(?:[^=]|=\s*.checked.)/i,oa=/^$|\/(?:java|ecma)script/i,pa=/^true\/(.*)/,qa=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ra={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:k.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},sa=da(y),ta=sa.appendChild(y.createElement("div"));ra.optgroup=ra.option,ra.tbody=ra.tfoot=ra.colgroup=ra.caption=ra.thead,ra.th=ra.td;function ua(a,b){var c,d,e=0,f=typeof a.getElementsByTagName!==K?a.getElementsByTagName(b||"*"):typeof a.querySelectorAll!==K?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||m.nodeName(d,b)?f.push(d):m.merge(f,ua(d,b));return void 0===b||b&&m.nodeName(a,b)?m.merge([a],f):f}function va(a){W.test(a.type)&&(a.defaultChecked=a.checked)}function wa(a,b){return m.nodeName(a,"table")&&m.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function xa(a){return a.type=(null!==m.find.attr(a,"type"))+"/"+a.type,a}function ya(a){var b=pa.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function za(a,b){for(var c,d=0;null!=(c=a[d]);d++)m._data(c,"globalEval",!b||m._data(b[d],"globalEval"))}function Aa(a,b){if(1===b.nodeType&&m.hasData(a)){var c,d,e,f=m._data(a),g=m._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)m.event.add(b,c,h[c][d])}g.data&&(g.data=m.extend({},g.data))}}function Ba(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!k.noCloneEvent&&b[m.expando]){e=m._data(b);for(d in e.events)m.removeEvent(b,d,e.handle);b.removeAttribute(m.expando)}"script"===c&&b.text!==a.text?(xa(b).text=a.text,ya(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),k.html5Clone&&a.innerHTML&&!m.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&W.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}m.extend({clone:function(a,b,c){var d,e,f,g,h,i=m.contains(a.ownerDocument,a);if(k.html5Clone||m.isXMLDoc(a)||!ga.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(ta.innerHTML=a.outerHTML,ta.removeChild(f=ta.firstChild)),!(k.noCloneEvent&&k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||m.isXMLDoc(a)))for(d=ua(f),h=ua(a),g=0;null!=(e=h[g]);++g)d[g]&&Ba(e,d[g]);if(b)if(c)for(h=h||ua(a),d=d||ua(f),g=0;null!=(e=h[g]);g++)Aa(e,d[g]);else Aa(a,f);return d=ua(f,"script"),d.length>0&&za(d,!i&&ua(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,l,n=a.length,o=da(b),p=[],q=0;n>q;q++)if(f=a[q],f||0===f)if("object"===m.type(f))m.merge(p,f.nodeType?[f]:f);else if(la.test(f)){h=h||o.appendChild(b.createElement("div")),i=(ja.exec(f)||["",""])[1].toLowerCase(),l=ra[i]||ra._default,h.innerHTML=l[1]+f.replace(ia,"<$1></$2>")+l[2],e=l[0];while(e--)h=h.lastChild;if(!k.leadingWhitespace&&ha.test(f)&&p.push(b.createTextNode(ha.exec(f)[0])),!k.tbody){f="table"!==i||ka.test(f)?"<table>"!==l[1]||ka.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;while(e--)m.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j)}m.merge(p,h.childNodes),h.textContent="";while(h.firstChild)h.removeChild(h.firstChild);h=o.lastChild}else p.push(b.createTextNode(f));h&&o.removeChild(h),k.appendChecked||m.grep(ua(p,"input"),va),q=0;while(f=p[q++])if((!d||-1===m.inArray(f,d))&&(g=m.contains(f.ownerDocument,f),h=ua(o.appendChild(f),"script"),g&&za(h),c)){e=0;while(f=h[e++])oa.test(f.type||"")&&c.push(f)}return h=null,o},cleanData:function(a,b){for(var d,e,f,g,h=0,i=m.expando,j=m.cache,l=k.deleteExpando,n=m.event.special;null!=(d=a[h]);h++)if((b||m.acceptData(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)n[e]?m.event.remove(d,e):m.removeEvent(d,e,g.handle);j[f]&&(delete j[f],l?delete d[i]:typeof d.removeAttribute!==K?d.removeAttribute(i):d[i]=null,c.push(f))}}}),m.fn.extend({text:function(a){return V(this,function(a){return void 0===a?m.text(this):this.empty().append((this[0]&&this[0].ownerDocument||y).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wa(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wa(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?m.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||m.cleanData(ua(c)),c.parentNode&&(b&&m.contains(c.ownerDocument,c)&&za(ua(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&m.cleanData(ua(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&m.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return m.clone(this,a,b)})},html:function(a){return V(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(fa,""):void 0;if(!("string"!=typeof a||ma.test(a)||!k.htmlSerialize&&ga.test(a)||!k.leadingWhitespace&&ha.test(a)||ra[(ja.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(ia,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(m.cleanData(ua(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,m.cleanData(ua(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,n=this,o=l-1,p=a[0],q=m.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&na.test(p))return this.each(function(c){var d=n.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(i=m.buildFragment(a,this[0].ownerDocument,!1,this),c=i.firstChild,1===i.childNodes.length&&(i=c),c)){for(g=m.map(ua(i,"script"),xa),f=g.length;l>j;j++)d=i,j!==o&&(d=m.clone(d,!0,!0),f&&m.merge(g,ua(d,"script"))),b.call(this[j],d,j);if(f)for(h=g[g.length-1].ownerDocument,m.map(g,ya),j=0;f>j;j++)d=g[j],oa.test(d.type||"")&&!m._data(d,"globalEval")&&m.contains(h,d)&&(d.src?m._evalUrl&&m._evalUrl(d.src):m.globalEval((d.text||d.textContent||d.innerHTML||"").replace(qa,"")));i=c=null}return this}}),m.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){m.fn[a]=function(a){for(var c,d=0,e=[],g=m(a),h=g.length-1;h>=d;d++)c=d===h?this:this.clone(!0),m(g[d])[b](c),f.apply(e,c.get());return this.pushStack(e)}});var Ca,Da={};function Ea(b,c){var d,e=m(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:m.css(e[0],"display");return e.detach(),f}function Fa(a){var b=y,c=Da[a];return c||(c=Ea(a,b),"none"!==c&&c||(Ca=(Ca||m("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Ca[0].contentWindow||Ca[0].contentDocument).document,b.write(),b.close(),c=Ea(a,b),Ca.detach()),Da[a]=c),c}!function(){var a;k.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,d;return c=y.getElementsByTagName("body")[0],c&&c.style?(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(y.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(d),a):void 0}}();var Ga=/^margin/,Ha=new RegExp("^("+S+")(?!px)[a-z%]+$","i"),Ia,Ja,Ka=/^(top|right|bottom|left)$/;a.getComputedStyle?(Ia=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)},Ja=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ia(a),g=c?c.getPropertyValue(b)||c[b]:void 0,c&&(""!==g||m.contains(a.ownerDocument,a)||(g=m.style(a,b)),Ha.test(g)&&Ga.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0===g?g:g+""}):y.documentElement.currentStyle&&(Ia=function(a){return a.currentStyle},Ja=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ia(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Ha.test(g)&&!Ka.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function La(a,b){return{get:function(){var c=a();if(null!=c)return c?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d,e,f,g,h;if(b=y.createElement("div"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],c=d&&d.style){c.cssText="float:left;opacity:.5",k.opacity="0.5"===c.opacity,k.cssFloat=!!c.cssFloat,b.style.backgroundClip="content-box",b.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===b.style.backgroundClip,k.boxSizing=""===c.boxSizing||""===c.MozBoxSizing||""===c.WebkitBoxSizing,m.extend(k,{reliableHiddenOffsets:function(){return null==g&&i(),g},boxSizingReliable:function(){return null==f&&i(),f},pixelPosition:function(){return null==e&&i(),e},reliableMarginRight:function(){return null==h&&i(),h}});function i(){var b,c,d,i;c=y.getElementsByTagName("body")[0],c&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),b.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",e=f=!1,h=!0,a.getComputedStyle&&(e="1%"!==(a.getComputedStyle(b,null)||{}).top,f="4px"===(a.getComputedStyle(b,null)||{width:"4px"}).width,i=b.appendChild(y.createElement("div")),i.style.cssText=b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",b.style.width="1px",h=!parseFloat((a.getComputedStyle(i,null)||{}).marginRight),b.removeChild(i)),b.innerHTML="<table><tr><td></td><td>t</td></tr></table>",i=b.getElementsByTagName("td"),i[0].style.cssText="margin:0;border:0;padding:0;display:none",g=0===i[0].offsetHeight,g&&(i[0].style.display="",i[1].style.display="none",g=0===i[0].offsetHeight),c.removeChild(d))}}}(),m.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Ma=/alpha\([^)]*\)/i,Na=/opacity\s*=\s*([^)]*)/,Oa=/^(none|table(?!-c[ea]).+)/,Pa=new RegExp("^("+S+")(.*)$","i"),Qa=new RegExp("^([+-])=("+S+")","i"),Ra={position:"absolute",visibility:"hidden",display:"block"},Sa={letterSpacing:"0",fontWeight:"400"},Ta=["Webkit","O","Moz","ms"];function Ua(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Ta.length;while(e--)if(b=Ta[e]+c,b in a)return b;return d}function Va(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=m._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&U(d)&&(f[g]=m._data(d,"olddisplay",Fa(d.nodeName)))):(e=U(d),(c&&"none"!==c||!e)&&m._data(d,"olddisplay",e?c:m.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function Wa(a,b,c){var d=Pa.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Xa(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=m.css(a,c+T[f],!0,e)),d?("content"===c&&(g-=m.css(a,"padding"+T[f],!0,e)),"margin"!==c&&(g-=m.css(a,"border"+T[f]+"Width",!0,e))):(g+=m.css(a,"padding"+T[f],!0,e),"padding"!==c&&(g+=m.css(a,"border"+T[f]+"Width",!0,e)));return g}function Ya(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ia(a),g=k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Ja(a,b,f),(0>e||null==e)&&(e=a.style[b]),Ha.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Xa(a,b,c||(g?"border":"content"),d,f)+"px"}m.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Ja(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:k.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=m.camelCase(b),i=a.style;if(b=m.cssProps[h]||(m.cssProps[h]=Ua(i,h)),g=m.cssHooks[b]||m.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=Qa.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(m.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||m.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=m.camelCase(b);return b=m.cssProps[h]||(m.cssProps[h]=Ua(a.style,h)),g=m.cssHooks[b]||m.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Ja(a,b,d)),"normal"===f&&b in Sa&&(f=Sa[b]),""===c||c?(e=parseFloat(f),c===!0||m.isNumeric(e)?e||0:f):f}}),m.each(["height","width"],function(a,b){m.cssHooks[b]={get:function(a,c,d){return c?Oa.test(m.css(a,"display"))&&0===a.offsetWidth?m.swap(a,Ra,function(){return Ya(a,b,d)}):Ya(a,b,d):void 0},set:function(a,c,d){var e=d&&Ia(a);return Wa(a,c,d?Xa(a,b,d,k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,e),e):0)}}}),k.opacity||(m.cssHooks.opacity={get:function(a,b){return Na.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=m.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===m.trim(f.replace(Ma,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Ma.test(f)?f.replace(Ma,e):f+" "+e)}}),m.cssHooks.marginRight=La(k.reliableMarginRight,function(a,b){return b?m.swap(a,{display:"inline-block"},Ja,[a,"marginRight"]):void 0}),m.each({margin:"",padding:"",border:"Width"},function(a,b){m.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+T[d]+b]=f[d]||f[d-2]||f[0];return e}},Ga.test(a)||(m.cssHooks[a+b].set=Wa)}),m.fn.extend({css:function(a,b){return V(this,function(a,b,c){var d,e,f={},g=0;if(m.isArray(b)){for(d=Ia(a),e=b.length;e>g;g++)f[b[g]]=m.css(a,b[g],!1,d);return f}return void 0!==c?m.style(a,b,c):m.css(a,b)},a,b,arguments.length>1)},show:function(){return Va(this,!0)},hide:function(){return Va(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){U(this)?m(this).show():m(this).hide()})}});function Za(a,b,c,d,e){return new Za.prototype.init(a,b,c,d,e)}m.Tween=Za,Za.prototype={constructor:Za,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(m.cssNumber[c]?"":"px")},cur:function(){var a=Za.propHooks[this.prop];return a&&a.get?a.get(this):Za.propHooks._default.get(this)},run:function(a){var b,c=Za.propHooks[this.prop];return this.options.duration?this.pos=b=m.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Za.propHooks._default.set(this),this}},Za.prototype.init.prototype=Za.prototype,Za.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=m.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){m.fx.step[a.prop]?m.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[m.cssProps[a.prop]]||m.cssHooks[a.prop])?m.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Za.propHooks.scrollTop=Za.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},m.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},m.fx=Za.prototype.init,m.fx.step={};var $a,_a,ab=/^(?:toggle|show|hide)$/,bb=new RegExp("^(?:([+-])=|)("+S+")([a-z%]*)$","i"),cb=/queueHooks$/,db=[ib],eb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=bb.exec(b),f=e&&e[3]||(m.cssNumber[a]?"":"px"),g=(m.cssNumber[a]||"px"!==f&&+d)&&bb.exec(m.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do{h=h||".5",g/=h,m.style(c.elem,a,g+f)}while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function fb(){return setTimeout(function(){$a=void 0}),$a=m.now()}function gb(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=T[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function hb(a,b,c){for(var d,e=(eb[b]||[]).concat(eb["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function ib(a,b,c){var d,e,f,g,h,i,j,l,n=this,o={},p=a.style,q=a.nodeType&&U(a),r=m._data(a,"fxshow");c.queue||(h=m._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,n.always(function(){n.always(function(){h.unqueued--,m.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=m.css(a,"display"),l="none"===j?m._data(a,"olddisplay")||Fa(a.nodeName):j,"inline"===l&&"none"===m.css(a,"float")&&(k.inlineBlockNeedsLayout&&"inline"!==Fa(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",k.shrinkWrapBlocks()||n.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],ab.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||m.style(a,d)}else j=void 0;if(m.isEmptyObject(o))"inline"===("none"===j?Fa(a.nodeName):j)&&(p.display=j);else{r?"hidden"in r&&(q=r.hidden):r=m._data(a,"fxshow",{}),f&&(r.hidden=!q),q?m(a).show():n.done(function(){m(a).hide()}),n.done(function(){var b;m._removeData(a,"fxshow");for(b in o)m.style(a,b,o[b])});for(d in o)g=hb(q?r[d]:0,d,n),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function jb(a,b){var c,d,e,f,g;for(c in a)if(d=m.camelCase(c),e=b[d],f=a[c],m.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=m.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function kb(a,b,c){var d,e,f=0,g=db.length,h=m.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=$a||fb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:m.extend({},b),opts:m.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:$a||fb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=m.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(jb(k,j.opts.specialEasing);g>f;f++)if(d=db[f].call(j,a,k,j.opts))return d;return m.map(k,hb,j),m.isFunction(j.opts.start)&&j.opts.start.call(a,j),m.fx.timer(m.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}m.Animation=m.extend(kb,{tweener:function(a,b){m.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],eb[c]=eb[c]||[],eb[c].unshift(b)},prefilter:function(a,b){b?db.unshift(a):db.push(a)}}),m.speed=function(a,b,c){var d=a&&"object"==typeof a?m.extend({},a):{complete:c||!c&&b||m.isFunction(a)&&a,duration:a,easing:c&&b||b&&!m.isFunction(b)&&b};return d.duration=m.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in m.fx.speeds?m.fx.speeds[d.duration]:m.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){m.isFunction(d.old)&&d.old.call(this),d.queue&&m.dequeue(this,d.queue)},d},m.fn.extend({fadeTo:function(a,b,c,d){return this.filter(U).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=m.isEmptyObject(a),f=m.speed(b,c,d),g=function(){var b=kb(this,m.extend({},a),f);(e||m._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=m.timers,g=m._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&cb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&m.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=m._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=m.timers,g=d?d.length:0;for(c.finish=!0,m.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),m.each(["toggle","show","hide"],function(a,b){var c=m.fn[b];m.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(gb(b,!0),a,d,e)}}),m.each({slideDown:gb("show"),slideUp:gb("hide"),slideToggle:gb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){m.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),m.timers=[],m.fx.tick=function(){var a,b=m.timers,c=0;for($a=m.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||m.fx.stop(),$a=void 0},m.fx.timer=function(a){m.timers.push(a),a()?m.fx.start():m.timers.pop()},m.fx.interval=13,m.fx.start=function(){_a||(_a=setInterval(m.fx.tick,m.fx.interval))},m.fx.stop=function(){clearInterval(_a),_a=null},m.fx.speeds={slow:600,fast:200,_default:400},m.fn.delay=function(a,b){return a=m.fx?m.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a,b,c,d,e;b=y.createElement("div"),b.setAttribute("className","t"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],c=y.createElement("select"),e=c.appendChild(y.createElement("option")),a=b.getElementsByTagName("input")[0],d.style.cssText="top:1px",k.getSetAttribute="t"!==b.className,k.style=/top/.test(d.getAttribute("style")),k.hrefNormalized="/a"===d.getAttribute("href"),k.checkOn=!!a.value,k.optSelected=e.selected,k.enctype=!!y.createElement("form").enctype,c.disabled=!0,k.optDisabled=!e.disabled,a=y.createElement("input"),a.setAttribute("value",""),k.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),k.radioValue="t"===a.value}();var lb=/\r/g;m.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=m.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,m(this).val()):a,null==e?e="":"number"==typeof e?e+="":m.isArray(e)&&(e=m.map(e,function(a){return null==a?"":a+""})),b=m.valHooks[this.type]||m.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=m.valHooks[e.type]||m.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(lb,""):null==c?"":c)}}}),m.extend({valHooks:{option:{get:function(a){var b=m.find.attr(a,"value");return null!=b?b:m.trim(m.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&m.nodeName(c.parentNode,"optgroup"))){if(b=m(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=m.makeArray(b),g=e.length;while(g--)if(d=e[g],m.inArray(m.valHooks.option.get(d),f)>=0)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),m.each(["radio","checkbox"],function(){m.valHooks[this]={set:function(a,b){return m.isArray(b)?a.checked=m.inArray(m(a).val(),b)>=0:void 0}},k.checkOn||(m.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var mb,nb,ob=m.expr.attrHandle,pb=/^(?:checked|selected)$/i,qb=k.getSetAttribute,rb=k.input;m.fn.extend({attr:function(a,b){return V(this,m.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){m.removeAttr(this,a)})}}),m.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===K?m.prop(a,b,c):(1===f&&m.isXMLDoc(a)||(b=b.toLowerCase(),d=m.attrHooks[b]||(m.expr.match.bool.test(b)?nb:mb)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=m.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void m.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=m.propFix[c]||c,m.expr.match.bool.test(c)?rb&&qb||!pb.test(c)?a[d]=!1:a[m.camelCase("default-"+c)]=a[d]=!1:m.attr(a,c,""),a.removeAttribute(qb?c:d)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&m.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),nb={set:function(a,b,c){return b===!1?m.removeAttr(a,c):rb&&qb||!pb.test(c)?a.setAttribute(!qb&&m.propFix[c]||c,c):a[m.camelCase("default-"+c)]=a[c]=!0,c}},m.each(m.expr.match.bool.source.match(/\w+/g),function(a,b){var c=ob[b]||m.find.attr;ob[b]=rb&&qb||!pb.test(b)?function(a,b,d){var e,f;return d||(f=ob[b],ob[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,ob[b]=f),e}:function(a,b,c){return c?void 0:a[m.camelCase("default-"+b)]?b.toLowerCase():null}}),rb&&qb||(m.attrHooks.value={set:function(a,b,c){return m.nodeName(a,"input")?void(a.defaultValue=b):mb&&mb.set(a,b,c)}}),qb||(mb={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},ob.id=ob.name=ob.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},m.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:mb.set},m.attrHooks.contenteditable={set:function(a,b,c){mb.set(a,""===b?!1:b,c)}},m.each(["width","height"],function(a,b){m.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),k.style||(m.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var sb=/^(?:input|select|textarea|button|object)$/i,tb=/^(?:a|area)$/i;m.fn.extend({prop:function(a,b){return V(this,m.prop,a,b,arguments.length>1)},removeProp:function(a){return a=m.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),m.extend({propFix:{for:"htmlFor",class:"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!m.isXMLDoc(a),f&&(b=m.propFix[b]||b,e=m.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=m.find.attr(a,"tabindex");return b?parseInt(b,10):sb.test(a.nodeName)||tb.test(a.nodeName)&&a.href?0:-1}}}}),k.hrefNormalized||m.each(["href","src"],function(a,b){m.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),k.optSelected||(m.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),m.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){m.propFix[this.toLowerCase()]=this}),k.enctype||(m.propFix.enctype="encoding");var ub=/[\t\r\n\f]/g;m.fn.extend({addClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j="string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).addClass(a.call(this,b,this.className))})
;if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ub," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=m.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j=0===arguments.length||"string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).removeClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ub," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?m.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(m.isFunction(a)?function(c){m(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=m(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===K||"boolean"===c)&&(this.className&&m._data(this,"__className__",this.className),this.className=this.className||a===!1?"":m._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ub," ").indexOf(b)>=0)return!0;return!1}}),m.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){m.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),m.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var vb=m.now(),wb=/\?/,xb=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;m.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=m.trim(b+"");return e&&!m.trim(e.replace(xb,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():m.error("Invalid JSON: "+b)},m.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||m.error("Invalid XML: "+b),c};var yb,zb,Ab=/#.*$/,Bb=/([?&])_=[^&]*/,Cb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Db=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Eb=/^(?:GET|HEAD)$/,Fb=/^\/\//,Gb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Hb={},Ib={},Jb="*/".concat("*");try{zb=location.href}catch(Kb){zb=y.createElement("a"),zb.href="",zb=zb.href}yb=Gb.exec(zb.toLowerCase())||[];function Lb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(m.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Mb(a,b,c,d){var e={},f=a===Ib;function g(h){var i;return e[h]=!0,m.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Nb(a,b){var c,d,e=m.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&m.extend(!0,a,c),a}function Ob(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Pb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}m.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:zb,type:"GET",isLocal:Db.test(yb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Jb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":m.parseJSON,"text xml":m.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Nb(Nb(a,m.ajaxSettings),b):Nb(m.ajaxSettings,a)},ajaxPrefilter:Lb(Hb),ajaxTransport:Lb(Ib),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=m.ajaxSetup({},b),l=k.context||k,n=k.context&&(l.nodeType||l.jquery)?m(l):m.event,o=m.Deferred(),p=m.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!j){j={};while(b=Cb.exec(f))j[b[1].toLowerCase()]=b[2]}b=j[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return i&&i.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||zb)+"").replace(Ab,"").replace(Fb,yb[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=m.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(c=Gb.exec(k.url.toLowerCase()),k.crossDomain=!(!c||c[1]===yb[1]&&c[2]===yb[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(yb[3]||("http:"===yb[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=m.param(k.data,k.traditional)),Mb(Hb,k,b,v),2===t)return v;h=m.event&&k.global,h&&0===m.active++&&m.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!Eb.test(k.type),e=k.url,k.hasContent||(k.data&&(e=k.url+=(wb.test(e)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=Bb.test(e)?e.replace(Bb,"$1_="+vb++):e+(wb.test(e)?"&":"?")+"_="+vb++)),k.ifModified&&(m.lastModified[e]&&v.setRequestHeader("If-Modified-Since",m.lastModified[e]),m.etag[e]&&v.setRequestHeader("If-None-Match",m.etag[e])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+Jb+"; q=0.01":""):k.accepts["*"]);for(d in k.headers)v.setRequestHeader(d,k.headers[d]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(d in{success:1,error:1,complete:1})v[d](k[d]);if(i=Mb(Ib,k,b,v)){v.readyState=1,h&&n.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,i.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,c,d){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),i=void 0,f=d||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,c&&(u=Ob(k,v,c)),u=Pb(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(m.lastModified[e]=w),w=v.getResponseHeader("etag"),w&&(m.etag[e]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,h&&n.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),h&&(n.trigger("ajaxComplete",[v,k]),--m.active||m.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return m.get(a,b,c,"json")},getScript:function(a,b){return m.get(a,void 0,b,"script")}}),m.each(["get","post"],function(a,b){m[b]=function(a,c,d,e){return m.isFunction(c)&&(e=e||d,d=c,c=void 0),m.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),m._evalUrl=function(a){return m.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},m.fn.extend({wrapAll:function(a){if(m.isFunction(a))return this.each(function(b){m(this).wrapAll(a.call(this,b))});if(this[0]){var b=m(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(m.isFunction(a)?function(b){m(this).wrapInner(a.call(this,b))}:function(){var b=m(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=m.isFunction(a);return this.each(function(c){m(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){m.nodeName(this,"body")||m(this).replaceWith(this.childNodes)}).end()}}),m.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!k.reliableHiddenOffsets()&&"none"===(a.style&&a.style.display||m.css(a,"display"))},m.expr.filters.visible=function(a){return!m.expr.filters.hidden(a)};var Qb=/%20/g,Rb=/\[\]$/,Sb=/\r?\n/g,Tb=/^(?:submit|button|image|reset|file)$/i,Ub=/^(?:input|select|textarea|keygen)/i;function Vb(a,b,c,d){var e;if(m.isArray(b))m.each(b,function(b,e){c||Rb.test(a)?d(a,e):Vb(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==m.type(b))d(a,b);else for(e in b)Vb(a+"["+e+"]",b[e],c,d)}m.param=function(a,b){var c,d=[],e=function(a,b){b=m.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=m.ajaxSettings&&m.ajaxSettings.traditional),m.isArray(a)||a.jquery&&!m.isPlainObject(a))m.each(a,function(){e(this.name,this.value)});else for(c in a)Vb(c,a[c],b,e);return d.join("&").replace(Qb,"+")},m.fn.extend({serialize:function(){return m.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=m.prop(this,"elements");return a?m.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!m(this).is(":disabled")&&Ub.test(this.nodeName)&&!Tb.test(a)&&(this.checked||!W.test(a))}).map(function(a,b){var c=m(this).val();return null==c?null:m.isArray(c)?m.map(c,function(a){return{name:b.name,value:a.replace(Sb,"\r\n")}}):{name:b.name,value:c.replace(Sb,"\r\n")}}).get()}}),m.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Zb()||$b()}:Zb;var Wb=0,Xb={},Yb=m.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in Xb)Xb[a](void 0,!0)}),k.cors=!!Yb&&"withCredentials"in Yb,Yb=k.ajax=!!Yb,Yb&&m.ajaxTransport(function(a){if(!a.crossDomain||k.cors){var b;return{send:function(c,d){var e,f=a.xhr(),g=++Wb;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)void 0!==c[e]&&f.setRequestHeader(e,c[e]+"");f.send(a.hasContent&&a.data||null),b=function(c,e){var h,i,j;if(b&&(e||4===f.readyState))if(delete Xb[g],b=void 0,f.onreadystatechange=m.noop,e)4!==f.readyState&&f.abort();else{j={},h=f.status,"string"==typeof f.responseText&&(j.text=f.responseText);try{i=f.statusText}catch(k){i=""}h||!a.isLocal||a.crossDomain?1223===h&&(h=204):h=j.text?200:404}j&&d(h,i,j,f.getAllResponseHeaders())},a.async?4===f.readyState?setTimeout(b):f.onreadystatechange=Xb[g]=b:b()},abort:function(){b&&b(void 0,!0)}}}});function Zb(){try{return new a.XMLHttpRequest}catch(b){}}function $b(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}m.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return m.globalEval(a),a}}}),m.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),m.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=y.head||m("head")[0]||y.documentElement;return{send:function(d,e){b=y.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||e(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var _b=[],ac=/(=)\?(?=&|$)|\?\?/;m.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=_b.pop()||m.expando+"_"+vb++;return this[a]=!0,a}}),m.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(ac.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&ac.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=m.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(ac,"$1"+e):b.jsonp!==!1&&(b.url+=(wb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||m.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,_b.push(e)),g&&m.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),m.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||y;var d=u.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=m.buildFragment([a],b,e),e&&e.length&&m(e).remove(),m.merge([],d.childNodes))};var bc=m.fn.load;m.fn.load=function(a,b,c){if("string"!=typeof a&&bc)return bc.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=m.trim(a.slice(h,a.length)),a=a.slice(0,h)),m.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(f="POST"),g.length>0&&m.ajax({url:a,type:f,dataType:"html",data:b}).done(function(a){e=arguments,g.html(d?m("<div>").append(m.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,e||[a.responseText,b,a])}),this},m.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){m.fn[b]=function(a){return this.on(b,a)}}),m.expr.filters.animated=function(a){return m.grep(m.timers,function(b){return a===b.elem}).length};var cc=a.document.documentElement;function dc(a){return m.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}m.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=m.css(a,"position"),l=m(a),n={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=m.css(a,"top"),i=m.css(a,"left"),j=("absolute"===k||"fixed"===k)&&m.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),m.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(n.top=b.top-h.top+g),null!=b.left&&(n.left=b.left-h.left+e),"using"in b?b.using.call(a,n):l.css(n)}},m.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){m.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,m.contains(b,e)?(typeof e.getBoundingClientRect!==K&&(d=e.getBoundingClientRect()),c=dc(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===m.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),m.nodeName(a[0],"html")||(c=a.offset()),c.top+=m.css(a[0],"borderTopWidth",!0),c.left+=m.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-m.css(d,"marginTop",!0),left:b.left-c.left-m.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||cc;while(a&&!m.nodeName(a,"html")&&"static"===m.css(a,"position"))a=a.offsetParent;return a||cc})}}),m.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);m.fn[a]=function(d){return V(this,function(a,d,e){var f=dc(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?m(f).scrollLeft():e,c?e:m(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),m.each(["top","left"],function(a,b){m.cssHooks[b]=La(k.pixelPosition,function(a,c){return c?(c=Ja(a,b),Ha.test(c)?m(a).position()[b]+"px":c):void 0})}),m.each({Height:"height",Width:"width"},function(a,b){m.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){m.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return V(this,function(b,c,d){var e;return m.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?m.css(b,c,g):m.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),m.fn.size=function(){return this.length},m.fn.andSelf=m.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return m});var ec=a.jQuery,fc=a.$;return m.noConflict=function(b){return a.$===m&&(a.$=fc),b&&a.jQuery===m&&(a.jQuery=ec),m},typeof b===K&&(a.jQuery=a.$=m),m});!function(a,b,c){!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):jQuery&&!jQuery.fn.qtip&&a(jQuery)}(function(d){"use strict";function e(a,b,c,e){this.id=c,this.target=a,this.tooltip=F,this.elements={target:a},this._id=S+"-"+c,this.timers={img:{}},this.options=b,this.plugins={},this.cache={event:{},target:d(),disabled:E,attr:e,onTooltip:E,lastClass:""},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=E}function f(a){return a===F||"object"!==d.type(a)}function g(a){return!(d.isFunction(a)||a&&a.attr||a.length||"object"===d.type(a)&&(a.jquery||a.then))}function h(a){var b,c,e,h;return f(a)?E:(f(a.metadata)&&(a.metadata={type:a.metadata}),"content"in a&&(b=a.content,f(b)||b.jquery||b.done?b=a.content={text:c=g(b)?E:b}:c=b.text,"ajax"in b&&(e=b.ajax,h=e&&e.once!==E,delete b.ajax,b.text=function(a,b){var f=c||d(this).attr(b.options.content.attr)||"Loading...",g=d.ajax(d.extend({},e,{context:b})).then(e.success,F,e.error).then(function(a){return a&&h&&b.set("content.text",a),a},function(a,c,d){b.destroyed||0===a.status||b.set("content.text",c+": "+d)});return h?f:(b.set("content.text",f),g)}),"title"in b&&(d.isPlainObject(b.title)&&(b.button=b.title.button,b.title=b.title.text),g(b.title||E)&&(b.title=E))),"position"in a&&f(a.position)&&(a.position={my:a.position,at:a.position}),"show"in a&&f(a.show)&&(a.show=a.show.jquery?{target:a.show}:a.show===D?{ready:D}:{event:a.show}),"hide"in a&&f(a.hide)&&(a.hide=a.hide.jquery?{target:a.hide}:{event:a.hide}),"style"in a&&f(a.style)&&(a.style={classes:a.style}),d.each(R,function(){this.sanitize&&this.sanitize(a)}),a)}function i(a,b){for(var c,d=0,e=a,f=b.split(".");e=e[f[d++]];)d<f.length&&(c=e);return[c||a,f.pop()]}function j(a,b){var c,d,e;for(c in this.checks)for(d in this.checks[c])(e=new RegExp(d,"i").exec(a))&&(b.push(e),("builtin"===c||this.plugins[c])&&this.checks[c][d].apply(this.plugins[c]||this,b))}function k(a){return V.concat("").join(a?"-"+a+" ":" ")}function l(a,b){return b>0?setTimeout(d.proxy(a,this),b):void a.call(this)}function m(a){this.tooltip.hasClass(ab)||(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this.timers.show=l.call(this,function(){this.toggle(D,a)},this.options.show.delay))}function n(a){if(!this.tooltip.hasClass(ab)&&!this.destroyed){var b=d(a.relatedTarget),c=b.closest(W)[0]===this.tooltip[0],e=b[0]===this.options.show.target[0];if(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this!==b[0]&&"mouse"===this.options.position.target&&c||this.options.hide.fixed&&/mouse(out|leave|move)/.test(a.type)&&(c||e))try{a.preventDefault(),a.stopImmediatePropagation()}catch(f){}else this.timers.hide=l.call(this,function(){this.toggle(E,a)},this.options.hide.delay,this)}}function o(a){!this.tooltip.hasClass(ab)&&this.options.hide.inactive&&(clearTimeout(this.timers.inactive),this.timers.inactive=l.call(this,function(){this.hide(a)},this.options.hide.inactive))}function p(a){this.rendered&&this.tooltip[0].offsetWidth>0&&this.reposition(a)}function q(a,c,e){d(b.body).delegate(a,(c.split?c:c.join("."+S+" "))+"."+S,function(){var a=y.api[d.attr(this,U)];a&&!a.disabled&&e.apply(a,arguments)})}function r(a,c,f){var g,i,j,k,l,m=d(b.body),n=a[0]===b?m:a,o=a.metadata?a.metadata(f.metadata):F,p="html5"===f.metadata.type&&o?o[f.metadata.name]:F,q=a.data(f.metadata.name||"qtipopts");try{q="string"==typeof q?d.parseJSON(q):q}catch(r){}if(k=d.extend(D,{},y.defaults,f,"object"==typeof q?h(q):F,h(p||o)),i=k.position,k.id=c,"boolean"==typeof k.content.text){if(j=a.attr(k.content.attr),k.content.attr===E||!j)return E;k.content.text=j}if(i.container.length||(i.container=m),i.target===E&&(i.target=n),k.show.target===E&&(k.show.target=n),k.show.solo===D&&(k.show.solo=i.container.closest("body")),k.hide.target===E&&(k.hide.target=n),k.position.viewport===D&&(k.position.viewport=i.container),i.container=i.container.eq(0),i.at=new A(i.at,D),i.my=new A(i.my),a.data(S))if(k.overwrite)a.qtip("destroy",!0);else if(k.overwrite===E)return E;return a.attr(T,c),k.suppress&&(l=a.attr("title"))&&a.removeAttr("title").attr(cb,l).attr("title",""),g=new e(a,k,c,!!j),a.data(S,g),g}function s(a){return a.charAt(0).toUpperCase()+a.slice(1)}function t(a,b){var d,e,f=b.charAt(0).toUpperCase()+b.slice(1),g=(b+" "+rb.join(f+" ")+f).split(" "),h=0;if(qb[b])return a.css(qb[b]);for(;d=g[h++];)if((e=a.css(d))!==c)return qb[b]=d,e}function u(a,b){return Math.ceil(parseFloat(t(a,b)))}function v(a,b){this._ns="tip",this.options=b,this.offset=b.offset,this.size=[b.width,b.height],this.init(this.qtip=a)}function w(a,b){this.options=b,this._ns="-modal",this.init(this.qtip=a)}function x(a){this._ns="ie6",this.init(this.qtip=a)}var y,z,A,B,C,D=!0,E=!1,F=null,G="x",H="y",I="width",J="height",K="top",L="left",M="bottom",N="right",O="center",P="flipinvert",Q="shift",R={},S="qtip",T="data-hasqtip",U="data-qtip-id",V=["ui-widget","ui-tooltip"],W="."+S,X="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" "),Y=S+"-fixed",Z=S+"-default",$=S+"-focus",_=S+"-hover",ab=S+"-disabled",bb="_replacedByqTip",cb="oldtitle",db={ie:function(){for(var a=4,c=b.createElement("div");(c.innerHTML="\x3c!--[if gt IE "+a+"]><i></i><![endif]--\x3e")&&c.getElementsByTagName("i")[0];a+=1);return a>4?a:0/0}(),iOS:parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||E};z=e.prototype,z._when=function(a){return d.when.apply(d,a)},z.render=function(a){if(this.rendered||this.destroyed)return this;var b,c=this,e=this.options,f=this.cache,g=this.elements,h=e.content.text,i=e.content.title,j=e.content.button,k=e.position,l=("."+this._id+" ",[]);return d.attr(this.target[0],"aria-describedby",this._id),f.posClass=this._createPosClass((this.position={my:k.my,at:k.at}).my),this.tooltip=g.tooltip=b=d("<div/>",{id:this._id,class:[S,Z,e.style.classes,f.posClass].join(" "),width:e.style.width||"",height:e.style.height||"",tracking:"mouse"===k.target&&k.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":E,"aria-describedby":this._id+"-content","aria-hidden":D}).toggleClass(ab,this.disabled).attr(U,this.id).data(S,this).appendTo(k.container).append(g.content=d("<div />",{class:S+"-content",id:this._id+"-content","aria-atomic":D})),this.rendered=-1,this.positioning=D,i&&(this._createTitle(),d.isFunction(i)||l.push(this._updateTitle(i,E))),j&&this._createButton(),d.isFunction(h)||l.push(this._updateContent(h,E)),this.rendered=D,this._setWidget(),d.each(R,function(a){var b;"render"===this.initialize&&(b=this(c))&&(c.plugins[a]=b)}),this._unassignEvents(),this._assignEvents(),this._when(l).then(function(){c._trigger("render"),c.positioning=E,c.hiddenDuringWait||!e.show.ready&&!a||c.toggle(D,f.event,E),c.hiddenDuringWait=E}),y.api[this.id]=this,this},z.destroy=function(a){function b(){if(!this.destroyed){this.destroyed=D;var a,b=this.target,c=b.attr(cb);this.rendered&&this.tooltip.stop(1,0).find("*").remove().end().remove(),d.each(this.plugins,function(){this.destroy&&this.destroy()});for(a in this.timers)clearTimeout(this.timers[a]);b.removeData(S).removeAttr(U).removeAttr(T).removeAttr("aria-describedby"),this.options.suppress&&c&&b.attr("title",c).removeAttr(cb),this._unassignEvents(),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=F,delete y.api[this.id]}}return this.destroyed?this.target:(a===D&&"hide"!==this.triggering||!this.rendered?b.call(this):(this.tooltip.one("tooltiphidden",d.proxy(b,this)),!this.triggering&&this.hide()),this.target)},B=z.checks={builtin:{"^id$":function(a,b,c,e){var f=c===D?y.nextid:c,g=S+"-"+f;f!==E&&f.length>0&&!d("#"+g).length?(this._id=g,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+"-content",this.elements.title[0].id=this._id+"-title")):a[b]=e},"^prerender":function(a,b,c){c&&!this.rendered&&this.render(this.options.show.ready)},"^content.text$":function(a,b,c){this._updateContent(c)},"^content.attr$":function(a,b,c,d){this.options.content.text===this.target.attr(d)&&this._updateContent(this.target.attr(c))},"^content.title$":function(a,b,c){return c?(c&&!this.elements.title&&this._createTitle(),void this._updateTitle(c)):this._removeTitle()},"^content.button$":function(a,b,c){this._updateButton(c)},"^content.title.(text|button)$":function(a,b,c){this.set("content."+b,c)},"^position.(my|at)$":function(a,b,c){"string"==typeof c&&(this.position[b]=a[b]=new A(c,"at"===b))},"^position.container$":function(a,b,c){this.rendered&&this.tooltip.appendTo(c)},"^show.ready$":function(a,b,c){c&&(!this.rendered&&this.render(D)||this.toggle(D))},"^style.classes$":function(a,b,c,d){this.rendered&&this.tooltip.removeClass(d).addClass(c)},"^style.(width|height)":function(a,b,c){this.rendered&&this.tooltip.css(b,c)},"^style.widget|content.title":function(){this.rendered&&this._setWidget()},"^style.def":function(a,b,c){this.rendered&&this.tooltip.toggleClass(Z,!!c)},"^events.(render|show|move|hide|focus|blur)$":function(a,b,c){this.rendered&&this.tooltip[(d.isFunction(c)?"":"un")+"bind"]("tooltip"+b,c)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){if(this.rendered){var a=this.options.position;this.tooltip.attr("tracking","mouse"===a.target&&a.adjust.mouse),this._unassignEvents(),this._assignEvents()}}}},z.get=function(a){if(this.destroyed)return this;var b=i(this.options,a.toLowerCase()),c=b[0][b[1]];return c.precedance?c.string():c};var eb=/^position\.(my|at|adjust|target|container|viewport)|style|content|show\.ready/i,fb=/^prerender|show\.ready/i;z.set=function(a,b){if(this.destroyed)return this;{var c,e=this.rendered,f=E,g=this.options;this.checks}return"string"==typeof a?(c=a,a={},a[c]=b):a=d.extend({},a),d.each(a,function(b,c){if(e&&fb.test(b))return void delete a[b];var h,j=i(g,b.toLowerCase());h=j[0][j[1]],j[0][j[1]]=c&&c.nodeType?d(c):c,f=eb.test(b)||f,a[b]=[j[0],j[1],c,h]}),h(g),this.positioning=D,d.each(a,d.proxy(j,this)),this.positioning=E,this.rendered&&this.tooltip[0].offsetWidth>0&&f&&this.reposition("mouse"===g.position.target?F:this.cache.event),this},z._update=function(a,b){var c=this,e=this.cache;return this.rendered&&a?(d.isFunction(a)&&(a=a.call(this.elements.target,e.event,this)||""),d.isFunction(a.then)?(e.waiting=D,a.then(function(a){return e.waiting=E,c._update(a,b)},F,function(a){return c._update(a,b)})):a===E||!a&&""!==a?E:(a.jquery&&a.length>0?b.empty().append(a.css({display:"block",visibility:"visible"})):b.html(a),this._waitForContent(b).then(function(a){c.rendered&&c.tooltip[0].offsetWidth>0&&c.reposition(e.event,!a.length)}))):E},z._waitForContent=function(a){var b=this.cache;return b.waiting=D,(d.fn.imagesLoaded?a.imagesLoaded():d.Deferred().resolve([])).done(function(){b.waiting=E}).promise()},z._updateContent=function(a,b){this._update(a,this.elements.content,b)},z._updateTitle=function(a,b){this._update(a,this.elements.title,b)===E&&this._removeTitle(E)},z._createTitle=function(){var a=this.elements,b=this._id+"-title";a.titlebar&&this._removeTitle(),a.titlebar=d("<div />",{class:S+"-titlebar "+(this.options.style.widget?k("header"):"")}).append(a.title=d("<div />",{id:b,class:S+"-title","aria-atomic":D})).insertBefore(a.content).delegate(".qtip-close","mousedown keydown mouseup keyup mouseout",function(a){d(this).toggleClass("ui-state-active ui-state-focus","down"===a.type.substr(-4))}).delegate(".qtip-close","mouseover mouseout",function(a){d(this).toggleClass("ui-state-hover","mouseover"===a.type)}),this.options.content.button&&this._createButton()},z._removeTitle=function(a){var b=this.elements;b.title&&(b.titlebar.remove(),b.titlebar=b.title=b.button=F,a!==E&&this.reposition())},z._createPosClass=function(a){return S+"-pos-"+(a||this.options.position.my).abbrev()},z.reposition=function(c,e){if(!this.rendered||this.positioning||this.destroyed)return this;this.positioning=D;var f,g,h,i,j=this.cache,k=this.tooltip,l=this.options.position,m=l.target,n=l.my,o=l.at,p=l.viewport,q=l.container,r=l.adjust,s=r.method.split(" "),t=k.outerWidth(E),u=k.outerHeight(E),v=0,w=0,x=k.css("position"),y={left:0,top:0},z=k[0].offsetWidth>0,A=c&&"scroll"===c.type,B=d(a),C=q[0].ownerDocument,F=this.mouse;if(d.isArray(m)&&2===m.length)o={x:L,y:K},y={left:m[0],top:m[1]};else if("mouse"===m)o={x:L,y:K},(!r.mouse||this.options.hide.distance)&&j.origin&&j.origin.pageX?c=j.origin:!c||c&&("resize"===c.type||"scroll"===c.type)?c=j.event:F&&F.pageX&&(c=F),"static"!==x&&(y=q.offset()),C.body.offsetWidth!==(a.innerWidth||C.documentElement.clientWidth)&&(g=d(b.body).offset()),y={left:c.pageX-y.left+(g&&g.left||0),top:c.pageY-y.top+(g&&g.top||0)},r.mouse&&A&&F&&(y.left-=(F.scrollX||0)-B.scrollLeft(),y.top-=(F.scrollY||0)-B.scrollTop());else{if("event"===m?c&&c.target&&"scroll"!==c.type&&"resize"!==c.type?j.target=d(c.target):c.target||(j.target=this.elements.target):"event"!==m&&(j.target=d(m.jquery?m:this.elements.target)),m=j.target,m=d(m).eq(0),0===m.length)return this;m[0]===b||m[0]===a?(v=db.iOS?a.innerWidth:m.width(),w=db.iOS?a.innerHeight:m.height(),m[0]===a&&(y={top:(p||m).scrollTop(),left:(p||m).scrollLeft()})):R.imagemap&&m.is("area")?f=R.imagemap(this,m,o,R.viewport?s:E):R.svg&&m&&m[0].ownerSVGElement?f=R.svg(this,m,o,R.viewport?s:E):(v=m.outerWidth(E),w=m.outerHeight(E),y=m.offset()),f&&(v=f.width,w=f.height,g=f.offset,y=f.position),y=this.reposition.offset(m,y,q),(db.iOS>3.1&&db.iOS<4.1||db.iOS>=4.3&&db.iOS<4.33||!db.iOS&&"fixed"===x)&&(y.left-=B.scrollLeft(),y.top-=B.scrollTop()),(!f||f&&f.adjustable!==E)&&(y.left+=o.x===N?v:o.x===O?v/2:0,y.top+=o.y===M?w:o.y===O?w/2:0)}return y.left+=r.x+(n.x===N?-t:n.x===O?-t/2:0),y.top+=r.y+(n.y===M?-u:n.y===O?-u/2:0),R.viewport?(h=y.adjusted=R.viewport(this,y,l,v,w,t,u),g&&h.left&&(y.left+=g.left),g&&h.top&&(y.top+=g.top),
h.my&&(this.position.my=h.my)):y.adjusted={left:0,top:0},j.posClass!==(i=this._createPosClass(this.position.my))&&k.removeClass(j.posClass).addClass(j.posClass=i),this._trigger("move",[y,p.elem||p],c)?(delete y.adjusted,e===E||!z||isNaN(y.left)||isNaN(y.top)||"mouse"===m||!d.isFunction(l.effect)?k.css(y):d.isFunction(l.effect)&&(l.effect.call(k,this,d.extend({},y)),k.queue(function(a){d(this).css({opacity:"",height:""}),db.ie&&this.style.removeAttribute("filter"),a()})),this.positioning=E,this):this},z.reposition.offset=function(a,c,e){function f(a,b){c.left+=b*a.scrollLeft(),c.top+=b*a.scrollTop()}if(!e[0])return c;var g,h,i,j,k=d(a[0].ownerDocument),l=!!db.ie&&"CSS1Compat"!==b.compatMode,m=e[0];do{"static"!==(h=d.css(m,"position"))&&("fixed"===h?(i=m.getBoundingClientRect(),f(k,-1)):(i=d(m).position(),i.left+=parseFloat(d.css(m,"borderLeftWidth"))||0,i.top+=parseFloat(d.css(m,"borderTopWidth"))||0),c.left-=i.left+(parseFloat(d.css(m,"marginLeft"))||0),c.top-=i.top+(parseFloat(d.css(m,"marginTop"))||0),g||"hidden"===(j=d.css(m,"overflow"))||"visible"===j||(g=d(m)))}while(m=m.offsetParent);return g&&(g[0]!==k[0]||l)&&f(g,1),c};var gb=(A=z.reposition.Corner=function(a,b){a=(""+a).replace(/([A-Z])/," $1").replace(/middle/gi,O).toLowerCase(),this.x=(a.match(/left|right/i)||a.match(/center/)||["inherit"])[0].toLowerCase(),this.y=(a.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase(),this.forceY=!!b;var c=a.charAt(0);this.precedance="t"===c||"b"===c?H:G}).prototype;gb.invert=function(a,b){this[a]=this[a]===L?N:this[a]===N?L:b||this[a]},gb.string=function(a){var b=this.x,c=this.y,d=b!==c?"center"===b||"center"!==c&&(this.precedance===H||this.forceY)?[c,b]:[b,c]:[b];return a!==!1?d.join(" "):d},gb.abbrev=function(){var a=this.string(!1);return a[0].charAt(0)+(a[1]&&a[1].charAt(0)||"")},gb.clone=function(){return new A(this.string(),this.forceY)},z.toggle=function(a,c){var e=this.cache,f=this.options,g=this.tooltip;if(c){if(/over|enter/.test(c.type)&&e.event&&/out|leave/.test(e.event.type)&&f.show.target.add(c.target).length===f.show.target.length&&g.has(c.relatedTarget).length)return this;e.event=d.event.fix(c)}if(this.waiting&&!a&&(this.hiddenDuringWait=D),!this.rendered)return a?this.render(1):this;if(this.destroyed||this.disabled)return this;var h,i,j,k=a?"show":"hide",l=this.options[k],m=(this.options[a?"hide":"show"],this.options.position),n=this.options.content,o=this.tooltip.css("width"),p=this.tooltip.is(":visible"),q=a||1===l.target.length,r=!c||l.target.length<2||e.target[0]===c.target;return(typeof a).search("boolean|number")&&(a=!p),h=!g.is(":animated")&&p===a&&r,i=h?F:!!this._trigger(k,[90]),this.destroyed?this:(i!==E&&a&&this.focus(c),!i||h?this:(d.attr(g[0],"aria-hidden",!a),a?(this.mouse&&(e.origin=d.event.fix(this.mouse)),d.isFunction(n.text)&&this._updateContent(n.text,E),d.isFunction(n.title)&&this._updateTitle(n.title,E),!C&&"mouse"===m.target&&m.adjust.mouse&&(d(b).bind("mousemove."+S,this._storeMouse),C=D),o||g.css("width",g.outerWidth(E)),this.reposition(c,arguments[2]),o||g.css("width",""),l.solo&&("string"==typeof l.solo?d(l.solo):d(W,l.solo)).not(g).not(l.target).qtip("hide",d.Event("tooltipsolo"))):(clearTimeout(this.timers.show),delete e.origin,C&&!d(W+'[tracking="true"]:visible',l.solo).not(g).length&&(d(b).unbind("mousemove."+S),C=E),this.blur(c)),j=d.proxy(function(){a?(db.ie&&g[0].style.removeAttribute("filter"),g.css("overflow",""),"string"==typeof l.autofocus&&d(this.options.show.autofocus,g).focus(),this.options.show.target.trigger("qtip-"+this.id+"-inactive")):g.css({display:"",visibility:"",opacity:"",left:"",top:""}),this._trigger(a?"visible":"hidden")},this),l.effect===E||q===E?(g[k](),j()):d.isFunction(l.effect)?(g.stop(1,1),l.effect.call(g,this),g.queue("fx",function(a){j(),a()})):g.fadeTo(90,a?1:0,j),a&&l.target.trigger("qtip-"+this.id+"-inactive"),this))},z.show=function(a){return this.toggle(D,a)},z.hide=function(a){return this.toggle(E,a)},z.focus=function(a){if(!this.rendered||this.destroyed)return this;var b=d(W),c=this.tooltip,e=parseInt(c[0].style.zIndex,10),f=y.zindex+b.length;return c.hasClass($)||this._trigger("focus",[f],a)&&(e!==f&&(b.each(function(){this.style.zIndex>e&&(this.style.zIndex=this.style.zIndex-1)}),b.filter("."+$).qtip("blur",a)),c.addClass($)[0].style.zIndex=f),this},z.blur=function(a){return!this.rendered||this.destroyed?this:(this.tooltip.removeClass($),this._trigger("blur",[this.tooltip.css("zIndex")],a),this)},z.disable=function(a){return this.destroyed?this:("toggle"===a?a=!(this.rendered?this.tooltip.hasClass(ab):this.disabled):"boolean"!=typeof a&&(a=D),this.rendered&&this.tooltip.toggleClass(ab,a).attr("aria-disabled",a),this.disabled=!!a,this)},z.enable=function(){return this.disable(E)},z._createButton=function(){var a=this,b=this.elements,c=b.tooltip,e=this.options.content.button,f="string"==typeof e,g=f?e:"Close tooltip";b.button&&b.button.remove(),b.button=e.jquery?e:d("<a />",{class:"qtip-close "+(this.options.style.widget?"":S+"-icon"),title:g,"aria-label":g}).prepend(d("<span />",{class:"ui-icon ui-icon-close",html:"&times;"})),b.button.appendTo(b.titlebar||c).attr("role","button").click(function(b){return c.hasClass(ab)||a.hide(b),E})},z._updateButton=function(a){if(!this.rendered)return E;var b=this.elements.button;a?this._createButton():b.remove()},z._setWidget=function(){var a=this.options.style.widget,b=this.elements,c=b.tooltip,d=c.hasClass(ab);c.removeClass(ab),ab=a?"ui-state-disabled":"qtip-disabled",c.toggleClass(ab,d),c.toggleClass("ui-helper-reset "+k(),a).toggleClass(Z,this.options.style.def&&!a),b.content&&b.content.toggleClass(k("content"),a),b.titlebar&&b.titlebar.toggleClass(k("header"),a),b.button&&b.button.toggleClass(S+"-icon",!a)},z._storeMouse=function(a){return(this.mouse=d.event.fix(a)).type="mousemove",this},z._bind=function(a,b,c,e,f){if(a&&c&&b.length){var g="."+this._id+(e?"-"+e:"");return d(a).bind((b.split?b:b.join(g+" "))+g,d.proxy(c,f||this)),this}},z._unbind=function(a,b){return a&&d(a).unbind("."+this._id+(b?"-"+b:"")),this},z._trigger=function(a,b,c){var e=d.Event("tooltip"+a);return e.originalEvent=c&&d.extend({},c)||this.cache.event||F,this.triggering=a,this.tooltip.trigger(e,[this].concat(b||[])),this.triggering=E,!e.isDefaultPrevented()},z._bindEvents=function(a,b,c,e,f,g){var h=c.filter(e).add(e.filter(c)),i=[];h.length&&(d.each(b,function(b,c){var e=d.inArray(c,a);e>-1&&i.push(a.splice(e,1)[0])}),i.length&&(this._bind(h,i,function(a){var b=this.rendered?this.tooltip[0].offsetWidth>0:!1;(b?g:f).call(this,a)}),c=c.not(h),e=e.not(h))),this._bind(c,a,f),this._bind(e,b,g)},z._assignInitialEvents=function(a){function b(a){return this.disabled||this.destroyed?E:(this.cache.event=a&&d.event.fix(a),this.cache.target=a&&d(a.target),clearTimeout(this.timers.show),void(this.timers.show=l.call(this,function(){this.render("object"==typeof a||c.show.ready)},c.prerender?0:c.show.delay)))}var c=this.options,e=c.show.target,f=c.hide.target,g=c.show.event?d.trim(""+c.show.event).split(" "):[],h=c.hide.event?d.trim(""+c.hide.event).split(" "):[];this._bind(this.elements.target,["remove","removeqtip"],function(){this.destroy(!0)},"destroy"),/mouse(over|enter)/i.test(c.show.event)&&!/mouse(out|leave)/i.test(c.hide.event)&&h.push("mouseleave"),this._bind(e,"mousemove",function(a){this._storeMouse(a),this.cache.onTarget=D}),this._bindEvents(g,h,e,f,b,function(){return this.timers?void clearTimeout(this.timers.show):E}),(c.show.ready||c.prerender)&&b.call(this,a)},z._assignEvents=function(){var c=this,e=this.options,f=e.position,g=this.tooltip,h=e.show.target,i=e.hide.target,j=f.container,k=f.viewport,l=d(b),q=(d(b.body),d(a)),r=e.show.event?d.trim(""+e.show.event).split(" "):[],s=e.hide.event?d.trim(""+e.hide.event).split(" "):[];d.each(e.events,function(a,b){c._bind(g,"toggle"===a?["tooltipshow","tooltiphide"]:["tooltip"+a],b,null,g)}),/mouse(out|leave)/i.test(e.hide.event)&&"window"===e.hide.leave&&this._bind(l,["mouseout","blur"],function(a){/select|option/.test(a.target.nodeName)||a.relatedTarget||this.hide(a)}),e.hide.fixed?i=i.add(g.addClass(Y)):/mouse(over|enter)/i.test(e.show.event)&&this._bind(i,"mouseleave",function(){clearTimeout(this.timers.show)}),(""+e.hide.event).indexOf("unfocus")>-1&&this._bind(j.closest("html"),["mousedown","touchstart"],function(a){var b=d(a.target),c=this.rendered&&!this.tooltip.hasClass(ab)&&this.tooltip[0].offsetWidth>0,e=b.parents(W).filter(this.tooltip[0]).length>0;b[0]===this.target[0]||b[0]===this.tooltip[0]||e||this.target.has(b[0]).length||!c||this.hide(a)}),"number"==typeof e.hide.inactive&&(this._bind(h,"qtip-"+this.id+"-inactive",o,"inactive"),this._bind(i.add(g),y.inactiveEvents,o)),this._bindEvents(r,s,h,i,m,n),this._bind(h.add(g),"mousemove",function(a){if("number"==typeof e.hide.distance){var b=this.cache.origin||{},c=this.options.hide.distance,d=Math.abs;(d(a.pageX-b.pageX)>=c||d(a.pageY-b.pageY)>=c)&&this.hide(a)}this._storeMouse(a)}),"mouse"===f.target&&f.adjust.mouse&&(e.hide.event&&this._bind(h,["mouseenter","mouseleave"],function(a){return this.cache?void(this.cache.onTarget="mouseenter"===a.type):E}),this._bind(l,"mousemove",function(a){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(ab)&&this.tooltip[0].offsetWidth>0&&this.reposition(a)})),(f.adjust.resize||k.length)&&this._bind(d.event.special.resize?k:q,"resize",p),f.adjust.scroll&&this._bind(q.add(f.container),"scroll",p)},z._unassignEvents=function(){var c=this.options,e=c.show.target,f=c.hide.target,g=d.grep([this.elements.target[0],this.rendered&&this.tooltip[0],c.position.container[0],c.position.viewport[0],c.position.container.closest("html")[0],a,b],function(a){return"object"==typeof a});e&&e.toArray&&(g=g.concat(e.toArray())),f&&f.toArray&&(g=g.concat(f.toArray())),this._unbind(g)._unbind(g,"destroy")._unbind(g,"inactive")},d(function(){q(W,["mouseenter","mouseleave"],function(a){var b="mouseenter"===a.type,c=d(a.currentTarget),e=d(a.relatedTarget||a.target),f=this.options;b?(this.focus(a),c.hasClass(Y)&&!c.hasClass(ab)&&clearTimeout(this.timers.hide)):"mouse"===f.position.target&&f.position.adjust.mouse&&f.hide.event&&f.show.target&&!e.closest(f.show.target[0]).length&&this.hide(a),c.toggleClass(_,b)}),q("["+U+"]",X,o)}),y=d.fn.qtip=function(a,b,e){var f=(""+a).toLowerCase(),g=F,i=d.makeArray(arguments).slice(1),j=i[i.length-1],k=this[0]?d.data(this[0],S):F;return!arguments.length&&k||"api"===f?k:"string"==typeof a?(this.each(function(){var a=d.data(this,S);if(!a)return D;if(j&&j.timeStamp&&(a.cache.event=j),!b||"option"!==f&&"options"!==f)a[f]&&a[f].apply(a,i);else{if(e===c&&!d.isPlainObject(b))return g=a.get(b),E;a.set(b,e)}}),g!==F?g:this):"object"!=typeof a&&arguments.length?void 0:(k=h(d.extend(D,{},a)),this.each(function(a){var b,c;return c=d.isArray(k.id)?k.id[a]:k.id,c=!c||c===E||c.length<1||y.api[c]?y.nextid++:c,b=r(d(this),c,k),b===E?D:(y.api[c]=b,d.each(R,function(){"initialize"===this.initialize&&this(b)}),void b._assignInitialEvents(j))}))},d.qtip=e,y.api={},d.each({attr:function(a,b){if(this.length){var c=this[0],e="title",f=d.data(c,"qtip");if(a===e&&f&&"object"==typeof f&&f.options.suppress)return arguments.length<2?d.attr(c,cb):(f&&f.options.content.attr===e&&f.cache.attr&&f.set("content.text",b),this.attr(cb,b))}return d.fn["attr"+bb].apply(this,arguments)},clone:function(a){var b=(d([]),d.fn["clone"+bb].apply(this,arguments));return a||b.filter("["+cb+"]").attr("title",function(){return d.attr(this,cb)}).removeAttr(cb),b}},function(a,b){if(!b||d.fn[a+bb])return D;var c=d.fn[a+bb]=d.fn[a];d.fn[a]=function(){return b.apply(this,arguments)||c.apply(this,arguments)}}),d.ui||(d["cleanData"+bb]=d.cleanData,d.cleanData=function(a){for(var b,c=0;(b=d(a[c])).length;c++)if(b.attr(T))try{b.triggerHandler("removeqtip")}catch(e){}d["cleanData"+bb].apply(this,arguments)}),y.version="2.2.1",y.nextid=0,y.inactiveEvents=X,y.zindex=15e3,y.defaults={prerender:E,id:E,overwrite:D,suppress:D,content:{text:D,attr:"title",title:E,button:E},position:{my:"top left",at:"bottom right",target:E,container:E,viewport:E,adjust:{x:0,y:0,mouse:D,scroll:D,resize:D,method:"flipinvert flipinvert"},effect:function(a,b){d(this).animate(b,{duration:200,queue:E})}},show:{target:E,event:"mouseenter",effect:D,delay:90,solo:E,ready:E,autofocus:E},hide:{target:E,event:"mouseleave",effect:D,delay:0,fixed:E,inactive:E,leave:"window",distance:E},style:{classes:"",widget:E,width:E,height:E,def:D},events:{render:F,move:F,show:F,hide:F,toggle:F,visible:F,hidden:F,focus:F,blur:F}};var hb,ib="margin",jb="border",kb="color",lb="background-color",mb="transparent",nb=" !important",ob=!!b.createElement("canvas").getContext,pb=/rgba?\(0, 0, 0(, 0)?\)|transparent|#123456/i,qb={},rb=["Webkit","O","Moz","ms"];if(ob)var sb=a.devicePixelRatio||1,tb=function(){var a=b.createElement("canvas").getContext("2d");return a.backingStorePixelRatio||a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||1}(),ub=sb/tb;else var vb=function(a,b,c){return"<qtipvml:"+a+' xmlns="urn:schemas-microsoft.com:vml" class="qtip-vml" '+(b||"")+' style="behavior: url(#default#VML); '+(c||"")+'" />'};d.extend(v.prototype,{init:function(a){var b,c;c=this.element=a.elements.tip=d("<div />",{class:S+"-tip"}).prependTo(a.tooltip),ob?(b=d("<canvas />").appendTo(this.element)[0].getContext("2d"),b.lineJoin="miter",b.miterLimit=1e5,b.save()):(b=vb("shape",'coordorigin="0,0"',"position:absolute;"),this.element.html(b+b),a._bind(d("*",c).add(c),["click","mousedown"],function(a){a.stopPropagation()},this._ns)),a._bind(a.tooltip,"tooltipmove",this.reposition,this._ns,this),this.create()},_swapDimensions:function(){this.size[0]=this.options.height,this.size[1]=this.options.width},_resetDimensions:function(){this.size[0]=this.options.width,this.size[1]=this.options.height},_useTitle:function(a){var b=this.qtip.elements.titlebar;return b&&(a.y===K||a.y===O&&this.element.position().top+this.size[1]/2+this.options.offset<b.outerHeight(D))},_parseCorner:function(a){var b=this.qtip.options.position.my;return a===E||b===E?a=E:a===D?a=new A(b.string()):a.string||(a=new A(a),a.fixed=D),a},_parseWidth:function(a,b,c){var d=this.qtip.elements,e=jb+s(b)+"Width";return(c?u(c,e):u(d.content,e)||u(this._useTitle(a)&&d.titlebar||d.content,e)||u(d.tooltip,e))||0},_parseRadius:function(a){var b=this.qtip.elements,c=jb+s(a.y)+s(a.x)+"Radius";return db.ie<9?0:u(this._useTitle(a)&&b.titlebar||b.content,c)||u(b.tooltip,c)||0},_invalidColour:function(a,b,c){var d=a.css(b);return!d||c&&d===a.css(c)||pb.test(d)?E:d},_parseColours:function(a){var b=this.qtip.elements,c=this.element.css("cssText",""),e=jb+s(a[a.precedance])+s(kb),f=this._useTitle(a)&&b.titlebar||b.content,g=this._invalidColour,h=[];return h[0]=g(c,lb)||g(f,lb)||g(b.content,lb)||g(b.tooltip,lb)||c.css(lb),h[1]=g(c,e,kb)||g(f,e,kb)||g(b.content,e,kb)||g(b.tooltip,e,kb)||b.tooltip.css(e),d("*",c).add(c).css("cssText",lb+":"+mb+nb+";"+jb+":0"+nb+";"),h},_calculateSize:function(a){var b,c,d,e=a.precedance===H,f=this.options.width,g=this.options.height,h="c"===a.abbrev(),i=(e?f:g)*(h?.5:1),j=Math.pow,k=Math.round,l=Math.sqrt(j(i,2)+j(g,2)),m=[this.border/i*l,this.border/g*l];return m[2]=Math.sqrt(j(m[0],2)-j(this.border,2)),m[3]=Math.sqrt(j(m[1],2)-j(this.border,2)),b=l+m[2]+m[3]+(h?0:m[0]),c=b/l,d=[k(c*f),k(c*g)],e?d:d.reverse()},_calculateTip:function(a,b,c){c=c||1,b=b||this.size;var d=b[0]*c,e=b[1]*c,f=Math.ceil(d/2),g=Math.ceil(e/2),h={br:[0,0,d,e,d,0],bl:[0,0,d,0,0,e],tr:[0,e,d,0,d,e],tl:[0,0,0,e,d,e],tc:[0,e,f,0,d,e],bc:[0,0,d,0,f,e],rc:[0,0,d,g,0,e],lc:[d,0,d,e,0,g]};return h.lt=h.br,h.rt=h.bl,h.lb=h.tr,h.rb=h.tl,h[a.abbrev()]},_drawCoords:function(a,b){a.beginPath(),a.moveTo(b[0],b[1]),a.lineTo(b[2],b[3]),a.lineTo(b[4],b[5]),a.closePath()},create:function(){var a=this.corner=(ob||db.ie)&&this._parseCorner(this.options.corner);return(this.enabled=!!this.corner&&"c"!==this.corner.abbrev())&&(this.qtip.cache.corner=a.clone(),this.update()),this.element.toggle(this.enabled),this.corner},update:function(b,c){if(!this.enabled)return this;var e,f,g,h,i,j,k,l,m=this.qtip.elements,n=this.element,o=n.children(),p=this.options,q=this.size,r=p.mimic,s=Math.round;b||(b=this.qtip.cache.corner||this.corner),r===E?r=b:(r=new A(r),r.precedance=b.precedance,"inherit"===r.x?r.x=b.x:"inherit"===r.y?r.y=b.y:r.x===r.y&&(r[b.precedance]=b[b.precedance])),f=r.precedance,b.precedance===G?this._swapDimensions():this._resetDimensions(),e=this.color=this._parseColours(b),e[1]!==mb?(l=this.border=this._parseWidth(b,b[b.precedance]),p.border&&1>l&&!pb.test(e[1])&&(e[0]=e[1]),this.border=l=p.border!==D?p.border:l):this.border=l=0,k=this.size=this._calculateSize(b),n.css({width:k[0],height:k[1],lineHeight:k[1]+"px"}),j=b.precedance===H?[s(r.x===L?l:r.x===N?k[0]-q[0]-l:(k[0]-q[0])/2),s(r.y===K?k[1]-q[1]:0)]:[s(r.x===L?k[0]-q[0]:0),s(r.y===K?l:r.y===M?k[1]-q[1]-l:(k[1]-q[1])/2)],ob?(g=o[0].getContext("2d"),g.restore(),g.save(),g.clearRect(0,0,6e3,6e3),h=this._calculateTip(r,q,ub),i=this._calculateTip(r,this.size,ub),o.attr(I,k[0]*ub).attr(J,k[1]*ub),o.css(I,k[0]).css(J,k[1]),this._drawCoords(g,i),g.fillStyle=e[1],g.fill(),g.translate(j[0]*ub,j[1]*ub),this._drawCoords(g,h),g.fillStyle=e[0],g.fill()):(h=this._calculateTip(r),h="m"+h[0]+","+h[1]+" l"+h[2]+","+h[3]+" "+h[4]+","+h[5]+" xe",j[2]=l&&/^(r|b)/i.test(b.string())?8===db.ie?2:1:0,o.css({coordsize:k[0]+l+" "+(k[1]+l),antialias:""+(r.string().indexOf(O)>-1),left:j[0]-j[2]*Number(f===G),top:j[1]-j[2]*Number(f===H),width:k[0]+l,height:k[1]+l}).each(function(a){var b=d(this);b[b.prop?"prop":"attr"]({coordsize:k[0]+l+" "+(k[1]+l),path:h,fillcolor:e[0],filled:!!a,stroked:!a}).toggle(!(!l&&!a)),!a&&b.html(vb("stroke",'weight="'+2*l+'px" color="'+e[1]+'" miterlimit="1000" joinstyle="miter"'))})),a.opera&&setTimeout(function(){m.tip.css({display:"inline-block",visibility:"visible"})},1),c!==E&&this.calculate(b,k)},calculate:function(a,b){if(!this.enabled)return E;var c,e,f=this,g=this.qtip.elements,h=this.element,i=this.options.offset,j=(g.tooltip.hasClass("ui-widget"),{});return a=a||this.corner,c=a.precedance,b=b||this._calculateSize(a),e=[a.x,a.y],c===G&&e.reverse(),d.each(e,function(d,e){var h,k,l;e===O?(h=c===H?L:K,j[h]="50%",j[ib+"-"+h]=-Math.round(b[c===H?0:1]/2)+i):(h=f._parseWidth(a,e,g.tooltip),k=f._parseWidth(a,e,g.content),l=f._parseRadius(a),j[e]=Math.max(-f.border,d?k:i+(l>h?l:-h)))}),j[a[c]]-=b[c===G?0:1],h.css({margin:"",top:"",bottom:"",left:"",right:""}).css(j),j},reposition:function(a,b,d){function e(a,b,c,d,e){a===Q&&j.precedance===b&&k[d]&&j[c]!==O?j.precedance=j.precedance===G?H:G:a!==Q&&k[d]&&(j[b]=j[b]===O?k[d]>0?d:e:j[b]===d?e:d)}function f(a,b,e){j[a]===O?p[ib+"-"+b]=o[a]=g[ib+"-"+b]-k[b]:(h=g[e]!==c?[k[b],-g[b]]:[-k[b],g[b]],(o[a]=Math.max(h[0],h[1]))>h[0]&&(d[b]-=k[b],o[b]=E),p[g[e]!==c?e:b]=o[a])}if(this.enabled){var g,h,i=b.cache,j=this.corner.clone(),k=d.adjusted,l=b.options.position.adjust.method.split(" "),m=l[0],n=l[1]||l[0],o={left:E,top:E,x:0,y:0},p={};this.corner.fixed!==D&&(e(m,G,H,L,N),e(n,H,G,K,M),(j.string()!==i.corner.string()||i.cornerTop!==k.top||i.cornerLeft!==k.left)&&this.update(j,E)),g=this.calculate(j),g.right!==c&&(g.left=-g.right),g.bottom!==c&&(g.top=-g.bottom),g.user=this.offset,(o.left=m===Q&&!!k.left)&&f(G,L,N),(o.top=n===Q&&!!k.top)&&f(H,K,M),this.element.css(p).toggle(!(o.x&&o.y||j.x===O&&o.y||j.y===O&&o.x)),d.left-=g.left.charAt?g.user:m!==Q||o.top||!o.left&&!o.top?g.left+this.border:0,d.top-=g.top.charAt?g.user:n!==Q||o.left||!o.left&&!o.top?g.top+this.border:0,i.cornerLeft=k.left,i.cornerTop=k.top,i.corner=j.clone()}},destroy:function(){this.qtip._unbind(this.qtip.tooltip,this._ns),this.qtip.elements.tip&&this.qtip.elements.tip.find("*").remove().end().remove()}}),hb=R.tip=function(a){return new v(a,a.options.style.tip)},hb.initialize="render",hb.sanitize=function(a){if(a.style&&"tip"in a.style){var b=a.style.tip;"object"!=typeof b&&(b=a.style.tip={corner:b}),/string|boolean/i.test(typeof b.corner)||(b.corner=D)}},B.tip={"^position.my|style.tip.(corner|mimic|border)$":function(){this.create(),this.qtip.reposition()},"^style.tip.(height|width)$":function(a){this.size=[a.width,a.height],this.update(),this.qtip.reposition()},"^content.title|style.(classes|widget)$":function(){this.update()}},d.extend(D,y.defaults,{style:{tip:{corner:D,mimic:E,width:6,height:6,border:D,offset:0}}});var wb,xb,yb="qtip-modal",zb="."+yb;xb=function(){function a(a){if(d.expr[":"].focusable)return d.expr[":"].focusable;var b,c,e,f=!isNaN(d.attr(a,"tabindex")),g=a.nodeName&&a.nodeName.toLowerCase();return"area"===g?(b=a.parentNode,c=b.name,a.href&&c&&"map"===b.nodeName.toLowerCase()?(e=d("img[usemap=#"+c+"]")[0],!!e&&e.is(":visible")):!1):/input|select|textarea|button|object/.test(g)?!a.disabled:"a"===g?a.href||f:f}function c(a){k.length<1&&a.length?a.not("body").blur():k.first().focus()}function e(a){if(i.is(":visible")){var b,e=d(a.target),h=f.tooltip,j=e.closest(W);b=j.length<1?E:parseInt(j[0].style.zIndex,10)>parseInt(h[0].style.zIndex,10),b||e.closest(W)[0]===h[0]||c(e),g=a.target===k[k.length-1]}}var f,g,h,i,j=this,k={};d.extend(j,{init:function(){return i=j.elem=d("<div />",{id:"qtip-overlay",html:"<div></div>",mousedown:function(){return E}}).hide(),d(b.body).bind("focusin"+zb,e),d(b).bind("keydown"+zb,function(a){f&&f.options.show.modal.escape&&27===a.keyCode&&f.hide(a)}),i.bind("click"+zb,function(a){f&&f.options.show.modal.blur&&f.hide(a)}),j},update:function(b){f=b,k=b.options.show.modal.stealfocus!==E?b.tooltip.find("*").filter(function(){return a(this)}):[]},toggle:function(a,e,g){var k=(d(b.body),a.tooltip),l=a.options.show.modal,m=l.effect,n=e?"show":"hide",o=i.is(":visible"),p=d(zb).filter(":visible:not(:animated)").not(k);return j.update(a),e&&l.stealfocus!==E&&c(d(":focus")),i.toggleClass("blurs",l.blur),e&&i.appendTo(b.body),i.is(":animated")&&o===e&&h!==E||!e&&p.length?j:(i.stop(D,E),d.isFunction(m)?m.call(i,e):m===E?i[n]():i.fadeTo(parseInt(g,10)||90,e?1:0,function(){e||i.hide()}),e||i.queue(function(a){i.css({left:"",top:""}),d(zb).length||i.detach(),a()}),h=e,f.destroyed&&(f=F),j)}}),j.init()},xb=new xb,d.extend(w.prototype,{init:function(a){var b=a.tooltip;return this.options.on?(a.elements.overlay=xb.elem,b.addClass(yb).css("z-index",y.modal_zindex+d(zb).length),a._bind(b,["tooltipshow","tooltiphide"],function(a,c,e){var f=a.originalEvent;if(a.target===b[0])if(f&&"tooltiphide"===a.type&&/mouse(leave|enter)/.test(f.type)&&d(f.relatedTarget).closest(xb.elem[0]).length)try{a.preventDefault()}catch(g){}else(!f||f&&"tooltipsolo"!==f.type)&&this.toggle(a,"tooltipshow"===a.type,e)},this._ns,this),a._bind(b,"tooltipfocus",function(a,c){if(!a.isDefaultPrevented()&&a.target===b[0]){var e=d(zb),f=y.modal_zindex+e.length,g=parseInt(b[0].style.zIndex,10);xb.elem[0].style.zIndex=f-1,e.each(function(){this.style.zIndex>g&&(this.style.zIndex-=1)}),e.filter("."+$).qtip("blur",a.originalEvent),b.addClass($)[0].style.zIndex=f,xb.update(c);try{a.preventDefault()}catch(h){}}},this._ns,this),void a._bind(b,"tooltiphide",function(a){a.target===b[0]&&d(zb).filter(":visible").not(b).last().qtip("focus",a)},this._ns,this)):this},toggle:function(a,b,c){return a&&a.isDefaultPrevented()?this:void xb.toggle(this.qtip,!!b,c)},destroy:function(){this.qtip.tooltip.removeClass(yb),this.qtip._unbind(this.qtip.tooltip,this._ns),xb.toggle(this.qtip,E),delete this.qtip.elements.overlay}}),wb=R.modal=function(a){return new w(a,a.options.show.modal)},wb.sanitize=function(a){a.show&&("object"!=typeof a.show.modal?a.show.modal={on:!!a.show.modal}:"undefined"==typeof a.show.modal.on&&(a.show.modal.on=D))},y.modal_zindex=y.zindex-200,wb.initialize="render",B.modal={"^show.modal.(on|blur)$":function(){this.destroy(),this.init(),this.qtip.elems.overlay.toggle(this.qtip.tooltip[0].offsetWidth>0)}},d.extend(D,y.defaults,{show:{modal:{on:E,effect:D,blur:D,stealfocus:D,escape:D}}}),R.viewport=function(c,d,e,f,g,h,i){function j(a,b,c,e,f,g,h,i,j){var k=d[f],s=u[a],t=v[a],w=c===Q,x=s===f?j:s===g?-j:-j/2,y=t===f?i:t===g?-i:-i/2,z=q[f]+r[f]-(n?0:m[f]),A=z-k,B=k+j-(h===I?o:p)-z,C=x-(u.precedance===a||s===u[b]?y:0)-(t===O?i/2:0);return w?(C=(s===f?1:-1)*x,d[f]+=A>0?A:B>0?-B:0,d[f]=Math.max(-m[f]+r[f],k-C,Math.min(Math.max(-m[f]+r[f]+(h===I?o:p),k+C),d[f],"center"===s?k-x:1e9))):(e*=c===P?2:0,A>0&&(s!==f||B>0)?(d[f]-=C+e,l.invert(a,f)):B>0&&(s!==g||A>0)&&(d[f]-=(s===O?-C:C)+e,l.invert(a,g)),d[f]<q&&-d[f]>B&&(d[f]=k,l=u.clone())),d[f]-k}var k,l,m,n,o,p,q,r,s=e.target,t=c.elements.tooltip,u=e.my,v=e.at,w=e.adjust,x=w.method.split(" "),y=x[0],z=x[1]||x[0],A=e.viewport,B=e.container,C=(c.cache,{left:0,top:0});return A.jquery&&s[0]!==a&&s[0]!==b.body&&"none"!==w.method?(m=B.offset()||C,n="static"===B.css("position"),k="fixed"===t.css("position"),o=A[0]===a?A.width():A.outerWidth(E),p=A[0]===a?A.height():A.outerHeight(E),q={left:k?0:A.scrollLeft(),top:k?0:A.scrollTop()},r=A.offset()||C,("shift"!==y||"shift"!==z)&&(l=u.clone()),C={left:"none"!==y?j(G,H,y,w.x,L,N,I,f,h):0,top:"none"!==z?j(H,G,z,w.y,K,M,J,g,i):0,my:l}):C},R.polys={polygon:function(a,b){var c,d,e,f={width:0,height:0,position:{top:1e10,right:0,bottom:0,left:1e10},adjustable:E},g=0,h=[],i=1,j=1,k=0,l=0;for(g=a.length;g--;)c=[parseInt(a[--g],10),parseInt(a[g+1],10)],c[0]>f.position.right&&(f.position.right=c[0]),c[0]<f.position.left&&(f.position.left=c[0]),c[1]>f.position.bottom&&(f.position.bottom=c[1]),c[1]<f.position.top&&(f.position.top=c[1]),h.push(c);if(d=f.width=Math.abs(f.position.right-f.position.left),e=f.height=Math.abs(f.position.bottom-f.position.top),"c"===b.abbrev())f.position={left:f.position.left+f.width/2,top:f.position.top+f.height/2};else{for(;d>0&&e>0&&i>0&&j>0;)for(d=Math.floor(d/2),e=Math.floor(e/2),b.x===L?i=d:b.x===N?i=f.width-d:i+=Math.floor(d/2),b.y===K?j=e:b.y===M?j=f.height-e:j+=Math.floor(e/2),g=h.length;g--&&!(h.length<2);)k=h[g][0]-f.position.left,l=h[g][1]-f.position.top,(b.x===L&&k>=i||b.x===N&&i>=k||b.x===O&&(i>k||k>f.width-i)||b.y===K&&l>=j||b.y===M&&j>=l||b.y===O&&(j>l||l>f.height-j))&&h.splice(g,1);f.position={left:h[0][0],top:h[0][1]}}return f},rect:function(a,b,c,d){return{width:Math.abs(c-a),height:Math.abs(d-b),position:{left:Math.min(a,c),top:Math.min(b,d)}}},_angles:{tc:1.5,tr:7/4,tl:5/4,bc:.5,br:.25,bl:.75,rc:2,lc:1,c:0},ellipse:function(a,b,c,d,e){var f=R.polys._angles[e.abbrev()],g=0===f?0:c*Math.cos(f*Math.PI),h=d*Math.sin(f*Math.PI);return{width:2*c-Math.abs(g),height:2*d-Math.abs(h),position:{left:a+g,top:b+h},adjustable:E}},circle:function(a,b,c,d){return R.polys.ellipse(a,b,c,c,d)}},R.svg=function(a,c,e){for(var f,g,h,i,j,k,l,m,n,o=(d(b),c[0]),p=d(o.ownerSVGElement),q=o.ownerDocument,r=(parseInt(c.css("stroke-width"),10)||0)/2;!o.getBBox;)o=o.parentNode;if(!o.getBBox||!o.parentNode)return E;switch(o.nodeName){case"ellipse":case"circle":m=R.polys.ellipse(o.cx.baseVal.value,o.cy.baseVal.value,(o.rx||o.r).baseVal.value+r,(o.ry||o.r).baseVal.value+r,e);break;case"line":case"polygon":case"polyline":for(l=o.points||[{x:o.x1.baseVal.value,y:o.y1.baseVal.value},{x:o.x2.baseVal.value,y:o.y2.baseVal.value}],m=[],k=-1,i=l.numberOfItems||l.length;++k<i;)j=l.getItem?l.getItem(k):l[k],m.push.apply(m,[j.x,j.y]);m=R.polys.polygon(m,e);break;default:m=o.getBBox(),m={width:m.width,height:m.height,position:{left:m.x,top:m.y}}}return n=m.position,p=p[0],p.createSVGPoint&&(g=o.getScreenCTM(),l=p.createSVGPoint(),l.x=n.left,l.y=n.top,h=l.matrixTransform(g),n.left=h.x,n.top=h.y),q!==b&&"mouse"!==a.position.target&&(f=d((q.defaultView||q.parentWindow).frameElement).offset(),f&&(n.left+=f.left,n.top+=f.top)),q=d(q),n.left+=q.scrollLeft(),n.top+=q.scrollTop(),m},R.imagemap=function(a,b,c){b.jquery||(b=d(b));var e,f,g,h,i,j=(b.attr("shape")||"rect").toLowerCase().replace("poly","polygon"),k=d('img[usemap="#'+b.parent("map").attr("name")+'"]'),l=d.trim(b.attr("coords")),m=l.replace(/,$/,"").split(",");if(!k.length)return E;if("polygon"===j)h=R.polys.polygon(m,c);else{if(!R.polys[j])return E;for(g=-1,i=m.length,f=[];++g<i;)f.push(parseInt(m[g],10));h=R.polys[j].apply(this,f.concat(c))}return e=k.offset(),e.left+=Math.ceil((k.outerWidth(E)-k.width())/2),e.top+=Math.ceil((k.outerHeight(E)-k.height())/2),h.position.left+=e.left,h.position.top+=e.top,h};var Ab,Bb='<iframe class="qtip-bgiframe" frameborder="0" tabindex="-1" src="javascript:\'\';"  style="display:block; position:absolute; z-index:-1; filter:alpha(opacity=0); -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";"></iframe>';d.extend(x.prototype,{_scroll:function(){var b=this.qtip.elements.overlay;b&&(b[0].style.top=d(a).scrollTop()+"px")},init:function(c){var e=c.tooltip;d("select, object").length<1&&(this.bgiframe=c.elements.bgiframe=d(Bb).appendTo(e),c._bind(e,"tooltipmove",this.adjustBGIFrame,this._ns,this)),this.redrawContainer=d("<div/>",{id:S+"-rcontainer"}).appendTo(b.body),c.elements.overlay&&c.elements.overlay.addClass("qtipmodal-ie6fix")&&(c._bind(a,["scroll","resize"],this._scroll,this._ns,this),c._bind(e,["tooltipshow"],this._scroll,this._ns,this)),this.redraw()},adjustBGIFrame:function(){var a,b,c=this.qtip.tooltip,d={height:c.outerHeight(E),width:c.outerWidth(E)},e=this.qtip.plugins.tip,f=this.qtip.elements.tip;b=parseInt(c.css("borderLeftWidth"),10)||0,b={left:-b,top:-b},e&&f&&(a="x"===e.corner.precedance?[I,L]:[J,K],b[a[1]]-=f[a[0]]()),this.bgiframe.css(b).css(d)},redraw:function(){if(this.qtip.rendered<1||this.drawing)return this;var a,b,c,d,e=this.qtip.tooltip,f=this.qtip.options.style,g=this.qtip.options.position.container;return this.qtip.drawing=1,f.height&&e.css(J,f.height),f.width?e.css(I,f.width):(e.css(I,"").appendTo(this.redrawContainer),b=e.width(),1>b%2&&(b+=1),c=e.css("maxWidth")||"",d=e.css("minWidth")||"",a=(c+d).indexOf("%")>-1?g.width()/100:0,c=(c.indexOf("%")>-1?a:1)*parseInt(c,10)||b,d=(d.indexOf("%")>-1?a:1)*parseInt(d,10)||0,b=c+d?Math.min(Math.max(b,d),c):b,e.css(I,Math.round(b)).appendTo(g)),this.drawing=0,this},destroy:function(){this.bgiframe&&this.bgiframe.remove(),this.qtip._unbind([a,this.qtip.tooltip],this._ns)}}),Ab=R.ie6=function(a){return 6===db.ie?new x(a):E},Ab.initialize="render",B.ie6={"^content|style$":function(){this.redraw()}}})}(window,document);(function(g,f){"use strict";var h=function(e){if("object"!==typeof e.document)throw Error("Cookies.js requires a `window` with a `document` object");var b=function(a,d,c){return 1===arguments.length?b.get(a):b.set(a,d,c)};b._document=e.document;b._cacheKeyPrefix="cookey.";b.defaults={path:"/",secure:!1};b.get=function(a){b._cachedDocumentCookie!==b._document.cookie&&b._renewCache();return b._cache[b._cacheKeyPrefix+a]};b.set=function(a,d,c){c=b._getExtendedOptions(c);c.expires=b._getExpiresDate(d===f?-1:c.expires);b._document.cookie=b._generateCookieString(a,d,c);return b};b.expire=function(a,d){return b.set(a,f,d)};b._getExtendedOptions=function(a){return{path:a&&a.path||b.defaults.path,domain:a&&a.domain||b.defaults.domain,expires:a&&a.expires||b.defaults.expires,secure:a&&a.secure!==f?a.secure:b.defaults.secure}};b._isValidDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())};b._getExpiresDate=function(a,d){d=d||new Date;switch(typeof a){case"number":a=new Date(d.getTime()+1e3*a);break;case"string":a=new Date(a)}if(a&&!b._isValidDate(a))throw Error("`expires` parameter cannot be converted to a valid Date instance");return a};b._generateCookieString=function(a,b,c){a=a.replace(/[^#$&+\^`|]/g,encodeURIComponent);a=a.replace(/\(/g,"%28").replace(/\)/g,"%29");b=(b+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent);c=c||{};a=a+"="+b+(c.path?";path="+c.path:"");a+=c.domain?";domain="+c.domain:"";a+=c.expires?";expires="+c.expires.toUTCString():"";return a+=c.secure?";secure":""};b._getCacheFromString=function(a){var d={};a=a?a.split("; "):[];for(var c=0;c<a.length;c++){var e=b._getKeyValuePairFromCookieString(a[c]);d[b._cacheKeyPrefix+e.key]===f&&(d[b._cacheKeyPrefix+e.key]=e.value)}return d}
;b._getKeyValuePairFromCookieString=function(a){var b=a.indexOf("="),b=0>b?a.length:b;return{key:decodeURIComponent(a.substr(0,b)),value:decodeURIComponent(a.substr(b+1))}};b._renewCache=function(){b._cache=b._getCacheFromString(b._document.cookie);b._cachedDocumentCookie=b._document.cookie};b._areEnabled=function(){var a="1"===b.set("cookies.js",1).get("cookies.js");b.expire("cookies.js");return a};b.enabled=b._areEnabled();return b},e="object"===typeof g.document?h(g):h;"function"===typeof define&&define.amd?define(function(){return e}):"object"===typeof exports?("object"===typeof module&&"object"===typeof module.exports&&(exports=module.exports=e),exports.Cookies=e):g.Cookies=e})("undefined"===typeof window?this:window);(function(root,factory){if(typeof exports==="object"){module.exports=exports=factory()}else if(typeof define==="function"&&define.amd){define([],factory)}else{root.CryptoJS=factory()}})(this,function(){var CryptoJS=CryptoJS||function(Math,undefined){var C={};var C_lib=C.lib={};var Base=C_lib.Base=function(){function F(){}return{extend:function(overrides){F.prototype=this;var subtype=new F;if(overrides){subtype.mixIn(overrides)}if(!subtype.hasOwnProperty("init")){subtype.init=function(){subtype.$super.init.apply(this,arguments)}}subtype.init.prototype=subtype;subtype.$super=this;return subtype},create:function(){var instance=this.extend();instance.init.apply(instance,arguments);return instance},init:function(){},mixIn:function(properties){for(var propertyName in properties){if(properties.hasOwnProperty(propertyName)){this[propertyName]=properties[propertyName]}}if(properties.hasOwnProperty("toString")){this.toString=properties.toString}},clone:function(){return this.init.prototype.extend(this)}}}();var WordArray=C_lib.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[];if(sigBytes!=undefined){this.sigBytes=sigBytes}else{this.sigBytes=words.length*4}},toString:function(encoder){return(encoder||Hex).stringify(this)},concat:function(wordArray){var thisWords=this.words;var thatWords=wordArray.words;var thisSigBytes=this.sigBytes;var thatSigBytes=wordArray.sigBytes;this.clamp();if(thisSigBytes%4){for(var i=0;i<thatSigBytes;i++){var thatByte=thatWords[i>>>2]>>>24-i%4*8&255;thisWords[thisSigBytes+i>>>2]|=thatByte<<24-(thisSigBytes+i)%4*8}}else if(thatWords.length>65535){for(var i=0;i<thatSigBytes;i+=4){thisWords[thisSigBytes+i>>>2]=thatWords[i>>>2]}}else{thisWords.push.apply(thisWords,thatWords)}this.sigBytes+=thatSigBytes;return this},clamp:function(){var words=this.words;var sigBytes=this.sigBytes;words[sigBytes>>>2]&=4294967295<<32-sigBytes%4*8;words.length=Math.ceil(sigBytes/4)},clone:function(){var clone=Base.clone.call(this);clone.words=this.words.slice(0);return clone},random:function(nBytes){var words=[];var r=function(m_w){var m_w=m_w;var m_z=987654321;var mask=4294967295;return function(){m_z=36969*(m_z&65535)+(m_z>>16)&mask;m_w=18e3*(m_w&65535)+(m_w>>16)&mask;var result=(m_z<<16)+m_w&mask;result/=4294967296;result+=.5;return result*(Math.random()>.5?1:-1)}};for(var i=0,rcache;i<nBytes;i+=4){var _r=r((rcache||Math.random())*4294967296);rcache=_r()*987654071;words.push(_r()*4294967296|0)}return new WordArray.init(words,nBytes)}});var C_enc=C.enc={};var Hex=C_enc.Hex={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var hexChars=[];for(var i=0;i<sigBytes;i++){var bite=words[i>>>2]>>>24-i%4*8&255;hexChars.push((bite>>>4).toString(16));hexChars.push((bite&15).toString(16))}return hexChars.join("")},parse:function(hexStr){var hexStrLength=hexStr.length;var words=[];for(var i=0;i<hexStrLength;i+=2){words[i>>>3]|=parseInt(hexStr.substr(i,2),16)<<24-i%8*4}return new WordArray.init(words,hexStrLength/2)}};var Latin1=C_enc.Latin1={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var latin1Chars=[];for(var i=0;i<sigBytes;i++){var bite=words[i>>>2]>>>24-i%4*8&255;latin1Chars.push(String.fromCharCode(bite))}return latin1Chars.join("")},parse:function(latin1Str){var latin1StrLength=latin1Str.length;var words=[];for(var i=0;i<latin1StrLength;i++){words[i>>>2]|=(latin1Str.charCodeAt(i)&255)<<24-i%4*8}return new WordArray.init(words,latin1StrLength)}};var Utf8=C_enc.Utf8={stringify:function(wordArray){try{return decodeURIComponent(escape(Latin1.stringify(wordArray)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(utf8Str){return Latin1.parse(unescape(encodeURIComponent(utf8Str)))}};var BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm=Base.extend({reset:function(){this._data=new WordArray.init;this._nDataBytes=0},_append:function(data){if(typeof data=="string"){data=Utf8.parse(data)}this._data.concat(data);this._nDataBytes+=data.sigBytes},_process:function(doFlush){var data=this._data;var dataWords=data.words;var dataSigBytes=data.sigBytes;var blockSize=this.blockSize;var blockSizeBytes=blockSize*4;var nBlocksReady=dataSigBytes/blockSizeBytes;if(doFlush){nBlocksReady=Math.ceil(nBlocksReady)}else{nBlocksReady=Math.max((nBlocksReady|0)-this._minBufferSize,0)}var nWordsReady=nBlocksReady*blockSize;var nBytesReady=Math.min(nWordsReady*4,dataSigBytes);if(nWordsReady){for(var offset=0;offset<nWordsReady;offset+=blockSize){this._doProcessBlock(dataWords,offset)}var processedWords=dataWords.splice(0,nWordsReady);data.sigBytes-=nBytesReady}return new WordArray.init(processedWords,nBytesReady)},clone:function(){var clone=Base.clone.call(this);clone._data=this._data.clone();return clone},_minBufferSize:0});var Hasher=C_lib.Hasher=BufferedBlockAlgorithm.extend({cfg:Base.extend(),init:function(cfg){this.cfg=this.cfg.extend(cfg);this.reset()},reset:function(){BufferedBlockAlgorithm.reset.call(this);this._doReset()},update:function(messageUpdate){this._append(messageUpdate);this._process();return this},finalize:function(messageUpdate){if(messageUpdate){this._append(messageUpdate)}var hash=this._doFinalize();return hash},blockSize:512/32,_createHelper:function(hasher){return function(message,cfg){return new hasher.init(cfg).finalize(message)}},_createHmacHelper:function(hasher){return function(message,key){return new C_algo.HMAC.init(hasher,key).finalize(message)}}});var C_algo=C.algo={};return C}(Math);return CryptoJS});(function(root,factory){if(typeof exports==="object"){module.exports=exports=factory(require("./core"))}else if(typeof define==="function"&&define.amd){define(["./core"],factory)}else{factory(root.CryptoJS)}})(this,function(CryptoJS){(function(){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var Hasher=C_lib.Hasher;var C_algo=C.algo;var W=[];var SHA1=C_algo.SHA1=Hasher.extend({_doReset:function(){this._hash=new WordArray.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(M,offset){var H=this._hash.words;var a=H[0];var b=H[1];var c=H[2];var d=H[3];var e=H[4];for(var i=0;i<80;i++){if(i<16){W[i]=M[offset+i]|0}else{var n=W[i-3]^W[i-8]^W[i-14]^W[i-16];W[i]=n<<1|n>>>31}var t=(a<<5|a>>>27)+e+W[i];if(i<20){t+=(b&c|~b&d)+1518500249}else if(i<40){t+=(b^c^d)+1859775393}else if(i<60){t+=(b&c|b&d|c&d)-1894007588}else{t+=(b^c^d)-899497514}e=d;d=c;c=b<<30|b>>>2;b=a;a=t}H[0]=H[0]+a|0;H[1]=H[1]+b|0;H[2]=H[2]+c|0;H[3]=H[3]+d|0;H[4]=H[4]+e|0},_doFinalize:function(){var data=this._data;var dataWords=data.words;var nBitsTotal=this._nDataBytes*8;var nBitsLeft=data.sigBytes*8;dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32;dataWords[(nBitsLeft+64>>>9<<4)+14]=Math.floor(nBitsTotal/4294967296);dataWords[(nBitsLeft+64>>>9<<4)+15]=nBitsTotal;data.sigBytes=dataWords.length*4;this._process();return this._hash},clone:function(){var clone=Hasher.clone.call(this);clone._hash=this._hash.clone();return clone}});C.SHA1=Hasher._createHelper(SHA1);C.HmacSHA1=Hasher._createHmacHelper(SHA1)})();return CryptoJS.SHA1});var HighchartsAdapter=function(){function p(c){function b(b,a,d){b.removeEventListener(a,d,!1)}function d(b,a,d){d=b.HCProxiedMethods[d.toString()];b.detachEvent("on"+a,d)}function a(a,c){var f=a.HCEvents,i,g,k,j;if(a.removeEventListener)i=b;else if(a.attachEvent)i=d;else return;c?(g={},g[c]=!0):g=f;for(j in g)if(f[j])for(k=f[j].length;k--;)i(a,j,f[j][k])}c.HCExtended||Highcharts.extend(c,{HCExtended:!0,HCEvents:{},bind:function(b,a){var d=this,c=this.HCEvents,g;if(d.addEventListener)d.addEventListener(b,a,!1);else if(d.attachEvent){g=function(b){b.target=b.srcElement||window;a.call(d,b)};if(!d.HCProxiedMethods)d.HCProxiedMethods={};d.HCProxiedMethods[a.toString()]=g;d.attachEvent("on"+b,g)}c[b]===s&&(c[b]=[]);c[b].push(a)},unbind:function(c,h){var f,i;c?(f=this.HCEvents[c]||[],h?(i=HighchartsAdapter.inArray(h,f),i>-1&&(f.splice(i,1),this.HCEvents[c]=f),this.removeEventListener?b(this,c,h):this.attachEvent&&d(this,c,h)):(a(this,c),this.HCEvents[c]=[])):(a(this),this.HCEvents={})},trigger:function(b,a){var d=this.HCEvents[b]||[],c=d.length,g,k,j;k=function(){a.defaultPrevented=!0};for(g=0;g<c;g++){j=d[g];if(a.stopped)break;a.preventDefault=k;a.target=this;if(!a.type)a.type=b;j.call(this,a)===!1&&a.preventDefault()}}});return c}var s,l=document,q=[],m=[],r,n={},o;Math.easeInOutSine=function(c,b,d,a){return-d/2*(Math.cos(Math.PI*c/a)-1)+b};return{init:function(c){if(!l.defaultView)this._getStyle=function(b,d){var a;return b.style[d]?b.style[d]:(d==="opacity"&&(d="filter"),a=b.currentStyle[d.replace(/\-(\w)/g,function(b,a){return a.toUpperCase()})],d==="filter"&&(a=a.replace(/alpha\(opacity=([0-9]+)\)/,function(b,a){return a/100})),a===""?1:a)},this.adapterRun=function(b,d){var a={width:"clientWidth",height:"clientHeight"}[d];if(a)return b.style.zoom=1,b[a]-2*parseInt(HighchartsAdapter._getStyle(b,"padding"),10)};if(!Array.prototype.forEach)this.each=function(b,d){for(var a=0,c=b.length;a<c;a++)if(d.call(b[a],b[a],a,b)===!1)return a};if(!Array.prototype.indexOf)this.inArray=function(b,d){var a,c=0;if(d)for(a=d.length;c<a;c++)if(d[c]===b)return c;return-1};if(!Array.prototype.filter)this.grep=function(b,d){for(var a=[],c=0,h=b.length;c<h;c++)d(b[c],c)&&a.push(b[c]);return a};o=function(b,c,a){this.options=c;this.elem=b;this.prop=a};o.prototype={update:function(){var b;b=this.paths;var d=this.elem,a=d.element;if(n[this.prop])n[this.prop](this);else b&&a?d.attr("d",c.step(b[0],b[1],this.now,this.toD)):d.attr?a&&d.attr(this.prop,this.now):(b={},b[this.prop]=this.now+this.unit,Highcharts.css(d,b));this.options.step&&this.options.step.call(this.elem,this.now,this)},custom:function(b,c,a){var e=this,h=function(a){return e.step(a)},f;this.startTime=+new Date;this.start=b;this.end=c;this.unit=a;this.now=this.start;this.pos=this.state=0;h.elem=this.elem;h()&&m.push(h)===1&&(r=setInterval(function(){for(f=0;f<m.length;f++)m[f]()||m.splice(f--,1);m.length||clearInterval(r)},13))},step:function(b){var c=+new Date,a;a=this.options;var e=this.elem,h;if(e.stopAnimation||e.attr&&!e.element)a=!1;else if(b||c>=a.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();b=this.options.curAnim[this.prop]=!0;for(h in a.curAnim)a.curAnim[h]!==!0&&(b=!1);b&&a.complete&&a.complete.call(e);a=!1}else e=c-this.startTime,this.state=e/a.duration,this.pos=a.easing(e,0,1,a.duration),this.now=this.start+(this.end-this.start)*this.pos,this.update(),a=!0;return a}};this.animate=function(b,d,a){var e,h="",f,i,g;b.stopAnimation=!1;if(typeof a!=="object"||a===null)e=arguments,a={duration:e[2],easing:e[3],complete:e[4]};if(typeof a.duration!=="number")a.duration=400;a.easing=Math[a.easing]||Math.easeInOutSine;a.curAnim=Highcharts.extend({},d);for(g in d)i=new o(b,a,g),f=null,g==="d"?(i.paths=c.init(b,b.d,d.d),i.toD=d.d,e=0,f=1):b.attr?e=b.attr(g):(e=parseFloat(HighchartsAdapter._getStyle(b,g))||0,g!=="opacity"&&(h="px")),f||(f=d[g]),i.custom(e,f,h)}},_getStyle:function(c,b){return window.getComputedStyle(c,void 0).getPropertyValue(b)},addAnimSetter:function(c,b){n[c]=b},getScript:function(c,b){var d=l.getElementsByTagName("head")[0],a=l.createElement("script");a.type="text/javascript";a.src=c;a.onload=b;d.appendChild(a)},inArray:function(c,b){return b.indexOf?b.indexOf(c):q.indexOf.call(b,c)},adapterRun:function(c,b){return parseInt(HighchartsAdapter._getStyle(c,b),10)},grep:function(c,b){return q.filter.call(c,b)},map:function(c,b){for(var d=[],a=0,e=c.length;a<e;a++)d[a]=b.call(c[a],c[a],a,c);return d},offset:function(c){var b=document.documentElement,c=c.getBoundingClientRect();return{top:c.top+(window.pageYOffset||b.scrollTop)-(b.clientTop||0),left:c.left+(window.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}},addEvent:function(c,b,d){p(c).bind(b,d)},removeEvent:function(c,b,d){p(c).unbind(b,d)},fireEvent:function(c,b,d,a){var e;l.createEvent&&(c.dispatchEvent||c.fireEvent)?(e=l.createEvent("Events"),e.initEvent(b,!0,!0),e.target=c,Highcharts.extend(e,d),c.dispatchEvent?c.dispatchEvent(e):c.fireEvent(b,e)):c.HCExtended===!0&&(d=d||{},c.trigger(b,d));d&&d.defaultPrevented&&(a=null);a&&a(d)},washMouseEvent:function(c){return c},stop:function(c){c.stopAnimation=!0},each:function(c,b){return Array.prototype.forEach.call(c,b)}}}();(function(){function r(a,b){var c;a||(a={});for(c in b)a[c]=b[c];return a}function w(){var a,b=arguments,c,d={},e=function(a,b){var c,d;typeof a!=="object"&&(a={});for(d in b)b.hasOwnProperty(d)&&(c=b[d],a[d]=c&&typeof c==="object"&&Object.prototype.toString.call(c)!=="[object Array]"&&d!=="renderTo"&&typeof c.nodeType!=="number"?e(a[d]||{},c):b[d]);return a};b[0]===!0&&(d=b[1],b=Array.prototype.slice.call(b,2));c=b.length;for(a=0;a<c;a++)d=e(d,b[a]);return d}function y(a,b){return parseInt(a,b||10)}function Ga(a){return typeof a==="string"}function da(a){return a&&typeof a==="object"}function Ha(a){return Object.prototype.toString.call(a)==="[object Array]"}function ja(a){return typeof a==="number"}function za(a){return V.log(a)/V.LN10}function ka(a){return V.pow(10,a)}function la(a,b){for(var c=a.length;c--;)if(a[c]===b){a.splice(c,1);break}}function s(a){return a!==u&&a!==null}function F(a,b,c){var d,e;if(Ga(b))s(c)?a.setAttribute(b,c):a&&a.getAttribute&&(e=a.getAttribute(b));else if(s(b)&&da(b))for(d in b)a.setAttribute(d,b[d]);return e}function ra(a){return Ha(a)?a:[a]}function p(){var a=arguments,b,c,d=a.length;for(b=0;b<d;b++)if(c=a[b],c!==u&&c!==null)return c}function B(a,b){if(Aa&&!ba&&b&&b.opacity!==u)b.filter="alpha(opacity="+b.opacity*100+")";r(a.style,b)}function $(a,b,c,d,e){a=x.createElement(a);b&&r(a,b);e&&B(a,{padding:0,border:P,margin:0});c&&B(a,c);d&&d.appendChild(a);return a}function ma(a,b){var c=function(){return u};c.prototype=new a;r(c.prototype,b);return c}function Ba(a,b,c,d){var e=K.numberFormat,f=E.lang,g=+a||0,h=b===-1?(g.toString().split(".")[1]||"").length:isNaN(b=Q(b))?2:b,i=c===void 0?f.decimalPoint:c,f=d===void 0?f.thousandsSep:d,j=g<0?"-":"",k=String(y(g=Q(g).toFixed(h))),l=k.length>3?k.length%3:0;return e!==Ba?e(a,b,c,d):j+(l?k.substr(0,l)+f:"")+k.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+f)+(h?i+Q(g-k).toFixed(h).slice(2):"")}function Ia(a,b){return Array((b||2)+1-String(a).length).join(0)+a}function Na(a,b,c){var d=a[b];a[b]=function(){var a=Array.prototype.slice.call(arguments);a.unshift(d);return c.apply(this,a)}}function Ja(a,b){for(var c="{",d=!1,e,f,g,h,i,j=[];(c=a.indexOf(c))!==-1;){e=a.slice(0,c);if(d){f=e.split(":");g=f.shift().split(".");i=g.length;e=b;for(h=0;h<i;h++)e=e[g[h]];if(f.length)f=f.join(":"),g=/\.([0-9])/,h=E.lang,i=void 0,/f$/.test(f)?(i=(i=f.match(g))?i[1]:-1,e!==null&&(e=Ba(e,i,h.decimalPoint,f.indexOf(",")>-1?h.thousandsSep:""))):e=cb(f,e)}j.push(e);a=a.slice(c+1);c=(d=!d)?"}":"{"}j.push(a);return j.join("")}function mb(a){return V.pow(10,U(V.log(a)/V.LN10))}function nb(a,b,c,d){var e,c=p(c,1);e=a/c;b||(b=[1,2,2.5,5,10],d===!1&&(c===1?b=[1,2,5,10]:c<=.1&&(b=[1/c])));for(d=0;d<b.length;d++)if(a=b[d],e<=(b[d]+(b[d+1]||b[d]))/2)break;a*=c;return a}function ob(a,b){var c=a.length,d,e;for(e=0;e<c;e++)a[e].ss_i=e;a.sort(function(a,c){d=b(a,c);return d===0?a.ss_i-c.ss_i:d});for(e=0;e<c;e++)delete a[e].ss_i}function Oa(a){for(var b=a.length,c=a[0];b--;)a[b]<c&&(c=a[b]);return c}function Ca(a){for(var b=a.length,c=a[0];b--;)a[b]>c&&(c=a[b]);return c}function Pa(a,b){for(var c in a)a[c]&&a[c]!==b&&a[c].destroy&&a[c].destroy(),delete a[c]}function Qa(a){db||(db=$(Ka));a&&db.appendChild(a);db.innerHTML=""}function ea(a){return parseFloat(a.toPrecision(14))}function Ra(a,b){va=p(a,b.animation)}function Bb(){var a=E.global.useUTC,b=a?"getUTC":"get",c=a?"setUTC":"set";Da=E.global.Date||window.Date;Sa=(a&&E.global.timezoneOffset||0)*6e4;eb=a?Da.UTC:function(a,b,c,g,h,i){return new Da(a,b,p(c,1),p(g,0),p(h,0),p(i,0)).getTime()};pb=b+"Minutes";qb=b+"Hours";rb=b+"Day";Xa=b+"Date";fb=b+"Month";gb=b+"FullYear";Cb=c+"Minutes";Db=c+"Hours";sb=c+"Date";Eb=c+"Month";Fb=c+"FullYear"}function S(){}function Ta(a,b,c,d){this.axis=a;this.pos=b;this.type=c||"";this.isNew=!0;!c&&!d&&this.addLabel()}function na(){this.init.apply(this,arguments)}function Ya(){this.init.apply(this,arguments)}function Gb(a,b,c,d,e){var f=a.chart.inverted;this.axis=a;this.isNegative=c;this.options=b;this.x=d;this.total=null;this.points={};this.stack=e;this.alignOptions={align:b.align||(f?c?"left":"right":"center"),verticalAlign:b.verticalAlign||(f?"middle":c?"bottom":"top"),y:p(b.y,f?4:c?14:-6),x:p(b.x,f?c?-6:6:0)};this.textAlign=b.textAlign||(f?c?"right":"left":"center")}var u,x=document,G=window,V=Math,v=V.round,U=V.floor,La=V.ceil,t=V.max,L=V.min,Q=V.abs,aa=V.cos,fa=V.sin,oa=V.PI,Ea=oa*2/360,wa=navigator.userAgent,Hb=G.opera,Aa=/msie/i.test(wa)&&!Hb,hb=x.documentMode===8,tb=/AppleWebKit/.test(wa),Ua=/Firefox/.test(wa),Ib=/(Mobile|Android|Windows Phone)/.test(wa),xa="http://www.w3.org/2000/svg",ba=!!x.createElementNS&&!!x.createElementNS(xa,"svg").createSVGRect,Ob=Ua&&parseInt(wa.split("Firefox/")[1],10)<4,ga=!ba&&!Aa&&!!x.createElement("canvas").getContext,Za,$a,Jb={},ub=0,db,E,cb,va,vb,A,ha,sa=function(){return u},W=[],ab=0,Ka="div",P="none",Pb=/^[0-9]+$/,Qb="stroke-width",Da,eb,Sa,pb,qb,rb,Xa,fb,gb,Cb,Db,sb,Eb,Fb,H={},K;G.Highcharts?ha(16,!0):K=G.Highcharts={};cb=function(a,b,c){if(!s(b)||isNaN(b))return"Invalid date";var a=p(a,"%Y-%m-%d %H:%M:%S"),d=new Da(b-Sa),e,f=d[qb](),g=d[rb](),h=d[Xa](),i=d[fb](),j=d[gb](),k=E.lang,l=k.weekdays,d=r({a:l[g].substr(0,3),A:l[g],d:Ia(h),e:h,b:k.shortMonths[i],B:k.months[i],m:Ia(i+1),y:j.toString().substr(2,2),Y:j,H:Ia(f),I:Ia(f%12||12),l:f%12||12,M:Ia(d[pb]()),p:f<12?"AM":"PM",P:f<12?"am":"pm",S:Ia(d.getSeconds()),L:Ia(v(b%1e3),3)},K.dateFormats);for(e in d)for(;a.indexOf("%"+e)!==-1;)a=a.replace("%"+e,typeof d[e]==="function"?d[e](b):d[e]);return c?a.substr(0,1).toUpperCase()+a.substr(1):a};ha=function(a,b){var c="Highcharts error #"+a+": www.highcharts.com/errors/"+a;if(b)throw c;G.console&&console.log(c)};A={millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:26784e5,year:31556952e3};vb={init:function(a,b,c){var b=b||"",d=a.shift,e=b.indexOf("C")>-1,f=e?7:3,g,b=b.split(" "),c=[].concat(c),h,i,j=function(a){for(g=a.length;g--;)a[g]==="M"&&a.splice(g+1,0,a[g+1],a[g+2],a[g+1],a[g+2])};e&&(j(b),j(c));a.isArea&&(h=b.splice(b.length-6,6),i=c.splice(c.length-6,6));if(d<=c.length/f&&b.length===c.length)for(;d--;)c=[].concat(c).splice(0,f).concat(c);a.shift=0;if(b.length)for(a=c.length;b.length<a;)d=[].concat(b).splice(b.length-f,f),e&&(d[f-6]=d[f-2],d[f-5]=d[f-1]),b=b.concat(d);h&&(b=b.concat(h),c=c.concat(i));return[b,c]},step:function(a,b,c,d){var e=[],f=a.length;if(c===1)e=d;else if(f===b.length&&c<1)for(;f--;)d=parseFloat(a[f]),e[f]=isNaN(d)?a[f]:c*parseFloat(b[f]-d)+d;else e=b;return e}};(function(a){G.HighchartsAdapter=G.HighchartsAdapter||a&&{init:function(b){var c=a.fx;a.extend(a.easing,{easeOutQuad:function(a,b,c,g,h){return-g*(b/=h)*(b-2)+c}});a.each(["cur","_default","width","height","opacity"],function(b,e){var f=c.step,g;e==="cur"?f=c.prototype:e==="_default"&&a.Tween&&(f=a.Tween.propHooks[e],e="set");(g=f[e])&&(f[e]=function(a){var c,a=b?a:this;if(a.prop!=="align")return c=a.elem,c.attr?c.attr(a.prop,e==="cur"?u:a.now):g.apply(this,arguments)})});Na(a.cssHooks.opacity,"get",function(a,b,c){return b.attr?b.opacity||0:a.call(this,b,c)});this.addAnimSetter("d",function(a){var c=a.elem,f;if(!a.started)f=b.init(c,c.d,c.toD),a.start=f[0],a.end=f[1],a.started=!0;c.attr("d",b.step(a.start,a.end,a.pos,c.toD))});this.each=Array.prototype.forEach?function(a,b){return Array.prototype.forEach.call(a,b)}:function(a,b){var c,g=a.length;for(c=0;c<g;c++)if(b.call(a[c],a[c],c,a)===!1)return c};a.fn.highcharts=function(){var a="Chart",b=arguments,c,g;if(this[0]){Ga(b[0])&&(a=b[0],b=Array.prototype.slice.call(b,1));c=b[0];if(c!==u)c.chart=c.chart||{},c.chart.renderTo=this[0],new K[a](c,b[1]),g=this;c===u&&(g=W[F(this[0],"data-highcharts-chart")])}return g}},addAnimSetter:function(b,c){a.Tween?a.Tween.propHooks[b]={set:c}:a.fx.step[b]=c},getScript:a.getScript,inArray:a.inArray,adapterRun:function(b,c){return a(b)[c]()},grep:a.grep,map:function(a,c){for(var d=[],e=0,f=a.length;e<f;e++)d[e]=c.call(a[e],a[e],e,a);return d},offset:function(b){return a(b).offset()},addEvent:function(b,c,d){a(b).bind(c,d)},removeEvent:function(b,c,d){var e=x.removeEventListener?"removeEventListener":"detachEvent";x[e]&&b&&!b[e]&&(b[e]=function(){});a(b).unbind(c,d)},fireEvent:function(b,c,d,e){var f=a.Event(c),g="detached"+c,h;!Aa&&d&&(delete d.layerX,delete d.layerY,delete d.returnValue);r(f,d);b[c]&&(b[g]=b[c],b[c]=null);a.each(["preventDefault","stopPropagation"],function(a,b){var c=f[b];f[b]=function(){try{c.call(f)}catch(a){b==="preventDefault"&&(h=!0)}}});a(b).trigger(f);b[g]&&(b[c]=b[g],b[g]=null);e&&!f.isDefaultPrevented()&&!h&&e(f)},washMouseEvent:function(a){var c=a.originalEvent||a;if(c.pageX===u)c.pageX=a.pageX,c.pageY=a.pageY;return c},animate:function(b,c,d){var e=a(b);if(!b.style)b.style={};if(c.d)b.toD=c.d,c.d=1;e.stop();c.opacity!==u&&b.attr&&(c.opacity+="px");b.hasAnim=1;e.animate(c,d)},stop:function(b){b.hasAnim&&a(b).stop()}}})(G.jQuery);var T=G.HighchartsAdapter,M=T||{};T&&T.init.call(T,vb);var ib=M.adapterRun,Rb=M.getScript,Ma=M.inArray,q=M.each,wb=M.grep,Sb=M.offset,Va=M.map,N=M.addEvent,X=M.removeEvent,I=M.fireEvent,Tb=M.washMouseEvent,jb=M.animate,bb=M.stop,M={enabled:!0,x:0,y:15,style:{color:"#606060",cursor:"default",fontSize:"11px"}};E={colors:"#7cb5ec,#434348,#90ed7d,#f7a35c,#8085e9,#f15c80,#e4d354,#8085e8,#8d4653,#91e8e1".split(","),symbols:["circle","diamond","square","triangle","triangle-down"],lang:{loading:"Loading...",months:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),shortMonths:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),weekdays:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),decimalPoint:".",numericSymbols:"k,M,G,T,P,E".split(","),resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",thousandsSep:","},global:{useUTC:!0,canvasToolsURL:"http://code.highcharts.com/4.0.4/modules/canvas-tools.js",VMLRadialGradientURL:"http://code.highcharts.com/4.0.4/gfx/vml-radial-gradient.png"},chart:{borderColor:"#4572A7",borderRadius:0,defaultSeriesType:"line",ignoreHiddenSeries:!0,spacing:[10,10,15,10],backgroundColor:"#FFFFFF",plotBorderColor:"#C0C0C0",resetZoomButton:{theme:{zIndex:20},position:{align:"right",x:-10,y:10}}},title:{text:"Chart title",align:"center",margin:15,style:{color:"#333333",fontSize:"18px"}},subtitle:{text:"",align:"center",style:{color:"#555555"}},plotOptions:{line:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:2,marker:{lineWidth:0,radius:4,lineColor:"#FFFFFF",states:{hover:{enabled:!0,lineWidthPlus:1,radiusPlus:2},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:w(M,{align:"center",enabled:!1,formatter:function(){return this.y===null?"":Ba(this.y,-1)},verticalAlign:"bottom",y:0}),cropThreshold:300,pointRange:0,states:{hover:{lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{marker:{}}},stickyTracking:!0,turboThreshold:1e3}},labels:{style:{position:"absolute",color:"#3E576F"}},legend:{enabled:!0,align:"center",layout:"horizontal",labelFormatter:function(){return this.name},borderColor:"#909090",borderRadius:0,navigation:{activeColor:"#274b6d",inactiveColor:"#CCC"},shadow:!1,itemStyle:{color:"#333333",fontSize:"12px",fontWeight:"bold"},itemHoverStyle:{color:"#000"},itemHiddenStyle:{color:"#CCC"},itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"white",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:ba,backgroundColor:"rgba(249, 249, 249, .85)",borderWidth:1,borderRadius:3,dateTimeLabelFormats:{millisecond:"%A, %b %e, %H:%M:%S.%L",second:"%A, %b %e, %H:%M:%S",minute:"%A, %b %e, %H:%M",hour:"%A, %b %e, %H:%M",day:"%A, %b %e, %Y",week:"Week from %A, %b %e, %Y",month:"%B %Y",year:"%Y"},headerFormat:'<span style="font-size: 10px">{point.key}</span><br/>',pointFormat:'<span style="color:{series.color}">●</span> {series.name}: <b>{point.y}</b><br/>',shadow:!0,snap:Ib?25:10,style:{color:"#333333",cursor:"default",fontSize:"12px",padding:"8px",whiteSpace:"nowrap"}},credits:{enabled:!0,text:"Highcharts.com",href:"http://www.highcharts.com",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#909090",fontSize:"9px"}}};var ca=E.plotOptions,T=ca.line;Bb();var Ub=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/,Vb=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,Wb=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,ya=function(a){var b=[],c,d;(function(a){a&&a.stops?d=Va(a.stops,function(a){return ya(a[1])}):(c=Ub.exec(a))?b=[y(c[1]),y(c[2]),y(c[3]),parseFloat(c[4],10)]:(c=Vb.exec(a))?b=[y(c[1],16),y(c[2],16),y(c[3],16),1]:(c=Wb.exec(a))&&(b=[y(c[1]),y(c[2]),y(c[3]),1])})(a);return{get:function(c){var f;d?(f=w(a),f.stops=[].concat(f.stops),q(d,function(a,b){f.stops[b]=[f.stops[b][0],a.get(c)]})):f=b&&!isNaN(b[0])?c==="rgb"?"rgb("+b[0]+","+b[1]+","+b[2]+")":c==="a"?b[3]:"rgba("+b.join(",")+")":a;return f},brighten:function(a){if(d)q(d,function(b){b.brighten(a)});else if(ja(a)&&a!==0){var c;for(c=0;c<3;c++)b[c]+=y(a*255),b[c]<0&&(b[c]=0),b[c]>255&&(b[c]=255)}return this},rgba:b,setOpacity:function(a){b[3]=a;return this}}};S.prototype={opacity:1,textProps:"fontSize,fontWeight,fontFamily,color,lineHeight,width,textDecoration,textShadow,HcTextStroke".split(","),init:function(a,b){this.element=b==="span"?$(b):x.createElementNS(xa,b);this.renderer=a},animate:function(a,b,c){b=p(b,va,!0);bb(this);if(b){b=w(b,{});if(c)b.complete=c;jb(this,a,b)}else this.attr(a),c&&c();return this},colorGradient:function(a,b,c){var d=this.renderer,e,f,g,h,i,j,k,l,n,m,o=[];a.linearGradient?f="linearGradient":a.radialGradient&&(f="radialGradient");if(f){g=a[f];h=d.gradients;j=a.stops;n=c.radialReference;Ha(g)&&(a[f]=g={x1:g[0],y1:g[1],x2:g[2],y2:g[3],gradientUnits:"userSpaceOnUse"});f==="radialGradient"&&n&&!s(g.gradientUnits)&&(g=w(g,{cx:n[0]-n[2]/2+g.cx*n[2],cy:n[1]-n[2]/2+g.cy*n[2],r:g.r*n[2],gradientUnits:"userSpaceOnUse"}));for(m in g)m!=="id"&&o.push(m,g[m]);for(m in j)o.push(j[m]);o=o.join(",");h[o]?a=h[o].attr("id"):(g.id=a="highcharts-"+ub++,h[o]=i=d.createElement(f).attr(g).add(d.defs),i.stops=[],q(j,function(a){a[1].indexOf("rgba")===0?(e=ya(a[1]),k=e.get("rgb"),l=e.get("a")):(k=a[1],l=1);a=d.createElement("stop").attr({offset:a[0],"stop-color":k,"stop-opacity":l}).add(i);i.stops.push(a)}));c.setAttribute(b,"url("+d.url+"#"+a+")")}},attr:function(a,b){var c,d,e=this.element,f,g=this,h;typeof a==="string"&&b!==u&&(c=a,a={},a[c]=b);if(typeof a==="string")g=(this[a+"Getter"]||this._defaultGetter).call(this,a,e);else{for(c in a){d=a[c];h=!1;this.symbolName&&/^(x|y|width|height|r|start|end|innerR|anchorX|anchorY)/.test(c)&&(f||(this.symbolAttr(a),f=!0),h=!0);if(this.rotation&&(c==="x"||c==="y"))this.doTransform=!0;h||(this[c+"Setter"]||this._defaultSetter).call(this,d,c,e);this.shadows&&/^(width|height|visibility|x|y|d|transform|cx|cy|r)$/.test(c)&&this.updateShadows(c,d)}if(this.doTransform)this.updateTransform(),this.doTransform=!1}return g},updateShadows:function(a,b){for(var c=this.shadows,d=c.length;d--;)c[d].setAttribute(a,a==="height"?t(b-(c[d].cutHeight||0),0):a==="d"?this.d:b)},addClass:function(a){var b=this.element,c=F(b,"class")||"";c.indexOf(a)===-1&&F(b,"class",c+" "+a);return this},symbolAttr:function(a){var b=this;q("x,y,r,start,end,width,height,innerR,anchorX,anchorY".split(","),function(c){b[c]=p(a[c],b[c])});b.attr({d:b.renderer.symbols[b.symbolName](b.x,b.y,b.width,b.height,b)})},clip:function(a){return this.attr("clip-path",a?"url("+this.renderer.url+"#"+a.id+")":P)},crisp:function(a){var b,c={},d,e=a.strokeWidth||this.strokeWidth||0;d=v(e)%2/2;a.x=U(a.x||this.x||0)+d;a.y=U(a.y||this.y||0)+d;a.width=U((a.width||this.width||0)-2*d);a.height=U((a.height||this.height||0)-2*d);a.strokeWidth=e;for(b in a)this[b]!==a[b]&&(this[b]=c[b]=a[b]);return c},css:function(a){var b=this.styles,c={},d=this.element,e,f,g="";e=!b;if(a&&a.color)a.fill=a.color;if(b)for(f in a)a[f]!==b[f]&&(c[f]=a[f],e=!0);if(e){e=this.textWidth=a&&a.width&&d.nodeName.toLowerCase()==="text"&&y(a.width);b&&(a=r(b,c));this.styles=a;e&&(ga||!ba&&this.renderer.forExport)&&delete a.width;if(Aa&&!ba)B(this.element,a);else{b=function(a,b){return"-"+b.toLowerCase()};for(f in a)g+=f.replace(/([A-Z])/g,b)+":"+a[f]+";";F(d,"style",g)}e&&this.added&&this.renderer.buildText(this)}return this},on:function(a,b){var c=this,d=c.element;$a&&a==="click"?(d.ontouchstart=function(a){c.touchEventFired=Da.now();a.preventDefault();b.call(d,a)},d.onclick=function(a){(wa.indexOf("Android")===-1||Da.now()-(c.touchEventFired||0)>1100)&&b.call(d,a)}):d["on"+a]=b;return this},setRadialReference:function(a){this.element.radialReference=a;return this},translate:function(a,b){return this.attr({translateX:a,translateY:b})},invert:function(){this.inverted=!0;this.updateTransform();return this},updateTransform:function(){var a=this.translateX||0,b=this.translateY||0,c=this.scaleX,d=this.scaleY,e=this.inverted,f=this.rotation,g=this.element;e&&(a+=this.attr("width"),b+=this.attr("height"));a=["translate("+a+","+b+")"];e?a.push("rotate(90) scale(-1,1)"):f&&a.push("rotate("+f+" "+(g.getAttribute("x")||0)+" "+(g.getAttribute("y")||0)+")");(s(c)||s(d))&&a.push("scale("+p(c,1)+" "+p(d,1)+")");a.length&&g.setAttribute("transform",a.join(" "))},toFront:function(){var a=this.element;a.parentNode.appendChild(a);return this},align:function(a,b,c){var d,e,f,g,h={};e=this.renderer;f=e.alignedObjects;if(a){if(this.alignOptions=a,this.alignByTranslate=b,!c||Ga(c))this.alignTo=d=c||"renderer",la(f,this),f.push(this),c=null}else a=this.alignOptions,b=this.alignByTranslate,d=this.alignTo;c=p(c,e[d],e);d=a.align;e=a.verticalAlign;f=(c.x||0)+(a.x||0);g=(c.y||0)+(a.y||0);if(d==="right"||d==="center")f+=(c.width-(a.width||0))/{right:1,center:2}[d];h[b?"translateX":"x"]=v(f);if(e==="bottom"||e==="middle")g+=(c.height-(a.height||0))/({bottom:1,middle:2}[e]||1);h[b?"translateY":"y"]=v(g);this[this.placed?"animate":"attr"](h);this.placed=!0;this.alignAttr=h;return this},getBBox:function(){var a=this.bBox,b=this.renderer,c,d,e=this.rotation;c=this.element;var f=this.styles,g=e*Ea;d=this.textStr;var h;if(d===""||Pb.test(d))h="num."+d.toString().length+(f?"|"+f.fontSize+"|"+f.fontFamily:"");h&&(a=b.cache[h]);if(!a){if(c.namespaceURI===xa||b.forExport){try{a=c.getBBox?r({},c.getBBox()):{width:c.offsetWidth,height:c.offsetHeight}}catch(i){}if(!a||a.width<0)a={width:0,height:0}}else a=this.htmlGetBBox();if(b.isSVG){c=a.width;d=a.height;if(Aa&&f&&f.fontSize==="11px"&&d.toPrecision(3)==="16.9")a.height=d=14;if(e)a.width=Q(d*fa(g))+Q(c*aa(g)),a.height=Q(d*aa(g))+Q(c*fa(g))}this.bBox=a;h&&(b.cache[h]=a)}return a},show:function(a){a&&this.element.namespaceURI===xa?this.element.removeAttribute("visibility"):this.attr({visibility:a?"inherit":"visible"})
;return this},hide:function(){return this.attr({visibility:"hidden"})},fadeOut:function(a){var b=this;b.animate({opacity:0},{duration:a||150,complete:function(){b.attr({y:-9999})}})},add:function(a){var b=this.renderer,c=a||b,d=c.element||b.box,e=this.element,f=this.zIndex,g,h;if(a)this.parentGroup=a;this.parentInverted=a&&a.inverted;this.textStr!==void 0&&b.buildText(this);if(f)c.handleZ=!0,f=y(f);if(c.handleZ){a=d.childNodes;for(g=0;g<a.length;g++)if(b=a[g],c=F(b,"zIndex"),b!==e&&(y(c)>f||!s(f)&&s(c))){d.insertBefore(e,b);h=!0;break}}h||d.appendChild(e);this.added=!0;if(this.onAdd)this.onAdd();return this},safeRemoveChild:function(a){var b=a.parentNode;b&&b.removeChild(a)},destroy:function(){var a=this,b=a.element||{},c=a.shadows,d=a.renderer.isSVG&&b.nodeName==="SPAN"&&a.parentGroup,e,f;b.onclick=b.onmouseout=b.onmouseover=b.onmousemove=b.point=null;bb(a);if(a.clipPath)a.clipPath=a.clipPath.destroy();if(a.stops){for(f=0;f<a.stops.length;f++)a.stops[f]=a.stops[f].destroy();a.stops=null}a.safeRemoveChild(b);for(c&&q(c,function(b){a.safeRemoveChild(b)});d&&d.div&&d.div.childNodes.length===0;)b=d.parentGroup,a.safeRemoveChild(d.div),delete d.div,d=b;a.alignTo&&la(a.renderer.alignedObjects,a);for(e in a)delete a[e];return null},shadow:function(a,b,c){var d=[],e,f,g=this.element,h,i,j,k;if(a){i=p(a.width,3);j=(a.opacity||.15)/i;k=this.parentInverted?"(-1,-1)":"("+p(a.offsetX,1)+", "+p(a.offsetY,1)+")";for(e=1;e<=i;e++){f=g.cloneNode(0);h=i*2+1-2*e;F(f,{isShadow:"true",stroke:a.color||"black","stroke-opacity":j*e,"stroke-width":h,transform:"translate"+k,fill:P});if(c)F(f,"height",t(F(f,"height")-h,0)),f.cutHeight=h;b?b.element.appendChild(f):g.parentNode.insertBefore(f,g);d.push(f)}this.shadows=d}return this},xGetter:function(a){this.element.nodeName==="circle"&&(a={x:"cx",y:"cy"}[a]||a);return this._defaultGetter(a)},_defaultGetter:function(a){a=p(this[a],this.element?this.element.getAttribute(a):null,0);/^[\-0-9\.]+$/.test(a)&&(a=parseFloat(a));return a},dSetter:function(a,b,c){a&&a.join&&(a=a.join(" "));/(NaN| {2}|^$)/.test(a)&&(a="M 0 0");c.setAttribute(b,a);this[b]=a},dashstyleSetter:function(a){var b;if(a=a&&a.toLowerCase()){a=a.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(b=a.length;b--;)a[b]=y(a[b])*this["stroke-width"];a=a.join(",").replace("NaN","none");this.element.setAttribute("stroke-dasharray",a)}},alignSetter:function(a){this.element.setAttribute("text-anchor",{left:"start",center:"middle",right:"end"}[a])},opacitySetter:function(a,b,c){this[b]=a;c.setAttribute(b,a)},titleSetter:function(a){var b=this.element.getElementsByTagName("title")[0];b||(b=x.createElementNS(xa,"title"),this.element.appendChild(b));b.textContent=p(a,"").replace(/<[^>]*>/g,"")},textSetter:function(a){if(a!==this.textStr)delete this.bBox,this.textStr=a,this.added&&this.renderer.buildText(this)},fillSetter:function(a,b,c){typeof a==="string"?c.setAttribute(b,a):a&&this.colorGradient(a,b,c)},zIndexSetter:function(a,b,c){c.setAttribute(b,a);this[b]=a},_defaultSetter:function(a,b,c){c.setAttribute(b,a)}};S.prototype.yGetter=S.prototype.xGetter;S.prototype.translateXSetter=S.prototype.translateYSetter=S.prototype.rotationSetter=S.prototype.verticalAlignSetter=S.prototype.scaleXSetter=S.prototype.scaleYSetter=function(a,b){this[b]=a;this.doTransform=!0};S.prototype["stroke-widthSetter"]=S.prototype.strokeSetter=function(a,b,c){this[b]=a;if(this.stroke&&this["stroke-width"])this.strokeWidth=this["stroke-width"],S.prototype.fillSetter.call(this,this.stroke,"stroke",c),c.setAttribute("stroke-width",this["stroke-width"]),this.hasStroke=!0;else if(b==="stroke-width"&&a===0&&this.hasStroke)c.removeAttribute("stroke"),this.hasStroke=!1};var ta=function(){this.init.apply(this,arguments)};ta.prototype={Element:S,init:function(a,b,c,d,e){var f=location,g,d=this.createElement("svg").attr({version:"1.1"}).css(this.getStyle(d));g=d.element;a.appendChild(g);a.innerHTML.indexOf("xmlns")===-1&&F(g,"xmlns",xa);this.isSVG=!0;this.box=g;this.boxWrapper=d;this.alignedObjects=[];this.url=(Ua||tb)&&x.getElementsByTagName("base").length?f.href.replace(/#.*?$/,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20"):"";this.createElement("desc").add().element.appendChild(x.createTextNode("Created with Highcharts 4.0.4"));this.defs=this.createElement("defs").add();this.forExport=e;this.gradients={};this.cache={};this.setSize(b,c,!1);var h;if(Ua&&a.getBoundingClientRect)this.subPixelFix=b=function(){B(a,{left:0,top:0});h=a.getBoundingClientRect();B(a,{left:La(h.left)-h.left+"px",top:La(h.top)-h.top+"px"})},b(),N(G,"resize",b)},getStyle:function(a){return this.style=r({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',fontSize:"12px"},a)},isHidden:function(){return!this.boxWrapper.getBBox().width},destroy:function(){var a=this.defs;this.box=null;this.boxWrapper=this.boxWrapper.destroy();Pa(this.gradients||{});this.gradients=null;if(a)this.defs=a.destroy();this.subPixelFix&&X(G,"resize",this.subPixelFix);return this.alignedObjects=null},createElement:function(a){var b=new this.Element;b.init(this,a);return b},draw:function(){},buildText:function(a){for(var b=a.element,c=this,d=c.forExport,e=p(a.textStr,"").toString(),f=e.indexOf("<")!==-1,g=b.childNodes,h,i,j=F(b,"x"),k=a.styles,l=a.textWidth,n=k&&k.lineHeight,m=k&&k.HcTextStroke,o=g.length,Y=function(a){return n?y(n):c.fontMetrics(/(px|em)$/.test(a&&a.style.fontSize)?a.style.fontSize:k&&k.fontSize||c.style.fontSize||12,a).h};o--;)b.removeChild(g[o]);!f&&!m&&e.indexOf(" ")===-1?b.appendChild(x.createTextNode(e)):(h=/<.*style="([^"]+)".*>/,i=/<.*href="(http[^"]+)".*>/,l&&!a.added&&this.box.appendChild(b),e=f?e.replace(/<(b|strong)>/g,'<span style="font-weight:bold">').replace(/<(i|em)>/g,'<span style="font-style:italic">').replace(/<a/g,"<span").replace(/<\/(b|strong|i|em|a)>/g,"</span>").split(/<br.*?>/g):[e],e[e.length-1]===""&&e.pop(),q(e,function(e,f){var g,n=0,e=e.replace(/<span/g,"|||<span").replace(/<\/span>/g,"</span>|||");g=e.split("|||");q(g,function(e){if(e!==""||g.length===1){var m={},o=x.createElementNS(xa,"tspan"),p;h.test(e)&&(p=e.match(h)[1].replace(/(;| |^)color([ :])/,"$1fill$2"),F(o,"style",p));i.test(e)&&!d&&(F(o,"onclick",'location.href="'+e.match(i)[1]+'"'),B(o,{cursor:"pointer"}));e=(e.replace(/<(.|\n)*?>/g,"")||" ").replace(/&lt;/g,"<").replace(/&gt;/g,">");if(e!==" "){o.appendChild(x.createTextNode(e));if(n)m.dx=0;else if(f&&j!==null)m.x=j;F(o,m);b.appendChild(o);!n&&f&&(!ba&&d&&B(o,{display:"block"}),F(o,"dy",Y(o)));if(l)for(var e=e.replace(/([^\^])-/g,"$1- ").split(" "),m=g.length>1||e.length>1&&k.whiteSpace!=="nowrap",q,D,s=k.HcHeight,t=[],u=Y(o),Lb=1;m&&(e.length||t.length);)delete a.bBox,q=a.getBBox(),D=q.width,!ba&&c.forExport&&(D=c.measureSpanWidth(o.firstChild.data,a.styles)),q=D>l,!q||e.length===1?(e=t,t=[],e.length&&(Lb++,s&&Lb*u>s?(e=["..."],a.attr("title",a.textStr)):(o=x.createElementNS(xa,"tspan"),F(o,{dy:u,x:j}),p&&F(o,"style",p),b.appendChild(o))),D>l&&(l=D)):(o.removeChild(o.firstChild),t.unshift(e.pop())),e.length&&o.appendChild(x.createTextNode(e.join(" ").replace(/- /g,"-")));n++}}})}))},button:function(a,b,c,d,e,f,g,h,i){var j=this.label(a,b,c,i,null,null,null,null,"button"),k=0,l,n,m,o,p,q,a={x1:0,y1:0,x2:0,y2:1},e=w({"stroke-width":1,stroke:"#CCCCCC",fill:{linearGradient:a,stops:[[0,"#FEFEFE"],[1,"#F6F6F6"]]},r:2,padding:5,style:{color:"black"}},e);m=e.style;delete e.style;f=w(e,{stroke:"#68A",fill:{linearGradient:a,stops:[[0,"#FFF"],[1,"#ACF"]]}},f);o=f.style;delete f.style;g=w(e,{stroke:"#68A",fill:{linearGradient:a,stops:[[0,"#9BD"],[1,"#CDF"]]}},g);p=g.style;delete g.style;h=w(e,{style:{color:"#CCC"}},h);q=h.style;delete h.style;N(j.element,Aa?"mouseover":"mouseenter",function(){k!==3&&j.attr(f).css(o)});N(j.element,Aa?"mouseout":"mouseleave",function(){k!==3&&(l=[e,f,g][k],n=[m,o,p][k],j.attr(l).css(n))});j.setState=function(a){(j.state=k=a)?a===2?j.attr(g).css(p):a===3&&j.attr(h).css(q):j.attr(e).css(m)};return j.on("click",function(){k!==3&&d.call(j)}).attr(e).css(r({cursor:"default"},m))},crispLine:function(a,b){a[1]===a[4]&&(a[1]=a[4]=v(a[1])-b%2/2);a[2]===a[5]&&(a[2]=a[5]=v(a[2])+b%2/2);return a},path:function(a){var b={fill:P};Ha(a)?b.d=a:da(a)&&r(b,a);return this.createElement("path").attr(b)},circle:function(a,b,c){a=da(a)?a:{x:a,y:b,r:c};b=this.createElement("circle");b.xSetter=function(a){this.element.setAttribute("cx",a)};b.ySetter=function(a){this.element.setAttribute("cy",a)};return b.attr(a)},arc:function(a,b,c,d,e,f){if(da(a))b=a.y,c=a.r,d=a.innerR,e=a.start,f=a.end,a=a.x;a=this.symbol("arc",a||0,b||0,c||0,c||0,{innerR:d||0,start:e||0,end:f||0});a.r=c;return a},rect:function(a,b,c,d,e,f){var e=da(a)?a.r:e,g=this.createElement("rect"),a=da(a)?a:a===u?{}:{x:a,y:b,width:t(c,0),height:t(d,0)};if(f!==u)a.strokeWidth=f,a=g.crisp(a);if(e)a.r=e;g.rSetter=function(a){F(this.element,{rx:a,ry:a})};return g.attr(a)},setSize:function(a,b,c){var d=this.alignedObjects,e=d.length;this.width=a;this.height=b;for(this.boxWrapper[p(c,!0)?"animate":"attr"]({width:a,height:b});e--;)d[e].align()},g:function(a){var b=this.createElement("g");return s(a)?b.attr({class:"highcharts-"+a}):b},image:function(a,b,c,d,e){var f={preserveAspectRatio:P};arguments.length>1&&r(f,{x:b,y:c,width:d,height:e});f=this.createElement("image").attr(f);f.element.setAttributeNS?f.element.setAttributeNS("http://www.w3.org/1999/xlink","href",a):f.element.setAttribute("hc-svg-href",a);return f},symbol:function(a,b,c,d,e,f){var g,h=this.symbols[a],h=h&&h(v(b),v(c),d,e,f),i=/^url\((.*?)\)$/,j,k;if(h)g=this.path(h),r(g,{symbolName:a,x:b,y:c,width:d,height:e}),f&&r(g,f);else if(i.test(a))k=function(a,b){a.element&&(a.attr({width:b[0],height:b[1]}),a.alignByTranslate||a.translate(v((d-b[0])/2),v((e-b[1])/2)))},j=a.match(i)[1],a=Jb[j]||f&&f.width&&f.height&&[f.width,f.height],g=this.image(j).attr({x:b,y:c}),g.isImg=!0,a?k(g,a):(g.attr({width:0,height:0}),$("img",{onload:function(){k(g,Jb[j]=[this.width,this.height])},src:j}));return g},symbols:{circle:function(a,b,c,d){var e=.166*c;return["M",a+c/2,b,"C",a+c+e,b,a+c+e,b+d,a+c/2,b+d,"C",a-e,b+d,a-e,b,a+c/2,b,"Z"]},square:function(a,b,c,d){return["M",a,b,"L",a+c,b,a+c,b+d,a,b+d,"Z"]},triangle:function(a,b,c,d){return["M",a+c/2,b,"L",a+c,b+d,a,b+d,"Z"]},"triangle-down":function(a,b,c,d){return["M",a,b,"L",a+c,b,a+c/2,b+d,"Z"]},diamond:function(a,b,c,d){return["M",a+c/2,b,"L",a+c,b+d/2,a+c/2,b+d,a,b+d/2,"Z"]},arc:function(a,b,c,d,e){var f=e.start,c=e.r||c||d,g=e.end-.001,d=e.innerR,h=e.open,i=aa(f),j=fa(f),k=aa(g),g=fa(g),e=e.end-f<oa?0:1;return["M",a+c*i,b+c*j,"A",c,c,0,e,1,a+c*k,b+c*g,h?"M":"L",a+d*k,b+d*g,"A",d,d,0,e,0,a+d*i,b+d*j,h?"":"Z"]},callout:function(a,b,c,d,e){var f=L(e&&e.r||0,c,d),g=f+6,h=e&&e.anchorX,i=e&&e.anchorY,e=v(e.strokeWidth||0)%2/2;a+=e;b+=e;e=["M",a+f,b,"L",a+c-f,b,"C",a+c,b,a+c,b,a+c,b+f,"L",a+c,b+d-f,"C",a+c,b+d,a+c,b+d,a+c-f,b+d,"L",a+f,b+d,"C",a,b+d,a,b+d,a,b+d-f,"L",a,b+f,"C",a,b,a,b,a+f,b];h&&h>c&&i>b+g&&i<b+d-g?e.splice(13,3,"L",a+c,i-6,a+c+6,i,a+c,i+6,a+c,b+d-f):h&&h<0&&i>b+g&&i<b+d-g?e.splice(33,3,"L",a,i+6,a-6,i,a,i-6,a,b+f):i&&i>d&&h>a+g&&h<a+c-g?e.splice(23,3,"L",h+6,b+d,h,b+d+6,h-6,b+d,a+f,b+d):i&&i<0&&h>a+g&&h<a+c-g&&e.splice(3,3,"L",h-6,b,h,b-6,h+6,b,c-f,b);return e}},clipRect:function(a,b,c,d){var e="highcharts-"+ub++,f=this.createElement("clipPath").attr({id:e}).add(this.defs),a=this.rect(a,b,c,d,0).add(f);a.id=e;a.clipPath=f;return a},text:function(a,b,c,d){var e=ga||!ba&&this.forExport,f={};if(d&&!this.forExport)return this.html(a,b,c);f.x=Math.round(b||0);if(c)f.y=Math.round(c);if(a||a===0)f.text=a;a=this.createElement("text").attr(f);e&&a.css({position:"absolute"});if(!d)a.xSetter=function(a,b,c){var d=c.getElementsByTagName("tspan"),e,f=c.getAttribute(b),n;for(n=0;n<d.length;n++)e=d[n],e.getAttribute(b)===f&&e.setAttribute(b,a);c.setAttribute(b,a)};return a},fontMetrics:function(a,b){a=a||this.style.fontSize;if(b&&G.getComputedStyle)b=b.element||b,a=G.getComputedStyle(b,"").fontSize;var a=/px/.test(a)?y(a):/em/.test(a)?parseFloat(a)*12:12,c=a<24?a+4:v(a*1.2),d=v(c*.8);return{h:c,b:d,f:a}},label:function(a,b,c,d,e,f,g,h,i){function j(){var a,b;a=o.element.style;D=(t===void 0||xb===void 0||m.styles.textAlign)&&o.textStr&&o.getBBox();m.width=(t||D.width||0)+2*C+kb;m.height=(xb||D.height||0)+2*C;R=C+n.fontMetrics(a&&a.fontSize,o).b;if(y){if(!p)a=v(-J*C),b=h?-R:0,m.box=p=d?n.symbol(d,a,b,m.width,m.height,z):n.rect(a,b,m.width,m.height,0,z[Qb]),p.attr("fill",P).add(m);p.isImg||p.attr(r({width:v(m.width),height:v(m.height)},z));z=null}}function k(){var a=m.styles,a=a&&a.textAlign,b=kb+C*(1-J),c;c=h?0:R;if(s(t)&&D&&(a==="center"||a==="right"))b+={center:.5,right:1}[a]*(t-D.width);if(b!==o.x||c!==o.y)o.attr("x",b),c!==u&&o.attr("y",c);o.x=b;o.y=c}function l(a,b){p?p.attr(a,b):z[a]=b}var n=this,m=n.g(i),o=n.text("",0,0,g).attr({zIndex:1}),p,D,J=0,C=3,kb=0,t,xb,yb,x,Kb=0,z={},R,y;m.onAdd=function(){o.add(m);m.attr({text:a||a===0?a:"",x:b,y:c});p&&s(e)&&m.attr({anchorX:e,anchorY:f})};m.widthSetter=function(a){t=a};m.heightSetter=function(a){xb=a};m.paddingSetter=function(a){s(a)&&a!==C&&(C=a,k())};m.paddingLeftSetter=function(a){s(a)&&a!==kb&&(kb=a,k())};m.alignSetter=function(a){J={left:0,center:.5,right:1}[a]};m.textSetter=function(a){a!==u&&o.textSetter(a);j();k()};m["stroke-widthSetter"]=function(a,b){a&&(y=!0);Kb=a%2/2;l(b,a)};m.strokeSetter=m.fillSetter=m.rSetter=function(a,b){b==="fill"&&a&&(y=!0);l(b,a)};m.anchorXSetter=function(a,b){e=a;l(b,a+Kb-yb)};m.anchorYSetter=function(a,b){f=a;l(b,a-x)};m.xSetter=function(a){m.x=a;J&&(a-=J*((t||D.width)+C));yb=v(a);m.attr("translateX",yb)};m.ySetter=function(a){x=m.y=v(a);m.attr("translateY",x)};var A=m.css;return r(m,{css:function(a){if(a){var b={},a=w(a);q(m.textProps,function(c){a[c]!==u&&(b[c]=a[c],delete a[c])});o.css(b)}return A.call(m,a)},getBBox:function(){return{width:D.width+2*C,height:D.height+2*C,x:D.x-C,y:D.y-C}},shadow:function(a){p&&p.shadow(a);return m},destroy:function(){X(m.element,"mouseenter");X(m.element,"mouseleave");o&&(o=o.destroy());p&&(p=p.destroy());S.prototype.destroy.call(m);m=n=j=k=l=null}})}};Za=ta;r(S.prototype,{htmlCss:function(a){var b=this.element;if(b=a&&b.tagName==="SPAN"&&a.width)delete a.width,this.textWidth=b,this.updateTransform();this.styles=r(this.styles,a);B(this.element,a);return this},htmlGetBBox:function(){var a=this.element,b=this.bBox;if(!b){if(a.nodeName==="text")a.style.position="absolute";b=this.bBox={x:a.offsetLeft,y:a.offsetTop,width:a.offsetWidth,height:a.offsetHeight}}return b},htmlUpdateTransform:function(){if(this.added){var a=this.renderer,b=this.element,c=this.translateX||0,d=this.translateY||0,e=this.x||0,f=this.y||0,g=this.textAlign||"left",h={left:0,center:.5,right:1}[g],i=this.shadows;B(b,{marginLeft:c,marginTop:d});i&&q(i,function(a){B(a,{marginLeft:c+1,marginTop:d+1})});this.inverted&&q(b.childNodes,function(c){a.invertChild(c,b)});if(b.tagName==="SPAN"){var j=this.rotation,k,l=y(this.textWidth),n=[j,g,b.innerHTML,this.textWidth].join(",");if(n!==this.cTT){k=a.fontMetrics(b.style.fontSize).b;s(j)&&this.setSpanRotation(j,h,k);i=p(this.elemWidth,b.offsetWidth);if(i>l&&/[ \-]/.test(b.textContent||b.innerText))B(b,{width:l+"px",display:"block",whiteSpace:"normal"}),i=l;this.getSpanCorrection(i,k,h,j,g)}B(b,{left:e+(this.xCorr||0)+"px",top:f+(this.yCorr||0)+"px"});if(tb)k=b.offsetHeight;this.cTT=n}}else this.alignOnAdd=!0},setSpanRotation:function(a,b,c){var d={},e=Aa?"-ms-transform":tb?"-webkit-transform":Ua?"MozTransform":Hb?"-o-transform":"";d[e]=d.transform="rotate("+a+"deg)";d[e+(Ua?"Origin":"-origin")]=d.transformOrigin=b*100+"% "+c+"px";B(this.element,d)},getSpanCorrection:function(a,b,c){this.xCorr=-a*c;this.yCorr=-b}});r(ta.prototype,{html:function(a,b,c){var d=this.createElement("span"),e=d.element,f=d.renderer;d.textSetter=function(a){a!==e.innerHTML&&delete this.bBox;e.innerHTML=this.textStr=a};d.xSetter=d.ySetter=d.alignSetter=d.rotationSetter=function(a,b){b==="align"&&(b="textAlign");d[b]=a;d.htmlUpdateTransform()};d.attr({text:a,x:v(b),y:v(c)}).css({position:"absolute",whiteSpace:"nowrap",fontFamily:this.style.fontFamily,fontSize:this.style.fontSize});d.css=d.htmlCss;if(f.isSVG)d.add=function(a){var b,c=f.box.parentNode,j=[];if(this.parentGroup=a){if(b=a.div,!b){for(;a;)j.push(a),a=a.parentGroup;q(j.reverse(),function(a){var d;b=a.div=a.div||$(Ka,{className:F(a.element,"class")},{position:"absolute",left:(a.translateX||0)+"px",top:(a.translateY||0)+"px"},b||c);d=b.style;r(a,{translateXSetter:function(b,c){d.left=b+"px";a[c]=b;a.doTransform=!0},translateYSetter:function(b,c){d.top=b+"px";a[c]=b;a.doTransform=!0},visibilitySetter:function(a,b){d[b]=a}})})}}else b=c;b.appendChild(e);d.added=!0;d.alignOnAdd&&d.htmlUpdateTransform();return d};return d}});var Z;if(!ba&&!ga){Z={init:function(a,b){var c=["<",b,' filled="f" stroked="f"'],d=["position: ","absolute",";"],e=b===Ka;(b==="shape"||e)&&d.push("left:0;top:0;width:1px;height:1px;");d.push("visibility: ",e?"hidden":"visible");c.push(' style="',d.join(""),'"/>');if(b)c=e||b==="span"||b==="img"?c.join(""):a.prepVML(c),this.element=$(c);this.renderer=a},add:function(a){var b=this.renderer,c=this.element,d=b.box,d=a?a.element||a:d;a&&a.inverted&&b.invertChild(c,d);d.appendChild(c);this.added=!0;this.alignOnAdd&&!this.deferUpdateTransform&&this.updateTransform();if(this.onAdd)this.onAdd();return this},updateTransform:S.prototype.htmlUpdateTransform,setSpanRotation:function(){var a=this.rotation,b=aa(a*Ea),c=fa(a*Ea);B(this.element,{filter:a?["progid:DXImageTransform.Microsoft.Matrix(M11=",b,", M12=",-c,", M21=",c,", M22=",b,", sizingMethod='auto expand')"].join(""):P})},getSpanCorrection:function(a,b,c,d,e){var f=d?aa(d*Ea):1,g=d?fa(d*Ea):0,h=p(this.elemHeight,this.element.offsetHeight),i;this.xCorr=f<0&&-a;this.yCorr=g<0&&-h;i=f*g<0;this.xCorr+=g*b*(i?1-c:c);this.yCorr-=f*b*(d?i?c:1-c:1);e&&e!=="left"&&(this.xCorr-=a*c*(f<0?-1:1),d&&(this.yCorr-=h*c*(g<0?-1:1)),B(this.element,{textAlign:e}))},pathToVML:function(a){for(var b=a.length,c=[];b--;)if(ja(a[b]))c[b]=v(a[b]*10)-5;else if(a[b]==="Z")c[b]="x";else if(c[b]=a[b],a.isArc&&(a[b]==="wa"||a[b]==="at"))c[b+5]===c[b+7]&&(c[b+7]+=a[b+7]>a[b+5]?1:-1),c[b+6]===c[b+8]&&(c[b+8]+=a[b+8]>a[b+6]?1:-1);return c.join(" ")||"x"},clip:function(a){var b=this,c;a?(c=a.members,la(c,b),c.push(b),b.destroyClip=function(){la(c,b)},a=a.getCSS(b)):(b.destroyClip&&b.destroyClip(),a={clip:hb?"inherit":"rect(auto)"});return b.css(a)},css:S.prototype.htmlCss,safeRemoveChild:function(a){a.parentNode&&Qa(a)},destroy:function(){this.destroyClip&&this.destroyClip();return S.prototype.destroy.apply(this)},on:function(a,b){this.element["on"+a]=function(){var a=G.event;a.target=a.srcElement;b(a)};return this},cutOffPath:function(a,b){var c,a=a.split(/[ ,]/);c=a.length;if(c===9||c===11)a[c-4]=a[c-2]=y(a[c-2])-10*b;return a.join(" ")},shadow:function(a,b,c){var d=[],e,f=this.element,g=this.renderer,h,i=f.style,j,k=f.path,l,n,m,o;k&&typeof k.value!=="string"&&(k="x");n=k;if(a){m=p(a.width,3);o=(a.opacity||.15)/m;for(e=1;e<=3;e++){l=m*2+1-2*e;c&&(n=this.cutOffPath(k.value,l+.5));j=['<shape isShadow="true" strokeweight="',l,'" filled="false" path="',n,'" coordsize="10 10" style="',f.style.cssText,'" />'];h=$(g.prepVML(j),null,{left:y(i.left)+p(a.offsetX,1),top:y(i.top)+p(a.offsetY,1)});if(c)h.cutOff=l+1;j=['<stroke color="',a.color||"black",'" opacity="',o*e,'"/>'];$(g.prepVML(j),null,null,h);b?b.element.appendChild(h):f.parentNode.insertBefore(h,f);d.push(h)}this.shadows=d}return this},updateShadows:sa,setAttr:function(a,b){hb?this.element[a]=b:this.element.setAttribute(a,b)},classSetter:function(a){this.element.className=a},dashstyleSetter:function(a,b,c){(c.getElementsByTagName("stroke")[0]||$(this.renderer.prepVML(["<stroke/>"]),null,null,c))[b]=a||"solid";this[b]=a},dSetter:function(a,b,c){var d=this.shadows,a=a||[];this.d=a.join&&a.join(" ");c.path=a=this.pathToVML(a);if(d)for(c=d.length;c--;)d[c].path=d[c].cutOff?this.cutOffPath(a,d[c].cutOff):a;this.setAttr(b,a)},fillSetter:function(a,b,c){var d=c.nodeName;if(d==="SPAN")c.style.color=a;else if(d!=="IMG")c.filled=a!==P,this.setAttr("fillcolor",this.renderer.color(a,c,b,this))},opacitySetter:sa,rotationSetter:function(a,b,c){c=c.style;this[b]=c[b]=a;c.left=-v(fa(a*Ea)+1)+"px";c.top=v(aa(a*Ea))+"px"},strokeSetter:function(a,b,c){this.setAttr("strokecolor",this.renderer.color(a,c,b))},"stroke-widthSetter":function(a,b,c){c.stroked=!!a;this[b]=a;ja(a)&&(a+="px");this.setAttr("strokeweight",a)},titleSetter:function(a,b){this.setAttr(b,a)},visibilitySetter:function(a,b,c){a==="inherit"&&(a="visible");this.shadows&&q(this.shadows,function(c){c.style[b]=a});c.nodeName==="DIV"&&(a=a==="hidden"?"-999em":0,hb||(c.style[b]=a?"visible":"hidden"),b="top");c.style[b]=a},xSetter:function(a,b,c){this[b]=a;b==="x"?b="left":b==="y"&&(b="top");this.updateClipping?(this[b]=a,this.updateClipping()):c.style[b]=a},zIndexSetter:function(a,b,c){c.style[b]=a}};K.VMLElement=Z=ma(S,Z);Z.prototype.ySetter=Z.prototype.widthSetter=Z.prototype.heightSetter=Z.prototype.xSetter;var ia={Element:Z,isIE8:wa.indexOf("MSIE 8.0")>-1,init:function(a,b,c,d){var e;this.alignedObjects=[];d=this.createElement(Ka).css(r(this.getStyle(d),{position:"relative"}));e=d.element;a.appendChild(d.element);this.isVML=!0;this.box=e;this.boxWrapper=d;this.cache={};this.setSize(b,c,!1);if(!x.namespaces.hcv){x.namespaces.add("hcv","urn:schemas-microsoft-com:vml");try{x.createStyleSheet().cssText="hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } "}catch(f){x.styleSheets[0].cssText+="hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } "}}},isHidden:function(){return!this.box.offsetWidth},clipRect:function(a,b,c,d){var e=this.createElement(),f=da(a);return r(e,{members:[],left:(f?a.x:a)+1,top:(f?a.y:b)+1,width:(f?a.width:c)-1,height:(f?a.height:d)-1,getCSS:function(a){var b=a.element,c=b.nodeName,a=a.inverted,d=this.top-(c==="shape"?b.offsetTop:0),e=this.left,b=e+this.width,f=d+this.height,d={clip:"rect("+v(a?e:d)+"px,"+v(a?f:b)+"px,"+v(a?b:f)+"px,"+v(a?d:e)+"px)"};!a&&hb&&c==="DIV"&&r(d,{width:b+"px",height:f+"px"});return d},updateClipping:function(){q(e.members,function(a){a.element&&a.css(e.getCSS(a))})}})},color:function(a,b,c,d){var e=this,f,g=/^rgba/,h,i,j=P;a&&a.linearGradient?i="gradient":a&&a.radialGradient&&(i="pattern");if(i){var k,l,n=a.linearGradient||a.radialGradient,m,o,p,D,J,C="",a=a.stops,t,s=[],u=function(){h=['<fill colors="'+s.join(",")+'" opacity="',p,'" o:opacity2="',o,'" type="',i,'" ',C,'focus="100%" method="any" />'];$(e.prepVML(h),null,null,b)};m=a[0];t=a[a.length-1];m[0]>0&&a.unshift([0,m[1]]);t[0]<1&&a.push([1,t[1]]);q(a,function(a,b){g.test(a[1])?(f=ya(a[1]),k=f.get("rgb"),l=f.get("a")):(k=a[1],l=1);s.push(a[0]*100+"% "+k);b?(p=l,D=k):(o=l,J=k)});if(c==="fill")if(i==="gradient")c=n.x1||n[0]||0,a=n.y1||n[1]||0,m=n.x2||n[2]||0,n=n.y2||n[3]||0,C='angle="'+(90-V.atan((n-a)/(m-c))*180/oa)+'"',u();else{var j=n.r,r=j*2,v=j*2,x=n.cx,z=n.cy,R=b.radialReference,w,j=function(){R&&(w=d.getBBox(),x+=(R[0]-w.x)/w.width-.5,z+=(R[1]-w.y)/w.height-.5,r*=R[2]/w.width,v*=R[2]/w.height);C='src="'+E.global.VMLRadialGradientURL+'" size="'+r+","+v+'" origin="0.5,0.5" position="'+x+","+z+'" color2="'+J+'" ';u()};d.added?j():d.onAdd=j;j=D}else j=k}else if(g.test(a)&&b.tagName!=="IMG")f=ya(a),h=["<",c,' opacity="',f.get("a"),'"/>'],$(this.prepVML(h),null,null,b),j=f.get("rgb");else{j=b.getElementsByTagName(c);if(j.length)j[0].opacity=1,j[0].type="solid";j=a}return j},prepVML:function(a){var b=this.isIE8,a=a.join("");b?(a=a.replace("/>",' xmlns="urn:schemas-microsoft-com:vml" />'),a=a.indexOf('style="')===-1?a.replace("/>",' style="display:inline-block;behavior:url(#default#VML);" />'):a.replace('style="','style="display:inline-block;behavior:url(#default#VML);')):a=a.replace("<","<hcv:");return a},text:ta.prototype.html,path:function(a){var b={coordsize:"10 10"};Ha(a)?b.d=a:da(a)&&r(b,a);return this.createElement("shape").attr(b)},circle:function(a,b,c){var d=this.symbol("circle");if(da(a))c=a.r,b=a.y,a=a.x;d.isCircle=!0;d.r=c;return d.attr({x:a,y:b})},g:function(a){var b;a&&(b={className:"highcharts-"+a,class:"highcharts-"+a});return this.createElement(Ka).attr(b)},image:function(a,b,c,d,e){var f=this.createElement("img").attr({src:a});arguments.length>1&&f.attr({x:b,y:c,width:d,height:e});return f},createElement:function(a){return a==="rect"?this.symbol(a):ta.prototype.createElement.call(this,a)},invertChild:function(a,b){var c=this,d=b.style,e=a.tagName==="IMG"&&a.style;B(a,{flip:"x",left:y(d.width)-(e?y(e.top):1),top:y(d.height)-(e?y(e.left):1),rotation:-90});q(a.childNodes,function(b){c.invertChild(b,a)})},symbols:{arc:function(a,b,c,d,e){var f=e.start,g=e.end,h=e.r||c||d,c=e.innerR,d=aa(f),i=fa(f),j=aa(g),k=fa(g);if(g-f===0)return["x"];f=["wa",a-h,b-h,a+h,b+h,a+h*d,b+h*i,a+h*j,b+h*k];e.open&&!c&&f.push("e","M",a,b);f.push("at",a-c,b-c,a+c,b+c,a+c*j,b+c*k,a+c*d,b+c*i,"x","e");f.isArc=!0;return f},circle:function(a,b,c,d,e){e&&(c=d=2*e.r);e&&e.isCircle&&(a-=c/2,b-=d/2);return["wa",a,b,a+c,b+d,a+c,b+d/2,a+c,b+d/2,"e"]},rect:function(a,b,c,d,e){return ta.prototype.symbols[!s(e)||!e.r?"square":"callout"].call(0,a,b,c,d,e)}}};K.VMLRenderer=Z=function(){this.init.apply(this,arguments)};Z.prototype=w(ta.prototype,ia);Za=Z}ta.prototype.measureSpanWidth=function(a,b){var c=x.createElement("span"),d;d=x.createTextNode(a);c.appendChild(d);B(c,b);this.box.appendChild(c);d=c.offsetWidth;Qa(c);return d};var Mb;if(ga)K.CanVGRenderer=Z=function(){xa="http://www.w3.org/1999/xhtml"},Z.prototype.symbols={},Mb=function(){function a(){var a=b.length,d;for(d=0;d<a;d++)b[d]();b=[]}var b=[];return{push:function(c,d){b.length===0&&Rb(d,a);b.push(c)}}}(),Za=Z;Ta.prototype={addLabel:function(){var a=this.axis,b=a.options,c=a.chart,d=a.horiz,e=a.categories,f=a.names,g=this.pos,h=b.labels,i=h.rotation,j=a.tickPositions,d=d&&e&&!h.step&&!h.staggerLines&&!h.rotation&&c.plotWidth/j.length||!d&&(c.margin[3]||c.chartWidth*.33),k=g===j[0],l=g===j[j.length-1],n,f=e?p(e[g],f[g],g):g,e=this.label,m=j.info;a.isDatetimeAxis&&m&&(n=b.dateTimeLabelFormats[m.higherRanks[g]||m.unitName]);this.isFirst=k;this.isLast=l;b=a.labelFormatter.call({axis:a,chart:c,isFirst:k,isLast:l,dateTimeLabelFormat:n,value:a.isLog?ea(ka(f)):f});g=d&&{width:t(1,v(d-2*(h.padding||10)))+"px"};if(s(e))e&&e.attr({text:b}).css(g);else{n={align:a.labelAlign};if(ja(i))n.rotation=i;if(d&&h.ellipsis)g.HcHeight=a.len/j.length;this.label=e=s(b)&&h.enabled?c.renderer.text(b,0,0,h.useHTML).attr(n).css(r(g,h.style)).add(a.labelGroup):null;a.tickBaseline=c.renderer.fontMetrics(h.style.fontSize,e).b;i&&a.side===2&&(a.tickBaseline*=aa(i*Ea))}this.yOffset=e?p(h.y,a.tickBaseline+(a.side===2?8:-(e.getBBox().height/2))):0},getLabelSize:function(){var a=this.label,b=this.axis;return a?a.getBBox()[b.horiz?"height":"width"]:0},getLabelSides:function(){var a=this.label.getBBox(),b=this.axis,c=b.horiz,d=b.options.labels,a=c?a.width:a.height,b=c?d.x-a*{left:0,center:.5,right:1}[b.labelAlign]:0;return[b,c?a+b:a]},handleOverflow:function(a,b){var c=!0,d=this.axis,e=this.isFirst,f=this.isLast,g=d.horiz?b.x:b.y,h=d.reversed,i=d.tickPositions,j=this.getLabelSides(),k=j[0],j=j[1],l,n,m,o=this.label.line;l=o||0;n=d.labelEdge;m=d.justifyLabels&&(e||f);n[l]===u||g+k>n[l]?n[l]=g+j:m||(c=!1);if(m){l=(n=d.justifyToPlot)?d.pos:0;n=n?l+d.len:d.chart.chartWidth;do{a+=e?1:-1,m=d.ticks[i[a]]}while(i[a]&&(!m||!m.label||m.label.line!==o));d=m&&m.label.xy&&m.label.xy.x+m.getLabelSides()[e?0:1];e&&!h||f&&h?g+k<l&&(g=l-k,m&&g+j>d&&(c=!1)):g+j>n&&(g=n-j,m&&g+k<d&&(c=!1));b.x=g}return c},getPosition:function(a,b,c,d){var e=this.axis,f=e.chart,g=d&&f.oldChartHeight||f.chartHeight;return{x:a?e.translate(b+c,null,null,d)+e.transB:e.left+e.offset+(e.opposite?(d&&f.oldChartWidth||f.chartWidth)-e.right-e.left:0),y:a?g-e.bottom+e.offset-(e.opposite?e.height:0):g-e.translate(b+c,null,null,d)-e.transB}},getLabelPosition:function(a,b,c,d,e,f,g,h){var i=this.axis,j=i.transA,k=i.reversed,l=i.staggerLines,a=a+e.x-(f&&d?f*j*(k?-1:1):0),b=b+this.yOffset-(f&&!d?f*j*(k?1:-1):0);if(l)c.line=g/(h||1)%l,b+=c.line*(i.labelOffset/l);return{x:a,y:b}},getMarkPath:function(a,b,c,d,e,f){return f.crispLine(["M",a,b,"L",a+(e?0:-c),b+(e?c:0)],d)},render:function(a,b,c){var d=this.axis,e=d.options,f=d.chart.renderer,g=d.horiz,h=this.type,i=this.label,j=this.pos,k=e.labels,l=this.gridLine,n=h?h+"Grid":"grid",m=h?h+"Tick":"tick",o=e[n+"LineWidth"],q=e[n+"LineColor"],D=e[n+"LineDashStyle"],J=e[m+"Length"],n=e[m+"Width"]||0,C=e[m+"Color"],t=e[m+"Position"],m=this.mark,s=k.step,r=!0,v=d.tickmarkOffset,w=this.getPosition(g,j,v,b),x=w.x,w=w.y,z=g&&x===d.pos+d.len||!g&&w===d.pos?-1:1,c=p(c,1);this.isActive=!0;if(o){j=d.getPlotLinePath(j+v,o*z,b,!0);if(l===u){l={stroke:q,"stroke-width":o};if(D)l.dashstyle=D;if(!h)l.zIndex=1;if(b)l.opacity=0;this.gridLine=l=o?f.path(j).attr(l).add(d.gridGroup):null}if(!b&&l&&j)l[this.isNew?"attr":"animate"]({d:j,opacity:c})}if(n&&J)t==="inside"&&(J=-J),d.opposite&&(J=-J),h=this.getMarkPath(x,w,J,n*z,g,f),m?m.animate({d:h,opacity:c}):this.mark=f.path(h).attr({stroke:C,"stroke-width":n,opacity:c}).add(d.axisGroup);if(i&&!isNaN(x))i.xy=w=this.getLabelPosition(x,w,i,g,k,v,a,s),this.isFirst&&!this.isLast&&!p(e.showFirstLabel,1)||this.isLast&&!this.isFirst&&!p(e.showLastLabel,1)?r=!1:!d.isRadial&&!k.step&&!k.rotation&&!b&&c!==0&&(r=this.handleOverflow(a,w)),s&&a%s&&(r=!1),r&&!isNaN(w.y)?(w.opacity=c,i[this.isNew?"attr":"animate"](w),this.isNew=!1):i.attr("y",-9999)},destroy:function(){Pa(this,this.axis)}};K.PlotLineOrBand=function(a,b){this.axis=a;if(b)this.options=b,this.id=b.id};K.PlotLineOrBand.prototype={render:function(){var a=this,b=a.axis,c=b.horiz,d=(b.pointRange||0)/2,e=a.options,f=e.label,g=a.label,h=e.width,i=e.to,j=e.from,k=s(j)&&s(i),l=e.value,n=e.dashStyle,m=a.svgElem,o=[],p,q=e.color,J=e.zIndex,C=e.events,r={},u=b.chart.renderer;b.isLog&&(j=za(j),i=za(i),l=za(l));if(h){if(o=b.getPlotLinePath(l,h),r={stroke:q,"stroke-width":h},n)r.dashstyle=n}else if(k){j=t(j,b.min-d);i=L(i,b.max+d);o=b.getPlotBandPath(j,i,e);if(q)r.fill=q;if(e.borderWidth)r.stroke=e.borderColor,r["stroke-width"]=e.borderWidth}else return;if(s(J))r.zIndex=J;if(m)if(o)m.animate({d:o},null,m.onGetPath);else{if(m.hide(),m.onGetPath=function(){m.show()},g)a.label=g=g.destroy()}else if(o&&o.length&&(a.svgElem=m=u.path(o).attr(r).add(),C))for(p in d=function(b){m.on(b,function(c){C[b].apply(a,[c])})},C)d(p);if(f&&s(f.text)&&o&&o.length&&b.width>0&&b.height>0){f=w({align:c&&k&&"center",x:c?!k&&4:10,verticalAlign:!c&&k&&"middle",y:c?k?16:10:k?6:-4,rotation:c&&!k&&90},f);if(!g){r={align:f.textAlign||f.align,rotation:f.rotation};if(s(J))r.zIndex=J;a.label=g=u.text(f.text,0,0,f.useHTML).attr(r).css(f.style).add()}b=[o[1],o[4],k?o[6]:o[1]];k=[o[2],o[5],k?o[7]:o[2]];o=Oa(b);c=Oa(k);g.align(f,!1,{x:o,y:c,width:Ca(b)-o,height:Ca(k)-c});g.show()}else g&&g.hide();return a},destroy:function(){la(this.axis.plotLinesAndBands,this);delete this.axis;Pa(this)}};na.prototype={defaultOptions:{dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e. %b",week:"%e. %b",month:"%b '%y",year:"%Y"},endOnTick:!1,gridLineColor:"#C0C0C0",labels:M,lineColor:"#C0D0E0",lineWidth:1,minPadding:.01,maxPadding:.01,minorGridLineColor:"#E0E0E0",minorGridLineWidth:1,minorTickColor:"#A0A0A0",minorTickLength:2,minorTickPosition:"outside",startOfWeek:1,startOnTick:!1,tickColor:"#C0D0E0",tickLength:10,tickmarkPlacement:"between",tickPixelInterval:100,tickPosition:"outside",tickWidth:1,title:{align:"middle",style:{color:"#707070"}},type:"linear"},defaultYAxisOptions:{endOnTick:!0,gridLineWidth:1,tickPixelInterval:72,showLastLabel:!0,labels:{x:-8,y:3},lineWidth:0,maxPadding:.05,minPadding:.05,startOnTick:!0,tickWidth:0,title:{
rotation:270,text:"Values"},stackLabels:{enabled:!1,formatter:function(){return Ba(this.total,-1)},style:M.style}},defaultLeftAxisOptions:{labels:{x:-15,y:null},title:{rotation:270}},defaultRightAxisOptions:{labels:{x:15,y:null},title:{rotation:90}},defaultBottomAxisOptions:{labels:{x:0,y:null},title:{rotation:0}},defaultTopAxisOptions:{labels:{x:0,y:-15},title:{rotation:0}},init:function(a,b){var c=b.isX;this.horiz=a.inverted?!c:c;this.coll=(this.isXAxis=c)?"xAxis":"yAxis";this.opposite=b.opposite;this.side=b.side||(this.horiz?this.opposite?0:2:this.opposite?1:3);this.setOptions(b);var d=this.options,e=d.type;this.labelFormatter=d.labels.formatter||this.defaultLabelFormatter;this.userOptions=b;this.minPixelPadding=0;this.chart=a;this.reversed=d.reversed;this.zoomEnabled=d.zoomEnabled!==!1;this.categories=d.categories||e==="category";this.names=[];this.isLog=e==="logarithmic";this.isDatetimeAxis=e==="datetime";this.isLinked=s(d.linkedTo);this.tickmarkOffset=this.categories&&d.tickmarkPlacement==="between"&&p(d.tickInterval,1)===1?.5:0;this.ticks={};this.labelEdge=[];this.minorTicks={};this.plotLinesAndBands=[];this.alternateBands={};this.len=0;this.minRange=this.userMinRange=d.minRange||d.maxZoom;this.range=d.range;this.offset=d.offset||0;this.stacks={};this.oldStacks={};this.min=this.max=null;this.crosshair=p(d.crosshair,ra(a.options.tooltip.crosshairs)[c?0:1],!1);var f,d=this.options.events;Ma(this,a.axes)===-1&&(c&&!this.isColorAxis?a.axes.splice(a.xAxis.length,0,this):a.axes.push(this),a[this.coll].push(this));this.series=this.series||[];if(a.inverted&&c&&this.reversed===u)this.reversed=!0;this.removePlotLine=this.removePlotBand=this.removePlotBandOrLine;for(f in d)N(this,f,d[f]);if(this.isLog)this.val2lin=za,this.lin2val=ka},setOptions:function(a){this.options=w(this.defaultOptions,this.isXAxis?{}:this.defaultYAxisOptions,[this.defaultTopAxisOptions,this.defaultRightAxisOptions,this.defaultBottomAxisOptions,this.defaultLeftAxisOptions][this.side],w(E[this.coll],a))},defaultLabelFormatter:function(){var a=this.axis,b=this.value,c=a.categories,d=this.dateTimeLabelFormat,e=E.lang.numericSymbols,f=e&&e.length,g,h=a.options.labels.format,a=a.isLog?b:a.tickInterval;if(h)g=Ja(h,this);else if(c)g=b;else if(d)g=cb(d,b);else if(f&&a>=1e3)for(;f--&&g===u;)c=Math.pow(1e3,f+1),a>=c&&e[f]!==null&&(g=Ba(b/c,-1)+e[f]);g===u&&(g=Q(b)>=1e4?Ba(b,0):Ba(b,-1,u,""));return g},getSeriesExtremes:function(){var a=this,b=a.chart;a.hasVisibleSeries=!1;a.dataMin=a.dataMax=a.ignoreMinPadding=a.ignoreMaxPadding=null;a.buildStacks&&a.buildStacks();q(a.series,function(c){if(c.visible||!b.options.chart.ignoreHiddenSeries){var d;d=c.options.threshold;var e;a.hasVisibleSeries=!0;a.isLog&&d<=0&&(d=null);if(a.isXAxis){if(d=c.xData,d.length)a.dataMin=L(p(a.dataMin,d[0]),Oa(d)),a.dataMax=t(p(a.dataMax,d[0]),Ca(d))}else{c.getExtremes();e=c.dataMax;c=c.dataMin;if(s(c)&&s(e))a.dataMin=L(p(a.dataMin,c),c),a.dataMax=t(p(a.dataMax,e),e);if(s(d))if(a.dataMin>=d)a.dataMin=d,a.ignoreMinPadding=!0;else if(a.dataMax<d)a.dataMax=d,a.ignoreMaxPadding=!0}}})},translate:function(a,b,c,d,e,f){var g=1,h=0,i=d?this.oldTransA:this.transA,d=d?this.oldMin:this.min,j=this.minPixelPadding,e=(this.options.ordinal||this.isLog&&e)&&this.lin2val;if(!i)i=this.transA;if(c)g*=-1,h=this.len;this.reversed&&(g*=-1,h-=g*(this.sector||this.len));b?(a=a*g+h,a-=j,a=a/i+d,e&&(a=this.lin2val(a))):(e&&(a=this.val2lin(a)),f==="between"&&(f=.5),a=g*(a-d)*i+h+g*j+(ja(f)?i*f*this.pointRange:0));return a},toPixels:function(a,b){return this.translate(a,!1,!this.horiz,null,!0)+(b?0:this.pos)},toValue:function(a,b){return this.translate(a-(b?0:this.pos),!0,!this.horiz,null,!0)},getPlotLinePath:function(a,b,c,d,e){var f=this.chart,g=this.left,h=this.top,i,j,k=c&&f.oldChartHeight||f.chartHeight,l=c&&f.oldChartWidth||f.chartWidth,n;i=this.transB;e=p(e,this.translate(a,null,null,c));a=c=v(e+i);i=j=v(k-e-i);if(isNaN(e))n=!0;else if(this.horiz){if(i=h,j=k-this.bottom,a<g||a>g+this.width)n=!0}else if(a=g,c=l-this.right,i<h||i>h+this.height)n=!0;return n&&!d?null:f.renderer.crispLine(["M",a,i,"L",c,j],b||1)},getLinearTickPositions:function(a,b,c){var d,e=ea(U(b/a)*a),f=ea(La(c/a)*a),g=[];if(b===c&&ja(b))return[b];for(b=e;b<=f;){g.push(b);b=ea(b+a);if(b===d)break;d=b}return g},getMinorTickPositions:function(){var a=this.options,b=this.tickPositions,c=this.minorTickInterval,d=[],e;if(this.isLog){e=b.length;for(a=1;a<e;a++)d=d.concat(this.getLogTickPositions(c,b[a-1],b[a],!0))}else if(this.isDatetimeAxis&&a.minorTickInterval==="auto")d=d.concat(this.getTimeTicks(this.normalizeTimeTickInterval(c),this.min,this.max,a.startOfWeek)),d[0]<this.min&&d.shift();else for(b=this.min+(b[0]-this.min)%c;b<=this.max;b+=c)d.push(b);return d},adjustForMinRange:function(){var a=this.options,b=this.min,c=this.max,d,e=this.dataMax-this.dataMin>=this.minRange,f,g,h,i,j;if(this.isXAxis&&this.minRange===u&&!this.isLog)s(a.min)||s(a.max)?this.minRange=null:(q(this.series,function(a){i=a.xData;for(g=j=a.xIncrement?1:i.length-1;g>0;g--)if(h=i[g]-i[g-1],f===u||h<f)f=h}),this.minRange=L(f*5,this.dataMax-this.dataMin));if(c-b<this.minRange){var k=this.minRange;d=(k-c+b)/2;d=[b-d,p(a.min,b-d)];if(e)d[2]=this.dataMin;b=Ca(d);c=[b+k,p(a.max,b+k)];if(e)c[2]=this.dataMax;c=Oa(c);c-b<k&&(d[0]=c-k,d[1]=p(a.min,c-k),b=Ca(d))}this.min=b;this.max=c},setAxisTranslation:function(a){var b=this,c=b.max-b.min,d=b.axisPointRange||0,e,f=0,g=0,h=b.linkedParent,i=!!b.categories,j=b.transA;if(b.isXAxis||i||d)h?(f=h.minPointOffset,g=h.pointRangePadding):q(b.series,function(a){var h=i?1:b.isXAxis?a.pointRange:b.axisPointRange||0,j=a.options.pointPlacement,m=a.closestPointRange;h>c&&(h=0);d=t(d,h);f=t(f,Ga(j)?0:h/2);g=t(g,j==="on"?0:h);!a.noSharedTooltip&&s(m)&&(e=s(e)?L(e,m):m)}),h=b.ordinalSlope&&e?b.ordinalSlope/e:1,b.minPointOffset=f*=h,b.pointRangePadding=g*=h,b.pointRange=L(d,c),b.closestPointRange=e;if(a)b.oldTransA=j;b.translationSlope=b.transA=j=b.len/(c+g||1);b.transB=b.horiz?b.left:b.bottom;b.minPixelPadding=j*f},setTickPositions:function(a){var b=this,c=b.chart,d=b.options,e=d.startOnTick,f=d.endOnTick,g=b.isLog,h=b.isDatetimeAxis,i=b.isXAxis,j=b.isLinked,k=b.options.tickPositioner,l=d.maxPadding,n=d.minPadding,m=d.tickInterval,o=d.minTickInterval,Y=d.tickPixelInterval,D,J=b.categories;j?(b.linkedParent=c[b.coll][d.linkedTo],c=b.linkedParent.getExtremes(),b.min=p(c.min,c.dataMin),b.max=p(c.max,c.dataMax),d.type!==b.linkedParent.options.type&&ha(11,1)):(b.min=p(b.userMin,d.min,b.dataMin),b.max=p(b.userMax,d.max,b.dataMax));if(g)!a&&L(b.min,p(b.dataMin,b.min))<=0&&ha(10,1),b.min=ea(za(b.min)),b.max=ea(za(b.max));if(b.range&&s(b.max))b.userMin=b.min=t(b.min,b.max-b.range),b.userMax=b.max,b.range=null;b.beforePadding&&b.beforePadding();b.adjustForMinRange();if(!J&&!b.axisPointRange&&!b.usePercentage&&!j&&s(b.min)&&s(b.max)&&(c=b.max-b.min)){if(!s(d.min)&&!s(b.userMin)&&n&&(b.dataMin<0||!b.ignoreMinPadding))b.min-=c*n;if(!s(d.max)&&!s(b.userMax)&&l&&(b.dataMax>0||!b.ignoreMaxPadding))b.max+=c*l}if(ja(d.floor))b.min=t(b.min,d.floor);if(ja(d.ceiling))b.max=L(b.max,d.ceiling);b.min===b.max||b.min===void 0||b.max===void 0?b.tickInterval=1:j&&!m&&Y===b.linkedParent.options.tickPixelInterval?b.tickInterval=b.linkedParent.tickInterval:(b.tickInterval=p(m,J?1:(b.max-b.min)*Y/t(b.len,Y)),!s(m)&&b.len<Y&&!this.isRadial&&!this.isLog&&!J&&e&&f&&(D=!0,b.tickInterval/=4));i&&!a&&q(b.series,function(a){a.processData(b.min!==b.oldMin||b.max!==b.oldMax)});b.setAxisTranslation(!0);b.beforeSetTickPositions&&b.beforeSetTickPositions();if(b.postProcessTickInterval)b.tickInterval=b.postProcessTickInterval(b.tickInterval);if(b.pointRange)b.tickInterval=t(b.pointRange,b.tickInterval);if(!m&&b.tickInterval<o)b.tickInterval=o;if(!h&&!g&&!m)b.tickInterval=nb(b.tickInterval,null,mb(b.tickInterval),p(d.allowDecimals,!(b.tickInterval>1&&b.tickInterval<5&&b.max>1e3&&b.max<9999)));b.minorTickInterval=d.minorTickInterval==="auto"&&b.tickInterval?b.tickInterval/5:d.minorTickInterval;b.tickPositions=a=d.tickPositions?[].concat(d.tickPositions):k&&k.apply(b,[b.min,b.max]);if(!a)!b.ordinalPositions&&(b.max-b.min)/b.tickInterval>t(2*b.len,200)&&ha(19,!0),a=h?b.getTimeTicks(b.normalizeTimeTickInterval(b.tickInterval,d.units),b.min,b.max,d.startOfWeek,b.ordinalPositions,b.closestPointRange,!0):g?b.getLogTickPositions(b.tickInterval,b.min,b.max):b.getLinearTickPositions(b.tickInterval,b.min,b.max),D&&a.splice(1,a.length-2),b.tickPositions=a;if(!j)d=a[0],g=a[a.length-1],h=b.minPointOffset||0,e?b.min=d:b.min-h>d&&a.shift(),f?b.max=g:b.max+h<g&&a.pop(),a.length===0&&s(d)&&a.push((g+d)/2),a.length===1&&(e=Q(b.max)>1e13?1:.001,b.min-=e,b.max+=e)},setMaxTicks:function(){var a=this.chart,b=a.maxTicks||{},c=this.tickPositions,d=this._maxTicksKey=[this.coll,this.pos,this.len].join("-");if(!this.isLinked&&!this.isDatetimeAxis&&c&&c.length>(b[d]||0)&&this.options.alignTicks!==!1)b[d]=c.length;a.maxTicks=b},adjustTickAmount:function(){var a=this._maxTicksKey,b=this.tickPositions,c=this.chart.maxTicks;if(c&&c[a]&&!this.isDatetimeAxis&&!this.categories&&!this.isLinked&&this.options.alignTicks!==!1&&this.min!==u){var d=this.tickAmount,e=b.length;this.tickAmount=a=c[a];if(e<a){for(;b.length<a;)b.push(ea(b[b.length-1]+this.tickInterval));this.transA*=(e-1)/(a-1);this.max=b[b.length-1]}if(s(d)&&a!==d)this.isDirty=!0}},setScale:function(){var a=this.stacks,b,c,d,e;this.oldMin=this.min;this.oldMax=this.max;this.oldAxisLength=this.len;this.setAxisSize();e=this.len!==this.oldAxisLength;q(this.series,function(a){if(a.isDirtyData||a.isDirty||a.xAxis.isDirty)d=!0});if(e||d||this.isLinked||this.forceRedraw||this.userMin!==this.oldUserMin||this.userMax!==this.oldUserMax){if(!this.isXAxis)for(b in a)for(c in a[b])a[b][c].total=null,a[b][c].cum=0;this.forceRedraw=!1;this.getSeriesExtremes();this.setTickPositions();this.oldUserMin=this.userMin;this.oldUserMax=this.userMax;if(!this.isDirty)this.isDirty=e||this.min!==this.oldMin||this.max!==this.oldMax}else if(!this.isXAxis){if(this.oldStacks)a=this.stacks=this.oldStacks;for(b in a)for(c in a[b])a[b][c].cum=a[b][c].total}this.setMaxTicks()},setExtremes:function(a,b,c,d,e){var f=this,g=f.chart,c=p(c,!0),e=r(e,{min:a,max:b});I(f,"setExtremes",e,function(){f.userMin=a;f.userMax=b;f.eventArgs=e;f.isDirtyExtremes=!0;c&&g.redraw(d)})},zoom:function(a,b){var c=this.dataMin,d=this.dataMax,e=this.options;this.allowZoomOutside||(s(c)&&a<=L(c,p(e.min,c))&&(a=u),s(d)&&b>=t(d,p(e.max,d))&&(b=u));this.displayBtn=a!==u||b!==u;this.setExtremes(a,b,!1,u,{trigger:"zoom"});return!0},setAxisSize:function(){var a=this.chart,b=this.options,c=b.offsetLeft||0,d=this.horiz,e=p(b.width,a.plotWidth-c+(b.offsetRight||0)),f=p(b.height,a.plotHeight),g=p(b.top,a.plotTop),b=p(b.left,a.plotLeft+c),c=/%$/;c.test(f)&&(f=parseInt(f,10)/100*a.plotHeight);c.test(g)&&(g=parseInt(g,10)/100*a.plotHeight+a.plotTop);this.left=b;this.top=g;this.width=e;this.height=f;this.bottom=a.chartHeight-f-g;this.right=a.chartWidth-e-b;this.len=t(d?e:f,0);this.pos=d?b:g},getExtremes:function(){var a=this.isLog;return{min:a?ea(ka(this.min)):this.min,max:a?ea(ka(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}},getThreshold:function(a){var b=this.isLog,c=b?ka(this.min):this.min,b=b?ka(this.max):this.max;c>a||a===null?a=c:b<a&&(a=b);return this.translate(a,0,1,0,1)},autoLabelAlign:function(a){a=(p(a,0)-this.side*90+720)%360;return a>15&&a<165?"right":a>195&&a<345?"left":"center"},getOffset:function(){var a=this,b=a.chart,c=b.renderer,d=a.options,e=a.tickPositions,f=a.ticks,g=a.horiz,h=a.side,i=b.inverted?[1,0,3,2][h]:h,j,k,l=0,n,m=0,o=d.title,Y=d.labels,D=0,J=b.axisOffset,b=b.clipOffset,C=[-1,1,1,-1][h],r,v=1,w=p(Y.maxStaggerLines,5),x,y,A,z,R;a.hasData=j=a.hasVisibleSeries||s(a.min)&&s(a.max)&&!!e;a.showAxis=k=j||p(d.showEmpty,!0);a.staggerLines=a.horiz&&Y.staggerLines;if(!a.axisGroup)a.gridGroup=c.g("grid").attr({zIndex:d.gridZIndex||1}).add(),a.axisGroup=c.g("axis").attr({zIndex:d.zIndex||2}).add(),a.labelGroup=c.g("axis-labels").attr({zIndex:Y.zIndex||7}).addClass("highcharts-"+a.coll.toLowerCase()+"-labels").add();if(j||a.isLinked){a.labelAlign=p(Y.align||a.autoLabelAlign(Y.rotation));q(e,function(b){f[b]?f[b].addLabel():f[b]=new Ta(a,b)});if(a.horiz&&!a.staggerLines&&w&&!Y.rotation){for(j=a.reversed?[].concat(e).reverse():e;v<w;){x=[];y=!1;for(r=0;r<j.length;r++)A=j[r],z=(z=f[A].label&&f[A].label.getBBox())?z.width:0,R=r%v,z&&(A=a.translate(A),x[R]!==u&&A<x[R]&&(y=!0),x[R]=A+z);if(y)v++;else break}if(v>1)a.staggerLines=v}q(e,function(b){if(h===0||h===2||{1:"left",3:"right"}[h]===a.labelAlign)D=t(f[b].getLabelSize(),D)});if(a.staggerLines)D*=a.staggerLines,a.labelOffset=D}else for(r in f)f[r].destroy(),delete f[r];if(o&&o.text&&o.enabled!==!1){if(!a.axisTitle)a.axisTitle=c.text(o.text,0,0,o.useHTML).attr({zIndex:7,rotation:o.rotation||0,align:o.textAlign||{low:"left",middle:"center",high:"right"}[o.align]}).addClass("highcharts-"+this.coll.toLowerCase()+"-title").css(o.style).add(a.axisGroup),a.axisTitle.isNew=!0;if(k)l=a.axisTitle.getBBox()[g?"height":"width"],n=o.offset,m=s(n)?0:p(o.margin,g?5:10);a.axisTitle[k?"show":"hide"]()}a.offset=C*p(d.offset,J[h]);c=h===2?a.tickBaseline:0;g=D+m+(D&&C*(g?p(Y.y,a.tickBaseline+8):Y.x)-c);a.axisTitleMargin=p(n,g);J[h]=t(J[h],a.axisTitleMargin+l+C*a.offset,g);b[i]=t(b[i],U(d.lineWidth/2)*2)},getLinePath:function(a){var b=this.chart,c=this.opposite,d=this.offset,e=this.horiz,f=this.left+(c?this.width:0)+d,d=b.chartHeight-this.bottom-(c?this.height:0)+d;c&&(a*=-1);return b.renderer.crispLine(["M",e?this.left:f,e?d:this.top,"L",e?b.chartWidth-this.right:f,e?d:b.chartHeight-this.bottom],a)},getTitlePosition:function(){var a=this.horiz,b=this.left,c=this.top,d=this.len,e=this.options.title,f=a?b:c,g=this.opposite,h=this.offset,i=y(e.style.fontSize||12),d={low:f+(a?0:d),middle:f+d/2,high:f+(a?d:0)}[e.align],b=(a?c+this.height:b)+(a?1:-1)*(g?-1:1)*this.axisTitleMargin+(this.side===2?i:0);return{x:a?d:b+(g?this.width:0)+h+(e.x||0),y:a?b-(g?this.height:0)+h:d+(e.y||0)}},render:function(){var a=this,b=a.horiz,c=a.reversed,d=a.chart,e=d.renderer,f=a.options,g=a.isLog,h=a.isLinked,i=a.tickPositions,j,k=a.axisTitle,l=a.ticks,n=a.minorTicks,m=a.alternateBands,o=f.stackLabels,p=f.alternateGridColor,D=a.tickmarkOffset,J=f.lineWidth,C=d.hasRendered&&s(a.oldMin)&&!isNaN(a.oldMin),r=a.hasData,t=a.showAxis,v,w=f.labels.overflow,x=a.justifyLabels=b&&w!==!1,A;a.labelEdge.length=0;a.justifyToPlot=w==="justify";q([l,n,m],function(a){for(var b in a)a[b].isActive=!1});if(r||h)if(a.minorTickInterval&&!a.categories&&q(a.getMinorTickPositions(),function(b){n[b]||(n[b]=new Ta(a,b,"minor"));C&&n[b].isNew&&n[b].render(null,!0);n[b].render(null,!1,1)}),i.length&&(j=i.slice(),(b&&c||!b&&!c)&&j.reverse(),x&&(j=j.slice(1).concat([j[0]])),q(j,function(b,c){x&&(c=c===j.length-1?0:c+1);if(!h||b>=a.min&&b<=a.max)l[b]||(l[b]=new Ta(a,b)),C&&l[b].isNew&&l[b].render(c,!0,.1),l[b].render(c)}),D&&a.min===0&&(l[-1]||(l[-1]=new Ta(a,-1,null,!0)),l[-1].render(-1))),p&&q(i,function(b,c){if(c%2===0&&b<a.max)m[b]||(m[b]=new K.PlotLineOrBand(a)),v=b+D,A=i[c+1]!==u?i[c+1]+D:a.max,m[b].options={from:g?ka(v):v,to:g?ka(A):A,color:p},m[b].render(),m[b].isActive=!0}),!a._addedPlotLB)q((f.plotLines||[]).concat(f.plotBands||[]),function(b){a.addPlotBandOrLine(b)}),a._addedPlotLB=!0;q([l,n,m],function(a){var b,c,e=[],f=va?va.duration||500:0,g=function(){for(c=e.length;c--;)a[e[c]]&&!a[e[c]].isActive&&(a[e[c]].destroy(),delete a[e[c]])};for(b in a)if(!a[b].isActive)a[b].render(b,!1,0),a[b].isActive=!1,e.push(b);a===m||!d.hasRendered||!f?g():f&&setTimeout(g,f)});if(J)b=a.getLinePath(J),a.axisLine?a.axisLine.animate({d:b}):a.axisLine=e.path(b).attr({stroke:f.lineColor,"stroke-width":J,zIndex:7}).add(a.axisGroup),a.axisLine[t?"show":"hide"]();if(k&&t)k[k.isNew?"attr":"animate"](a.getTitlePosition()),k.isNew=!1;o&&o.enabled&&a.renderStackTotals();a.isDirty=!1},redraw:function(){this.render();q(this.plotLinesAndBands,function(a){a.render()});q(this.series,function(a){a.isDirty=!0})},destroy:function(a){var b=this,c=b.stacks,d,e=b.plotLinesAndBands;a||X(b);for(d in c)Pa(c[d]),c[d]=null;q([b.ticks,b.minorTicks,b.alternateBands],function(a){Pa(a)});for(a=e.length;a--;)e[a].destroy();q("stackTotalGroup,axisLine,axisTitle,axisGroup,cross,gridGroup,labelGroup".split(","),function(a){b[a]&&(b[a]=b[a].destroy())});this.cross&&this.cross.destroy()},drawCrosshair:function(a,b){if(this.crosshair)if((s(b)||!p(this.crosshair.snap,!0))===!1)this.hideCrosshair();else{var c,d=this.crosshair,e=d.animation;p(d.snap,!0)?s(b)&&(c=this.chart.inverted!=this.horiz?b.plotX:this.len-b.plotY):c=this.horiz?a.chartX-this.pos:this.len-a.chartY+this.pos;c=this.isRadial?this.getPlotLinePath(this.isXAxis?b.x:p(b.stackY,b.y)):this.getPlotLinePath(null,null,null,null,c);if(c===null)this.hideCrosshair();else if(this.cross)this.cross.attr({visibility:"visible"})[e?"animate":"attr"]({d:c},e);else{e={"stroke-width":d.width||1,stroke:d.color||"#C0C0C0",zIndex:d.zIndex||2};if(d.dashStyle)e.dashstyle=d.dashStyle;this.cross=this.chart.renderer.path(c).attr(e).add()}}},hideCrosshair:function(){this.cross&&this.cross.hide()}};r(na.prototype,{getPlotBandPath:function(a,b){var c=this.getPlotLinePath(b),d=this.getPlotLinePath(a);d&&c?d.push(c[4],c[5],c[1],c[2]):d=null;return d},addPlotBand:function(a){return this.addPlotBandOrLine(a,"plotBands")},addPlotLine:function(a){return this.addPlotBandOrLine(a,"plotLines")},addPlotBandOrLine:function(a,b){var c=new K.PlotLineOrBand(this,a).render(),d=this.userOptions;c&&(b&&(d[b]=d[b]||[],d[b].push(a)),this.plotLinesAndBands.push(c));return c},removePlotBandOrLine:function(a){for(var b=this.plotLinesAndBands,c=this.options,d=this.userOptions,e=b.length;e--;)b[e].id===a&&b[e].destroy();q([c.plotLines||[],d.plotLines||[],c.plotBands||[],d.plotBands||[]],function(b){for(e=b.length;e--;)b[e].id===a&&la(b,b[e])})}});na.prototype.getTimeTicks=function(a,b,c,d){var e=[],f={},g=E.global.useUTC,h,i=new Da(b-Sa),j=a.unitRange,k=a.count;if(s(b)){j>=A.second&&(i.setMilliseconds(0),i.setSeconds(j>=A.minute?0:k*U(i.getSeconds()/k)));if(j>=A.minute)i[Cb](j>=A.hour?0:k*U(i[pb]()/k));if(j>=A.hour)i[Db](j>=A.day?0:k*U(i[qb]()/k));if(j>=A.day)i[sb](j>=A.month?1:k*U(i[Xa]()/k));j>=A.month&&(i[Eb](j>=A.year?0:k*U(i[fb]()/k)),h=i[gb]());j>=A.year&&(h-=h%k,i[Fb](h));if(j===A.week)i[sb](i[Xa]()-i[rb]()+p(d,1));b=1;Sa&&(i=new Da(i.getTime()+Sa));h=i[gb]();for(var d=i.getTime(),l=i[fb](),n=i[Xa](),m=(A.day+(g?Sa:i.getTimezoneOffset()*6e4))%A.day;d<c;)e.push(d),j===A.year?d=eb(h+b*k,0):j===A.month?d=eb(h,l+b*k):!g&&(j===A.day||j===A.week)?d=eb(h,l,n+b*k*(j===A.day?1:7)):d+=j*k,b++;e.push(d);q(wb(e,function(a){return j<=A.hour&&a%A.day===m}),function(a){f[a]="day"})}e.info=r(a,{higherRanks:f,totalRange:j*k});return e};na.prototype.normalizeTimeTickInterval=function(a,b){var c=b||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],d=c[c.length-1],e=A[d[0]],f=d[1],g;for(g=0;g<c.length;g++)if(d=c[g],e=A[d[0]],f=d[1],c[g+1]&&a<=(e*f[f.length-1]+A[c[g+1][0]])/2)break;e===A.year&&a<5*e&&(f=[1,2,5]);c=nb(a/e,f,d[0]==="year"?t(mb(a/e),1):1);return{unitRange:e,count:c,unitName:d[0]}};na.prototype.getLogTickPositions=function(a,b,c,d){var e=this.options,f=this.len,g=[];if(!d)this._minorAutoInterval=null;if(a>=.5)a=v(a),g=this.getLinearTickPositions(a,b,c);else if(a>=.08)for(var f=U(b),h,i,j,k,l,e=a>.3?[1,2,4]:a>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9];f<c+1&&!l;f++){i=e.length;for(h=0;h<i&&!l;h++)j=za(ka(f)*e[h]),j>b&&(!d||k<=c)&&k!==u&&g.push(k),k>c&&(l=!0),k=j}else if(b=ka(b),c=ka(c),a=e[d?"minorTickInterval":"tickInterval"],a=p(a==="auto"?null:a,this._minorAutoInterval,(c-b)*(e.tickPixelInterval/(d?5:1))/((d?f/this.tickPositions.length:f)||1)),a=nb(a,null,mb(a)),g=Va(this.getLinearTickPositions(a,b,c),za),!d)this._minorAutoInterval=a/5;if(!d)this.tickInterval=a;return g};var Nb=K.Tooltip=function(){this.init.apply(this,arguments)};Nb.prototype={init:function(a,b){var c=b.borderWidth,d=b.style,e=y(d.padding);this.chart=a;this.options=b;this.crosshairs=[];this.now={x:0,y:0};this.isHidden=!0;this.label=a.renderer.label("",0,0,b.shape||"callout",null,null,b.useHTML,null,"tooltip").attr({padding:e,fill:b.backgroundColor,"stroke-width":c,r:b.borderRadius,zIndex:8}).css(d).css({padding:0}).add().attr({y:-9999});ga||this.label.shadow(b.shadow);this.shared=b.shared},destroy:function(){if(this.label)this.label=this.label.destroy();clearTimeout(this.hideTimer);clearTimeout(this.tooltipTimeout)},move:function(a,b,c,d){var e=this,f=e.now,g=e.options.animation!==!1&&!e.isHidden&&(Q(a-f.x)>1||Q(b-f.y)>1),h=e.followPointer||e.len>1;r(f,{x:g?(2*f.x+a)/3:a,y:g?(f.y+b)/2:b,anchorX:h?u:g?(2*f.anchorX+c)/3:c,anchorY:h?u:g?(f.anchorY+d)/2:d});e.label.attr(f);if(g)clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout(function(){e&&e.move(a,b,c,d)},32)},hide:function(a){var b=this,c;clearTimeout(this.hideTimer);if(!this.isHidden)c=this.chart.hoverPoints,this.hideTimer=setTimeout(function(){b.label.fadeOut();b.isHidden=!0},p(a,this.options.hideDelay,500)),c&&q(c,function(a){a.setState()}),this.chart.hoverPoints=null},getAnchor:function(a,b){var c,d=this.chart,e=d.inverted,f=d.plotTop,g=0,h=0,i,a=ra(a);c=a[0].tooltipPos;this.followPointer&&b&&(b.chartX===u&&(b=d.pointer.normalize(b)),c=[b.chartX-d.plotLeft,b.chartY-f]);c||(q(a,function(a){i=a.series.yAxis;g+=a.plotX;h+=(a.plotLow?(a.plotLow+a.plotHigh)/2:a.plotY)+(!e&&i?i.top-f:0)}),g/=a.length,h/=a.length,c=[e?d.plotWidth-h:g,this.shared&&!e&&a.length>1&&b?b.chartY-f:e?d.plotHeight-g:h]);return Va(c,v)},getPosition:function(a,b,c){var d=this.chart,e=this.distance,f={},g,h=["y",d.chartHeight,b,c.plotY+d.plotTop],i=["x",d.chartWidth,a,c.plotX+d.plotLeft],j=c.ttBelow||d.inverted&&!c.negative||!d.inverted&&c.negative,k=function(a,b,c,d){var g=c<d-e,b=d+e+c<b,c=d-e-c;d+=e;if(j&&b)f[a]=d;else if(!j&&g)f[a]=c;else if(g)f[a]=c;else if(b)f[a]=d;else return!1},l=function(a,b,c,d){if(d<e||d>b-e)return!1;else f[a]=d<c/2?1:d>b-c/2?b-c-2:d-c/2},n=function(a){var b=h;h=i;i=b;g=a},m=function(){k.apply(0,h)!==!1?l.apply(0,i)===!1&&!g&&(n(!0),m()):g?f.x=f.y=0:(n(!0),m())};(d.inverted||this.len>1)&&n();m();return f},defaultFormatter:function(a){var b=this.points||ra(this),c=b[0].series,d;d=[a.tooltipHeaderFormatter(b[0])];q(b,function(a){c=a.series;d.push(c.tooltipFormatter&&c.tooltipFormatter(a)||a.point.tooltipFormatter(c.tooltipOptions.pointFormat))});d.push(a.options.footerFormat||"");return d.join("")},refresh:function(a,b){var c=this.chart,d=this.label,e=this.options,f,g,h={},i,j=[];i=e.formatter||this.defaultFormatter;var h=c.hoverPoints,k,l=this.shared;clearTimeout(this.hideTimer);this.followPointer=ra(a)[0].series.tooltipOptions.followPointer;g=this.getAnchor(a,b);f=g[0];g=g[1];l&&(!a.series||!a.series.noSharedTooltip)?(c.hoverPoints=a,h&&q(h,function(a){a.setState()}),q(a,function(a){a.setState("hover");j.push(a.getLabelConfig())}),h={x:a[0].category,y:a[0].y},h.points=j,this.len=j.length,a=a[0]):h=a.getLabelConfig();i=i.call(h,this);h=a.series;this.distance=p(h.tooltipOptions.distance,16);i===!1?this.hide():(this.isHidden&&(bb(d),d.attr("opacity",1).show()),d.attr({text:i}),k=e.borderColor||a.color||h.color||"#606060",d.attr({stroke:k}),this.updatePosition({plotX:f,plotY:g,negative:a.negative,ttBelow:a.ttBelow}),this.isHidden=!1);I(c,"tooltipRefresh",{text:i,x:f+c.plotLeft,y:g+c.plotTop,borderColor:k})},updatePosition:function(a){var b=this.chart,c=this.label,c=(this.options.positioner||this.getPosition).call(this,c.width,c.height,a);this.move(v(c.x),v(c.y),a.plotX+b.plotLeft,a.plotY+b.plotTop)},tooltipHeaderFormatter:function(a){var b=a.series,c=b.tooltipOptions,d=c.dateTimeLabelFormats,e=c.xDateFormat,f=b.xAxis,g=f&&f.options.type==="datetime"&&ja(a.key),c=c.headerFormat,f=f&&f.closestPointRange,h;if(g&&!e){if(f)for(h in A){if(A[h]>=f||A[h]<=A.day&&a.key%A[h]>0){e=d[h];break}}else e=d.day;e=e||d.year}g&&e&&(c=c.replace("{point.key}","{point.key:"+e+"}"));return Ja(c,{point:a,series:b})}};var pa;$a=x.documentElement.ontouchstart!==u;var Wa=K.Pointer=function(a,b){this.init(a,b)};Wa.prototype={init:function(a,b){var c=b.chart,d=c.events,e=ga?"":c.zoomType,c=a.inverted,f;this.options=b;this.chart=a;this.zoomX=f=/x/.test(e);this.zoomY=e=/y/.test(e);this.zoomHor=f&&!c||e&&c;this.zoomVert=e&&!c||f&&c;this.hasZoom=f||e;this.runChartClick=d&&!!d.click;this.pinchDown=[];this.lastValidTouch={};if(K.Tooltip&&b.tooltip.enabled)a.tooltip=new Nb(a,b.tooltip),this.followTouchMove=b.tooltip.followTouchMove;this.setDOMEvents()},normalize:function(a,b){var c,d,a=a||window.event,a=Tb(a);if(!a.target)a.target=a.srcElement;d=a.touches?a.touches.length?a.touches.item(0):a.changedTouches[0]:a;if(!b)this.chartPosition=b=Sb(this.chart.container);d.pageX===u?(c=t(a.x,a.clientX-b.left),d=a.y):(c=d.pageX-b.left,d=d.pageY-b.top);return r(a,{chartX:v(c),chartY:v(d)})},getCoordinates:function(a){var b={xAxis:[],yAxis:[]};q(this.chart.axes,function(c){b[c.isXAxis?"xAxis":"yAxis"].push({axis:c,value:c.toValue(a[c.horiz?"chartX":"chartY"])})});return b},getIndex:function(a){var b=this.chart;return b.inverted?b.plotHeight+b.plotTop-a.chartY:a.chartX-b.plotLeft},runPointActions:function(a){var b=this.chart,c=b.series,d=b.tooltip,e,f,g=b.hoverPoint,h=b.hoverSeries,i,j,k=b.chartWidth,l=this.getIndex(a);if(d&&this.options.tooltip.shared&&(!h||!h.noSharedTooltip)){f=[];i=c.length;for(j=0;j<i;j++)if(c[j].visible&&c[j].options.enableMouseTracking!==!1&&!c[j].noSharedTooltip&&c[j].singularTooltips!==!0&&c[j].tooltipPoints.length&&(e=c[j].tooltipPoints[l])&&e.series)e._dist=Q(l-e.clientX),k=L(k,e._dist),f.push(e);for(i=f.length;i--;)f[i]._dist>k&&f.splice(i,1);if(f.length&&f[0].clientX!==this.hoverX)d.refresh(f,a),this.hoverX=f[0].clientX}c=h&&h.tooltipOptions.followPointer;if(h&&h.tracker&&!c){if((e=h.tooltipPoints[l])&&e!==g)e.onMouseOver(a)}else d&&c&&!d.isHidden&&(h=d.getAnchor([{}],a),d.updatePosition({plotX:h[0],plotY:h[1]}));if(d&&!this._onDocumentMouseMove)this._onDocumentMouseMove=function(a){if(W[pa])W[pa].pointer.onDocumentMouseMove(a)},N(x,"mousemove",this._onDocumentMouseMove);q(b.axes,function(b){b.drawCrosshair(a,p(e,g))})},reset:function(a,b){var c=this.chart,d=c.hoverSeries,e=c.hoverPoint,f=c.tooltip,g=f&&f.shared?c.hoverPoints:e;(a=a&&f&&g)&&ra(g)[0].plotX===u&&(a=!1);if(a)f.refresh(g),e&&e.setState(e.state,!0);else{if(e)e.onMouseOut();if(d)d.onMouseOut();f&&f.hide(b);if(this._onDocumentMouseMove)X(x,"mousemove",this._onDocumentMouseMove),this._onDocumentMouseMove=null;q(c.axes,function(a){a.hideCrosshair()});this.hoverX=null}},scaleGroups:function(a,b){var c=this.chart,d;q(c.series,function(e){d=a||e.getPlotBox();e.xAxis&&e.xAxis.zoomEnabled&&(e.group.attr(d),e.markerGroup&&(e.markerGroup.attr(d),e.markerGroup.clip(b?c.clipRect:null)),e.dataLabelsGroup&&e.dataLabelsGroup.attr(d))});c.clipRect.attr(b||c.clipBox)},dragStart:function(a){var b=this.chart;b.mouseIsDown=a.type;b.cancelClick=!1;b.mouseDownX=this.mouseDownX=a.chartX;b.mouseDownY=this.mouseDownY=a.chartY},drag:function(a){var b=this.chart,c=b.options.chart,d=a.chartX,e=a.chartY,f=this.zoomHor,g=this.zoomVert,h=b.plotLeft,i=b.plotTop,j=b.plotWidth,k=b.plotHeight,l,n=this.mouseDownX,m=this.mouseDownY,o=c.panKey&&a[c.panKey+"Key"];d<h?d=h:d>h+j&&(d=h+j);e<i?e=i:e>i+k&&(e=i+k);this.hasDragged=Math.sqrt(Math.pow(n-d,2)+Math.pow(m-e,2));if(this.hasDragged>10){l=b.isInsidePlot(n-h,m-i);if(b.hasCartesianSeries&&(this.zoomX||this.zoomY)&&l&&!o&&!this.selectionMarker)this.selectionMarker=b.renderer.rect(h,i,f?1:j,g?1:k,0).attr({fill:c.selectionMarkerFill||"rgba(69,114,167,0.25)",zIndex:7}).add();this.selectionMarker&&f&&(d-=n,this.selectionMarker.attr({width:Q(d),x:(d>0?0:d)+n}));this.selectionMarker&&g&&(d=e-m,this.selectionMarker.attr({height:Q(d),y:(d>0?0:d)+m}));l&&!this.selectionMarker&&c.panning&&b.pan(a,c.panning)}},drop:function(a){var b=this.chart,c=this.hasPinched;if(this.selectionMarker){var d={xAxis:[],yAxis:[],originalEvent:a.originalEvent||a},e=this.selectionMarker,f=e.attr?e.attr("x"):e.x,g=e.attr?e.attr("y"):e.y,h=e.attr?e.attr("width"):e.width,i=e.attr?e.attr("height"):e.height,j;if(this.hasDragged||c)q(b.axes,function(b){if(b.zoomEnabled){var c=b.horiz,e=a.type==="touchend"?b.minPixelPadding:0,m=b.toValue((c?f:g)+e),c=b.toValue((c?f+h:g+i)-e);!isNaN(m)&&!isNaN(c)&&(d[b.coll].push({axis:b,min:L(m,c),max:t(m,c)}),j=!0)}}),j&&I(b,"selection",d,function(a){b.zoom(r(a,c?{animation:!1}:null))});this.selectionMarker=this.selectionMarker.destroy();c&&this.scaleGroups()}if(b)B(b.container,{cursor:b._cursor}),b.cancelClick=this.hasDragged>10,b.mouseIsDown=this.hasDragged=this.hasPinched=!1,this.pinchDown=[]},onContainerMouseDown:function(a){a=this.normalize(a);a.preventDefault&&a.preventDefault();this.dragStart(a)},onDocumentMouseUp:function(a){W[pa]&&W[pa].pointer.drop(a)},onDocumentMouseMove:function(a){var b=this.chart,c=this.chartPosition,d=b.hoverSeries,a=this.normalize(a,c);c&&d&&!this.inClass(a.target,"highcharts-tracker")&&!b.isInsidePlot(a.chartX-b.plotLeft,a.chartY-b.plotTop)&&this.reset()},onContainerMouseLeave:function(){var a=W[pa];if(a)a.pointer.reset(),a.pointer.chartPosition=null},onContainerMouseMove:function(a){var b=this.chart;pa=b.index;a=this.normalize(a);a.returnValue=!1;b.mouseIsDown==="mousedown"&&this.drag(a);(this.inClass(a.target,"highcharts-tracker")||b.isInsidePlot(a.chartX-b.plotLeft,a.chartY-b.plotTop))&&!b.openMenu&&this.runPointActions(a)},inClass:function(a,b){for(var c;a;){if(c=F(a,"class"))if(c.indexOf(b)!==-1)return!0;else if(c.indexOf("highcharts-container")!==-1)return!1;a=a.parentNode}},onTrackerMouseOut:function(a){var b=this.chart.hoverSeries,c=(a=a.relatedTarget||a.toElement)&&a.point&&a.point.series;if(b&&!b.options.stickyTracking&&!this.inClass(a,"highcharts-tooltip")&&c!==b)b.onMouseOut()},onContainerClick:function(a){var b=this.chart,c=b.hoverPoint,d=b.plotLeft,e=b.plotTop,a=this.normalize(a);a.cancelBubble=!0;b.cancelClick||(c&&this.inClass(a.target,"highcharts-tracker")?(I(c.series,"click",r(a,{point:c})),b.hoverPoint&&c.firePointEvent("click",a)):(r(a,this.getCoordinates(a)),b.isInsidePlot(a.chartX-d,a.chartY-e)&&I(b,"click",a)))},setDOMEvents:function(){var a=this,b=a.chart.container;b.onmousedown=function(b){a.onContainerMouseDown(b)};b.onmousemove=function(b){a.onContainerMouseMove(b)};b.onclick=function(b){a.onContainerClick(b)};N(b,"mouseleave",a.onContainerMouseLeave);ab===1&&N(x,"mouseup",a.onDocumentMouseUp);if($a)b.ontouchstart=function(b){a.onContainerTouchStart(b)},b.ontouchmove=function(b){a.onContainerTouchMove(b)},ab===1&&N(x,"touchend",a.onDocumentTouchEnd)},destroy:function(){var a;X(this.chart.container,"mouseleave",this.onContainerMouseLeave);ab||(X(x,"mouseup",this.onDocumentMouseUp),X(x,"touchend",this.onDocumentTouchEnd));clearInterval(this.tooltipTimeout);for(a in this)this[a]=null}};r(K.Pointer.prototype,{pinchTranslate:function(a,b,c,d,e,f){(this.zoomHor||this.pinchHor)&&this.pinchTranslateDirection(!0,a,b,c,d,e,f);(this.zoomVert||this.pinchVert)&&this.pinchTranslateDirection(!1,a,b,c,d,e,f)},pinchTranslateDirection:function(a,b,c,d,e,f,g,h){var i=this.chart,j=a?"x":"y",k=a?"X":"Y",l="chart"+k,n=a?"width":"height",m=i["plot"+(a?"Left":"Top")],o,p,q=h||1,r=i.inverted,C=i.bounds[a?"h":"v"],t=b.length===1,s=b[0][l],v=c[0][l],u=!t&&b[1][l],w=!t&&c[1][l],x,c=function(){!t&&Q(s-u)>20&&(q=h||Q(v-w)/Q(s-u));p=(m-v)/q+s;o=i["plot"+(a?"Width":"Height")]/q};c();b=p;b<C.min?(b=C.min,x=!0):b+o>C.max&&(b=C.max-o,x=!0);x?(v-=.8*(v-g[j][0]),t||(w-=.8*(w-g[j][1])),c()):g[j]=[v,w];r||(f[j]=p-m,f[n]=o);f=r?1/q:q;e[n]=o;e[j]=b;d[r?a?"scaleY":"scaleX":"scale"+k]=q;d["translate"+k]=f*m+(v-f*s)},pinch:function(a){var b=this,c=b.chart,d=b.pinchDown,e=b.followTouchMove,f=a.touches,g=f.length,h=b.lastValidTouch,i=b.hasZoom,j=b.selectionMarker,k={},l=g===1&&(b.inClass(a.target,"highcharts-tracker")&&c.runTrackerClick||b.runChartClick),n={}
;(i||e)&&!l&&a.preventDefault();Va(f,function(a){return b.normalize(a)});if(a.type==="touchstart")q(f,function(a,b){d[b]={chartX:a.chartX,chartY:a.chartY}}),h.x=[d[0].chartX,d[1]&&d[1].chartX],h.y=[d[0].chartY,d[1]&&d[1].chartY],q(c.axes,function(a){if(a.zoomEnabled){var b=c.bounds[a.horiz?"h":"v"],d=a.minPixelPadding,e=a.toPixels(p(a.options.min,a.dataMin)),f=a.toPixels(p(a.options.max,a.dataMax)),g=L(e,f),e=t(e,f);b.min=L(a.pos,g-d);b.max=t(a.pos+a.len,e+d)}}),b.res=!0;else if(d.length){if(!j)b.selectionMarker=j=r({destroy:sa},c.plotBox);b.pinchTranslate(d,f,k,j,n,h);b.hasPinched=i;b.scaleGroups(k,n);if(!i&&e&&g===1)this.runPointActions(b.normalize(a));else if(b.res)b.res=!1,this.reset(!1,0)}},onContainerTouchStart:function(a){var b=this.chart;pa=b.index;a.touches.length===1?(a=this.normalize(a),b.isInsidePlot(a.chartX-b.plotLeft,a.chartY-b.plotTop)?(this.runPointActions(a),this.pinch(a)):this.reset()):a.touches.length===2&&this.pinch(a)},onContainerTouchMove:function(a){(a.touches.length===1||a.touches.length===2)&&this.pinch(a)},onDocumentTouchEnd:function(a){W[pa]&&W[pa].pointer.drop(a)}});if(G.PointerEvent||G.MSPointerEvent){var ua={},zb=!!G.PointerEvent,Xb=function(){var a,b=[];b.item=function(a){return this[a]};for(a in ua)ua.hasOwnProperty(a)&&b.push({pageX:ua[a].pageX,pageY:ua[a].pageY,target:ua[a].target});return b},Ab=function(a,b,c,d){a=a.originalEvent||a;if((a.pointerType==="touch"||a.pointerType===a.MSPOINTER_TYPE_TOUCH)&&W[pa])d(a),d=W[pa].pointer,d[b]({type:c,target:a.currentTarget,preventDefault:sa,touches:Xb()})};r(Wa.prototype,{onContainerPointerDown:function(a){Ab(a,"onContainerTouchStart","touchstart",function(a){ua[a.pointerId]={pageX:a.pageX,pageY:a.pageY,target:a.currentTarget}})},onContainerPointerMove:function(a){Ab(a,"onContainerTouchMove","touchmove",function(a){ua[a.pointerId]={pageX:a.pageX,pageY:a.pageY};if(!ua[a.pointerId].target)ua[a.pointerId].target=a.currentTarget})},onDocumentPointerUp:function(a){Ab(a,"onContainerTouchEnd","touchend",function(a){delete ua[a.pointerId]})},batchMSEvents:function(a){a(this.chart.container,zb?"pointerdown":"MSPointerDown",this.onContainerPointerDown);a(this.chart.container,zb?"pointermove":"MSPointerMove",this.onContainerPointerMove);a(x,zb?"pointerup":"MSPointerUp",this.onDocumentPointerUp)}});Na(Wa.prototype,"init",function(a,b,c){a.call(this,b,c);(this.hasZoom||this.followTouchMove)&&B(b.container,{"-ms-touch-action":P,"touch-action":P})});Na(Wa.prototype,"setDOMEvents",function(a){a.apply(this);(this.hasZoom||this.followTouchMove)&&this.batchMSEvents(N)});Na(Wa.prototype,"destroy",function(a){this.batchMSEvents(X);a.call(this)})}var lb=K.Legend=function(a,b){this.init(a,b)};lb.prototype={init:function(a,b){var c=this,d=b.itemStyle,e=p(b.padding,8),f=b.itemMarginTop||0;this.options=b;if(b.enabled)c.itemStyle=d,c.itemHiddenStyle=w(d,b.itemHiddenStyle),c.itemMarginTop=f,c.padding=e,c.initialItemX=e,c.initialItemY=e-5,c.maxItemWidth=0,c.chart=a,c.itemHeight=0,c.lastLineHeight=0,c.symbolWidth=p(b.symbolWidth,16),c.pages=[],c.render(),N(c.chart,"endResize",function(){c.positionCheckboxes()})},colorizeItem:function(a,b){var c=this.options,d=a.legendItem,e=a.legendLine,f=a.legendSymbol,g=this.itemHiddenStyle.color,c=b?c.itemStyle.color:g,h=b?a.legendColor||a.color||"#CCC":g,g=a.options&&a.options.marker,i={fill:h},j;d&&d.css({fill:c,color:c});e&&e.attr({stroke:h});if(f){if(g&&f.isMarker)for(j in i.stroke=h,g=a.convertAttribs(g),g)d=g[j],d!==u&&(i[j]=d);f.attr(i)}},positionItem:function(a){var b=this.options,c=b.symbolPadding,b=!b.rtl,d=a._legendItemPos,e=d[0],d=d[1],f=a.checkbox;a.legendGroup&&a.legendGroup.translate(b?e:this.legendWidth-e-2*c-4,d);if(f)f.x=e,f.y=d},destroyItem:function(a){var b=a.checkbox;q(["legendItem","legendLine","legendSymbol","legendGroup"],function(b){a[b]&&(a[b]=a[b].destroy())});b&&Qa(a.checkbox)},destroy:function(){var a=this.group,b=this.box;if(b)this.box=b.destroy();if(a)this.group=a.destroy()},positionCheckboxes:function(a){var b=this.group.alignAttr,c,d=this.clipHeight||this.legendHeight;if(b)c=b.translateY,q(this.allItems,function(e){var f=e.checkbox,g;f&&(g=c+f.y+(a||0)+3,B(f,{left:b.translateX+e.checkboxOffset+f.x-20+"px",top:g+"px",display:g>c-6&&g<c+d-6?"":P}))})},renderTitle:function(){var a=this.padding,b=this.options.title,c=0;if(b.text){if(!this.title)this.title=this.chart.renderer.label(b.text,a-3,a-4,null,null,null,null,null,"legend-title").attr({zIndex:1}).css(b.style).add(this.group);a=this.title.getBBox();c=a.height;this.offsetWidth=a.width;this.contentGroup.attr({translateY:c})}this.titleHeight=c},renderItem:function(a){var b=this.chart,c=b.renderer,d=this.options,e=d.layout==="horizontal",f=this.symbolWidth,g=d.symbolPadding,h=this.itemStyle,i=this.itemHiddenStyle,j=this.padding,k=e?p(d.itemDistance,20):0,l=!d.rtl,n=d.width,m=d.itemMarginBottom||0,o=this.itemMarginTop,q=this.initialItemX,r=a.legendItem,s=a.series&&a.series.drawLegendSymbol?a.series:a,C=s.options,C=this.createCheckboxForItem&&C&&C.showCheckbox,u=d.useHTML;if(!r){a.legendGroup=c.g("legend-item").attr({zIndex:1}).add(this.scrollGroup);a.legendItem=r=c.text(d.labelFormat?Ja(d.labelFormat,a):d.labelFormatter.call(a),l?f+g:-g,this.baseline||0,u).css(w(a.visible?h:i)).attr({align:l?"left":"right",zIndex:2}).add(a.legendGroup);if(!this.baseline)this.baseline=c.fontMetrics(h.fontSize,r).f+3+o,r.attr("y",this.baseline);s.drawLegendSymbol(this,a);this.setItemEvents&&this.setItemEvents(a,r,u,h,i);this.colorizeItem(a,a.visible);C&&this.createCheckboxForItem(a)}c=r.getBBox();f=a.checkboxOffset=d.itemWidth||a.legendItemWidth||f+g+c.width+k+(C?20:0);this.itemHeight=g=v(a.legendItemHeight||c.height);if(e&&this.itemX-q+f>(n||b.chartWidth-2*j-q-d.x))this.itemX=q,this.itemY+=o+this.lastLineHeight+m,this.lastLineHeight=0;this.maxItemWidth=t(this.maxItemWidth,f);this.lastItemY=o+this.itemY+m;this.lastLineHeight=t(g,this.lastLineHeight);a._legendItemPos=[this.itemX,this.itemY];e?this.itemX+=f:(this.itemY+=o+g+m,this.lastLineHeight=g);this.offsetWidth=n||t((e?this.itemX-q-k:f)+j,this.offsetWidth)},getAllItems:function(){var a=[];q(this.chart.series,function(b){var c=b.options;if(p(c.showInLegend,!s(c.linkedTo)?u:!1,!0))a=a.concat(b.legendItems||(c.legendType==="point"?b.data:b))});return a},render:function(){var a=this,b=a.chart,c=b.renderer,d=a.group,e,f,g,h,i=a.box,j=a.options,k=a.padding,l=j.borderWidth,n=j.backgroundColor;a.itemX=a.initialItemX;a.itemY=a.initialItemY;a.offsetWidth=0;a.lastItemY=0;if(!d)a.group=d=c.g("legend").attr({zIndex:7}).add(),a.contentGroup=c.g().attr({zIndex:1}).add(d),a.scrollGroup=c.g().add(a.contentGroup);a.renderTitle();e=a.getAllItems();ob(e,function(a,b){return(a.options&&a.options.legendIndex||0)-(b.options&&b.options.legendIndex||0)});j.reversed&&e.reverse();a.allItems=e;a.display=f=!!e.length;q(e,function(b){a.renderItem(b)});g=j.width||a.offsetWidth;h=a.lastItemY+a.lastLineHeight+a.titleHeight;h=a.handleOverflow(h);if(l||n){g+=k;h+=k;if(i){if(g>0&&h>0)i[i.isNew?"attr":"animate"](i.crisp({width:g,height:h})),i.isNew=!1}else a.box=i=c.rect(0,0,g,h,j.borderRadius,l||0).attr({stroke:j.borderColor,"stroke-width":l||0,fill:n||P}).add(d).shadow(j.shadow),i.isNew=!0;i[f?"show":"hide"]()}a.legendWidth=g;a.legendHeight=h;q(e,function(b){a.positionItem(b)});f&&d.align(r({width:g,height:h},j),!0,"spacingBox");b.isResizing||this.positionCheckboxes()},handleOverflow:function(a){var b=this,c=this.chart,d=c.renderer,e=this.options,f=e.y,f=c.spacingBox.height+(e.verticalAlign==="top"?-f:f)-this.padding,g=e.maxHeight,h,i=this.clipRect,j=e.navigation,k=p(j.animation,!0),l=j.arrowSize||12,n=this.nav,m=this.pages,o,r=this.allItems;e.layout==="horizontal"&&(f/=2);g&&(f=L(f,g));m.length=0;if(a>f&&!e.useHTML){this.clipHeight=h=t(f-20-this.titleHeight-this.padding,0);this.currentPage=p(this.currentPage,1);this.fullHeight=a;q(r,function(a,b){var c=a._legendItemPos[1],d=v(a.legendItem.getBBox().height),e=m.length;if(!e||c-m[e-1]>h&&(o||c)!==m[e-1])m.push(o||c),e++;b===r.length-1&&c+d-m[e-1]>h&&m.push(c);c!==o&&(o=c)});if(!i)i=b.clipRect=d.clipRect(0,this.padding,9999,0),b.contentGroup.clip(i);i.attr({height:h});if(!n)this.nav=n=d.g().attr({zIndex:1}).add(this.group),this.up=d.symbol("triangle",0,0,l,l).on("click",function(){b.scroll(-1,k)}).add(n),this.pager=d.text("",15,10).css(j.style).add(n),this.down=d.symbol("triangle-down",0,0,l,l).on("click",function(){b.scroll(1,k)}).add(n);b.scroll(0);a=f}else if(n)i.attr({height:c.chartHeight}),n.hide(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0;return a},scroll:function(a,b){var c=this.pages,d=c.length,e=this.currentPage+a,f=this.clipHeight,g=this.options.navigation,h=g.activeColor,g=g.inactiveColor,i=this.pager,j=this.padding;e>d&&(e=d);if(e>0)b!==u&&Ra(b,this.chart),this.nav.attr({translateX:j,translateY:f+this.padding+7+this.titleHeight,visibility:"visible"}),this.up.attr({fill:e===1?g:h}).css({cursor:e===1?"default":"pointer"}),i.attr({text:e+"/"+d}),this.down.attr({x:18+this.pager.getBBox().width,fill:e===d?g:h}).css({cursor:e===d?"default":"pointer"}),c=-c[e-1]+this.initialItemY,this.scrollGroup.animate({translateY:c}),this.currentPage=e,this.positionCheckboxes(c)}};M=K.LegendSymbolMixin={drawRectangle:function(a,b){var c=a.options.symbolHeight||12;b.legendSymbol=this.chart.renderer.rect(0,a.baseline-5-c/2,a.symbolWidth,c,a.options.symbolRadius||0).attr({zIndex:3}).add(b.legendGroup)},drawLineMarker:function(a){var b=this.options,c=b.marker,d;d=a.symbolWidth;var e=this.chart.renderer,f=this.legendGroup,a=a.baseline-v(e.fontMetrics(a.options.itemStyle.fontSize,this.legendItem).b*.3),g;if(b.lineWidth){g={"stroke-width":b.lineWidth};if(b.dashStyle)g.dashstyle=b.dashStyle;this.legendLine=e.path(["M",0,a,"L",d,a]).attr(g).add(f)}if(c&&c.enabled!==!1)b=c.radius,this.legendSymbol=d=e.symbol(this.symbol,d/2-b,a-b,2*b,2*b).add(f),d.isMarker=!0}};(/Trident\/7\.0/.test(wa)||Ua)&&Na(lb.prototype,"positionItem",function(a,b){var c=this,d=function(){b._legendItemPos&&a.call(c,b)};d();setTimeout(d)});Ya.prototype={init:function(a,b){var c,d=a.series;a.series=null;c=w(E,a);c.series=a.series=d;this.userOptions=a;d=c.chart;this.margin=this.splashArray("margin",d);this.spacing=this.splashArray("spacing",d);var e=d.events;this.bounds={h:{},v:{}};this.callback=b;this.isResizing=0;this.options=c;this.axes=[];this.series=[];this.hasCartesianSeries=d.showAxes;var f=this,g;f.index=W.length;W.push(f);ab++;d.reflow!==!1&&N(f,"load",function(){f.initReflow()});if(e)for(g in e)N(f,g,e[g]);f.xAxis=[];f.yAxis=[];f.animation=ga?!1:p(d.animation,!0);f.pointCount=f.colorCounter=f.symbolCounter=0;f.firstRender()},initSeries:function(a){var b=this.options.chart;(b=H[a.type||b.type||b.defaultSeriesType])||ha(17,!0);b=new b;b.init(this,a);return b},isInsidePlot:function(a,b,c){var d=c?b:a,a=c?a:b;return d>=0&&d<=this.plotWidth&&a>=0&&a<=this.plotHeight},adjustTickAmounts:function(){this.options.chart.alignTicks!==!1&&q(this.axes,function(a){a.adjustTickAmount()});this.maxTicks=null},redraw:function(a){var b=this.axes,c=this.series,d=this.pointer,e=this.legend,f=this.isDirtyLegend,g,h,i=this.hasCartesianSeries,j=this.isDirtyBox,k=c.length,l=k,n=this.renderer,m=n.isHidden(),o=[];Ra(a,this);m&&this.cloneRenderTo();for(this.layOutTitles();l--;)if(a=c[l],a.options.stacking&&(g=!0,a.isDirty)){h=!0;break}if(h)for(l=k;l--;)if(a=c[l],a.options.stacking)a.isDirty=!0;q(c,function(a){a.isDirty&&a.options.legendType==="point"&&(f=!0)});if(f&&e.options.enabled)e.render(),this.isDirtyLegend=!1;g&&this.getStacks();if(i){if(!this.isResizing)this.maxTicks=null,q(b,function(a){a.setScale()});this.adjustTickAmounts()}this.getMargins();i&&(q(b,function(a){a.isDirty&&(j=!0)}),q(b,function(a){if(a.isDirtyExtremes)a.isDirtyExtremes=!1,o.push(function(){I(a,"afterSetExtremes",r(a.eventArgs,a.getExtremes()));delete a.eventArgs});(j||g)&&a.redraw()}));j&&this.drawChartBox();q(c,function(a){a.isDirty&&a.visible&&(!a.isCartesian||a.xAxis)&&a.redraw()});d&&d.reset(!0);n.draw();I(this,"redraw");m&&this.cloneRenderTo(!0);q(o,function(a){a.call()})},get:function(a){var b=this.axes,c=this.series,d,e;for(d=0;d<b.length;d++)if(b[d].options.id===a)return b[d];for(d=0;d<c.length;d++)if(c[d].options.id===a)return c[d];for(d=0;d<c.length;d++){e=c[d].points||[];for(b=0;b<e.length;b++)if(e[b].id===a)return e[b]}return null},getAxes:function(){var a=this,b=this.options,c=b.xAxis=ra(b.xAxis||{}),b=b.yAxis=ra(b.yAxis||{});q(c,function(a,b){a.index=b;a.isX=!0});q(b,function(a,b){a.index=b});c=c.concat(b);q(c,function(b){new na(a,b)});a.adjustTickAmounts()},getSelectedPoints:function(){var a=[];q(this.series,function(b){a=a.concat(wb(b.points||[],function(a){return a.selected}))});return a},getSelectedSeries:function(){return wb(this.series,function(a){return a.selected})},getStacks:function(){var a=this;q(a.yAxis,function(a){if(a.stacks&&a.hasVisibleSeries)a.oldStacks=a.stacks});q(a.series,function(b){if(b.options.stacking&&(b.visible===!0||a.options.chart.ignoreHiddenSeries===!1))b.stackKey=b.type+p(b.options.stack,"")})},setTitle:function(a,b,c){var g;var d=this,e=d.options,f;f=e.title=w(e.title,a);g=e.subtitle=w(e.subtitle,b),e=g;q([["title",a,f],["subtitle",b,e]],function(a){var b=a[0],c=d[b],e=a[1],a=a[2];c&&e&&(d[b]=c=c.destroy());a&&a.text&&!c&&(d[b]=d.renderer.text(a.text,0,0,a.useHTML).attr({align:a.align,class:"highcharts-"+b,zIndex:a.zIndex||4}).css(a.style).add())});d.layOutTitles(c)},layOutTitles:function(a){var b=0,c=this.title,d=this.subtitle,e=this.options,f=e.title,e=e.subtitle,g=this.renderer,h=this.spacingBox.width-44;if(c&&(c.css({width:(f.width||h)+"px"}).align(r({y:g.fontMetrics(f.style.fontSize,c).b-3},f),!1,"spacingBox"),!f.floating&&!f.verticalAlign))b=c.getBBox().height;d&&(d.css({width:(e.width||h)+"px"}).align(r({y:b+(f.margin-13)+g.fontMetrics(f.style.fontSize,d).b},e),!1,"spacingBox"),!e.floating&&!e.verticalAlign&&(b=La(b+d.getBBox().height)));c=this.titleOffset!==b;this.titleOffset=b;if(!this.isDirtyBox&&c)this.isDirtyBox=c,this.hasRendered&&p(a,!0)&&this.isDirtyBox&&this.redraw()},getChartSize:function(){var a=this.options.chart,b=a.width,a=a.height,c=this.renderToClone||this.renderTo;if(!s(b))this.containerWidth=ib(c,"width");if(!s(a))this.containerHeight=ib(c,"height");this.chartWidth=t(0,b||this.containerWidth||600);this.chartHeight=t(0,p(a,this.containerHeight>19?this.containerHeight:400))},cloneRenderTo:function(a){var b=this.renderToClone,c=this.container;a?b&&(this.renderTo.appendChild(c),Qa(b),delete this.renderToClone):(c&&c.parentNode===this.renderTo&&this.renderTo.removeChild(c),this.renderToClone=b=this.renderTo.cloneNode(0),B(b,{position:"absolute",top:"-9999px",display:"block"}),b.style.setProperty&&b.style.setProperty("display","block","important"),x.body.appendChild(b),c&&b.appendChild(c))},getContainer:function(){var a,b=this.options.chart,c,d,e;this.renderTo=a=b.renderTo;e="highcharts-"+ub++;if(Ga(a))this.renderTo=a=x.getElementById(a);a||ha(13,!0);c=y(F(a,"data-highcharts-chart"));!isNaN(c)&&W[c]&&W[c].hasRendered&&W[c].destroy();F(a,"data-highcharts-chart",this.index);a.innerHTML="";!b.skipClone&&!a.offsetWidth&&this.cloneRenderTo();this.getChartSize();c=this.chartWidth;d=this.chartHeight;this.container=a=$(Ka,{className:"highcharts-container"+(b.className?" "+b.className:""),id:e},r({position:"relative",overflow:"hidden",width:c+"px",height:d+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)"},b.style),this.renderToClone||a);this._cursor=a.style.cursor;this.renderer=b.forExport?new ta(a,c,d,b.style,!0):new Za(a,c,d,b.style);ga&&this.renderer.create(this,a,c,d)},getMargins:function(){var a=this.spacing,b,c=this.legend,d=this.margin,e=this.options.legend,f=p(e.margin,20),g=e.x,h=e.y,i=e.align,j=e.verticalAlign,k=this.titleOffset;this.resetMargins();b=this.axisOffset;if(k&&!s(d[0]))this.plotTop=t(this.plotTop,k+this.options.title.margin+a[0]);if(c.display&&!e.floating)if(i==="right"){if(!s(d[1]))this.marginRight=t(this.marginRight,c.legendWidth-g+f+a[1])}else if(i==="left"){if(!s(d[3]))this.plotLeft=t(this.plotLeft,c.legendWidth+g+f+a[3])}else if(j==="top"){if(!s(d[0]))this.plotTop=t(this.plotTop,c.legendHeight+h+f+a[0])}else if(j==="bottom"&&!s(d[2]))this.marginBottom=t(this.marginBottom,c.legendHeight-h+f+a[2]);this.extraBottomMargin&&(this.marginBottom+=this.extraBottomMargin);this.extraTopMargin&&(this.plotTop+=this.extraTopMargin);this.hasCartesianSeries&&q(this.axes,function(a){a.getOffset()});s(d[3])||(this.plotLeft+=b[3]);s(d[0])||(this.plotTop+=b[0]);s(d[2])||(this.marginBottom+=b[2]);s(d[1])||(this.marginRight+=b[1]);this.setChartSize()},reflow:function(a){var b=this,c=b.options.chart,d=b.renderTo,e=c.width||ib(d,"width"),f=c.height||ib(d,"height"),c=a?a.target:G,d=function(){if(b.container)b.setSize(e,f,!1),b.hasUserSize=null};if(!b.hasUserSize&&e&&f&&(c===G||c===x)){if(e!==b.containerWidth||f!==b.containerHeight)clearTimeout(b.reflowTimeout),a?b.reflowTimeout=setTimeout(d,100):d();b.containerWidth=e;b.containerHeight=f}},initReflow:function(){var a=this,b=function(b){a.reflow(b)};N(G,"resize",b);N(a,"destroy",function(){X(G,"resize",b)})},setSize:function(a,b,c){var d=this,e,f,g;d.isResizing+=1;g=function(){d&&I(d,"endResize",null,function(){d.isResizing-=1})};Ra(c,d);d.oldChartHeight=d.chartHeight;d.oldChartWidth=d.chartWidth;if(s(a))d.chartWidth=e=t(0,v(a)),d.hasUserSize=!!e;if(s(b))d.chartHeight=f=t(0,v(b));(va?jb:B)(d.container,{width:e+"px",height:f+"px"},va);d.setChartSize(!0);d.renderer.setSize(e,f,c);d.maxTicks=null;q(d.axes,function(a){a.isDirty=!0;a.setScale()});q(d.series,function(a){a.isDirty=!0});d.isDirtyLegend=!0;d.isDirtyBox=!0;d.layOutTitles();d.getMargins();d.redraw(c);d.oldChartHeight=null;I(d,"resize");va===!1?g():setTimeout(g,va&&va.duration||500)},setChartSize:function(a){var b=this.inverted,c=this.renderer,d=this.chartWidth,e=this.chartHeight,f=this.options.chart,g=this.spacing,h=this.clipOffset,i,j,k,l;this.plotLeft=i=v(this.plotLeft);this.plotTop=j=v(this.plotTop);this.plotWidth=k=t(0,v(d-i-this.marginRight));this.plotHeight=l=t(0,v(e-j-this.marginBottom));this.plotSizeX=b?l:k;this.plotSizeY=b?k:l;this.plotBorderWidth=f.plotBorderWidth||0;this.spacingBox=c.spacingBox={x:g[3],y:g[0],width:d-g[3]-g[1],height:e-g[0]-g[2]};this.plotBox=c.plotBox={x:i,y:j,width:k,height:l};d=2*U(this.plotBorderWidth/2);b=La(t(d,h[3])/2);c=La(t(d,h[0])/2);this.clipBox={x:b,y:c,width:U(this.plotSizeX-t(d,h[1])/2-b),height:t(0,U(this.plotSizeY-t(d,h[2])/2-c))};a||q(this.axes,function(a){a.setAxisSize();a.setAxisTranslation()})},resetMargins:function(){var a=this.spacing,b=this.margin;this.plotTop=p(b[0],a[0]);this.marginRight=p(b[1],a[1]);this.marginBottom=p(b[2],a[2]);this.plotLeft=p(b[3],a[3]);this.axisOffset=[0,0,0,0];this.clipOffset=[0,0,0,0]},drawChartBox:function(){var a=this.options.chart,b=this.renderer,c=this.chartWidth,d=this.chartHeight,e=this.chartBackground,f=this.plotBackground,g=this.plotBorder,h=this.plotBGImage,i=a.borderWidth||0,j=a.backgroundColor,k=a.plotBackgroundColor,l=a.plotBackgroundImage,n=a.plotBorderWidth||0,m,o=this.plotLeft,p=this.plotTop,q=this.plotWidth,r=this.plotHeight,t=this.plotBox,s=this.clipRect,v=this.clipBox;m=i+(a.shadow?8:0);if(i||j)if(e)e.animate(e.crisp({width:c-m,height:d-m}));else{e={fill:j||P};if(i)e.stroke=a.borderColor,e["stroke-width"]=i;this.chartBackground=b.rect(m/2,m/2,c-m,d-m,a.borderRadius,i).attr(e).addClass("highcharts-background").add().shadow(a.shadow)}if(k)f?f.animate(t):this.plotBackground=b.rect(o,p,q,r,0).attr({fill:k}).add().shadow(a.plotShadow);if(l)h?h.animate(t):this.plotBGImage=b.image(l,o,p,q,r).add();s?s.animate({width:v.width,height:v.height}):this.clipRect=b.clipRect(v);if(n)g?g.animate(g.crisp({x:o,y:p,width:q,height:r,strokeWidth:-n})):this.plotBorder=b.rect(o,p,q,r,0,-n).attr({stroke:a.plotBorderColor,"stroke-width":n,fill:P,zIndex:1}).add();this.isDirtyBox=!1},propFromSeries:function(){var a=this,b=a.options.chart,c,d=a.options.series,e,f;q(["inverted","angular","polar"],function(g){c=H[b.type||b.defaultSeriesType];f=a[g]||b[g]||c&&c.prototype[g];for(e=d&&d.length;!f&&e--;)(c=H[d[e].type])&&c.prototype[g]&&(f=!0);a[g]=f})},linkSeries:function(){var a=this,b=a.series;q(b,function(a){a.linkedSeries.length=0});q(b,function(b){var d=b.options.linkedTo;if(Ga(d)&&(d=d===":previous"?a.series[b.index-1]:a.get(d)))d.linkedSeries.push(b),b.linkedParent=d})},renderSeries:function(){q(this.series,function(a){a.translate();a.setTooltipPoints&&a.setTooltipPoints();a.render()})},renderLabels:function(){var a=this,b=a.options.labels;b.items&&q(b.items,function(c){var d=r(b.style,c.style),e=y(d.left)+a.plotLeft,f=y(d.top)+a.plotTop+12;delete d.left;delete d.top;a.renderer.text(c.html,e,f).attr({zIndex:2}).css(d).add()})},render:function(){var a=this.axes,b=this.renderer,c=this.options;this.setTitle();this.legend=new lb(this,c.legend);this.getStacks();q(a,function(a){a.setScale()});this.getMargins();this.maxTicks=null;q(a,function(a){a.setTickPositions(!0);a.setMaxTicks()});this.adjustTickAmounts();this.getMargins();this.drawChartBox();this.hasCartesianSeries&&q(a,function(a){a.render()});if(!this.seriesGroup)this.seriesGroup=b.g("series-group").attr({zIndex:3}).add();this.renderSeries();this.renderLabels();this.showCredits(c.credits);this.hasRendered=!0},showCredits:function(a){if(a.enabled&&!this.credits)this.credits=this.renderer.text(a.text,0,0).on("click",function(){if(a.href)location.href=a.href}).attr({align:a.position.align,zIndex:8}).css(a.style).add().align(a.position)},destroy:function(){var a=this,b=a.axes,c=a.series,d=a.container,e,f=d&&d.parentNode;I(a,"destroy");W[a.index]=u;ab--;a.renderTo.removeAttribute("data-highcharts-chart");X(a);for(e=b.length;e--;)b[e]=b[e].destroy();for(e=c.length;e--;)c[e]=c[e].destroy();q("title,subtitle,chartBackground,plotBackground,plotBGImage,plotBorder,seriesGroup,clipRect,credits,pointer,scroller,rangeSelector,legend,resetZoomButton,tooltip,renderer".split(","),function(b){var c=a[b];c&&c.destroy&&(a[b]=c.destroy())});if(d)d.innerHTML="",X(d),f&&Qa(d);for(e in a)delete a[e]},isReadyToRender:function(){var a=this;return!ba&&G==G.top&&x.readyState!=="complete"||ga&&!G.canvg?(ga?Mb.push(function(){a.firstRender()},a.options.global.canvasToolsURL):x.attachEvent("onreadystatechange",function(){x.detachEvent("onreadystatechange",a.firstRender);x.readyState==="complete"&&a.firstRender()}),!1):!0},firstRender:function(){var a=this,b=a.options,c=a.callback;if(a.isReadyToRender()){a.getContainer();I(a,"init");a.resetMargins();a.setChartSize();a.propFromSeries();a.getAxes();q(b.series||[],function(b){a.initSeries(b)});a.linkSeries();I(a,"beforeRender");if(K.Pointer)a.pointer=new Wa(a,b);a.render();a.renderer.draw();c&&c.apply(a,[a]);q(a.callbacks,function(b){b.apply(a,[a])});a.cloneRenderTo(!0);I(a,"load")}},splashArray:function(a,b){var c=b[a],c=da(c)?c:[c,c,c,c];return[p(b[a+"Top"],c[0]),p(b[a+"Right"],c[1]),p(b[a+"Bottom"],c[2]),p(b[a+"Left"],c[3])]}};Ya.prototype.callbacks=[];Z=K.CenteredSeriesMixin={getCenter:function(){var a=this.options,b=this.chart,c=2*(a.slicedOffset||0),d,e=b.plotWidth-2*c,f=b.plotHeight-2*c,b=a.center,a=[p(b[0],"50%"),p(b[1],"50%"),a.size||"100%",a.innerSize||0],g=L(e,f),h;return Va(a,function(a,b){h=/%$/.test(a);d=b<2||b===2&&h;return(h?[e,f,g,g][b]*y(a)/100:a)+(d?c:0)})}};var Fa=function(){};Fa.prototype={init:function(a,b,c){this.series=a;this.applyOptions(b,c);this.pointAttr={};if(a.options.colorByPoint&&(b=a.options.colors||a.chart.options.colors,this.color=this.color||b[a.colorCounter++],a.colorCounter===b.length))a.colorCounter=0;a.chart.pointCount++;return this},applyOptions:function(a,b){var c=this.series,d=c.options.pointValKey||c.pointValKey,a=Fa.prototype.optionsToObject.call(this,a);r(this,a);this.options=this.options?r(this.options,a):a;if(d)this.y=this[d];if(this.x===u&&c)this.x=b===u?c.autoIncrement():b;return this},optionsToObject:function(a){var b={},c=this.series,d=c.pointArrayMap||["y"],e=d.length,f=0,g=0;if(typeof a==="number"||a===null)b[d[0]]=a;else if(Ha(a)){if(a.length>e){c=typeof a[0];if(c==="string")b.name=a[0];else if(c==="number")b.x=a[0];f++}for(;g<e;)b[d[g++]]=a[f++]}else if(typeof a==="object"){b=a;if(a.dataLabels)c._hasPointLabels=!0;if(a.marker)c._hasPointMarkers=!0}return b},destroy:function(){var a=this.series.chart,b=a.hoverPoints,c;a.pointCount--;if(b&&(this.setState(),la(b,this),!b.length))a.hoverPoints=null;if(this===a.hoverPoint)this.onMouseOut();if(this.graphic||this.dataLabel)X(this),this.destroyElements();this.legendItem&&a.legend.destroyItem(this);for(c in this)this[c]=null},destroyElements:function(){for(var a="graphic,dataLabel,dataLabelUpper,group,connector,shadowGroup".split(","),b,c=6;c--;)b=a[c],this[b]&&(this[b]=this[b].destroy())},getLabelConfig:function(){return{x:this.category,y:this.y,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}},tooltipFormatter:function(a){var b=this.series,c=b.tooltipOptions,d=p(c.valueDecimals,""),e=c.valuePrefix||"",f=c.valueSuffix||"";q(b.pointArrayMap||["y"],function(b){b="{point."+b;if(e||f)a=a.replace(b+"}",e+b+"}"+f);a=a.replace(b+"}",b+":,."+d+"f}")});return Ja(a,{point:this,series:this.series})},firePointEvent:function(a,b,c){var d=this,e=this.series.options;(e.point.events[a]||d.options&&d.options.events&&d.options.events[a])&&this.importEvents();a==="click"&&e.allowPointSelect&&(c=function(a){d.select(null,a.ctrlKey||a.metaKey||a.shiftKey)});I(this,a,b,c)}};var O=function(){};O.prototype={isCartesian:!0,type:"line",pointClass:Fa,sorted:!0,requireSorting:!0,pointAttrToOptions:{stroke:"lineColor","stroke-width":"lineWidth",fill:"fillColor",r:"radius"},axisTypes:["xAxis","yAxis"],colorCounter:0,parallelArrays:["x","y"],init:function(a,b){var c=this,d,e,f=a.series,g=function(a,b){return p(a.options.index,a._i)-p(b.options.index,b._i)};c.chart=a;c.options=b=c.setOptions(b);c.linkedSeries=[];c.bindAxes();r(c,{name:b.name,state:"",pointAttr:{},visible:b.visible!==!1,selected:b.selected===!0});if(ga)b.animation=!1;e=b.events;for(d in e)N(c,d,e[d]);if(e&&e.click||b.point&&b.point.events&&b.point.events.click||b.allowPointSelect)a.runTrackerClick=!0;c.getColor();c.getSymbol();q(c.parallelArrays,function(a){c[a+"Data"]=[]});c.setData(b.data,!1);if(c.isCartesian)a.hasCartesianSeries=!0;f.push(c);c._i=f.length-1;ob(f,g);this.yAxis&&ob(this.yAxis.series,g);q(f,function(a,b){a.index=b;a.name=a.name||"Series "+(b+1)})},bindAxes:function(){var a=this,b=a.options,c=a.chart,d;q(a.axisTypes||[],function(e){q(c[e],function(c){d=c.options;if(b[e]===d.index||b[e]!==u&&b[e]===d.id||b[e]===u&&d.index===0)c.series.push(a),a[e]=c,c.isDirty=!0});!a[e]&&a.optionalAxis!==e&&ha(18,!0)})},updateParallelArrays:function(a,b){var c=a.series,d=arguments;q(c.parallelArrays,typeof b==="number"?function(d){var f=d==="y"&&c.toYData?c.toYData(a):a[d];c[d+"Data"][b]=f}:function(a){Array.prototype[b].apply(c[a+"Data"],Array.prototype.slice.call(d,2))})},autoIncrement:function(){var a=this.options,b=this.xIncrement,b=p(b,a.pointStart,0);this.pointInterval=p(this.pointInterval,a.pointInterval,1);this.xIncrement=b+this.pointInterval;return b},getSegments:function(){var a=-1,b=[],c,d=this.points,e=d.length;if(e)if(this.options.connectNulls){for(c=e;c--;)d[c].y===null&&d.splice(c,1);d.length&&(b=[d])}else q(d,function(c,g){c.y===null?(g>a+1&&b.push(d.slice(a+1,g)),a=g):g===e-1&&b.push(d.slice(a+1,g+1))});this.segments=b},setOptions:function(a){var b=this.chart,c=b.options.plotOptions,b=b.userOptions||{},d=b.plotOptions||{},e=c[this.type];this.userOptions=a;c=w(e,c.series,a);this.tooltipOptions=w(E.tooltip,E.plotOptions[this.type].tooltip,b.tooltip,d.series&&d.series.tooltip,d[this.type]&&d[this.type].tooltip,a.tooltip);e.marker===null&&delete c.marker;return c},getCyclic:function(a,b,c){var d=this.userOptions,e="_"+a+"Index",f=a+"Counter";b||(s(d[e])?b=d[e]:(d[e]=b=this.chart[f]%c.length,this.chart[f]+=1),b=c[b]);this[a]=b},getColor:function(){this.options.colorByPoint||this.getCyclic("color",this.options.color||ca[this.type].color,this.chart.options.colors)},getSymbol:function(){var a=this.options.marker;this.getCyclic("symbol",a.symbol,this.chart.options.symbols);if(/^url/.test(this.symbol))a.radius=0},drawLegendSymbol:M.drawLineMarker,setData:function(a,b,c,d){var e=this,f=e.points,g=f&&f.length||0,h,i=e.options,j=e.chart,k=null,l=e.xAxis,n=l&&!!l.categories,m=e.tooltipPoints,o=i.turboThreshold,r=this.xData,t=this.yData,s=(h=e.pointArrayMap)&&h.length,a=a||[];h=a.length;b=p(b,!0);if(d!==!1&&h&&g===h&&!e.cropped&&!e.hasGroupedData)q(a,function(a,b){f[b].update(a,!1,null,!1)});else{e.xIncrement=null;e.pointRange=n?1:i.pointRange;e.colorCounter=0;q(this.parallelArrays,function(a){e[a+"Data"].length=0});if(o&&h>o){for(c=0;k===null&&c<h;)k=a[c],c++;if(ja(k)){n=p(i.pointStart,0);i=p(i.pointInterval,1);for(c=0;c<h;c++)r[c]=n,t[c]=a[c],n+=i;e.xIncrement=n}else if(Ha(k))if(s)for(c=0;c<h;c++)i=a[c],r[c]=i[0],t[c]=i.slice(1,s+1);else for(c=0;c<h;c++)i=a[c],r[c]=i[0],t[c]=i[1];else ha(12)}else for(c=0;c<h;c++)if(a[c]!==u&&(i={series:e},e.pointClass.prototype.applyOptions.apply(i,[a[c]]),e.updateParallelArrays(i,c),n&&i.name))l.names[i.x]=i.name;Ga(t[0])&&ha(14,!0);e.data=[];e.options.data=a;for(c=g;c--;)f[c]&&f[c].destroy&&f[c].destroy();if(m)m.length=0;if(l)l.minRange=l.userMinRange;e.isDirty=e.isDirtyData=j.isDirtyBox=!0;c=!1}b&&j.redraw(c)},processData:function(a){var b=this.xData,c=this.yData,d=b.length,e;e=0;var f,g,h=this.xAxis,i,j=this.options;i=j.cropThreshold;var k=0,l=this.isCartesian,n,m;if(l&&!this.isDirty&&!h.isDirty&&!this.yAxis.isDirty&&!a)return!1;if(h)n=h.getExtremes(),m=n.min,n=n.max;if(l&&this.sorted&&(!i||d>i||this.forceCrop))if(b[d-1]<m||b[0]>n)b=[],c=[];else if(b[0]<m||b[d-1]>n)e=this.cropData(this.xData,this.yData,m,n),b=e.xData,c=e.yData,e=e.start,f=!0,k=b.length;for(i=b.length-1;i>=0;i--)d=b[i]-b[i-1],!f&&b[i]>m&&b[i]<n&&k++,d>0&&(g===u||d<g)?g=d:d<0&&this.requireSorting&&ha(15);this.cropped=f;this.cropStart=e;this.processedXData=b;this.processedYData=c;this.activePointCount=k;if(j.pointRange===null)this.pointRange=g||1;this.closestPointRange=g},cropData:function(a,b,c,d){var e=a.length,f=0,g=e,h=p(this.cropShoulder,1),i;for(i=0;i<e;i++)if(a[i]>=c){f=t(0,i-h);break}for(;i<e;i++)if(a[i]>d){g=i+h;break}return{xData:a.slice(f,g),yData:b.slice(f,g),start:f,end:g}},generatePoints:function(){var a=this.options.data,b=this.data,c,d=this.processedXData,e=this.processedYData,f=this.pointClass,g=d.length,h=this.cropStart||0,i,j=this.hasGroupedData,k,l=[],n;if(!b&&!j)b=[],b.length=a.length,b=this.data=b;for(n=0;n<g;n++)i=h+n,j?l[n]=(new f).init(this,[d[n]].concat(ra(e[n]))):(b[i]?k=b[i]:a[i]!==u&&(b[i]=k=(new f).init(this,a[i],d[n])),l[n]=k),l[n].index=i;if(b&&(g!==(c=b.length)||j))for(n=0;n<c;n++)if(n===h&&!j&&(n+=g),b[n])b[n].destroyElements(),b[n].plotX=u;this.data=b;this.points=l},getExtremes:function(a){var b=this.yAxis,c=this.processedXData,d,e=[],f=0;d=this.xAxis.getExtremes();var g=d.min,h=d.max,i,j,k,l,a=a||this.stackedYData||this.processedYData;d=a.length;for(l=0;l<d;l++)if(j=c[l],k=a[l],i=k!==null&&k!==u&&(!b.isLog||k.length||k>0),j=this.getExtremesFromAll||this.cropped||(c[l+1]||j)>=g&&(c[l-1]||j)<=h,i&&j)if(i=k.length)for(;i--;)k[i]!==null&&(e[f++]=k[i]);else e[f++]=k;this.dataMin=p(void 0,Oa(e));this.dataMax=p(void 0,Ca(e))},translate:function(){this.processedXData||this.processData();this.generatePoints();for(var a=this.options,b=a.stacking,c=this.xAxis,d=c.categories,e=this.yAxis,f=this.points,g=f.length,h=!!this.modifyValue,i=a.pointPlacement,j=i==="between"||ja(i),k=a.threshold,a=0;a<g;a++){var l=f[a],n=l.x,m=l.y,o=l.low,q=b&&e.stacks[(this.negStacks&&m<k?"-":"")+this.stackKey];if(e.isLog&&m<=0)l.y=m=null,ha(10);l.plotX=c.translate(n,0,0,0,1,i,this.type==="flags");if(b&&this.visible&&q&&q[n])q=q[n],m=q.points[this.index+","+a],o=m[0],m=m[1],o===0&&(o=p(k,e.min)),e.isLog&&o<=0&&(o=null),l.total=l.stackTotal=q.total,l.percentage=q.total&&l.y/q.total*100,l.stackY=m,
q.setOffset(this.pointXOffset||0,this.barW||0);l.yBottom=s(o)?e.translate(o,0,1,0,1):null;h&&(m=this.modifyValue(m,l));l.plotY=typeof m==="number"&&m!==Infinity?e.translate(m,0,1,0,1):u;l.clientX=j?c.translate(n,0,0,0,1):l.plotX;l.negative=l.y<(k||0);l.category=d&&d[l.x]!==u?d[l.x]:l.x}this.getSegments()},animate:function(a){var b=this.chart,c=b.renderer,d;d=this.options.animation;var e=this.clipBox||b.clipBox,f=b.inverted,g;if(d&&!da(d))d=ca[this.type].animation;g=["_sharedClip",d.duration,d.easing,e.height].join(",");a?(a=b[g],d=b[g+"m"],a||(b[g]=a=c.clipRect(r(e,{width:0})),b[g+"m"]=d=c.clipRect(-99,f?-b.plotLeft:-b.plotTop,99,f?b.chartWidth:b.chartHeight)),this.group.clip(a),this.markerGroup.clip(d),this.sharedClipKey=g):((a=b[g])&&a.animate({width:b.plotSizeX},d),b[g+"m"]&&b[g+"m"].animate({width:b.plotSizeX+99},d),this.animate=null)},afterAnimate:function(){var a=this.chart,b=this.sharedClipKey,c=this.group,d=this.clipBox;if(c&&this.options.clip!==!1){if(!b||!d)c.clip(d?a.renderer.clipRect(d):a.clipRect);this.markerGroup.clip()}I(this,"afterAnimate");setTimeout(function(){b&&a[b]&&(d||(a[b]=a[b].destroy()),a[b+"m"]&&(a[b+"m"]=a[b+"m"].destroy()))},100)},drawPoints:function(){var a,b=this.points,c=this.chart,d,e,f,g,h,i,j,k,l=this.options.marker,n=this.pointAttr[""],m,o,q,t=this.markerGroup,s=p(l.enabled,!this.requireSorting||this.activePointCount<.5*this.xAxis.len/l.radius);if(l.enabled!==!1||this._hasPointMarkers)for(f=b.length;f--;)if(g=b[f],d=U(g.plotX),e=g.plotY,k=g.graphic,m=g.marker||{},o=!!g.marker,a=s&&m.enabled===u||m.enabled,q=c.isInsidePlot(v(d),e,c.inverted),a&&e!==u&&!isNaN(e)&&g.y!==null)if(a=g.pointAttr[g.selected?"select":""]||n,h=a.r,i=p(m.symbol,this.symbol),j=i.indexOf("url")===0,k)k[q?"show":"hide"](!0).animate(r({x:d-h,y:e-h},k.symbolName?{width:2*h,height:2*h}:{}));else{if(q&&(h>0||j))g.graphic=c.renderer.symbol(i,d-h,e-h,2*h,2*h,o?m:l).attr(a).add(t)}else if(k)g.graphic=k.destroy()},convertAttribs:function(a,b,c,d){var e=this.pointAttrToOptions,f,g,h={},a=a||{},b=b||{},c=c||{},d=d||{};for(f in e)g=e[f],h[f]=p(a[g],b[f],c[f],d[f]);return h},getAttribs:function(){var a=this,b=a.options,c=ca[a.type].marker?b.marker:b,d=c.states,e=d.hover,f,g=a.color;f={stroke:g,fill:g};var h=a.points||[],i,j=[],k,l=a.pointAttrToOptions;k=a.hasPointSpecificOptions;var n=b.negativeColor,m=c.lineColor,o=c.fillColor;i=b.turboThreshold;var p;b.marker?(e.radius=e.radius||c.radius+e.radiusPlus,e.lineWidth=e.lineWidth||c.lineWidth+e.lineWidthPlus):e.color=e.color||ya(e.color||g).brighten(e.brightness).get();j[""]=a.convertAttribs(c,f);q(["hover","select"],function(b){j[b]=a.convertAttribs(d[b],j[""])});a.pointAttr=j;g=h.length;if(!i||g<i||k)for(;g--;){i=h[g];if((c=i.options&&i.options.marker||i.options)&&c.enabled===!1)c.radius=0;if(i.negative&&n)i.color=i.fillColor=n;k=b.colorByPoint||i.color;if(i.options)for(p in l)s(c[l[p]])&&(k=!0);if(k){c=c||{};k=[];d=c.states||{};f=d.hover=d.hover||{};if(!b.marker)f.color=f.color||!i.options.color&&e.color||ya(i.color).brighten(f.brightness||e.brightness).get();f={color:i.color};if(!o)f.fillColor=i.color;if(!m)f.lineColor=i.color;k[""]=a.convertAttribs(r(f,c),j[""]);k.hover=a.convertAttribs(d.hover,j.hover,k[""]);k.select=a.convertAttribs(d.select,j.select,k[""])}else k=j;i.pointAttr=k}},destroy:function(){var a=this,b=a.chart,c=/AppleWebKit\/533/.test(wa),d,e,f=a.data||[],g,h,i;I(a,"destroy");X(a);q(a.axisTypes||[],function(b){if(i=a[b])la(i.series,a),i.isDirty=i.forceRedraw=!0});a.legendItem&&a.chart.legend.destroyItem(a);for(e=f.length;e--;)(g=f[e])&&g.destroy&&g.destroy();a.points=null;clearTimeout(a.animationTimeout);q("area,graph,dataLabelsGroup,group,markerGroup,tracker,graphNeg,areaNeg,posClip,negClip".split(","),function(b){a[b]&&(d=c&&b==="group"?"hide":"destroy",a[b][d]())});if(b.hoverSeries===a)b.hoverSeries=null;la(b.series,a);for(h in a)delete a[h]},getSegmentPath:function(a){var b=this,c=[],d=b.options.step;q(a,function(e,f){var g=e.plotX,h=e.plotY,i;b.getPointSpline?c.push.apply(c,b.getPointSpline(a,e,f)):(c.push(f?"L":"M"),d&&f&&(i=a[f-1],d==="right"?c.push(i.plotX,h):d==="center"?c.push((i.plotX+g)/2,i.plotY,(i.plotX+g)/2,h):c.push(g,i.plotY)),c.push(e.plotX,e.plotY))});return c},getGraphPath:function(){var a=this,b=[],c,d=[];q(a.segments,function(e){c=a.getSegmentPath(e);e.length>1?b=b.concat(c):d.push(e[0])});a.singlePoints=d;return a.graphPath=b},drawGraph:function(){var a=this,b=this.options,c=[["graph",b.lineColor||this.color]],d=b.lineWidth,e=b.dashStyle,f=b.linecap!=="square",g=this.getGraphPath(),h=b.negativeColor;h&&c.push(["graphNeg",h]);q(c,function(c,h){var k=c[0],l=a[k];if(l)bb(l),l.animate({d:g});else if(d&&g.length)l={stroke:c[1],"stroke-width":d,fill:P,zIndex:1},e?l.dashstyle=e:f&&(l["stroke-linecap"]=l["stroke-linejoin"]="round"),a[k]=a.chart.renderer.path(g).attr(l).add(a.group).shadow(!h&&b.shadow)})},clipNeg:function(){var a=this.options,b=this.chart,c=b.renderer,d=a.negativeColor||a.negativeFillColor,e,f=this.graph,g=this.area,h=this.posClip,i=this.negClip;e=b.chartWidth;var j=b.chartHeight,k=t(e,j),l=this.yAxis;if(d&&(f||g)){d=v(l.toPixels(a.threshold||0,!0));d<0&&(k-=d);a={x:0,y:0,width:k,height:d};k={x:0,y:d,width:k,height:k};if(b.inverted)a.height=k.y=b.plotWidth-d,c.isVML&&(a={x:b.plotWidth-d-b.plotLeft,y:0,width:e,height:j},k={x:d+b.plotLeft-e,y:0,width:b.plotLeft+d,height:e});l.reversed?(b=k,e=a):(b=a,e=k);h?(h.animate(b),i.animate(e)):(this.posClip=h=c.clipRect(b),this.negClip=i=c.clipRect(e),f&&this.graphNeg&&(f.clip(h),this.graphNeg.clip(i)),g&&(g.clip(h),this.areaNeg.clip(i)))}},invertGroups:function(){function a(){var a={width:b.yAxis.len,height:b.xAxis.len};q(["group","markerGroup"],function(c){b[c]&&b[c].attr(a).invert()})}var b=this,c=b.chart;if(b.xAxis)N(c,"resize",a),N(b,"destroy",function(){X(c,"resize",a)}),a(),b.invertGroups=a},plotGroup:function(a,b,c,d,e){var f=this[a],g=!f;g&&(this[a]=f=this.chart.renderer.g(b).attr({visibility:c,zIndex:d||.1}).add(e));f[g?"attr":"animate"](this.getPlotBox());return f},getPlotBox:function(){var a=this.chart,b=this.xAxis,c=this.yAxis;if(a.inverted)b=c,c=this.xAxis;return{translateX:b?b.left:a.plotLeft,translateY:c?c.top:a.plotTop,scaleX:1,scaleY:1}},render:function(){var a=this,b=a.chart,c,d=a.options,e=(c=d.animation)&&!!a.animate&&b.renderer.isSVG&&p(c.duration,500)||0,f=a.visible?"visible":"hidden",g=d.zIndex,h=a.hasRendered,i=b.seriesGroup;c=a.plotGroup("group","series",f,g,i);a.markerGroup=a.plotGroup("markerGroup","markers",f,g,i);e&&a.animate(!0);a.getAttribs();c.inverted=a.isCartesian?b.inverted:!1;a.drawGraph&&(a.drawGraph(),a.clipNeg());q(a.points,function(a){a.redraw&&a.redraw()});a.drawDataLabels&&a.drawDataLabels();a.visible&&a.drawPoints();a.drawTracker&&a.options.enableMouseTracking!==!1&&a.drawTracker();b.inverted&&a.invertGroups();d.clip!==!1&&!a.sharedClipKey&&!h&&c.clip(b.clipRect);e&&a.animate();if(!h)e?a.animationTimeout=setTimeout(function(){a.afterAnimate()},e):a.afterAnimate();a.isDirty=a.isDirtyData=!1;a.hasRendered=!0},redraw:function(){var a=this.chart,b=this.isDirtyData,c=this.group,d=this.xAxis,e=this.yAxis;c&&(a.inverted&&c.attr({width:a.plotWidth,height:a.plotHeight}),c.animate({translateX:p(d&&d.left,a.plotLeft),translateY:p(e&&e.top,a.plotTop)}));this.translate();this.setTooltipPoints&&this.setTooltipPoints(!0);this.render();b&&I(this,"updatedData")}};Gb.prototype={destroy:function(){Pa(this,this.axis)},render:function(a){var b=this.options,c=b.format,c=c?Ja(c,this):b.formatter.call(this);this.label?this.label.attr({text:c,visibility:"hidden"}):this.label=this.axis.chart.renderer.text(c,null,null,b.useHTML).css(b.style).attr({align:this.textAlign,rotation:b.rotation,visibility:"hidden"}).add(a)},setOffset:function(a,b){var c=this.axis,d=c.chart,e=d.inverted,f=this.isNegative,g=c.translate(c.usePercentage?100:this.total,0,0,0,1),c=c.translate(0),c=Q(g-c),h=d.xAxis[0].translate(this.x)+a,i=d.plotHeight,f={x:e?f?g:g-c:h,y:e?i-h-b:f?i-g-c:i-g,width:e?c:b,height:e?b:c};if(e=this.label)e.align(this.alignOptions,null,f),f=e.alignAttr,e[this.options.crop===!1||d.isInsidePlot(f.x,f.y)?"show":"hide"](!0)}};na.prototype.buildStacks=function(){var a=this.series,b=p(this.options.reversedStacks,!0),c=a.length;if(!this.isXAxis){for(this.usePercentage=!1;c--;)a[b?c:a.length-c-1].setStackedPoints();if(this.usePercentage)for(c=0;c<a.length;c++)a[c].setPercentStacks()}};na.prototype.renderStackTotals=function(){var a=this.chart,b=a.renderer,c=this.stacks,d,e,f=this.stackTotalGroup;if(!f)this.stackTotalGroup=f=b.g("stack-labels").attr({visibility:"visible",zIndex:6}).add();f.translate(a.plotLeft,a.plotTop);for(d in c)for(e in a=c[d],a)a[e].render(f)};O.prototype.setStackedPoints=function(){if(this.options.stacking&&!(this.visible!==!0&&this.chart.options.chart.ignoreHiddenSeries!==!1)){var a=this.processedXData,b=this.processedYData,c=[],d=b.length,e=this.options,f=e.threshold,g=e.stack,e=e.stacking,h=this.stackKey,i="-"+h,j=this.negStacks,k=this.yAxis,l=k.stacks,n=k.oldStacks,m,o,p,q,r,s;for(q=0;q<d;q++){r=a[q];s=b[q];p=this.index+","+q;o=(m=j&&s<f)?i:h;l[o]||(l[o]={});if(!l[o][r])n[o]&&n[o][r]?(l[o][r]=n[o][r],l[o][r].total=null):l[o][r]=new Gb(k,k.options.stackLabels,m,r,g);o=l[o][r];o.points[p]=[o.cum||0];e==="percent"?(m=m?h:i,j&&l[m]&&l[m][r]?(m=l[m][r],o.total=m.total=t(m.total,o.total)+Q(s)||0):o.total=ea(o.total+(Q(s)||0))):o.total=ea(o.total+(s||0));o.cum=(o.cum||0)+(s||0);o.points[p].push(o.cum);c[q]=o.cum}if(e==="percent")k.usePercentage=!0;this.stackedYData=c;k.oldStacks={}}};O.prototype.setPercentStacks=function(){var a=this,b=a.stackKey,c=a.yAxis.stacks,d=a.processedXData;q([b,"-"+b],function(b){var e;for(var f=d.length,g,h;f--;)if(g=d[f],e=(h=c[b]&&c[b][g])&&h.points[a.index+","+f],g=e)h=h.total?100/h.total:0,g[0]=ea(g[0]*h),g[1]=ea(g[1]*h),a.stackedYData[f]=g[1]})};r(Ya.prototype,{addSeries:function(a,b,c){var d,e=this;a&&(b=p(b,!0),I(e,"addSeries",{options:a},function(){d=e.initSeries(a);e.isDirtyLegend=!0;e.linkSeries();b&&e.redraw(c)}));return d},addAxis:function(a,b,c,d){var e=b?"xAxis":"yAxis",f=this.options;new na(this,w(a,{index:this[e].length,isX:b}));f[e]=ra(f[e]||{});f[e].push(a);p(c,!0)&&this.redraw(d)},showLoading:function(a){var b=this,c=b.options,d=b.loadingDiv,e=c.loading,f=function(){d&&B(d,{left:b.plotLeft+"px",top:b.plotTop+"px",width:b.plotWidth+"px",height:b.plotHeight+"px"})};if(!d)b.loadingDiv=d=$(Ka,{className:"highcharts-loading"},r(e.style,{zIndex:10,display:P}),b.container),b.loadingSpan=$("span",null,e.labelStyle,d),N(b,"redraw",f);b.loadingSpan.innerHTML=a||c.lang.loading;if(!b.loadingShown)B(d,{opacity:0,display:""}),jb(d,{opacity:e.style.opacity},{duration:e.showDuration||0}),b.loadingShown=!0;f()},hideLoading:function(){var a=this.options,b=this.loadingDiv;b&&jb(b,{opacity:0},{duration:a.loading.hideDuration||100,complete:function(){B(b,{display:P})}});this.loadingShown=!1}});r(Fa.prototype,{update:function(a,b,c,d){function e(){f.applyOptions(a);if(da(a)&&!Ha(a))f.redraw=function(){if(h)a&&a.marker&&a.marker.symbol?f.graphic=h.destroy():h.attr(f.pointAttr[f.state||""]);if(a&&a.dataLabels&&f.dataLabel)f.dataLabel=f.dataLabel.destroy();f.redraw=null};i=f.index;g.updateParallelArrays(f,i);k.data[i]=f.options;g.isDirty=g.isDirtyData=!0;if(!g.fixedBox&&g.hasCartesianSeries)j.isDirtyBox=!0;k.legendType==="point"&&j.legend.destroyItem(f);b&&j.redraw(c)}var f=this,g=f.series,h=f.graphic,i,j=g.chart,k=g.options,b=p(b,!0);d===!1?e():f.firePointEvent("update",{options:a},e)},remove:function(a,b){var c=this,d=c.series,e=d.points,f=d.chart,g,h=d.data;Ra(b,f);a=p(a,!0);c.firePointEvent("remove",null,function(){g=Ma(c,h);h.length===e.length&&e.splice(g,1);h.splice(g,1);d.options.data.splice(g,1);d.updateParallelArrays(c,"splice",g,1);c.destroy();d.isDirty=!0;d.isDirtyData=!0;a&&f.redraw()})}});r(O.prototype,{addPoint:function(a,b,c,d){var e=this.options,f=this.data,g=this.graph,h=this.area,i=this.chart,j=this.xAxis&&this.xAxis.names,k=g&&g.shift||0,l=e.data,n,m=this.xData;Ra(d,i);c&&q([g,h,this.graphNeg,this.areaNeg],function(a){if(a)a.shift=k+1});if(h)h.isArea=!0;b=p(b,!0);d={series:this};this.pointClass.prototype.applyOptions.apply(d,[a]);g=d.x;h=m.length;if(this.requireSorting&&g<m[h-1])for(n=!0;h&&m[h-1]>g;)h--;this.updateParallelArrays(d,"splice",h,0,0);this.updateParallelArrays(d,h);if(j&&d.name)j[g]=d.name;l.splice(h,0,a);n&&(this.data.splice(h,0,null),this.processData());e.legendType==="point"&&this.generatePoints();c&&(f[0]&&f[0].remove?f[0].remove(!1):(f.shift(),this.updateParallelArrays(d,"shift"),l.shift()));this.isDirtyData=this.isDirty=!0;b&&(this.getAttribs(),i.redraw())},remove:function(a,b){var c=this,d=c.chart,a=p(a,!0);if(!c.isRemoving)c.isRemoving=!0,I(c,"remove",null,function(){c.destroy();d.isDirtyLegend=d.isDirtyBox=!0;d.linkSeries();a&&d.redraw(b)});c.isRemoving=!1},update:function(a,b){var c=this,d=this.chart,e=this.userOptions,f=this.type,g=H[f].prototype,h=["group","markerGroup","dataLabelsGroup"],i;q(h,function(a){h[a]=c[a];delete c[a]});a=w(e,{animation:!1,index:this.index,pointStart:this.xData[0]},{data:this.options.data},a);this.remove(!1);for(i in g)g.hasOwnProperty(i)&&(this[i]=u);r(this,H[a.type||f].prototype);q(h,function(a){c[a]=h[a]});this.init(d,a);d.linkSeries();p(b,!0)&&d.redraw(!1)}});r(na.prototype,{update:function(a,b){var c=this.chart,a=c.options[this.coll][this.options.index]=w(this.userOptions,a);this.destroy(!0);this._addedPlotLB=u;this.init(c,r(a,{events:u}));c.isDirtyBox=!0;p(b,!0)&&c.redraw()},remove:function(a){for(var b=this.chart,c=this.coll,d=this.series,e=d.length;e--;)d[e]&&d[e].remove(!1);la(b.axes,this);la(b[c],this);b.options[c].splice(this.options.index,1);q(b[c],function(a,b){a.options.index=b});this.destroy();b.isDirtyBox=!0;p(a,!0)&&b.redraw()},setTitle:function(a,b){this.update({title:a},b)},setCategories:function(a,b){this.update({categories:a},b)}});ia=ma(O);H.line=ia;ca.area=w(T,{threshold:0});var qa=ma(O,{type:"area",getSegments:function(){var a=this,b=[],c=[],d=[],e=this.xAxis,f=this.yAxis,g=f.stacks[this.stackKey],h={},i,j,k=this.points,l=this.options.connectNulls,n,m;if(this.options.stacking&&!this.cropped){for(n=0;n<k.length;n++)h[k[n].x]=k[n];for(m in g)g[m].total!==null&&d.push(+m);d.sort(function(a,b){return a-b});q(d,function(b){var d=0,k;if(!l||h[b]&&h[b].y!==null)if(h[b])c.push(h[b]);else{for(n=a.index;n<=f.series.length;n++)if(k=g[b].points[n+","+b]){d=k[1];break}i=e.translate(b);j=f.toPixels(d,!0);c.push({y:null,plotX:i,clientX:i,plotY:j,yBottom:j,onMouseOver:sa})}});c.length&&b.push(c)}else O.prototype.getSegments.call(this),b=this.segments;this.segments=b},getSegmentPath:function(a){var b=O.prototype.getSegmentPath.call(this,a),c=[].concat(b),d,e=this.options;d=b.length;var f=this.yAxis.getThreshold(e.threshold),g;d===3&&c.push("L",b[1],b[2]);if(e.stacking&&!this.closedStacks)for(d=a.length-1;d>=0;d--)g=p(a[d].yBottom,f),d<a.length-1&&e.step&&c.push(a[d+1].plotX,g),c.push(a[d].plotX,g);else this.closeSegment(c,a,f);this.areaPath=this.areaPath.concat(c);return b},closeSegment:function(a,b,c){a.push("L",b[b.length-1].plotX,c,"L",b[0].plotX,c)},drawGraph:function(){this.areaPath=[];O.prototype.drawGraph.apply(this);var a=this,b=this.areaPath,c=this.options,d=c.negativeColor,e=c.negativeFillColor,f=[["area",this.color,c.fillColor]];(d||e)&&f.push(["areaNeg",d,e]);q(f,function(d){var e=d[0],f=a[e];f?f.animate({d:b}):a[e]=a.chart.renderer.path(b).attr({fill:p(d[2],ya(d[1]).setOpacity(p(c.fillOpacity,.75)).get()),zIndex:0}).add(a.group)})},drawLegendSymbol:M.drawRectangle});H.area=qa;ca.spline=w(T);ia=ma(O,{type:"spline",getPointSpline:function(a,b,c){var d=b.plotX,e=b.plotY,f=a[c-1],g=a[c+1],h,i,j,k;if(f&&g){a=f.plotY;j=g.plotX;var g=g.plotY,l;h=(1.5*d+f.plotX)/2.5;i=(1.5*e+a)/2.5;j=(1.5*d+j)/2.5;k=(1.5*e+g)/2.5;l=(k-i)*(j-d)/(j-h)+e-k;i+=l;k+=l;i>a&&i>e?(i=t(a,e),k=2*e-i):i<a&&i<e&&(i=L(a,e),k=2*e-i);k>g&&k>e?(k=t(g,e),i=2*e-k):k<g&&k<e&&(k=L(g,e),i=2*e-k);b.rightContX=j;b.rightContY=k}c?(b=["C",f.rightContX||f.plotX,f.rightContY||f.plotY,h||d,i||e,d,e],f.rightContX=f.rightContY=null):b=["M",d,e];return b}});H.spline=ia;ca.areaspline=w(ca.area);qa=qa.prototype;ia=ma(ia,{type:"areaspline",closedStacks:!0,getSegmentPath:qa.getSegmentPath,closeSegment:qa.closeSegment,drawGraph:qa.drawGraph,drawLegendSymbol:M.drawRectangle});H.areaspline=ia;ca.column=w(T,{borderColor:"#FFFFFF",borderRadius:0,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{brightness:.1,shadow:!1,halo:!1},select:{color:"#C0C0C0",borderColor:"#000000",shadow:!1}},dataLabels:{align:null,verticalAlign:null,y:null},stickyTracking:!1,tooltip:{distance:6},threshold:0});ia=ma(O,{type:"column",pointAttrToOptions:{stroke:"borderColor",fill:"color",r:"borderRadius"},cropShoulder:0,trackerGroups:["group","dataLabelsGroup"],negStacks:!0,init:function(){O.prototype.init.apply(this,arguments);var a=this,b=a.chart;b.hasRendered&&q(b.series,function(b){if(b.type===a.type)b.isDirty=!0})},getColumnMetrics:function(){var a=this,b=a.options,c=a.xAxis,d=a.yAxis,e=c.reversed,f,g={},h,i=0;b.grouping===!1?i=1:q(a.chart.series,function(b){var c=b.options,e=b.yAxis;if(b.type===a.type&&b.visible&&d.len===e.len&&d.pos===e.pos)c.stacking?(f=b.stackKey,g[f]===u&&(g[f]=i++),h=g[f]):c.grouping!==!1&&(h=i++),b.columnIndex=h});var c=L(Q(c.transA)*(c.ordinalSlope||b.pointRange||c.closestPointRange||c.tickInterval||1),c.len),j=c*b.groupPadding,k=(c-2*j)/i,l=b.pointWidth,b=s(l)?(k-l)/2:k*b.pointPadding,l=p(l,k-2*b);return a.columnMetrics={width:l,offset:b+(j+((e?i-(a.columnIndex||0):a.columnIndex)||0)*k-c/2)*(e?-1:1)}},translate:function(){var a=this,b=a.chart,c=a.options,d=a.borderWidth=p(c.borderWidth,a.activePointCount>.5*a.xAxis.len?0:1),e=a.yAxis,f=a.translatedThreshold=e.getThreshold(c.threshold),g=p(c.minPointLength,5),h=a.getColumnMetrics(),i=h.width,j=a.barW=t(i,1+2*d),k=a.pointXOffset=h.offset,l=-(d%2?.5:0),n=d%2?.5:1;b.renderer.isVML&&b.inverted&&(n+=1);c.pointPadding&&(j=La(j));O.prototype.translate.apply(a);q(a.points,function(c){var d=p(c.yBottom,f),h=L(t(-999-d,c.plotY),e.len+999+d),q=c.plotX+k,r=j,s=L(h,d),u;u=t(h,d)-s;Q(u)<g&&g&&(u=g,s=v(Q(s-f)>g?d-g:f-(e.translate(c.y,0,1,0,1)<=f?g:0)));c.barX=q;c.pointWidth=i;c.tooltipPos=b.inverted?[e.len-h,a.xAxis.len-q-r/2]:[q+r/2,h+e.pos-b.plotTop];r=v(q+r)+l;q=v(q)+l;r-=q;d=Q(s)<.5;u=v(s+u)+n;s=v(s)+n;u-=s;d&&(s-=1,u+=1);c.shapeType="rect";c.shapeArgs={x:q,y:s,width:r,height:u}})},getSymbol:sa,drawLegendSymbol:M.drawRectangle,drawGraph:sa,drawPoints:function(){var a=this,b=this.chart,c=a.options,d=b.renderer,e=c.animationLimit||250,f,g;q(a.points,function(h){var i=h.plotY,j=h.graphic;if(i!==u&&!isNaN(i)&&h.y!==null)f=h.shapeArgs,i=s(a.borderWidth)?{"stroke-width":a.borderWidth}:{},g=h.pointAttr[h.selected?"select":""]||a.pointAttr[""],j?(bb(j),j.attr(i)[b.pointCount<e?"animate":"attr"](w(f))):h.graphic=d[h.shapeType](f).attr(g).attr(i).add(a.group).shadow(c.shadow,null,c.stacking&&!c.borderRadius);else if(j)h.graphic=j.destroy()})},animate:function(a){var b=this.yAxis,c=this.options,d=this.chart.inverted,e={};if(ba)a?(e.scaleY=.001,a=L(b.pos+b.len,t(b.pos,b.toPixels(c.threshold))),d?e.translateX=a-b.len:e.translateY=a,this.group.attr(e)):(e.scaleY=1,e[d?"translateX":"translateY"]=b.pos,this.group.animate(e,this.options.animation),this.animate=null)},remove:function(){var a=this,b=a.chart;b.hasRendered&&q(b.series,function(b){if(b.type===a.type)b.isDirty=!0});O.prototype.remove.apply(a,arguments)}});H.column=ia;ca.bar=w(ca.column);qa=ma(ia,{type:"bar",inverted:!0});H.bar=qa;ca.scatter=w(T,{lineWidth:0,tooltip:{headerFormat:'<span style="color:{series.color}">●</span> <span style="font-size: 10px;"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"},stickyTracking:!1});qa=ma(O,{type:"scatter",sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["markerGroup","dataLabelsGroup"],takeOrdinalPosition:!1,singularTooltips:!0,drawGraph:function(){this.options.lineWidth&&O.prototype.drawGraph.call(this)}});H.scatter=qa;ca.pie=w(T,{borderColor:"#FFFFFF",borderWidth:1,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{distance:30,enabled:!0,formatter:function(){return this.point.name}},ignoreHiddenPoint:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,states:{hover:{brightness:.1,shadow:!1}},stickyTracking:!1,tooltip:{followPointer:!0}});T={type:"pie",isCartesian:!1,pointClass:ma(Fa,{init:function(){Fa.prototype.init.apply(this,arguments);var a=this,b;if(a.y<0)a.y=null;r(a,{visible:a.visible!==!1,name:p(a.name,"Slice")});b=function(b){a.slice(b.type==="select")};N(a,"select",b);N(a,"unselect",b);return a},setVisible:function(a){var b=this,c=b.series,d=c.chart;b.visible=b.options.visible=a=a===u?!b.visible:a;c.options.data[Ma(b,c.data)]=b.options;q(["graphic","dataLabel","connector","shadowGroup"],function(c){if(b[c])b[c][a?"show":"hide"](!0)});b.legendItem&&d.legend.colorizeItem(b,a);if(!c.isDirty&&c.options.ignoreHiddenPoint)c.isDirty=!0,d.redraw()},slice:function(a,b,c){var d=this.series;Ra(c,d.chart);p(b,!0);this.sliced=this.options.sliced=a=s(a)?a:!this.sliced;d.options.data[Ma(this,d.data)]=this.options;a=a?this.slicedTranslation:{translateX:0,translateY:0};this.graphic.animate(a);this.shadowGroup&&this.shadowGroup.animate(a)},haloPath:function(a){var b=this.shapeArgs,c=this.series.chart;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(c.plotLeft+b.x,c.plotTop+b.y,b.r+a,b.r+a,{innerR:this.shapeArgs.r,start:b.start,end:b.end})}}),requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","dataLabelsGroup"],axisTypes:[],pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color"},singularTooltips:!0,getColor:sa,animate:function(a){var b=this,c=b.points,d=b.startAngleRad;if(!a)q(c,function(a){var c=a.graphic,a=a.shapeArgs;c&&(c.attr({r:b.center[3]/2,start:d,end:d}),c.animate({r:a.r,start:a.start,end:a.end},b.options.animation))}),b.animate=null},setData:function(a,b,c,d){O.prototype.setData.call(this,a,!1,c,d);this.processData();this.generatePoints();p(b,!0)&&this.chart.redraw(c)},generatePoints:function(){var a,b=0,c,d,e,f=this.options.ignoreHiddenPoint;O.prototype.generatePoints.call(this);c=this.points;d=c.length;for(a=0;a<d;a++)e=c[a],b+=f&&!e.visible?0:e.y;this.total=b;for(a=0;a<d;a++)e=c[a],e.percentage=b>0?e.y/b*100:0,e.total=b},translate:function(a){this.generatePoints();var b=0,c=this.options,d=c.slicedOffset,e=d+c.borderWidth,f,g,h,i=c.startAngle||0,j=this.startAngleRad=oa/180*(i-90),i=(this.endAngleRad=oa/180*(p(c.endAngle,i+360)-90))-j,k=this.points,l=c.dataLabels.distance,c=c.ignoreHiddenPoint,n,m=k.length,o;if(!a)this.center=a=this.getCenter();this.getX=function(b,c){h=V.asin(L((b-a[1])/(a[2]/2+l),1));return a[0]+(c?-1:1)*aa(h)*(a[2]/2+l)};for(n=0;n<m;n++){o=k[n];f=j+b*i;if(!c||o.visible)b+=o.percentage/100;g=j+b*i;o.shapeType="arc";o.shapeArgs={x:a[0],y:a[1],r:a[2]/2,innerR:a[3]/2,start:v(f*1e3)/1e3,end:v(g*1e3)/1e3};h=(g+f)/2;h>1.5*oa?h-=2*oa:h<-oa/2&&(h+=2*oa);o.slicedTranslation={translateX:v(aa(h)*d),translateY:v(fa(h)*d)};f=aa(h)*a[2]/2;g=fa(h)*a[2]/2;o.tooltipPos=[a[0]+f*.7,a[1]+g*.7];o.half=h<-oa/2||h>oa/2?1:0;o.angle=h;e=L(e,l/2);o.labelPos=[a[0]+f+aa(h)*l,a[1]+g+fa(h)*l,a[0]+f+aa(h)*e,a[1]+g+fa(h)*e,a[0]+f,a[1]+g,l<0?"center":o.half?"right":"left",h]}},drawGraph:null,drawPoints:function(){var a=this,b=a.chart.renderer,c,d,e=a.options.shadow,f,g;if(e&&!a.shadowGroup)a.shadowGroup=b.g("shadow").add(a.group);q(a.points,function(h){d=h.graphic;g=h.shapeArgs;f=h.shadowGroup;if(e&&!f)f=h.shadowGroup=b.g("shadow").add(a.shadowGroup);c=h.sliced?h.slicedTranslation:{translateX:0,translateY:0};f&&f.attr(c);d?d.animate(r(g,c)):h.graphic=d=b[h.shapeType](g).setRadialReference(a.center).attr(h.pointAttr[h.selected?"select":""]).attr({"stroke-linejoin":"round"}).attr(c).add(a.group).shadow(e,f);h.visible!==void 0&&h.setVisible(h.visible)})},sortByAngle:function(a,b){a.sort(function(a,d){return a.angle!==void 0&&(d.angle-a.angle)*b})},drawLegendSymbol:M.drawRectangle,getCenter:Z.getCenter,getSymbol:sa};T=ma(O,T);H.pie=T;O.prototype.drawDataLabels=function(){var a=this,b=a.options,c=b.cursor,d=b.dataLabels,e=a.points,f,g,h=a.hasRendered||0,i,j;if(d.enabled||a._hasPointLabels)a.dlProcessOptions&&a.dlProcessOptions(d),j=a.plotGroup("dataLabelsGroup","data-labels",d.defer?"hidden":"visible",d.zIndex||6),p(d.defer,!0)&&(j.attr({opacity:+h}),h||N(a,"afterAnimate",function(){a.visible&&j.show();j[b.animation?"animate":"attr"]({opacity:1},{duration:200})})),g=d,q(e,function(b){var e,h=b.dataLabel,m,o,q=b.connector,t=!0;f=b.options&&b.options.dataLabels;e=p(f&&f.enabled,g.enabled);if(h&&!e)b.dataLabel=h.destroy();else if(e){d=w(g,f);e=d.rotation;m=b.getLabelConfig();i=d.format?Ja(d.format,m):d.formatter.call(m,d);d.style.color=p(d.color,d.style.color,a.color,"black");if(h)if(s(i))h.attr({text:i}),t=!1;else{if(b.dataLabel=h=h.destroy(),q)b.connector=q.destroy()}else if(s(i)){h={fill:d.backgroundColor,stroke:d.borderColor,"stroke-width":d.borderWidth,r:d.borderRadius||0,rotation:e,padding:d.padding,zIndex:1};for(o in h)h[o]===u&&delete h[o];h=b.dataLabel=a.chart.renderer[e?"text":"label"](i,0,-999,null,null,null,d.useHTML).attr(h).css(r(d.style,c&&{cursor:c})).add(j).shadow(d.shadow)}h&&a.alignDataLabel(b,h,d,null,t)}})};O.prototype.alignDataLabel=function(a,b,c,d,e){var f=this.chart,g=f.inverted,h=p(a.plotX,-999),i=p(a.plotY,-999),j=b.getBBox();if(a=this.visible&&(a.series.forceDL||f.isInsidePlot(h,v(i),g)||d&&f.isInsidePlot(h,g?d.x+1:d.y+d.height-1,g)))d=r({x:g?f.plotWidth-i:h,y:v(g?f.plotHeight-h:i),width:0,height:0},d),r(c,{width:j.width,height:j.height}),c.rotation?b[e?"attr":"animate"]({x:d.x+c.x+d.width/2,y:d.y+c.y+d.height/2}).attr({align:c.align}):(b.align(c,null,d),g=b.alignAttr,p(c.overflow,"justify")==="justify"?this.justifyDataLabel(b,c,g,j,d,e):p(c.crop,!0)&&(a=f.isInsidePlot(g.x,g.y)&&f.isInsidePlot(g.x+j.width,g.y+j.height)));if(!a)b.attr({y:-999}),b.placed=!1};O.prototype.justifyDataLabel=function(a,b,c,d,e,f){var g=this.chart,h=b.align,i=b.verticalAlign,j,k;j=c.x;if(j<0)h==="right"?b.align="left":b.x=-j,k=!0;j=c.x+d.width;if(j>g.plotWidth)h==="left"?b.align="right":b.x=g.plotWidth-j,k=!0;j=c.y;if(j<0)i==="bottom"?b.verticalAlign="top":b.y=-j,k=!0;j=c.y+d.height;if(j>g.plotHeight)i==="top"?b.verticalAlign="bottom":b.y=g.plotHeight-j,k=!0;if(k)a.placed=!f,a.align(b,null,e)};if(H.pie)H.pie.prototype.drawDataLabels=function(){var a=this,b=a.data,c,d=a.chart,e=a.options.dataLabels,f=p(e.connectorPadding,10),g=p(e.connectorWidth,1),h=d.plotWidth,i=d.plotHeight,j,k,l=p(e.softConnector,!0),n=e.distance,m=a.center,o=m[2]/2,r=m[1],s=n>0,u,w,x,A=[[],[]],y,B,I,H,z,R=[0,0,0,0],N=function(a,b){return b.y-a.y};if(a.visible&&(e.enabled||a._hasPointLabels)){O.prototype.drawDataLabels.apply(a);q(b,function(a){a.dataLabel&&a.visible&&A[a.half].push(a)});for(H=2;H--;){var G=[],M=[],F=A[H],K=F.length,E;if(K){a.sortByAngle(F,H-.5);for(z=b=0;!b&&F[z];)b=F[z]&&F[z].dataLabel&&(F[z].dataLabel.getBBox().height||21),z++;if(n>0){w=L(r+o+n,d.plotHeight);for(z=t(0,r-o-n);z<=w;z+=b)G.push(z);w=G.length;if(K>w){c=[].concat(F);c.sort(N);for(z=K;z--;)c[z].rank=z;for(z=K;z--;)F[z].rank>=w&&F.splice(z,1);K=F.length}for(z=0;z<K;z++){c=F[z];x=c.labelPos;c=9999;var S,P;for(P=0;P<w;P++)S=Q(G[P]-x[1]),S<c&&(c=S,E=P);if(E<z&&G[z]!==null)E=z;else for(w<K-z+E&&G[z]!==null&&(E=w-K+z);G[E]===null;)E++;M.push({i:E,y:G[E]});G[E]=null}M.sort(N)}for(z=0;z<K;z++){c=F[z];x=c.labelPos;u=c.dataLabel;I=c.visible===!1?"hidden":"visible";c=x[1];if(n>0){if(w=M.pop(),E=w.i,B=w.y,c>B&&G[E+1]!==null||c<B&&G[E-1]!==null)B=L(t(0,c),d.plotHeight)}else B=c;y=e.justify?m[0]+(H?-1:1)*(o+n):a.getX(B===r-o-n||B===r+o+n?c:B,H);u._attr={visibility:I,align:x[6]};u._pos={x:y+e.x+({left:f,right:-f}[x[6]]||0),y:B+e.y-10};u.connX=y;u.connY=B;if(this.options.size===null)w=u.width,y-w<f?R[3]=t(v(w-y+f),R[3]):y+w>h-f&&(R[1]=t(v(y+w-h+f),R[1])),B-b/2<0?R[0]=t(v(-B+b/2),R[0]):B+b/2>i&&(R[2]=t(v(B+b/2-i),R[2]))}}}if(Ca(R)===0||this.verifyDataLabelOverflow(R))this.placeDataLabels(),s&&g&&q(this.points,function(b){j=b.connector;x=b.labelPos;if((u=b.dataLabel)&&u._pos)I=u._attr.visibility,y=u.connX,B=u.connY,k=l?["M",y+(x[6]==="left"?5:-5),B,"C",y,B,2*x[2]-x[4],2*x[3]-x[5],x[2],x[3],"L",x[4],x[5]]:["M",y+(x[6]==="left"?5:-5),B,"L",x[2],x[3],"L",x[4],x[5]],j?(j.animate({d:k}),j.attr("visibility",I)):b.connector=j=a.chart.renderer.path(k).attr({"stroke-width":g,stroke:e.connectorColor||b.color||"#606060",visibility:I}).add(a.dataLabelsGroup);else if(j)b.connector=j.destroy()})}},H.pie.prototype.placeDataLabels=function(){q(this.points,function(a){var a=a.dataLabel,b;if(a)(b=a._pos)?(a.attr(a._attr),a[a.moved?"animate":"attr"](b),a.moved=!0):a&&a.attr({y:-999})})},H.pie.prototype.alignDataLabel=sa,H.pie.prototype.verifyDataLabelOverflow=function(a){var b=this.center,c=this.options,d=c.center,e=c=c.minSize||80,f;d[0]!==null?e=t(b[2]-t(a[1],a[3]),c):(e=t(b[2]-a[1]-a[3],c),b[0]+=(a[3]-a[1])/2);d[1]!==null?e=t(L(e,b[2]-t(a[0],a[2])),c):(e=t(L(e,b[2]-a[0]-a[2]),c),b[1]+=(a[0]-a[2])/2);e<b[2]?(b[2]=e,this.translate(b),q(this.points,function(a){if(a.dataLabel)a.dataLabel._pos=null}),this.drawDataLabels&&this.drawDataLabels()):f=!0;return f};if(H.column)H.column.prototype.alignDataLabel=function(a,b,c,d,e){var f=this.chart,g=f.inverted,h=a.dlBox||a.shapeArgs,i=a.below||a.plotY>p(this.translatedThreshold,f.plotSizeY),j=p(c.inside,!!this.options.stacking);if(h&&(d=w(h),g&&(d={x:f.plotWidth-d.y-d.height,y:f.plotHeight-d.x-d.width,width:d.height,height:d.width}),!j))g?(d.x+=i?0:d.width,d.width=0):(d.y+=i?d.height:0,d.height=0);c.align=p(c.align,!g||j?"center":i?"right":"left");c.verticalAlign=p(c.verticalAlign,g||j?"middle":i?"top":"bottom");O.prototype.alignDataLabel.call(this,a,b,c,d,e)};T=K.TrackerMixin={drawTrackerPoint:function(){var a=this,b=a.chart,c=b.pointer,d=a.options.cursor,e=d&&{cursor:d},f=function(c){var d=c.target,e;if(b.hoverSeries!==a)a.onMouseOver();for(;d&&!e;)e=d.point,d=d.parentNode;if(e!==u&&e!==b.hoverPoint)e.onMouseOver(c)};q(a.points,function(a){if(a.graphic)a.graphic.element.point=a;if(a.dataLabel)a.dataLabel.element.point=a});if(!a._hasTracking)q(a.trackerGroups,function(b){if(a[b]&&(a[b].addClass("highcharts-tracker").on("mouseover",f).on("mouseout",function(a){c.onTrackerMouseOut(a)}).css(e),$a))a[b].on("touchstart",f)}),a._hasTracking=!0},drawTrackerGraph:function(){var a=this,b=a.options,c=b.trackByArea,d=[].concat(c?a.areaPath:a.graphPath),e=d.length,f=a.chart,g=f.pointer,h=f.renderer,i=f.options.tooltip.snap,j=a.tracker,k=b.cursor,l=k&&{cursor:k},k=a.singlePoints,n,m=function(){if(f.hoverSeries!==a)a.onMouseOver()},o="rgba(192,192,192,"+(ba?1e-4:.002)+")";if(e&&!c)for(n=e+1;n--;)d[n]==="M"&&d.splice(n+1,0,d[n+1]-i,d[n+2],"L"),(n&&d[n]==="M"||n===e)&&d.splice(n,0,"L",d[n-2]+i,d[n-1]);for(n=0;n<k.length;n++)e=k[n],d.push("M",e.plotX-i,e.plotY,"L",e.plotX+i,e.plotY);j?j.attr({d:d}):(a.tracker=h.path(d).attr({"stroke-linejoin":"round",visibility:a.visible?"visible":"hidden",stroke:o,fill:c?o:P,"stroke-width":b.lineWidth+(c?0:2*i),zIndex:2}).add(a.group),q([a.tracker,a.markerGroup],function(a){a.addClass("highcharts-tracker").on("mouseover",m).on("mouseout",function(a){g.onTrackerMouseOut(a)}).css(l);if($a)a.on("touchstart",m)}))}};if(H.column)ia.prototype.drawTracker=T.drawTrackerPoint;if(H.pie)H.pie.prototype.drawTracker=T.drawTrackerPoint;if(H.scatter)qa.prototype.drawTracker=T.drawTrackerPoint;r(lb.prototype,{setItemEvents:function(a,b,c,d,e){var f=this;(c?b:a.legendGroup).on("mouseover",function(){a.setState("hover");b.css(f.options.itemHoverStyle)}).on("mouseout",function(){b.css(a.visible?d:e);a.setState()}).on("click",function(b){var c=function(){a.setVisible()},b={browserEvent:b};a.firePointEvent?a.firePointEvent("legendItemClick",b,c):I(a,"legendItemClick",b,c)})},createCheckboxForItem:function(a){a.checkbox=$("input",{type:"checkbox",checked:a.selected,defaultChecked:a.selected
},this.options.itemCheckboxStyle,this.chart.container);N(a.checkbox,"click",function(b){I(a,"checkboxClick",{checked:b.target.checked},function(){a.select()})})}});E.legend.itemStyle.cursor="pointer";r(Ya.prototype,{showResetZoom:function(){var a=this,b=E.lang,c=a.options.chart.resetZoomButton,d=c.theme,e=d.states,f=c.relativeTo==="chart"?null:"plotBox";this.resetZoomButton=a.renderer.button(b.resetZoom,null,null,function(){a.zoomOut()},d,e&&e.hover).attr({align:c.position.align,title:b.resetZoomTitle}).add().align(c.position,!1,f)},zoomOut:function(){var a=this;I(a,"selection",{resetSelection:!0},function(){a.zoom()})},zoom:function(a){var b,c=this.pointer,d=!1,e;!a||a.resetSelection?q(this.axes,function(a){b=a.zoom()}):q(a.xAxis.concat(a.yAxis),function(a){var e=a.axis,h=e.isXAxis;if(c[h?"zoomX":"zoomY"]||c[h?"pinchX":"pinchY"])b=e.zoom(a.min,a.max),e.displayBtn&&(d=!0)});e=this.resetZoomButton;if(d&&!e)this.showResetZoom();else if(!d&&da(e))this.resetZoomButton=e.destroy();b&&this.redraw(p(this.options.chart.animation,a&&a.animation,this.pointCount<100))},pan:function(a,b){var c=this,d=c.hoverPoints,e;d&&q(d,function(a){a.setState()});q(b==="xy"?[1,0]:[1],function(b){var d=a[b?"chartX":"chartY"],h=c[b?"xAxis":"yAxis"][0],i=c[b?"mouseDownX":"mouseDownY"],j=(h.pointRange||0)/2,k=h.getExtremes(),l=h.toValue(i-d,!0)+j,i=h.toValue(i+c[b?"plotWidth":"plotHeight"]-d,!0)-j;h.series.length&&l>L(k.dataMin,k.min)&&i<t(k.dataMax,k.max)&&(h.setExtremes(l,i,!1,!1,{trigger:"pan"}),e=!0);c[b?"mouseDownX":"mouseDownY"]=d});e&&c.redraw(!1);B(c.container,{cursor:"move"})}});r(Fa.prototype,{select:function(a,b){var c=this,d=c.series,e=d.chart,a=p(a,!c.selected);c.firePointEvent(a?"select":"unselect",{accumulate:b},function(){c.selected=c.options.selected=a;d.options.data[Ma(c,d.data)]=c.options;c.setState(a&&"select");b||q(e.getSelectedPoints(),function(a){if(a.selected&&a!==c)a.selected=a.options.selected=!1,d.options.data[Ma(a,d.data)]=a.options,a.setState(""),a.firePointEvent("unselect")})})},onMouseOver:function(a){var b=this.series,c=b.chart,d=c.tooltip,e=c.hoverPoint;if(e&&e!==this)e.onMouseOut();this.firePointEvent("mouseOver");d&&(!d.shared||b.noSharedTooltip)&&d.refresh(this,a);this.setState("hover");c.hoverPoint=this},onMouseOut:function(){var a=this.series.chart,b=a.hoverPoints;this.firePointEvent("mouseOut");if(!b||Ma(this,b)===-1)this.setState(),a.hoverPoint=null},importEvents:function(){if(!this.hasImportedEvents){var a=w(this.series.options.point,this.options).events,b;this.events=a;for(b in a)N(this,b,a[b]);this.hasImportedEvents=!0}},setState:function(a,b){var c=this.plotX,d=this.plotY,e=this.series,f=e.options.states,g=ca[e.type].marker&&e.options.marker,h=g&&!g.enabled,i=g&&g.states[a],j=i&&i.enabled===!1,k=e.stateMarkerGraphic,l=this.marker||{},n=e.chart,m=e.halo,o,a=a||"";o=this.pointAttr[a]||e.pointAttr[a];if(!(a===this.state&&!b||this.selected&&a!=="select"||f[a]&&f[a].enabled===!1||a&&(j||h&&i.enabled===!1)||a&&l.states&&l.states[a]&&l.states[a].enabled===!1)){if(this.graphic)g=g&&this.graphic.symbolName&&o.r,this.graphic.attr(w(o,g?{x:c-g,y:d-g,width:2*g,height:2*g}:{})),k&&k.hide();else{if(a&&i)if(g=i.radius,l=l.symbol||e.symbol,k&&k.currentSymbol!==l&&(k=k.destroy()),k)k[b?"animate":"attr"]({x:c-g,y:d-g});else if(l)e.stateMarkerGraphic=k=n.renderer.symbol(l,c-g,d-g,2*g,2*g).attr(o).add(e.markerGroup),k.currentSymbol=l;if(k)k[a&&n.isInsidePlot(c,d,n.inverted)?"show":"hide"]()}if((c=f[a]&&f[a].halo)&&c.size){if(!m)e.halo=m=n.renderer.path().add(e.seriesGroup);m.attr(r({fill:ya(this.color||e.color).setOpacity(c.opacity).get()},c.attributes))[b?"animate":"attr"]({d:this.haloPath(c.size)})}else m&&m.attr({d:[]});this.state=a}},haloPath:function(a){var b=this.series,c=b.chart,d=b.getPlotBox(),e=c.inverted;return c.renderer.symbols.circle(d.translateX+(e?b.yAxis.len-this.plotY:this.plotX)-a,d.translateY+(e?b.xAxis.len-this.plotX:this.plotY)-a,a*2,a*2)}});r(O.prototype,{onMouseOver:function(){var a=this.chart,b=a.hoverSeries;if(b&&b!==this)b.onMouseOut();this.options.events.mouseOver&&I(this,"mouseOver");this.setState("hover");a.hoverSeries=this},onMouseOut:function(){var a=this.options,b=this.chart,c=b.tooltip,d=b.hoverPoint;if(d)d.onMouseOut();this&&a.events.mouseOut&&I(this,"mouseOut");c&&!a.stickyTracking&&(!c.shared||this.noSharedTooltip)&&c.hide();this.setState();b.hoverSeries=null},setState:function(a){var b=this.options,c=this.graph,d=this.graphNeg,e=b.states,b=b.lineWidth,a=a||"";if(this.state!==a)this.state=a,e[a]&&e[a].enabled===!1||(a&&(b=e[a].lineWidth||b+(e[a].lineWidthPlus||0)),c&&!c.dashstyle&&(a={"stroke-width":b},c.attr(a),d&&d.attr(a)))},setVisible:function(a,b){var c=this,d=c.chart,e=c.legendItem,f,g=d.options.chart.ignoreHiddenSeries,h=c.visible;f=(c.visible=a=c.userOptions.visible=a===u?!h:a)?"show":"hide";q(["group","dataLabelsGroup","markerGroup","tracker"],function(a){if(c[a])c[a][f]()});if(d.hoverSeries===c)c.onMouseOut();e&&d.legend.colorizeItem(c,a);c.isDirty=!0;c.options.stacking&&q(d.series,function(a){if(a.options.stacking&&a.visible)a.isDirty=!0});q(c.linkedSeries,function(b){b.setVisible(a,!1)});if(g)d.isDirtyBox=!0;b!==!1&&d.redraw();I(c,f)},setTooltipPoints:function(a){var b=[],c,d,e=this.xAxis,f=e&&e.getExtremes(),g=e?e.tooltipLen||e.len:this.chart.plotSizeX,h,i,j=[];if(!(this.options.enableMouseTracking===!1||this.singularTooltips)){if(a)this.tooltipPoints=null;q(this.segments||this.points,function(a){b=b.concat(a)});e&&e.reversed&&(b=b.reverse());this.orderTooltipPoints&&this.orderTooltipPoints(b);a=b.length;for(i=0;i<a;i++)if(e=b[i],c=e.x,c>=f.min&&c<=f.max){h=b[i+1];c=d===u?0:d+1;for(d=b[i+1]?L(t(0,U((e.clientX+(h?h.wrappedClientX||h.clientX:g))/2)),g):g;c>=0&&c<=d;)j[c++]=e}this.tooltipPoints=j}},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},select:function(a){this.selected=a=a===u?!this.selected:a;if(this.checkbox)this.checkbox.checked=a;I(this,a?"select":"unselect")},drawTracker:T.drawTrackerGraph});r(K,{Axis:na,Chart:Ya,Color:ya,Point:Fa,Tick:Ta,Renderer:Za,Series:O,SVGElement:S,SVGRenderer:ta,arrayMin:Oa,arrayMax:Ca,charts:W,dateFormat:cb,format:Ja,pathAnim:vb,getOptions:function(){return E},hasBidiBug:Ob,isTouchDevice:Ib,numberFormat:Ba,seriesTypes:H,setOptions:function(a){E=w(!0,E,a);Bb();return E},addEvent:N,removeEvent:X,createElement:$,discardElement:Qa,css:B,each:q,extend:r,map:Va,merge:w,pick:p,splat:ra,extendClass:ma,pInt:y,wrap:Na,svg:ba,canvas:ga,vml:!ba&&!ga,product:"Highcharts",version:"4.0.4"})})();(function(factory){if(typeof define==="function"&&define.amd){define(factory)}else{window.purl=factory()}})(function(){var tag2attr={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href",embed:"src",object:"data"},key=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],aliases={anchor:"fragment"},parser={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},isint=/^[0-9]+$/;function parseUri(url,strictMode){var str=decodeURI(url),res=parser[strictMode||false?"strict":"loose"].exec(str),uri={attr:{},param:{},seg:{}},i=14;while(i--){uri.attr[key[i]]=res[i]||""}uri.param["query"]=parseString(uri.attr["query"]);uri.param["fragment"]=parseString(uri.attr["fragment"]);uri.seg["path"]=uri.attr.path.replace(/^\/+|\/+$/g,"").split("/");uri.seg["fragment"]=uri.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");uri.attr["base"]=uri.attr.host?(uri.attr.protocol?uri.attr.protocol+"://"+uri.attr.host:uri.attr.host)+(uri.attr.port?":"+uri.attr.port:""):"";return uri}function getAttrName(elm){var tn=elm.tagName;if(typeof tn!=="undefined")return tag2attr[tn.toLowerCase()];return tn}function promote(parent,key){if(parent[key].length===0)return parent[key]={};var t={};for(var i in parent[key])t[i]=parent[key][i];parent[key]=t;return t}function parse(parts,parent,key,val){var part=parts.shift();if(!part){if(isArray(parent[key])){parent[key].push(val)}else if("object"==typeof parent[key]){parent[key]=val}else if("undefined"==typeof parent[key]){parent[key]=val}else{parent[key]=[parent[key],val]}}else{var obj=parent[key]=parent[key]||[];if("]"==part){if(isArray(obj)){if(""!==val)obj.push(val)}else if("object"==typeof obj){obj[keys(obj).length]=val}else{obj=parent[key]=[parent[key],val]}}else if(~part.indexOf("]")){part=part.substr(0,part.length-1);if(!isint.test(part)&&isArray(obj))obj=promote(parent,key);parse(parts,obj,part,val)}else{if(!isint.test(part)&&isArray(obj))obj=promote(parent,key);parse(parts,obj,part,val)}}}function merge(parent,key,val){if(~key.indexOf("]")){var parts=key.split("[");parse(parts,parent,"base",val)}else{if(!isint.test(key)&&isArray(parent.base)){var t={};for(var k in parent.base)t[k]=parent.base[k];parent.base=t}if(key!==""){set(parent.base,key,val)}}return parent}function parseString(str){return reduce(String(str).split(/&|;/),function(ret,pair){try{pair=decodeURIComponent(pair.replace(/\+/g," "))}catch(e){}var eql=pair.indexOf("="),brace=lastBraceInKey(pair),key=pair.substr(0,brace||eql),val=pair.substr(brace||eql,pair.length);val=val.substr(val.indexOf("=")+1,val.length);if(key===""){key=pair;val=""}return merge(ret,key,val)},{base:{}}).base}function set(obj,key,val){var v=obj[key];if(typeof v==="undefined"){obj[key]=val}else if(isArray(v)){v.push(val)}else{obj[key]=[v,val]}}function lastBraceInKey(str){var len=str.length,brace,c;for(var i=0;i<len;++i){c=str[i];if("]"==c)brace=false;if("["==c)brace=true;if("="==c&&!brace)return i}}function reduce(obj,accumulator){var i=0,l=obj.length>>0,curr=arguments[2];while(i<l){if(i in obj)curr=accumulator.call(undefined,curr,obj[i],i,obj);++i}return curr}function isArray(vArg){return Object.prototype.toString.call(vArg)==="[object Array]"}function keys(obj){var key_array=[];for(var prop in obj){if(obj.hasOwnProperty(prop))key_array.push(prop)}return key_array}function purl(url,strictMode){if(arguments.length===1&&url===true){strictMode=true;url=undefined}strictMode=strictMode||false;url=url||window.location.toString();return{data:parseUri(url,strictMode),attr:function(attr){attr=aliases[attr]||attr;return typeof attr!=="undefined"?this.data.attr[attr]:this.data.attr},param:function(param){return typeof param!=="undefined"?this.data.param.query[param]:this.data.param.query},fparam:function(param){return typeof param!=="undefined"?this.data.param.fragment[param]:this.data.param.fragment},segment:function(seg){if(typeof seg==="undefined"){return this.data.seg.path}else{seg=seg<0?this.data.seg.path.length+seg:seg-1;return this.data.seg.path[seg]}},fsegment:function(seg){if(typeof seg==="undefined"){return this.data.seg.fragment}else{seg=seg<0?this.data.seg.fragment.length+seg:seg-1;return this.data.seg.fragment[seg]}}}}purl.jQuery=function($){if($!=null){$.fn.url=function(strictMode){var url="";if(this.length){url=$(this).attr(getAttrName(this[0]))||""}return purl(url,strictMode)};$.url=purl}};purl.jQuery(window.jQuery);return purl});!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});(function(e){"use strict";var t={};typeof exports=="undefined"?typeof define=="function"&&typeof define.amd=="object"&&define.amd?(t.exports={},define(function(){return t.exports})):t.exports=typeof window!="undefined"?window:e:t.exports=exports,function(e){if(!t)var t=1e-6;if(!n)var n=typeof Float32Array!="undefined"?Float32Array:Array;if(!r)var r=Math.random;var i={};i.setMatrixArrayType=function(e){n=e},typeof e!="undefined"&&(e.glMatrix=i);var s=Math.PI/180;i.toRadian=function(e){return e*s};var o={};o.create=function(){var e=new n(2);return e[0]=0,e[1]=0,e},o.clone=function(e){var t=new n(2);return t[0]=e[0],t[1]=e[1],t},o.fromValues=function(e,t){var r=new n(2);return r[0]=e,r[1]=t,r},o.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},o.set=function(e,t,n){return e[0]=t,e[1]=n,e},o.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},o.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},o.sub=o.subtract,o.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},o.mul=o.multiply,o.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},o.div=o.divide,o.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},o.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},o.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},o.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},o.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},o.dist=o.distance,o.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},o.sqrDist=o.squaredDistance,o.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},o.len=o.length,o.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},o.sqrLen=o.squaredLength,o.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},o.normalize=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},o.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},o.lerp=function(e,t,n,r){var i=t[0],s=t[1];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e},o.random=function(e,t){t=t||1;var n=r()*2*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},o.transformMat2=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e},o.transformMat2d=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e},o.transformMat3=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e},o.transformMat4=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},o.forEach=function(){var e=o.create();return function(t,n,r,i,s,o){var u,a;n||(n=2),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],s(e,e,o),t[u]=e[0],t[u+1]=e[1];return t}}(),o.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},typeof e!="undefined"&&(e.vec2=o);var u={};u.create=function(){var e=new n(3);return e[0]=0,e[1]=0,e[2]=0,e},u.clone=function(e){var t=new n(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},u.fromValues=function(e,t,r){var i=new n(3);return i[0]=e,i[1]=t,i[2]=r,i},u.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},u.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},u.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},u.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},u.sub=u.subtract,u.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},u.mul=u.multiply,u.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},u.div=u.divide,u.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},u.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},u.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},u.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},u.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},u.dist=u.distance,u.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i},u.sqrDist=u.squaredDistance,u.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},u.len=u.length,u.squaredLength=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r},u.sqrLen=u.squaredLength,u.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},u.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e},u.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},u.cross=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2];return e[0]=i*a-s*u,e[1]=s*o-r*a,e[2]=r*u-i*o,e},u.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e},u.random=function(e,t){t=t||1;var n=r()*2*Math.PI,i=r()*2-1,s=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*s,e[1]=Math.sin(n)*s,e[2]=i*t,e},u.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12],e[1]=n[1]*r+n[5]*i+n[9]*s+n[13],e[2]=n[2]*r+n[6]*i+n[10]*s+n[14],e},u.transformMat3=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=r*n[0]+i*n[3]+s*n[6],e[1]=r*n[1]+i*n[4]+s*n[7],e[2]=r*n[2]+i*n[5]+s*n[8],e},u.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},u.rotateX=function(e,t,n,r){var i=[],s=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e},u.rotateY=function(e,t,n,r){var i=[],s=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e},u.rotateZ=function(e,t,n,r){var i=[],s=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e},u.forEach=function(){var e=u.create();return function(t,n,r,i,s,o){var u,a;n||(n=3),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}(),u.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},typeof e!="undefined"&&(e.vec3=u);var a={};a.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},a.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.fromValues=function(e,t,r,i){var s=new n(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},a.sub=a.subtract,a.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},a.mul=a.multiply,a.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e},a.div=a.divide,a.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},a.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},a.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},a.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},a.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+s*s)},a.dist=a.distance,a.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return n*n+r*r+i*i+s*s},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},a.len=a.length,a.squaredLength=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},a.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},a.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e[3]=u+r*(n[3]-u),e},a.random=function(e,t){return t=t||1,e[0]=r(),e[1]=r(),e[2]=r(),e[3]=r(),a.normalize(e,e),a.scale(e,e,t),e},a.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,e},a.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},a.forEach=function(){var e=a.create();return function(t,n,r,i,s,o){var u,a;n||(n=4),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}(),a.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.vec4=a);var f={};f.create=function(){var e=new n(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},f.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},f.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},f.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},f.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},f.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*s-i*r;return o?(o=1/o,e[0]=s*o,e[1]=-r*o,e[2]=-i*o,e[3]=n*o,e):null},f.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},f.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},f.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*u+s*a,e[1]=i*u+o*a,e[2]=r*f+s*l,e[3]=i*f+o*l,e},f.mul=f.multiply,f.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+s*u,e[1]=i*a+o*u,e[2]=r*-u+s*a,e[3]=i*-u+o*a,e},f.scale=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1];return e[0]=r*u,e[1]=i*u,e[2]=s*a,e[3]=o*a,e},f.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},f.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},f.LDU=function(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]},typeof e!="undefined"&&(e.mat2=f);var l={};l.create=function(){var e=new n(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},l.clone=function(e){var t=new n(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},l.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},l.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},l.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=n*s-r*i;return a?(a=1/a,e[0]=s*a,e[1]=-r*a,e[2]=-i*a,e[3]=n*a,e[4]=(i*u-s*o)*a,e[5]=(r*o-n*u)*a,e):null},l.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},l.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n[0],l=n[1],c=n[2],h=n[3],p=n[4],d=n[5];return e[0]=r*f+s*l,e[1]=i*f+o*l,e[2]=r*c+s*h,e[3]=i*c+o*h,e[4]=r*p+s*d+u,e[5]=i*p+o*d+a,e},l.mul=l.multiply,l.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=Math.sin(n),l=Math.cos(n);return e[0]=r*l+s*f,e[1]=i*l+o*f,e[2]=r*-f+s*l,e[3]=i*-f+o*l,e[4]=u,e[5]=a,e},l.scale=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n[0],l=n[1];return e[0]=r*f,e[1]=i*f,e[2]=s*l,e[3]=o*l,e[4]=u,e[5]=a,e},l.translate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n[0],l=n[1];return e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=r*f+s*l+u,e[5]=i*f+o*l+a,e},l.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},l.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},typeof e!="undefined"&&(e.mat2d=l);var c={};c.create=function(){var e=new n(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},c.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},c.clone=function(e){var t=new n(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},c.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},c.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},c.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},c.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=l*o-u*f,h=-l*s+u*a,p=f*s-o*a,d=n*c+r*h+i*p;return d?(d=1/d,e[0]=c*d,e[1]=(-l*r+i*f)*d,e[2]=(u*r-i*o)*d,e[3]=h*d,e[4]=(l*n-i*a)*d,e[5]=(-u*n+i*s)*d,e[6]=p*d,e[7]=(-f*n+r*a)*d,e[8]=(o*n-r*s)*d,e):null},c.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8];return e[0]=o*l-u*f,e[1]=i*f-r*l,e[2]=r*u-i*o,e[3]=u*a-s*l,e[4]=n*l-i*a,e[5]=i*s-n*u,e[6]=s*f-o*a,e[7]=r*a-n*f,e[8]=n*o-r*s,e},c.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*(f*s-o*a)+n*(-f*i+o*u)+r*(a*i-s*u)},c.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8];return e[0]=h*r+p*o+d*f,e[1]=h*i+p*u+d*l,e[2]=h*s+p*a+d*c,e[3]=v*r+m*o+g*f,e[4]=v*i+m*u+g*l,e[5]=v*s+m*a+g*c,e[6]=y*r+b*o+w*f,e[7]=y*i+b*u+w*l,e[8]=y*s+b*a+w*c,e},c.mul=c.multiply,c.translate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1];return e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=u,e[5]=a,e[6]=h*r+p*o+f,e[7]=h*i+p*u+l,e[8]=h*s+p*a+c,e},c.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=Math.sin(n),p=Math.cos(n);return e[0]=p*r+h*o,e[1]=p*i+h*u,e[2]=p*s+h*a,e[3]=p*o-h*r,e[4]=p*u-h*i,e[5]=p*a-h*s,e[6]=f,e[7]=l,e[8]=c,e},c.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},c.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},c.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=r*o,c=r*u,h=i*o,p=i*u,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-c-d,e[3]=l-g,e[6]=h+m,e[1]=l+g,e[4]=1-f-d,e[7]=p-v,e[2]=h-m,e[5]=p+v,e[8]=1-f-c,e},c.normalFromMat4=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(a*C-o*A-f*N)*O,e[2]=(o*L-u*C+f*T)*O,e[3]=(i*L-r*A-s*k)*O,e[4]=(n*A-i*C+s*N)*O,e[5]=(r*C-n*L-s*T)*O,e[6]=(v*x-m*S+g*E)*O,e[7]=(m*w-d*x-g*b)*O,e[8]=(d*S-v*w+g*y)*O,e):null},c.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},c.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},typeof e!="undefined"&&(e.mat3=c);var h={};h.create=function(){var e=new n(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},h.clone=function(e){var t=new n(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},h.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},h.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],s=t[6],o=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=i,e[13]=o,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},h.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(i*L-r*A-s*k)*O,e[2]=(v*x-m*S+g*E)*O,e[3]=(h*S-c*x-p*E)*O,e[4]=(a*C-o*A-f*N)*O,e[5]=(n*A-i*C+s*N)*O,e[6]=(m*w-d*x-g*b)*O,e[7]=(l*x-h*w+p*b)*O,e[8]=(o*L-u*C+f*T)*O,e[9]=(r*C-n*L-s*T)*O,e[10]=(d*S-v*w+g*y)*O,e[11]=(c*w-l*S-p*y)*O,e[12]=(u*N-o*k-a*T)*O,e[13]=(n*k-r*N+i*T)*O,e[14]=(v*b-d*E-m*y)*O,
e[15]=(l*E-c*b+h*y)*O,e):null},h.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15];return e[0]=u*(h*g-p*m)-c*(a*g-f*m)+v*(a*p-f*h),e[1]=-(r*(h*g-p*m)-c*(i*g-s*m)+v*(i*p-s*h)),e[2]=r*(a*g-f*m)-u*(i*g-s*m)+v*(i*f-s*a),e[3]=-(r*(a*p-f*h)-u*(i*p-s*h)+c*(i*f-s*a)),e[4]=-(o*(h*g-p*m)-l*(a*g-f*m)+d*(a*p-f*h)),e[5]=n*(h*g-p*m)-l*(i*g-s*m)+d*(i*p-s*h),e[6]=-(n*(a*g-f*m)-o*(i*g-s*m)+d*(i*f-s*a)),e[7]=n*(a*p-f*h)-o*(i*p-s*h)+l*(i*f-s*a),e[8]=o*(c*g-p*v)-l*(u*g-f*v)+d*(u*p-f*c),e[9]=-(n*(c*g-p*v)-l*(r*g-s*v)+d*(r*p-s*c)),e[10]=n*(u*g-f*v)-o*(r*g-s*v)+d*(r*f-s*u),e[11]=-(n*(u*p-f*c)-o*(r*p-s*c)+l*(r*f-s*u)),e[12]=-(o*(c*m-h*v)-l*(u*m-a*v)+d*(u*h-a*c)),e[13]=n*(c*m-h*v)-l*(r*m-i*v)+d*(r*h-i*c),e[14]=-(n*(u*m-a*v)-o*(r*m-i*v)+d*(r*a-i*u)),e[15]=n*(u*h-a*c)-o*(r*h-i*c)+l*(r*a-i*u),e},h.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14],m=e[15],g=t*o-n*s,y=t*u-r*s,b=t*a-i*s,w=n*u-r*o,E=n*a-i*o,S=r*a-i*u,x=f*d-l*p,T=f*v-c*p,N=f*m-h*p,C=l*v-c*d,k=l*m-h*d,L=c*m-h*v;return g*L-y*k+b*C+w*N-E*T+S*x},h.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],b=n[0],w=n[1],E=n[2],S=n[3];return e[0]=b*r+w*u+E*c+S*v,e[1]=b*i+w*a+E*h+S*m,e[2]=b*s+w*f+E*p+S*g,e[3]=b*o+w*l+E*d+S*y,b=n[4],w=n[5],E=n[6],S=n[7],e[4]=b*r+w*u+E*c+S*v,e[5]=b*i+w*a+E*h+S*m,e[6]=b*s+w*f+E*p+S*g,e[7]=b*o+w*l+E*d+S*y,b=n[8],w=n[9],E=n[10],S=n[11],e[8]=b*r+w*u+E*c+S*v,e[9]=b*i+w*a+E*h+S*m,e[10]=b*s+w*f+E*p+S*g,e[11]=b*o+w*l+E*d+S*y,b=n[12],w=n[13],E=n[14],S=n[15],e[12]=b*r+w*u+E*c+S*v,e[13]=b*i+w*a+E*h+S*m,e[14]=b*s+w*f+E*p+S*g,e[15]=b*o+w*l+E*d+S*y,e},h.mul=h.multiply,h.translate=function(e,t,n){var r=n[0],i=n[1],s=n[2],o,u,a,f,l,c,h,p,d,v,m,g;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*s+t[12],e[13]=t[1]*r+t[5]*i+t[9]*s+t[13],e[14]=t[2]*r+t[6]*i+t[10]*s+t[14],e[15]=t[3]*r+t[7]*i+t[11]*s+t[15]):(o=t[0],u=t[1],a=t[2],f=t[3],l=t[4],c=t[5],h=t[6],p=t[7],d=t[8],v=t[9],m=t[10],g=t[11],e[0]=o,e[1]=u,e[2]=a,e[3]=f,e[4]=l,e[5]=c,e[6]=h,e[7]=p,e[8]=d,e[9]=v,e[10]=m,e[11]=g,e[12]=o*r+l*i+d*s+t[12],e[13]=u*r+c*i+v*s+t[13],e[14]=a*r+h*i+m*s+t[14],e[15]=f*r+p*i+g*s+t[15]),e},h.scale=function(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},h.rotate=function(e,n,r,i){var s=i[0],o=i[1],u=i[2],a=Math.sqrt(s*s+o*o+u*u),f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;return Math.abs(a)<t?null:(a=1/a,s*=a,o*=a,u*=a,f=Math.sin(r),l=Math.cos(r),c=1-l,h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8],E=n[9],S=n[10],x=n[11],T=s*s*c+l,N=o*s*c+u*f,C=u*s*c-o*f,k=s*o*c-u*f,L=o*o*c+l,A=u*o*c+s*f,O=s*u*c+o*f,M=o*u*c-s*f,_=u*u*c+l,e[0]=h*T+m*N+w*C,e[1]=p*T+g*N+E*C,e[2]=d*T+y*N+S*C,e[3]=v*T+b*N+x*C,e[4]=h*k+m*L+w*A,e[5]=p*k+g*L+E*A,e[6]=d*k+y*L+S*A,e[7]=v*k+b*L+x*A,e[8]=h*O+m*M+w*_,e[9]=p*O+g*M+E*_,e[10]=d*O+y*M+S*_,e[11]=v*O+b*M+x*_,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)},h.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[4],o=t[5],u=t[6],a=t[7],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+f*r,e[5]=o*i+l*r,e[6]=u*i+c*r,e[7]=a*i+h*r,e[8]=f*i-s*r,e[9]=l*i-o*r,e[10]=c*i-u*r,e[11]=h*i-a*r,e},h.rotateY=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-f*r,e[1]=o*i-l*r,e[2]=u*i-c*r,e[3]=a*i-h*r,e[8]=s*r+f*i,e[9]=o*r+l*i,e[10]=u*r+c*i,e[11]=a*r+h*i,e},h.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[4],l=t[5],c=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+f*r,e[1]=o*i+l*r,e[2]=u*i+c*r,e[3]=a*i+h*r,e[4]=f*i-s*r,e[5]=l*i-o*r,e[6]=c*i-u*r,e[7]=h*i-a*r,e},h.fromRotationTranslation=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r+r,a=i+i,f=s+s,l=r*u,c=r*a,h=r*f,p=i*a,d=i*f,v=s*f,m=o*u,g=o*a,y=o*f;return e[0]=1-(p+v),e[1]=c+y,e[2]=h-g,e[3]=0,e[4]=c-y,e[5]=1-(l+v),e[6]=d+m,e[7]=0,e[8]=h+g,e[9]=d-m,e[10]=1-(l+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},h.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=r*o,c=r*u,h=i*o,p=i*u,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-c-d,e[1]=l+g,e[2]=h-m,e[3]=0,e[4]=l-g,e[5]=1-f-d,e[6]=p+v,e[7]=0,e[8]=h+m,e[9]=p-v,e[10]=1-f-c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},h.frustum=function(e,t,n,r,i,s,o){var u=1/(n-t),a=1/(i-r),f=1/(s-o);return e[0]=s*2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*a,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(i+r)*a,e[10]=(o+s)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*f,e[15]=0,e},h.perspective=function(e,t,n,r,i){var s=1/Math.tan(t/2),o=1/(r-i);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*o,e[15]=0,e},h.ortho=function(e,t,n,r,i,s,o){var u=1/(t-n),a=1/(r-i),f=1/(s-o);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+n)*u,e[13]=(i+r)*a,e[14]=(o+s)*f,e[15]=1,e},h.lookAt=function(e,n,r,i){var s,o,u,a,f,l,c,p,d,v,m=n[0],g=n[1],y=n[2],b=i[0],w=i[1],E=i[2],S=r[0],x=r[1],T=r[2];return Math.abs(m-S)<t&&Math.abs(g-x)<t&&Math.abs(y-T)<t?h.identity(e):(c=m-S,p=g-x,d=y-T,v=1/Math.sqrt(c*c+p*p+d*d),c*=v,p*=v,d*=v,s=w*d-E*p,o=E*c-b*d,u=b*p-w*c,v=Math.sqrt(s*s+o*o+u*u),v?(v=1/v,s*=v,o*=v,u*=v):(s=0,o=0,u=0),a=p*u-d*o,f=d*s-c*u,l=c*o-p*s,v=Math.sqrt(a*a+f*f+l*l),v?(v=1/v,a*=v,f*=v,l*=v):(a=0,f=0,l=0),e[0]=s,e[1]=a,e[2]=c,e[3]=0,e[4]=o,e[5]=f,e[6]=p,e[7]=0,e[8]=u,e[9]=l,e[10]=d,e[11]=0,e[12]=-(s*m+o*g+u*y),e[13]=-(a*m+f*g+l*y),e[14]=-(c*m+p*g+d*y),e[15]=1,e)},h.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},h.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},typeof e!="undefined"&&(e.mat4=h);var p={};p.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},p.rotationTo=function(){var e=u.create(),t=u.fromValues(1,0,0),n=u.fromValues(0,1,0);return function(r,i,s){var o=u.dot(i,s);return o<-.999999?(u.cross(e,t,i),u.length(e)<1e-6&&u.cross(e,n,i),u.normalize(e,e),p.setAxisAngle(r,e,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(u.cross(e,i,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+o,p.normalize(r,r))}}(),p.setAxes=function(){var e=c.create();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],p.normalize(t,p.fromMat3(t,e))}}(),p.clone=a.clone,p.fromValues=a.fromValues,p.copy=a.copy,p.set=a.set,p.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},p.setAxisAngle=function(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e},p.add=a.add,p.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*l+o*u+i*f-s*a,e[1]=i*l+o*a+s*u-r*f,e[2]=s*l+o*f+r*a-i*u,e[3]=o*l-r*u-i*a-s*f,e},p.mul=p.multiply,p.scale=a.scale,p.rotateX=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+o*u,e[1]=i*a+s*u,e[2]=s*a-i*u,e[3]=o*a-r*u,e},p.rotateY=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a-s*u,e[1]=i*a+o*u,e[2]=s*a+r*u,e[3]=o*a-i*u,e},p.rotateZ=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=i*a-r*u,e[2]=s*a+o*u,e[3]=o*a-s*u,e},p.calculateW=function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},p.dot=a.dot,p.lerp=a.lerp,p.slerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3],a=n[0],f=n[1],l=n[2],c=n[3],h,p,d,v,m;return p=i*a+s*f+o*l+u*c,p<0&&(p=-p,a=-a,f=-f,l=-l,c=-c),1-p>1e-6?(h=Math.acos(p),d=Math.sin(h),v=Math.sin((1-r)*h)/d,m=Math.sin(r*h)/d):(v=1-r,m=r),e[0]=v*i+m*a,e[1]=v*s+m*f,e[2]=v*o+m*l,e[3]=v*u+m*c,e},p.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s,u=o?1/o:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-i*u,e[3]=s*u,e},p.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},p.length=a.length,p.len=p.length,p.squaredLength=a.squaredLength,p.sqrLen=p.squaredLength,p.normalize=a.normalize,p.fromMat3=function(e,t){var n=t[0]+t[4]+t[8],r;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[7]-t[5])*r,e[1]=(t[2]-t[6])*r,e[2]=(t[3]-t[1])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(t[i*3+i]-t[s*3+s]-t[o*3+o]+1),e[i]=.5*r,r=.5/r,e[3]=(t[o*3+s]-t[s*3+o])*r,e[s]=(t[s*3+i]+t[i*3+s])*r,e[o]=(t[o*3+i]+t[i*3+o])*r}return e},p.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.quat=p)}(t.exports)})(this);(function(e,n){"object"===typeof exports?module.exports=n():"function"===typeof define&&define.amd?define(n):e.IPv6=n(e)})(this,function(e){var n=e&&e.IPv6;return{best:function(g){g=g.toLowerCase().split(":");var l=g.length,b=8;""===g[0]&&""===g[1]&&""===g[2]?(g.shift(),g.shift()):""===g[0]&&""===g[1]?g.shift():""===g[l-1]&&""===g[l-2]&&g.pop();l=g.length;-1!==g[l-1].indexOf(".")&&(b=7);var h;for(h=0;h<l&&""!==g[h];h++);if(h<b)for(g.splice(h,1,"0000");g.length<b;)g.splice(h,0,"0000");for(h=0;h<b;h++){for(var l=g[h].split(""),e=0;3>e;e++)if("0"===l[0]&&1<l.length)l.splice(0,1);else break;g[h]=l.join("")}var l=-1,n=e=0,k=-1,u=!1;for(h=0;h<b;h++)u?"0"===g[h]?n+=1:(u=!1,n>e&&(l=k,e=n)):"0"===g[h]&&(u=!0,k=h,n=1);n>e&&(l=k,e=n);1<e&&g.splice(l,e,"");l=g.length;b="";""===g[0]&&(b=":");for(h=0;h<l;h++){b+=g[h];if(h===l-1)break;b+=":"}""===g[l-1]&&(b+=":");return b},noConflict:function(){e.IPv6===this&&(e.IPv6=n);return this}}});(function(e){function n(b){throw RangeError(v[b])}function g(b,f){for(var k=b.length;k--;)b[k]=f(b[k]);return b}function l(b,k){return g(b.split(f),k).join(".")}function b(b){for(var f=[],k=0,g=b.length,a,c;k<g;)a=b.charCodeAt(k++),55296<=a&&56319>=a&&k<g?(c=b.charCodeAt(k++),56320==(c&64512)?f.push(((a&1023)<<10)+(c&1023)+65536):(f.push(a),k--)):f.push(a);return f}function h(b){return g(b,function(b){var f="";65535<b&&(b-=65536,f+=x(b>>>10&1023|55296),b=56320|b&1023);return f+=x(b)}).join("")}function A(b,f){return b+22+75*(26>b)-((0!=f)<<5)}function w(b,f,k){var g=0;b=k?q(b/700):b>>1;for(b+=q(b/f);455<b;g+=36)b=q(b/35);return q(g+36*b/(b+38))}function k(b){var f=[],k=b.length,g,a=0,c=128,d=72,m,z,y,e,l;m=b.lastIndexOf("-");0>m&&(m=0);for(z=0;z<m;++z)128<=b.charCodeAt(z)&&n("not-basic"),f.push(b.charCodeAt(z));for(m=0<m?m+1:0;m<k;){z=a;g=1;for(y=36;;y+=36){m>=k&&n("invalid-input");e=b.charCodeAt(m++);e=10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:36;(36<=e||e>q((2147483647-a)/g))&&n("overflow");a+=e*g;l=y<=d?1:y>=d+26?26:y-d;if(e<l)break;e=36-l;g>q(2147483647/e)&&n("overflow");g*=e}g=f.length+1;d=w(a-z,g,0==z);q(a/g)>2147483647-c&&n("overflow");c+=q(a/g);a%=g;f.splice(a++,0,c)}return h(f)}function u(f){var g,k,e,a,c,d,m,z,y,l=[],u,h,p;f=b(f);u=f.length;g=128;k=0;c=72;for(d=0;d<u;++d)y=f[d],128>y&&l.push(x(y));for((e=a=l.length)&&l.push("-");e<u;){m=2147483647;for(d=0;d<u;++d)y=f[d],y>=g&&y<m&&(m=y);h=e+1;m-g>q((2147483647-k)/h)&&n("overflow");k+=(m-g)*h;g=m;for(d=0;d<u;++d)if(y=f[d],y<g&&2147483647<++k&&n("overflow"),y==g){z=k;for(m=36;;m+=36){y=m<=c?1:m>=c+26?26:m-c;if(z<y)break;p=z-y;z=36-y;l.push(x(A(y+p%z,0)));z=q(p/z)}l.push(x(A(z,0)));c=w(k,h,e==a);k=0;++e}++k;++g}return l.join("")}var D="object"==typeof exports&&exports,E="object"==typeof module&&module&&module.exports==D&&module,B="object"==typeof global&&global;if(B.global===B||B.window===B)e=B;var t,r=/^xn--/,p=/[^ -~]/,f=/\x2E|\u3002|\uFF0E|\uFF61/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},q=Math.floor,x=String.fromCharCode,C;t={version:"1.2.3",ucs2:{decode:b,encode:h},decode:k,encode:u,toASCII:function(b){return l(b,function(b){return p.test(b)?"xn--"+u(b):b})},toUnicode:function(b){return l(b,function(b){return r.test(b)?k(b.slice(4).toLowerCase()):b})}};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return t});else if(D&&!D.nodeType)if(E)E.exports=t;else for(C in t)t.hasOwnProperty(C)&&(D[C]=t[C]);else e.punycode=t})(this);(function(e,n){"object"===typeof exports?module.exports=n():"function"===typeof define&&define.amd?define(n):e.SecondLevelDomains=n(e)})(this,function(e){var n=e&&e.SecondLevelDomains,g={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch "},has:function(e){var b=e.lastIndexOf(".");if(0>=b||b>=e.length-1)return!1;var h=e.lastIndexOf(".",b-1);if(0>=h||h>=b-1)return!1;var n=g.list[e.slice(b+1)];return n?0<=n.indexOf(" "+e.slice(h+1,b)+" "):!1},is:function(e){var b=e.lastIndexOf(".");if(0>=b||b>=e.length-1||0<=e.lastIndexOf(".",b-1))return!1;var h=g.list[e.slice(b+1)];return h?0<=h.indexOf(" "+e.slice(0,b)+" "):!1},get:function(e){var b=e.lastIndexOf(".");if(0>=b||b>=e.length-1)return null;var h=e.lastIndexOf(".",b-1);if(0>=h||h>=b-1)return null;var n=g.list[e.slice(b+1)];return!n||0>n.indexOf(" "+e.slice(h+1,b)+" ")?null:e.slice(h+1)},noConflict:function(){e.SecondLevelDomains===this&&(e.SecondLevelDomains=n);return this}};return g});(function(e,n){"object"===typeof exports?module.exports=n(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"===typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],n):e.URI=n(e.punycode,e.IPv6,e.SecondLevelDomains,e)})(this,function(e,n,g,l){function b(a,c){var d=1<=arguments.length,m=2<=arguments.length;if(!(this instanceof b))return d?m?new b(a,c):new b(a):new b;if(void 0===a){if(d)throw new TypeError("undefined is not a valid argument for URI");a="undefined"!==typeof location?location.href+"":""}this.href(a);return void 0!==c?this.absoluteTo(c):this}function h(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function A(a){return void 0===a?"Undefined":String(Object.prototype.toString.call(a)).slice(8,-1)}function w(a){return"Array"===A(a)}function k(a,c){var d={},b,f;if("RegExp"===A(c))d=null;else if(w(c))for(b=0,f=c.length;b<f;b++)d[c[b]]=!0;else d[c]=!0;b=0;for(f=a.length;b<f;b++)if(d&&void 0!==d[a[b]]||!d&&c.test(a[b]))a.splice(b,1),f--,b--;return a}function u(a,c){var d,b;if(w(c)){d=0;for(b=c.length;d<b;d++)if(!u(a,c[d]))return!1;return!0}var f=A(c);d=0;for(b=a.length;d<b;d++)if("RegExp"===f){if("string"===typeof a[d]&&a[d].match(c))return!0}else if(a[d]===c)return!0;return!1}function D(a,c){if(!w(a)||!w(c)||a.length!==c.length)return!1;a.sort();c.sort();for(var d=0,b=a.length;d<b;d++)if(a[d]!==c[d])return!1;return!0}function E(a){return escape(a)}function B(a){return encodeURIComponent(a).replace(/[!'()*]/g,E).replace(/\*/g,"%2A")}function t(a){return function(c,d){if(void 0===c)return this._parts[a]||"";this._parts[a]=c||null;this.build(!d);return this}}function r(a,c){return function(d,b){if(void 0===d)return this._parts[a]||"";null!==d&&(d+="",d.charAt(0)===c&&(d=d.substring(1)));this._parts[a]=d;this.build(!b);return this}}var p=l&&l.URI;b.version="1.16.1";var f=b.prototype,v=Object.prototype.hasOwnProperty;b._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:b.duplicateQueryParameters,escapeQuerySpace:b.escapeQuerySpace}};b.duplicateQueryParameters=!1;b.escapeQuerySpace=!0;b.protocol_expression=/^[a-z][a-z0-9.+-]*$/i;b.idn_expression=/[^a-z0-9\.-]/i;b.punycode_expression=/(xn--)/i;b.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;b.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;b.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/gi;b.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/};b.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"};b.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/;b.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"};b.getDomAttribute=function(a){if(a&&a.nodeName){var c=a.nodeName.toLowerCase();return"input"===c&&"image"!==a.type?void 0:b.domAttributes[c]}};b.encode=B;b.decode=decodeURIComponent;b.iso8859=function(){b.encode=escape;b.decode=unescape};b.unicode=function(){b.encode=B;b.decode=decodeURIComponent};b.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}};b.encodeQuery=function(a,c){var d=b.encode(a+"");void 0===c&&(c=b.escapeQuerySpace);return c?d.replace(/%20/g,"+"):d};b.decodeQuery=function(a,c){a+="";void 0===c&&(c=b.escapeQuerySpace);try{return b.decode(c?a.replace(/\+/g,"%20"):a)}catch(d){return a}};var q={encode:"encode",decode:"decode"},x,C=function(a,c){return function(d){try{return b[c](d+"").replace(b.characters[a][c].expression,function(d){return b.characters[a][c].map[d]})}catch(m){return d}}};for(x in q)b[x+"PathSegment"]=C("pathname",q[x]),b[x+"UrnPathSegment"]=C("urnpath",q[x]);q=function(a,c,d){return function(m){var f;f=d?function(a){return b[c](b[d](a))}:b[c];m=(m+"").split(a);for(var e=0,k=m.length;e<k;e++)m[e]=f(m[e]);return m.join(a)}};b.decodePath=q("/","decodePathSegment");b.decodeUrnPath=q(":","decodeUrnPathSegment");b.recodePath=q("/","encodePathSegment","decode");b.recodeUrnPath=q(":","encodeUrnPathSegment","decode");b.encodeReserved=C("reserved","encode");b.parse=function(a,c){var d;c||(c={});d=a.indexOf("#");-1<d&&(c.fragment=a.substring(d+1)||null,a=a.substring(0,d));d=a.indexOf("?");-1<d&&(c.query=a.substring(d+1)||null,a=a.substring(0,d));"//"===a.substring(0,2)?(c.protocol=null,a=a.substring(2),a=b.parseAuthority(a,c)):(d=a.indexOf(":"),-1<d&&(c.protocol=a.substring(0,d)||null,c.protocol&&!c.protocol.match(b.protocol_expression)?c.protocol=void 0:"//"===a.substring(d+1,d+3)?(a=a.substring(d+3),a=b.parseAuthority(a,c)):(a=a.substring(d+1),c.urn=!0)));c.path=a;return c};b.parseHost=function(a,c){a=a.replace(/\\/g,"/");var d=a.indexOf("/"),b;-1===d&&(d=a.length);if("["===a.charAt(0))b=a.indexOf("]"),c.hostname=a.substring(1,b)||null,c.port=a.substring(b+2,d)||null,"/"===c.port&&(c.port=null);else{var f=a.indexOf(":");b=a.indexOf("/");f=a.indexOf(":",f+1);-1!==f&&(-1===b||f<b)?(c.hostname=a.substring(0,d)||null,c.port=null):(b=a.substring(0,d).split(":"),c.hostname=b[0]||null,c.port=b[1]||null)}c.hostname&&"/"!==a.substring(d).charAt(0)&&(d++,a="/"+a);return a.substring(d)||"/"};b.parseAuthority=function(a,c){a=b.parseUserinfo(a,c);return b.parseHost(a,c)};b.parseUserinfo=function(a,c){var d=a.indexOf("/"),m=a.lastIndexOf("@",-1<d?d:a.length-1);-1<m&&(-1===d||m<d)?(d=a.substring(0,m).split(":"),c.username=d[0]?b.decode(d[0]):null,d.shift(),c.password=d[0]?b.decode(d.join(":")):null,a=a.substring(m+1)):(c.username=null,c.password=null);return a};b.parseQuery=function(a,c){if(!a)return{};a=a.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!a)return{};for(var d={},m=a.split("&"),f=m.length,e,k,g=0;g<f;g++)if(e=m[g].split("="),k=b.decodeQuery(e.shift(),c),e=e.length?b.decodeQuery(e.join("="),c):null,v.call(d,k)){if("string"===typeof d[k]||null===d[k])d[k]=[d[k]];d[k].push(e)}else d[k]=e;return d};b.build=function(a){var c="";a.protocol&&(c+=a.protocol+":");a.urn||!c&&!a.hostname||(c+="//");c+=b.buildAuthority(a)||"";"string"===typeof a.path&&("/"!==a.path.charAt(0)&&"string"===typeof a.hostname&&(c+="/"),c+=a.path);"string"===typeof a.query&&a.query&&(c+="?"+a.query);"string"===typeof a.fragment&&a.fragment&&(c+="#"+a.fragment);return c};b.buildHost=function(a){var c="";if(a.hostname)c=b.ip6_expression.test(a.hostname)?c+("["+a.hostname+"]"):c+a.hostname;else return"";a.port&&(c+=":"+a.port);return c};b.buildAuthority=function(a){return b.buildUserinfo(a)+b.buildHost(a)};b.buildUserinfo=function(a){var c="";a.username&&(c+=b.encode(a.username),a.password&&(c+=":"+b.encode(a.password)),c+="@");return c};b.buildQuery=function(a,c,d){var m="",f,e,k,g;for(e in a)if(v.call(a,e)&&e)if(w(a[e]))for(f={},k=0,g=a[e].length;k<g;k++)void 0!==a[e][k]&&void 0===f[a[e][k]+""]&&(m+="&"+b.buildQueryParameter(e,a[e][k],d),!0!==c&&(f[a[e][k]+""]=!0));else void 0!==a[e]&&(m+="&"+b.buildQueryParameter(e,a[e],d));return m.substring(1)};b.buildQueryParameter=function(a,c,d){return b.encodeQuery(a,d)+(null!==c?"="+b.encodeQuery(c,d):"")};b.addQuery=function(a,c,d){if("object"===typeof c)for(var m in c)v.call(c,m)&&b.addQuery(a,m,c[m]);else if("string"===typeof c)void 0===a[c]?a[c]=d:("string"===typeof a[c]&&(a[c]=[a[c]]),w(d)||(d=[d]),a[c]=(a[c]||[]).concat(d));else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")};b.removeQuery=function(a,c,d){var m;if(w(c))for(d=0,m=c.length;d<m;d++)a[c[d]]=void 0;else if("RegExp"===A(c))for(m in a)c.test(m)&&(a[m]=void 0);else if("object"===typeof c)for(m in c)v.call(c,m)&&b.removeQuery(a,m,c[m]);else if("string"===typeof c)void 0!==d?"RegExp"===A(d)?!w(a[c])&&d.test(a[c])?a[c]=void 0:a[c]=k(a[c],d):a[c]===d?a[c]=void 0:w(a[c])&&(a[c]=k(a[c],d)):a[c]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")};b.hasQuery=function(a,c,d,m){if("object"===typeof c){for(var f in c)if(v.call(c,f)&&!b.hasQuery(a,f,c[f]))return!1;return!0}if("string"!==typeof c)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(A(d)){case"Undefined":return c in a;case"Boolean":return a=Boolean(w(a[c])?a[c].length:a[c]),d===a;case"Function":return!!d(a[c],c,a);case"Array":return w(a[c])?(m?u:D)(a[c],d):!1;case"RegExp":return w(a[c])?m?u(a[c],d):!1:Boolean(a[c]&&a[c].match(d));case"Number":d=String(d);case"String":return w(a[c])?m?u(a[c],d):!1:a[c]===d;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}};b.commonPath=function(a,c){var d=Math.min(a.length,c.length),b;for(b=0;b<d;b++)if(a.charAt(b)!==c.charAt(b)){b--;break}if(1>b)return a.charAt(0)===c.charAt(0)&&"/"===a.charAt(0)?"/":""
;if("/"!==a.charAt(b)||"/"!==c.charAt(b))b=a.substring(0,b).lastIndexOf("/");return a.substring(0,b+1)};b.withinString=function(a,c,d){d||(d={});var m=d.start||b.findUri.start,f=d.end||b.findUri.end,e=d.trim||b.findUri.trim,k=/[a-z0-9-]=["']?$/i;for(m.lastIndex=0;;){var g=m.exec(a);if(!g)break;g=g.index;if(d.ignoreHtml){var u=a.slice(Math.max(g-3,0),g);if(u&&k.test(u))continue}var u=g+a.slice(g).search(f),h=a.slice(g,u).replace(e,"");d.ignore&&d.ignore.test(h)||(u=g+h.length,h=c(h,g,u,a),a=a.slice(0,g)+h+a.slice(u),m.lastIndex=g+h.length)}m.lastIndex=0;return a};b.ensureValidHostname=function(a){if(a.match(b.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(e.toASCII(a).match(b.invalid_hostname_characters))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]')}};b.noConflict=function(a){if(a)return a={URI:this.noConflict()},l.URITemplate&&"function"===typeof l.URITemplate.noConflict&&(a.URITemplate=l.URITemplate.noConflict()),l.IPv6&&"function"===typeof l.IPv6.noConflict&&(a.IPv6=l.IPv6.noConflict()),l.SecondLevelDomains&&"function"===typeof l.SecondLevelDomains.noConflict&&(a.SecondLevelDomains=l.SecondLevelDomains.noConflict()),a;l.URI===this&&(l.URI=p);return this};f.build=function(a){if(!0===a)this._deferred_build=!0;else if(void 0===a||this._deferred_build)this._string=b.build(this._parts),this._deferred_build=!1;return this};f.clone=function(){return new b(this)};f.valueOf=f.toString=function(){return this.build(!1)._string};f.protocol=t("protocol");f.username=t("username");f.password=t("password");f.hostname=t("hostname");f.port=t("port");f.query=r("query","?");f.fragment=r("fragment","#");f.search=function(a,c){var b=this.query(a,c);return"string"===typeof b&&b.length?"?"+b:b};f.hash=function(a,c){var b=this.fragment(a,c);return"string"===typeof b&&b.length?"#"+b:b};f.pathname=function(a,c){if(void 0===a||!0===a){var d=this._parts.path||(this._parts.hostname?"/":"");return a?(this._parts.urn?b.decodeUrnPath:b.decodePath)(d):d}this._parts.path=this._parts.urn?a?b.recodeUrnPath(a):"":a?b.recodePath(a):"/";this.build(!c);return this};f.path=f.pathname;f.href=function(a,c){var d;if(void 0===a)return this.toString();this._string="";this._parts=b._parts();var f=a instanceof b,e="object"===typeof a&&(a.hostname||a.path||a.pathname);a.nodeName&&(e=b.getDomAttribute(a),a=a[e]||"",e=!1);!f&&e&&void 0!==a.pathname&&(a=a.toString());if("string"===typeof a||a instanceof String)this._parts=b.parse(String(a),this._parts);else if(f||e)for(d in f=f?a._parts:a,f)v.call(this._parts,d)&&(this._parts[d]=f[d]);else throw new TypeError("invalid input");this.build(!c);return this};f.is=function(a){var c=!1,d=!1,f=!1,e=!1,k=!1,u=!1,h=!1,l=!this._parts.urn;this._parts.hostname&&(l=!1,d=b.ip4_expression.test(this._parts.hostname),f=b.ip6_expression.test(this._parts.hostname),c=d||f,k=(e=!c)&&g&&g.has(this._parts.hostname),u=e&&b.idn_expression.test(this._parts.hostname),h=e&&b.punycode_expression.test(this._parts.hostname));switch(a.toLowerCase()){case"relative":return l;case"absolute":return!l;case"domain":case"name":return e;case"sld":return k;case"ip":return c;case"ip4":case"ipv4":case"inet4":return d;case"ip6":case"ipv6":case"inet6":return f;case"idn":return u;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return h}return null};var F=f.protocol,G=f.port,H=f.hostname;f.protocol=function(a,c){if(void 0!==a&&a&&(a=a.replace(/:(\/\/)?$/,""),!a.match(b.protocol_expression)))throw new TypeError('Protocol "'+a+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return F.call(this,a,c)};f.scheme=f.protocol;f.port=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a&&(0===a&&(a=null),a&&(a+="",":"===a.charAt(0)&&(a=a.substring(1)),a.match(/[^0-9]/))))throw new TypeError('Port "'+a+'" contains characters other than [0-9]');return G.call(this,a,c)};f.hostname=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a){var d={};if("/"!==b.parseHost(a,d))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');a=d.hostname}return H.call(this,a,c)};f.host=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a)return this._parts.hostname?b.buildHost(this._parts):"";if("/"!==b.parseHost(a,this._parts))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');this.build(!c);return this};f.authority=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a)return this._parts.hostname?b.buildAuthority(this._parts):"";if("/"!==b.parseAuthority(a,this._parts))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');this.build(!c);return this};f.userinfo=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.username)return"";var d=b.buildUserinfo(this._parts);return d.substring(0,d.length-1)}"@"!==a[a.length-1]&&(a+="@");b.parseUserinfo(a,this._parts);this.build(!c);return this};f.resource=function(a,c){var d;if(void 0===a)return this.path()+this.search()+this.hash();d=b.parse(a);this._parts.path=d.path;this._parts.query=d.query;this._parts.fragment=d.fragment;this.build(!c);return this};f.subdomain=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var d=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,d)||""}d=this._parts.hostname.length-this.domain().length;d=this._parts.hostname.substring(0,d);d=new RegExp("^"+h(d));a&&"."!==a.charAt(a.length-1)&&(a+=".");a&&b.ensureValidHostname(a);this._parts.hostname=this._parts.hostname.replace(d,a);this.build(!c);return this};f.domain=function(a,c){if(this._parts.urn)return void 0===a?"":this;"boolean"===typeof a&&(c=a,a=void 0);if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var d=this._parts.hostname.match(/\./g);if(d&&2>d.length)return this._parts.hostname;d=this._parts.hostname.length-this.tld(c).length-1;d=this._parts.hostname.lastIndexOf(".",d-1)+1;return this._parts.hostname.substring(d)||""}if(!a)throw new TypeError("cannot set domain empty");b.ensureValidHostname(a);!this._parts.hostname||this.is("IP")?this._parts.hostname=a:(d=new RegExp(h(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(d,a));this.build(!c);return this};f.tld=function(a,c){if(this._parts.urn)return void 0===a?"":this;"boolean"===typeof a&&(c=a,a=void 0);if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var b=this._parts.hostname.lastIndexOf("."),b=this._parts.hostname.substring(b+1);return!0!==c&&g&&g.list[b.toLowerCase()]?g.get(this._parts.hostname)||b:b}if(a)if(a.match(/[^a-zA-Z0-9-]/))if(g&&g.is(a))b=new RegExp(h(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(b,a);else throw new TypeError('TLD "'+a+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");b=new RegExp(h(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(b,a)}else throw new TypeError("cannot set TLD empty");this.build(!c);return this};f.directory=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var d=this._parts.path.length-this.filename().length-1,d=this._parts.path.substring(0,d)||(this._parts.hostname?"/":"");return a?b.decodePath(d):d}d=this._parts.path.length-this.filename().length;d=this._parts.path.substring(0,d);d=new RegExp("^"+h(d));this.is("relative")||(a||(a="/"),"/"!==a.charAt(0)&&(a="/"+a));a&&"/"!==a.charAt(a.length-1)&&(a+="/");a=b.recodePath(a);this._parts.path=this._parts.path.replace(d,a);this.build(!c);return this};f.filename=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path)return"";var d=this._parts.path.lastIndexOf("/"),d=this._parts.path.substring(d+1);return a?b.decodePathSegment(d):d}d=!1;"/"===a.charAt(0)&&(a=a.substring(1));a.match(/\.?\//)&&(d=!0);var f=new RegExp(h(this.filename())+"$");a=b.recodePath(a);this._parts.path=this._parts.path.replace(f,a);d?this.normalizePath(c):this.build(!c);return this};f.suffix=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path)return"";var d=this.filename(),f=d.lastIndexOf(".");if(-1===f)return"";d=d.substring(f+1);d=/^[a-z0-9%]+$/i.test(d)?d:"";return a?b.decodePathSegment(d):d}"."===a.charAt(0)&&(a=a.substring(1));if(d=this.suffix())f=a?new RegExp(h(d)+"$"):new RegExp(h("."+d)+"$");else{if(!a)return this;this._parts.path+="."+b.recodePath(a)}f&&(a=b.recodePath(a),this._parts.path=this._parts.path.replace(f,a));this.build(!c);return this};f.segment=function(a,c,b){var f=this._parts.urn?":":"/",e=this.path(),k="/"===e.substring(0,1),e=e.split(f);void 0!==a&&"number"!==typeof a&&(b=c,c=a,a=void 0);if(void 0!==a&&"number"!==typeof a)throw Error('Bad segment "'+a+'", must be 0-based integer');k&&e.shift();0>a&&(a=Math.max(e.length+a,0));if(void 0===c)return void 0===a?e:e[a];if(null===a||void 0===e[a])if(w(c)){e=[];a=0;for(var g=c.length;a<g;a++)if(c[a].length||e.length&&e[e.length-1].length)e.length&&!e[e.length-1].length&&e.pop(),e.push(c[a])}else{if(c||"string"===typeof c)""===e[e.length-1]?e[e.length-1]=c:e.push(c)}else c?e[a]=c:e.splice(a,1);k&&e.unshift("");return this.path(e.join(f),b)};f.segmentCoded=function(a,c,d){var f,e;"number"!==typeof a&&(d=c,c=a,a=void 0);if(void 0===c){a=this.segment(a,c,d);if(w(a))for(f=0,e=a.length;f<e;f++)a[f]=b.decode(a[f]);else a=void 0!==a?b.decode(a):void 0;return a}if(w(c))for(f=0,e=c.length;f<e;f++)c[f]=b.encode(c[f]);else c="string"===typeof c||c instanceof String?b.encode(c):c;return this.segment(a,c,d)};var I=f.query;f.query=function(a,c){if(!0===a)return b.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"===typeof a){var d=b.parseQuery(this._parts.query,this._parts.escapeQuerySpace),f=a.call(this,d);this._parts.query=b.buildQuery(f||d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!c);return this}return void 0!==a&&"string"!==typeof a?(this._parts.query=b.buildQuery(a,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!c),this):I.call(this,a,c)};f.setQuery=function(a,c,d){var f=b.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"===typeof a||a instanceof String)f[a]=void 0!==c?c:null;else if("object"===typeof a)for(var e in a)v.call(a,e)&&(f[e]=a[e]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");this._parts.query=b.buildQuery(f,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof a&&(d=c);this.build(!d);return this};f.addQuery=function(a,c,d){var f=b.parseQuery(this._parts.query,this._parts.escapeQuerySpace);b.addQuery(f,a,void 0===c?null:c);this._parts.query=b.buildQuery(f,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof a&&(d=c);this.build(!d);return this};f.removeQuery=function(a,c,d){var f=b.parseQuery(this._parts.query,this._parts.escapeQuerySpace);b.removeQuery(f,a,c);this._parts.query=b.buildQuery(f,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof a&&(d=c);this.build(!d);return this};f.hasQuery=function(a,c,d){var f=b.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return b.hasQuery(f,a,c,d)};f.setSearch=f.setQuery;f.addSearch=f.addQuery;f.removeSearch=f.removeQuery;f.hasSearch=f.hasQuery;f.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()};f.normalizeProtocol=function(a){"string"===typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!a));return this};f.normalizeHostname=function(a){this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&n&&(this._parts.hostname=n.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!a));return this};f.normalizePort=function(a){"string"===typeof this._parts.protocol&&this._parts.port===b.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a));return this};f.normalizePath=function(a){var c=this._parts.path;if(!c)return this;if(this._parts.urn)return this._parts.path=b.recodeUrnPath(this._parts.path),this.build(!a),this;if("/"===this._parts.path)return this;var d,f="",e,k;"/"!==c.charAt(0)&&(d=!0,c="/"+c);if("/.."===c.slice(-3)||"/."===c.slice(-2))c+="/";c=c.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/");d&&(f=c.substring(1).match(/^(\.\.\/)+/)||"")&&(f=f[0]);for(;;){e=c.indexOf("/..");if(-1===e)break;else if(0===e){c=c.substring(3);continue}k=c.substring(0,e).lastIndexOf("/");-1===k&&(k=e);c=c.substring(0,k)+c.substring(e+3)}d&&this.is("relative")&&(c=f+c.substring(1));c=b.recodePath(c);this._parts.path=c;this.build(!a);return this};f.normalizePathname=f.normalizePath;f.normalizeQuery=function(a){"string"===typeof this._parts.query&&(this._parts.query.length?this.query(b.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a));return this};f.normalizeFragment=function(a){this._parts.fragment||(this._parts.fragment=null,this.build(!a));return this};f.normalizeSearch=f.normalizeQuery;f.normalizeHash=f.normalizeFragment;f.iso8859=function(){var a=b.encode,c=b.decode;b.encode=escape;b.decode=decodeURIComponent;try{this.normalize()}finally{b.encode=a,b.decode=c}return this};f.unicode=function(){var a=b.encode,c=b.decode;b.encode=B;b.decode=unescape;try{this.normalize()}finally{b.encode=a,b.decode=c}return this};f.readable=function(){var a=this.clone();a.username("").password("").normalize();var c="";a._parts.protocol&&(c+=a._parts.protocol+"://");a._parts.hostname&&(a.is("punycode")&&e?(c+=e.toUnicode(a._parts.hostname),a._parts.port&&(c+=":"+a._parts.port)):c+=a.host());a._parts.hostname&&a._parts.path&&"/"!==a._parts.path.charAt(0)&&(c+="/");c+=a.path(!0);if(a._parts.query){for(var d="",f=0,k=a._parts.query.split("&"),g=k.length;f<g;f++){var u=(k[f]||"").split("="),d=d+("&"+b.decodeQuery(u[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"));void 0!==u[1]&&(d+="="+b.decodeQuery(u[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}c+="?"+d.substring(1)}return c+=b.decodeQuery(a.hash(),!0)};f.absoluteTo=function(a){var c=this.clone(),d=["protocol","username","password","hostname","port"],f,e;if(this._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");a instanceof b||(a=new b(a));c._parts.protocol||(c._parts.protocol=a._parts.protocol);if(this._parts.hostname)return c;for(f=0;e=d[f];f++)c._parts[e]=a._parts[e];c._parts.path?".."===c._parts.path.substring(-2)&&(c._parts.path+="/"):(c._parts.path=a._parts.path,c._parts.query||(c._parts.query=a._parts.query));"/"!==c.path().charAt(0)&&(d=(d=a.directory())?d:0===a.path().indexOf("/")?"/":"",c._parts.path=(d?d+"/":"")+c._parts.path,c.normalizePath());c.build();return c};f.relativeTo=function(a){var c=this.clone().normalize(),d,f,e;if(c._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");a=new b(a).normalize();d=c._parts;f=a._parts;e=c.path();a=a.path();if("/"!==e.charAt(0))throw Error("URI is already relative");if("/"!==a.charAt(0))throw Error("Cannot calculate a URI relative to another relative URI");d.protocol===f.protocol&&(d.protocol=null);if(d.username===f.username&&d.password===f.password&&null===d.protocol&&null===d.username&&null===d.password&&d.hostname===f.hostname&&d.port===f.port)d.hostname=null,d.port=null;else return c.build();if(e===a)return d.path="",c.build();e=b.commonPath(e,a);if(!e)return c.build();f=f.path.substring(e.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");d.path=f+d.path.substring(e.length)||"./";return c.build()};f.equals=function(a){var c=this.clone();a=new b(a);var d={},f={},e={},k;c.normalize();a.normalize();if(c.toString()===a.toString())return!0;d=c.query();f=a.query();c.query("");a.query("");if(c.toString()!==a.toString()||d.length!==f.length)return!1;d=b.parseQuery(d,this._parts.escapeQuerySpace);f=b.parseQuery(f,this._parts.escapeQuerySpace);for(k in d)if(v.call(d,k)){if(!w(d[k])){if(d[k]!==f[k])return!1}else if(!D(d[k],f[k]))return!1;e[k]=!0}for(k in f)if(v.call(f,k)&&!e[k])return!1;return!0};f.duplicateQueryParameters=function(a){this._parts.duplicateQueryParameters=!!a;return this};f.escapeQuerySpace=function(a){this._parts.escapeQuerySpace=!!a;return this};return b});(function(e,n){"object"===typeof exports?module.exports=n(require("./URI")):"function"===typeof define&&define.amd?define(["./URI"],n):e.URITemplate=n(e.URI,e)})(this,function(e,n){function g(b){if(g._cache[b])return g._cache[b];if(!(this instanceof g))return new g(b);this.expression=b;g._cache[b]=this;return this}function l(b){this.data=b;this.cache={}}var b=n&&n.URITemplate,h=Object.prototype.hasOwnProperty,A=g.prototype,w={"":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encode"},"+":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},"#":{prefix:"#",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},".":{prefix:".",separator:".",named:!1,empty_name_separator:!1,encode:"encode"},"/":{prefix:"/",separator:"/",named:!1,empty_name_separator:!1,encode:"encode"},";":{prefix:";",separator:";",named:!0,empty_name_separator:!1,encode:"encode"},"?":{prefix:"?",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"},"&":{prefix:"&",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"}};g._cache={};g.EXPRESSION_PATTERN=/\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g;g.VARIABLE_PATTERN=/^([^*:]+)((\*)|:(\d+))?$/;g.VARIABLE_NAME_PATTERN=/[^a-zA-Z0-9%_]/;g.expand=function(b,e){var h=w[b.operator],l=h.named?"Named":"Unnamed",n=b.variables,t=[],r,p,f;for(f=0;p=n[f];f++)r=e.get(p.name),r.val.length?t.push(g["expand"+l](r,h,p.explode,p.explode&&h.separator||",",p.maxlength,p.name)):r.type&&t.push("");return t.length?h.prefix+t.join(h.separator):""};g.expandNamed=function(b,g,h,l,n,t){var r="",p=g.encode;g=g.empty_name_separator;var f=!b[p].length,v=2===b.type?"":e[p](t),q,x,w;x=0;for(w=b.val.length;x<w;x++)n?(q=e[p](b.val[x][1].substring(0,n)),2===b.type&&(v=e[p](b.val[x][0].substring(0,n)))):f?(q=e[p](b.val[x][1]),2===b.type?(v=e[p](b.val[x][0]),b[p].push([v,q])):b[p].push([void 0,q])):(q=b[p][x][1],2===b.type&&(v=b[p][x][0])),r&&(r+=l),h?r+=v+(g||q?"=":"")+q:(x||(r+=e[p](t)+(g||q?"=":"")),2===b.type&&(r+=v+","),r+=q);return r};g.expandUnnamed=function(b,g,h,l,n){var t="",r=g.encode;g=g.empty_name_separator;var p=!b[r].length,f,v,q,w;q=0;for(w=b.val.length;q<w;q++)n?v=e[r](b.val[q][1].substring(0,n)):p?(v=e[r](b.val[q][1]),b[r].push([2===b.type?e[r](b.val[q][0]):void 0,v])):v=b[r][q][1],t&&(t+=l),2===b.type&&(f=n?e[r](b.val[q][0].substring(0,n)):b[r][q][0],t+=f,t=h?t+(g||v?"=":""):t+","),t+=v;return t};g.noConflict=function(){n.URITemplate===g&&(n.URITemplate=b);return g};A.expand=function(b){var e="";this.parts&&this.parts.length||this.parse();b instanceof l||(b=new l(b));for(var h=0,n=this.parts.length;h<n;h++)e+="string"===typeof this.parts[h]?this.parts[h]:g.expand(this.parts[h],b);return e};A.parse=function(){var b=this.expression,e=g.EXPRESSION_PATTERN,h=g.VARIABLE_PATTERN,n=g.VARIABLE_NAME_PATTERN,l=[],t=0,r,p,f;for(e.lastIndex=0;;){p=e.exec(b);if(null===p){l.push(b.substring(t));break}else l.push(b.substring(t,p.index)),t=p.index+p[0].length;if(!w[p[1]])throw Error('Unknown Operator "'+p[1]+'" in "'+p[0]+'"');if(!p[3])throw Error('Unclosed Expression "'+p[0]+'"');r=p[2].split(",");for(var v=0,q=r.length;v<q;v++){f=r[v].match(h);if(null===f)throw Error('Invalid Variable "'+r[v]+'" in "'+p[0]+'"');if(f[1].match(n))throw Error('Invalid Variable Name "'+f[1]+'" in "'+p[0]+'"');r[v]={name:f[1],explode:!!f[3],maxlength:f[4]&&parseInt(f[4],10)}}if(!r.length)throw Error('Expression Missing Variable(s) "'+p[0]+'"');l.push({expression:p[0],operator:p[1],variables:r})}l.length||l.push(b);this.parts=l;return this};l.prototype.get=function(b){var e=this.data,g={type:0,val:[],encode:[],encodeReserved:[]},l;if(void 0!==this.cache[b])return this.cache[b];this.cache[b]=g;e="[object Function]"===String(Object.prototype.toString.call(e))?e(b):"[object Function]"===String(Object.prototype.toString.call(e[b]))?e[b](b):e[b];if(void 0!==e&&null!==e)if("[object Array]"===String(Object.prototype.toString.call(e))){l=0;for(b=e.length;l<b;l++)void 0!==e[l]&&null!==e[l]&&g.val.push([void 0,String(e[l])]);g.val.length&&(g.type=3)}else if("[object Object]"===String(Object.prototype.toString.call(e))){for(l in e)h.call(e,l)&&void 0!==e[l]&&null!==e[l]&&g.val.push([l,String(e[l])]);g.val.length&&(g.type=2)}else g.type=1,g.val.push([void 0,String(e)]);return g};e.expand=function(b,h){var l=new g(b).expand(h);return new e(l)};return g});var ChemDoodle=function(){var b={iChemLabs:{},informatics:{},io:{},lib:{},notations:{},structures:{}};b.structures.d2={};b.structures.d3={};b.getVersion=function(){return"7.0.1"};return b}();(function(b,j,o){function l(z){var c=z.length,a=m.type(z);return m.isWindow(z)?!1:1===z.nodeType&&c?!0:"array"===a||"function"!==a&&(0===c||"number"===typeof c&&0<c&&c-1 in z)}function h(z,c,a,d){if(m.acceptData(z)){var k=m.expando,e=z.nodeType,f=e?m.cache:z,b=e?z[k]:z[k]&&k;if(b&&f[b]&&(d||f[b].data)||!(a===o&&"string"===typeof c)){b||(b=e?z[k]=ga.pop()||m.guid++:k);f[b]||(f[b]=e?{}:{toJSON:m.noop});if("object"===typeof c||"function"===typeof c)d?f[b]=m.extend(f[b],c):f[b].data=m.extend(f[b].data,c);z=f[b];d||(z.data||(z.data={}),z=z.data);a!==o&&(z[m.camelCase(c)]=a);"string"===typeof c?(a=z[c],null==a&&(a=z[m.camelCase(c)])):a=z;return a}}}function g(z,c,d){if(m.acceptData(z)){var k,f,e=z.nodeType,b=e?m.cache:z,g=e?z[m.expando]:m.expando;if(b[g]){if(c&&(k=d?b[g]:b[g].data)){m.isArray(c)?c=c.concat(m.map(c,m.camelCase)):c in k?c=[c]:(c=m.camelCase(c),c=c in k?[c]:c.split(" "));for(f=c.length;f--;)delete k[c[f]];if(d?!a(k):!m.isEmptyObject(k))return}if(!d&&(delete b[g].data,!a(b[g])))return;e?m.cleanData([z],!0):m.support.deleteExpando||b!=b.window?delete b[g]:b[g]=null}}}function e(z,c,a){if(a===o&&1===z.nodeType)if(a="data-"+c.replace(yc,"-$1").toLowerCase(),a=z.getAttribute(a),"string"===typeof a){try{a="true"===a?!0:"false"===a?!1:"null"===a?null:+a+""===a?+a:zc.test(a)?m.parseJSON(a):a}catch(d){}m.data(z,c,a)}else a=o;return a}function a(z){for(var c in z)if(!("data"===c&&m.isEmptyObject(z[c]))&&"toJSON"!==c)return!1;return!0}function d(){return!0}function n(){return!1}function f(){try{return K.activeElement}catch(z){}}function y(z,c){do{z=z[c]}while(z&&1!==z.nodeType);return z}function p(z,c,a){if(m.isFunction(c))return m.grep(z,function(z,d){return!!c.call(z,d,z)!==a});if(c.nodeType)return m.grep(z,function(z){return z===c!==a});if("string"===typeof c){if(Ac.test(c))return m.filter(c,z,a);c=m.filter(c,z)}return m.grep(z,function(z){return 0<=m.inArray(z,c)!==a})}function q(z){var c=Nb.split("|");z=z.createDocumentFragment();if(z.createElement)for(;c.length;)z.createElement(c.pop());return z}function A(z,c){return m.nodeName(z,"table")&&m.nodeName(1===c.nodeType?c:c.firstChild,"tr")?z.getElementsByTagName("tbody")[0]||z.appendChild(z.ownerDocument.createElement("tbody")):z}function r(z){z.type=(null!==m.find.attr(z,"type"))+"/"+z.type;return z}function v(z){var c=Bc.exec(z.type);c?z.type=c[1]:z.removeAttribute("type");return z}function u(z,c){for(var a,d=0;null!=(a=z[d]);d++)m._data(a,"globalEval",!c||m._data(c[d],"globalEval"))}function t(z,c){if(1===c.nodeType&&m.hasData(z)){var a,d,k;d=m._data(z);var f=m._data(c,d),e=d.events;if(e)for(a in delete f.handle,f.events={},e){d=0;for(k=e[a].length;d<k;d++)m.event.add(c,a,e[a][d])}f.data&&(f.data=m.extend({},f.data))}}function w(z,c){var a,d,k=0,f=typeof z.getElementsByTagName!==oa?z.getElementsByTagName(c||"*"):typeof z.querySelectorAll!==oa?z.querySelectorAll(c||"*"):o;if(!f){f=[];for(a=z.childNodes||z;null!=(d=a[k]);k++)!c||m.nodeName(d,c)?f.push(d):m.merge(f,w(d,c))}return c===o||c&&m.nodeName(z,c)?m.merge([z],f):f}function x(z){mb.test(z.type)&&(z.defaultChecked=z.checked)}function B(z,c){if(c in z)return c;for(var a=c.charAt(0).toUpperCase()+c.slice(1),d=c,k=Ob.length;k--;)if(c=Ob[k]+a,c in z)return c;return d}function c(z,c){z=c||z;return"none"===m.css(z,"display")||!m.contains(z.ownerDocument,z)}function k(z,a){for(var d,k,f,e=[],b=0,g=z.length;b<g;b++)if(k=z[b],k.style)if(e[b]=m._data(k,"olddisplay"),d=k.style.display,a)!e[b]&&"none"===d&&(k.style.display=""),""===k.style.display&&c(k)&&(e[b]=m._data(k,"olddisplay",E(k.nodeName)));else if(!e[b]&&(f=c(k),d&&"none"!==d||!f))m._data(k,"olddisplay",f?d:m.css(k,"display"));for(b=0;b<g;b++)if(k=z[b],k.style&&(!a||"none"===k.style.display||""===k.style.display))k.style.display=a?e[b]||"":"none";return z}function C(z,c,a){return(z=Cc.exec(c))?Math.max(0,z[1]-(a||0))+(z[2]||"px"):c}function D(z,c,a,d,k){c=a===(d?"border":"content")?4:"width"===c?1:0;for(var f=0;4>c;c+=2)"margin"===a&&(f+=m.css(z,a+Aa[c],!0,k)),d?("content"===a&&(f-=m.css(z,"padding"+Aa[c],!0,k)),"margin"!==a&&(f-=m.css(z,"border"+Aa[c]+"Width",!0,k))):(f+=m.css(z,"padding"+Aa[c],!0,k),"padding"!==a&&(f+=m.css(z,"border"+Aa[c]+"Width",!0,k)));return f}function G(z,c,a){var d=!0,k="width"===c?z.offsetWidth:z.offsetHeight,f=Ba(z),e=m.support.boxSizing&&"border-box"===m.css(z,"boxSizing",!1,f);if(0>=k||null==k){k=Ca(z,c,f);if(0>k||null==k)k=z.style[c];if(Wa.test(k))return k;d=e&&(m.support.boxSizingReliable||k===z.style[c]);k=parseFloat(k)||0}return k+D(z,c,a||(e?"border":"content"),d,f)+"px"}function E(z){var c=K,a=Pb[z];if(!a){a=H(z,c);if("none"===a||!a)Ra=(Ra||m("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(c.documentElement),c=(Ra[0].contentWindow||Ra[0].contentDocument).document,c.write("<!doctype html><html><body>"),c.close(),a=H(z,c),Ra.detach();Pb[z]=a}return a}function H(z,c){var a=m(c.createElement(z)).appendTo(c.body),d=m.css(a[0],"display");a.remove();return d}function I(z,c,a,d){var k;if(m.isArray(c))m.each(c,function(c,k){a||Dc.test(z)?d(z,k):I(z+"["+("object"===typeof k?c:"")+"]",k,a,d)});else if(!a&&"object"===m.type(c))for(k in c)I(z+"["+k+"]",c[k],a,d);else d(z,c)}function M(z){return function(c,a){"string"!==typeof c&&(a=c,c="*");var d,k=0,f=c.toLowerCase().match(pa)||[];if(m.isFunction(a))for(;d=f[k++];)"+"===d[0]?(d=d.slice(1)||"*",(z[d]=z[d]||[]).unshift(a)):(z[d]=z[d]||[]).push(a)}}function J(z,c,a,d){function k(b){var g;f[b]=!0;m.each(z[b]||[],function(z,b){var n=b(c,a,d);if("string"===typeof n&&!e&&!f[n])return c.dataTypes.unshift(n),k(n),!1;if(e)return!(g=n)});return g}var f={},e=z===nb;return k(c.dataTypes[0])||!f["*"]&&k("*")}function T(z,c){var a,d,k=m.ajaxSettings.flatOptions||{};for(d in c)c[d]!==o&&((k[d]?z:a||(a={}))[d]=c[d]);a&&m.extend(!0,z,a);return z}function F(){try{return new b.XMLHttpRequest}catch(z){}}function W(){setTimeout(function(){La=o});return La=m.now()}function R(z,c,a){for(var d,k=(Sa[c]||[]).concat(Sa["*"]),f=0,e=k.length;f<e;f++)if(d=k[f].call(a,c,z))return d}function O(z,c,a){var d,k,f=0,e=Xa.length,b=m.Deferred().always(function(){delete g.elem}),g=function(){if(k)return!1;for(var c=La||W(),c=Math.max(0,n.startTime+n.duration-c),a=1-(c/n.duration||0),d=0,f=n.tweens.length;d<f;d++)n.tweens[d].run(a);b.notifyWith(z,[n,a,c]);if(1>a&&f)return c;b.resolveWith(z,[n]);return!1},n=b.promise({elem:z,props:m.extend({},c),opts:m.extend(!0,{specialEasing:{}},a),originalProperties:c,originalOptions:a,startTime:La||W(),duration:a.duration,tweens:[],createTween:function(c,a){var d=m.Tween(z,n.opts,c,a,n.opts.specialEasing[c]||n.opts.easing);n.tweens.push(d);return d},stop:function(c){var a=0,d=c?n.tweens.length:0;if(k)return this;for(k=!0;a<d;a++)n.tweens[a].run(1);c?b.resolveWith(z,[n,c]):b.rejectWith(z,[n,c]);return this}});c=n.props;a=n.opts.specialEasing;var p,y,h,j;for(d in c)if(p=m.camelCase(d),y=a[p],h=c[d],m.isArray(h)&&(y=h[1],h=c[d]=h[0]),d!==p&&(c[p]=h,delete c[d]),(j=m.cssHooks[p])&&"expand"in j)for(d in h=j.expand(h),delete c[p],h)d in c||(c[d]=h[d],a[d]=y);else a[p]=y;for(;f<e;f++)if(d=Xa[f].call(n,z,c,n.opts))return d;m.map(c,R,n);m.isFunction(n.opts.start)&&n.opts.start.call(z,n);m.fx.timer(m.extend(g,{elem:z,anim:n,queue:n.opts.queue}));return n.progress(n.opts.progress).done(n.opts.done,n.opts.complete).fail(n.opts.fail).always(n.opts.always)}function L(z,c,a,d,k){return new L.prototype.init(z,c,a,d,k)}function Z(z,c){var a,d={height:z},k=0;for(c=c?1:0;4>k;k+=2-c)a=Aa[k],d["margin"+a]=d["padding"+a]=z;c&&(d.opacity=d.width=z);return d}function Da(z){return m.isWindow(z)?z:9===z.nodeType?z.defaultView||z.parentWindow:!1}var ka,$,oa=typeof o,Fc=b.location,K=b.document,ca=K.documentElement,da=b.jQuery,ea=b.$,Y={},ga=[],sa=ga.concat,qa=ga.push,U=ga.slice,Qb=ga.indexOf,Gc=Y.toString,Ma=Y.hasOwnProperty,ob="1.10.2".trim,m=function(z,c){return new m.fn.init(z,c,$)},Ya=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,pa=/\S+/g,Hc=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,Ic=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,Rb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Jc=/^[\],:{}\s]*$/,Kc=/(?:^|:|,)(?:\s*\[)+/g,Lc=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,Mc=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,Nc=/^-ms-/,Oc=/-([\da-z])/gi,Pc=function(z,c){return c.toUpperCase()},ta=function(z){if(K.addEventListener||"load"===z.type||"complete"===K.readyState)Sb(),m.ready()},Sb=function(){K.addEventListener?(K.removeEventListener("DOMContentLoaded",ta,!1),b.removeEventListener("load",ta,!1)):(K.detachEvent("onreadystatechange",ta),b.detachEvent("onload",ta))};m.fn=m.prototype={jquery:"1.10.2",constructor:m,init:function(z,c,a){var d;if(!z)return this;if("string"===typeof z){if((d="<"===z.charAt(0)&&">"===z.charAt(z.length-1)&&3<=z.length?[null,z,null]:Ic.exec(z))&&(d[1]||!c)){if(d[1]){if(c=c instanceof m?c[0]:c,m.merge(this,m.parseHTML(d[1],c&&c.nodeType?c.ownerDocument||c:K,!0)),Rb.test(d[1])&&m.isPlainObject(c))for(d in c)if(m.isFunction(this[d]))this[d](c[d]);else this.attr(d,c[d])}else{if((c=K.getElementById(d[2]))&&c.parentNode){if(c.id!==d[2])return a.find(z);this.length=1;this[0]=c}this.context=K;this.selector=z}return this}return!c||c.jquery?(c||a).find(z):this.constructor(c).find(z)}if(z.nodeType)return this.context=this[0]=z,this.length=1,this;if(m.isFunction(z))return a.ready(z);z.selector!==o&&(this.selector=z.selector,this.context=z.context);return m.makeArray(z,this)},selector:"",length:0,toArray:function(){return U.call(this)},get:function(z){return null==z?this.toArray():0>z?this[this.length+z]:this[z]},pushStack:function(z){z=m.merge(this.constructor(),z);z.prevObject=this;z.context=this.context;return z},each:function(z,c){return m.each(this,z,c)},ready:function(z){m.ready.promise().done(z);return this},slice:function(){return this.pushStack(U.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(z){var c=this.length;z=+z+(0>z?c:0);return this.pushStack(0<=z&&z<c?[this[z]]:[])},map:function(z){return this.pushStack(m.map(this,function(c,a){return z.call(c,a,c)}))},end:function(){return this.prevObject||this.constructor(null)},push:qa,sort:[].sort,splice:[].splice};m.fn.init.prototype=m.fn;m.extend=m.fn.extend=function(){var z,c,a,d,k,f=arguments[0]||{},e=1,b=arguments.length,n=!1;"boolean"===typeof f&&(n=f,f=arguments[1]||{},e=2);"object"!==typeof f&&!m.isFunction(f)&&(f={});b===e&&(f=this,--e);for(;e<b;e++)if(null!=(k=arguments[e]))for(d in k)z=f[d],a=k[d],
f!==a&&(n&&a&&(m.isPlainObject(a)||(c=m.isArray(a)))?(c?(c=!1,z=z&&m.isArray(z)?z:[]):z=z&&m.isPlainObject(z)?z:{},f[d]=m.extend(n,z,a)):a!==o&&(f[d]=a));return f};m.extend({expando:"jQuery"+("1.10.2"+Math.random()).replace(/\D/g,""),noConflict:function(c){b.$===m&&(b.$=ea);c&&b.jQuery===m&&(b.jQuery=da);return m},isReady:!1,readyWait:1,holdReady:function(c){c?m.readyWait++:m.ready(!0)},ready:function(c){if(!(!0===c?--m.readyWait:m.isReady)){if(!K.body)return setTimeout(m.ready);m.isReady=!0;!0!==c&&0<--m.readyWait||(ka.resolveWith(K,[m]),m.fn.trigger&&m(K).trigger("ready").off("ready"))}},isFunction:function(c){return"function"===m.type(c)},isArray:Array.isArray||function(c){return"array"===m.type(c)},isWindow:function(c){return null!=c&&c==c.window},isNumeric:function(c){return!isNaN(parseFloat(c))&&isFinite(c)},type:function(c){return null==c?String(c):"object"===typeof c||"function"===typeof c?Y[Gc.call(c)]||"object":typeof c},isPlainObject:function(c){var a;if(!c||"object"!==m.type(c)||c.nodeType||m.isWindow(c))return!1;try{if(c.constructor&&!Ma.call(c,"constructor")&&!Ma.call(c.constructor.prototype,"isPrototypeOf"))return!1}catch(d){return!1}if(m.support.ownLast)for(a in c)return Ma.call(c,a);for(a in c);return a===o||Ma.call(c,a)},isEmptyObject:function(c){for(var a in c)return!1;return!0},error:function(c){throw Error(c)},parseHTML:function(c,a,d){if(!c||"string"!==typeof c)return null;"boolean"===typeof a&&(d=a,a=!1);a=a||K;var k=Rb.exec(c);d=!d&&[];if(k)return[a.createElement(k[1])];k=m.buildFragment([c],a,d);d&&m(d).remove();return m.merge([],k.childNodes)},parseJSON:function(c){if(b.JSON&&b.JSON.parse)return b.JSON.parse(c);if(null===c)return c;if("string"===typeof c&&(c=m.trim(c))&&Jc.test(c.replace(Lc,"@").replace(Mc,"]").replace(Kc,"")))return new Function("return "+c)();m.error("Invalid JSON: "+c)},parseXML:function(c){var a,d;if(!c||"string"!==typeof c)return null;try{b.DOMParser?(d=new DOMParser,a=d.parseFromString(c,"text/xml")):(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(c))}catch(k){a=o}(!a||!a.documentElement||a.getElementsByTagName("parsererror").length)&&m.error("Invalid XML: "+c);return a},noop:function(){},globalEval:function(c){c&&m.trim(c)&&(b.execScript||function(c){b.eval.call(b,c)})(c)},camelCase:function(c){return c.replace(Nc,"ms-").replace(Oc,Pc)},nodeName:function(c,a){return c.nodeName&&c.nodeName.toLowerCase()===a.toLowerCase()},each:function(c,a,d){var k,f=0,e=c.length;k=l(c);if(d)if(k)for(;f<e&&!(k=a.apply(c[f],d),!1===k);f++);else for(f in c){if(k=a.apply(c[f],d),!1===k)break}else if(k)for(;f<e&&!(k=a.call(c[f],f,c[f]),!1===k);f++);else for(f in c)if(k=a.call(c[f],f,c[f]),!1===k)break;return c},trim:ob&&!ob.call("\ufeff ")?function(c){return null==c?"":ob.call(c)}:function(c){return null==c?"":(c+"").replace(Hc,"")},makeArray:function(c,a){var d=a||[];null!=c&&(l(Object(c))?m.merge(d,"string"===typeof c?[c]:c):qa.call(d,c));return d},inArray:function(c,a,d){var k;if(a){if(Qb)return Qb.call(a,c,d);k=a.length;for(d=d?0>d?Math.max(0,k+d):d:0;d<k;d++)if(d in a&&a[d]===c)return d}return-1},merge:function(c,a){var d=a.length,k=c.length,f=0;if("number"===typeof d)for(;f<d;f++)c[k++]=a[f];else for(;a[f]!==o;)c[k++]=a[f++];c.length=k;return c},grep:function(c,a,d){var k,f=[],e=0,b=c.length;for(d=!!d;e<b;e++)k=!!a(c[e],e),d!==k&&f.push(c[e]);return f},map:function(c,a,d){var k,f=0,e=c.length,b=[];if(l(c))for(;f<e;f++)k=a(c[f],f,d),null!=k&&(b[b.length]=k);else for(f in c)k=a(c[f],f,d),null!=k&&(b[b.length]=k);return sa.apply([],b)},guid:1,proxy:function(c,a){var d,k;"string"===typeof a&&(k=c[a],a=c,c=k);if(!m.isFunction(c))return o;d=U.call(arguments,2);k=function(){return c.apply(a||this,d.concat(U.call(arguments)))};k.guid=c.guid=c.guid||m.guid++;return k},access:function(c,a,d,k,f,e,b){var n=0,g=c.length,p=null==d;if("object"===m.type(d))for(n in f=!0,d)m.access(c,a,n,d[n],!0,e,b);else if(k!==o&&(f=!0,m.isFunction(k)||(b=!0),p&&(b?(a.call(c,k),a=null):(p=a,a=function(c,a,z){return p.call(m(c),z)})),a))for(;n<g;n++)a(c[n],d,b?k:k.call(c[n],n,a(c[n],d)));return f?c:p?a.call(c):g?a(c[0],d):e},now:function(){return(new Date).getTime()},swap:function(c,a,d,k){var f,e={};for(f in a)e[f]=c.style[f],c.style[f]=a[f];d=d.apply(c,k||[]);for(f in a)c.style[f]=e[f];return d}});m.ready.promise=function(c){if(!ka)if(ka=m.Deferred(),"complete"===K.readyState)setTimeout(m.ready);else if(K.addEventListener)K.addEventListener("DOMContentLoaded",ta,!1),b.addEventListener("load",ta,!1);else{K.attachEvent("onreadystatechange",ta);b.attachEvent("onload",ta);var a=!1;try{a=null==b.frameElement&&K.documentElement}catch(d){}a&&a.doScroll&&function xc(){if(!m.isReady){try{a.doScroll("left")}catch(c){return setTimeout(xc,50)}Sb();m.ready()}}()}return ka.promise(c)};m.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(c,a){Y["[object "+a+"]"]=a.toLowerCase()});$=m(K);var pb=b,S=function(c,a,d,k){var f,e,b,n,g;(a?a.ownerDocument||a:ra)!==aa&&Ea(a);a=a||aa;d=d||[];if(!c||"string"!==typeof c)return d;if(1!==(n=a.nodeType)&&9!==n)return[];if(la&&!k){if(f=Qc.exec(c))if(b=f[1])if(9===n)if((e=a.getElementById(b))&&e.parentNode){if(e.id===b)return d.push(e),d}else return d;else{if(a.ownerDocument&&(e=a.ownerDocument.getElementById(b))&&Ta(a,e)&&e.id===b)return d.push(e),d}else{if(f[2])return ua.apply(d,a.getElementsByTagName(c)),d;if((b=f[3])&&V.getElementsByClassName&&a.getElementsByClassName)return ua.apply(d,a.getElementsByClassName(b)),d}if(V.qsa&&(!fa||!fa.test(c))){e=f=X;b=a;g=9===n&&c;if(1===n&&"object"!==a.nodeName.toLowerCase()){n=Za(c);(f=a.getAttribute("id"))?e=f.replace(Rc,"\\$&"):a.setAttribute("id",e);e="[id='"+e+"'] ";for(b=n.length;b--;)n[b]=e+$a(n[b]);b=qb.test(c)&&a.parentNode||a;g=n.join(",")}if(g)try{return ua.apply(d,b.querySelectorAll(g)),d}catch(p){}finally{f||a.removeAttribute("id")}}}var y;a:{c=c.replace(ab,"$1");e=Za(c);if(!k&&1===e.length){f=e[0]=e[0].slice(0);if(2<f.length&&"ID"===(y=f[0]).type&&V.getById&&9===a.nodeType&&la&&Q.relative[f[1].type]){a=(Q.find.ID(y.matches[0].replace(va,wa),a)||[])[0];if(!a){y=d;break a}c=c.slice(f.shift().value.length)}for(n=bb.needsContext.test(c)?0:f.length;n--;){y=f[n];if(Q.relative[b=y.type])break;if(b=Q.find[b])if(k=b(y.matches[0].replace(va,wa),qb.test(f[0].type)&&a.parentNode||a)){f.splice(n,1);c=k.length&&$a(f);if(!c){ua.apply(d,k);y=d;break a}break}}}rb(c,e)(k,a,!la,d,qb.test(c));y=d}return y},sb=function(){function c(d,k){a.push(d+=" ")>Q.cacheLength&&delete c[a.shift()];return c[d]=k}var a=[];return c},ia=function(c){c[X]=!0;return c},ja=function(c){var a=aa.createElement("div");try{return!!c(a)}catch(d){return!1}finally{a.parentNode&&a.parentNode.removeChild(a)}},tb=function(c,a){for(var d=c.split("|"),k=c.length;k--;)Q.attrHandle[d[k]]=a},Ub=function(c,a){var d=a&&c,k=d&&1===c.nodeType&&1===a.nodeType&&(~a.sourceIndex||Tb)-(~c.sourceIndex||Tb);if(k)return k;if(d)for(;d=d.nextSibling;)if(d===a)return-1;return c?1:-1},Sc=function(c){return function(a){return"input"===a.nodeName.toLowerCase()&&a.type===c}},Tc=function(c){return function(a){var d=a.nodeName.toLowerCase();return("input"===d||"button"===d)&&a.type===c}},Fa=function(c){return ia(function(a){a=+a;return ia(function(d,k){for(var f,e=c([],d.length,a),b=e.length;b--;)if(d[f=e[b]])d[f]=!(k[f]=d[f])})})},Vb=function(){},Za=function(c,a){var d,k,f,e,b,n,g;if(b=Wb[c+" "])return a?0:b.slice(0);b=c;n=[];for(g=Q.preFilter;b;){if(!d||(k=Uc.exec(b)))k&&(b=b.slice(k[0].length)||b),n.push(f=[]);d=!1;if(k=Vc.exec(b))d=k.shift(),f.push({value:d,type:k[0].replace(ab," ")}),b=b.slice(d.length);for(e in Q.filter)if((k=bb[e].exec(b))&&(!g[e]||(k=g[e](k))))d=k.shift(),f.push({value:d,type:e,matches:k}),b=b.slice(d.length);if(!d)break}return a?b.length:b?S.error(c):Wb(c,n).slice(0)},$a=function(c){for(var a=0,d=c.length,k="";a<d;a++)k+=c[a].value;return k},ub=function(c,a,d){var k=a.dir,f=d&&"parentNode"===k,e=Wc++;return a.first?function(a,d,e){for(;a=a[k];)if(1===a.nodeType||f)return c(a,d,e)}:function(a,d,b){var n,g,p,y=ma+" "+e;if(b)for(;a=a[k];){if((1===a.nodeType||f)&&c(a,d,b))return!0}else for(;a=a[k];)if(1===a.nodeType||f)if(p=a[X]||(a[X]={}),(g=p[k])&&g[0]===y){if(!0===(n=g[1])||n===cb)return!0===n}else if(g=p[k]=[y],g[1]=c(a,d,b)||cb,!0===g[1])return!0}},vb=function(c){return 1<c.length?function(a,d,k){for(var f=c.length;f--;)if(!c[f](a,d,k))return!1;return!0}:c[0]},db=function(c,a,d,k,f){for(var e,b=[],n=0,g=c.length,p=null!=a;n<g;n++)if(e=c[n])if(!d||d(e,k,f))b.push(e),p&&a.push(n);return b},wb=function(c,a,d,k,f,e){k&&!k[X]&&(k=wb(k));f&&!f[X]&&(f=wb(f,e));return ia(function(e,b,n,g){var p,y,h=[],j=[],q=b.length,l;if(!(l=e)){l=a||"*";for(var C=n.nodeType?[n]:n,m=[],r=0,o=C.length;r<o;r++)S(l,C[r],m);l=m}l=c&&(e||!a)?db(l,h,c,n,g):l;C=d?f||(e?c:q||k)?[]:b:l;d&&d(l,C,n,g);if(k){p=db(C,j);k(p,[],n,g);for(n=p.length;n--;)if(y=p[n])C[j[n]]=!(l[j[n]]=y)}if(e){if(f||c){if(f){p=[];for(n=C.length;n--;)if(y=C[n])p.push(l[n]=y);f(null,C=[],p,g)}for(n=C.length;n--;)if((y=C[n])&&-1<(p=f?Ga.call(e,y):h[n]))e[p]=!(b[p]=y)}}else C=db(C===b?C.splice(q,C.length):C),f?f(null,b,C,g):ua.apply(b,C)})},xb=function(c){var a,d,k,f=c.length,e=Q.relative[c[0].type];d=e||Q.relative[" "];for(var b=e?1:0,n=ub(function(c){return c===a},d,!0),g=ub(function(c){return-1<Ga.call(a,c)},d,!0),p=[function(c,d,z){return!e&&(z||d!==eb)||((a=d).nodeType?n(c,d,z):g(c,d,z))}];b<f;b++)if(d=Q.relative[c[b].type])p=[ub(vb(p),d)];else{d=Q.filter[c[b].type].apply(null,c[b].matches);if(d[X]){for(k=++b;k<f&&!Q.relative[c[k].type];k++);return wb(1<b&&vb(p),1<b&&$a(c.slice(0,b-1).concat({value:" "===c[b-2].type?"*":""})).replace(ab,"$1"),d,b<k&&xb(c.slice(b,k)),k<f&&xb(c=c.slice(k)),k<f&&$a(c))}p.push(d)}return vb(p)},Na,V,cb,Q,fb,Xb,rb,eb,Ha,Ea,aa,na,la,fa,Ia,gb,Ta,X="sizzle"+-new Date,ra=pb.document,ma=0,Wc=0,Yb=sb(),Wb=sb(),Zb=sb(),Oa=!1,yb=function(c,a){c===a&&(Oa=!0);return 0},Tb=-2147483648,Xc={}.hasOwnProperty,xa=[],Yc=xa.pop,Zc=xa.push,ua=xa.push,$b=xa.slice,Ga=xa.indexOf||function(c){for(var a=0,d=this.length;a<d;a++)if(this[a]===c)return a;return-1},ac="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+".replace("w","w#"),bc="\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[\\w-]|[^\\x00-\\xa0])+)[\\x20\\t\\r\\n\\f]*(?:([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ac+")|)|)[\\x20\\t\\r\\n\\f]*\\]",zb=":((?:\\\\.|[\\w-]|[^\\x00-\\xa0])+)(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+bc.replace(3,8)+")*)|.*)\\)|)",ab=RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),Uc=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,Vc=/^[\x20\t\r\n\f]*([>+~]|[\x20\t\r\n\f])[\x20\t\r\n\f]*/,qb=/[\x20\t\r\n\f]*[+~]/,$c=RegExp("=[\\x20\\t\\r\\n\\f]*([^\\]'\"]*)[\\x20\\t\\r\\n\\f]*\\]","g"),ad=RegExp(zb),bd=RegExp("^"+ac+"$"),bb={ID:/^#((?:\\.|[\w-]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[\w-]|[^\x00-\xa0])+)/,TAG:RegExp("^("+"(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+".replace("w","w*")+")"),ATTR:RegExp("^"+bc),PSEUDO:RegExp("^"+zb),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:RegExp("^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$","i"),needsContext:RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},Ab=/^[^{]+\{\s*\[native \w/,Qc=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,cd=/^(?:input|select|textarea|button)$/i,dd=/^h\d$/i,Rc=/'|\\/g,va=RegExp("\\\\([\\da-f]{1,6}[\\x20\\t\\r\\n\\f]?|([\\x20\\t\\r\\n\\f])|.)","ig"),wa=function(c,a,d){c="0x"+a-65536;return c!==c||d?a:0>c?String.fromCharCode(c+65536):String.fromCharCode(c>>10|55296,c&1023|56320)};try{ua.apply(xa=$b.call(ra.childNodes),ra.childNodes),xa[ra.childNodes.length].nodeType}catch(Gd){ua={apply:xa.length?function(c,a){Zc.apply(c,$b.call(a))}:function(c,a){for(var d=c.length,k=0;c[d++]=a[k++];);c.length=d-1}}}Xb=S.isXML=function(c){return(c=c&&(c.ownerDocument||c).documentElement)?"HTML"!==c.nodeName:!1};V=S.support={};Ea=S.setDocument=function(c){var a=c?c.ownerDocument||c:ra;c=a.defaultView;if(a===aa||9!==a.nodeType||!a.documentElement)return aa;aa=a;na=a.documentElement;la=!Xb(a);c&&(c.attachEvent&&c!==c.top)&&c.attachEvent("onbeforeunload",function(){Ea()});V.attributes=ja(function(c){c.className="i";return!c.getAttribute("className")});V.getElementsByTagName=ja(function(c){c.appendChild(a.createComment(""));return!c.getElementsByTagName("*").length});V.getElementsByClassName=ja(function(c){c.innerHTML="<div class='a'></div><div class='a i'></div>";c.firstChild.className="i";return 2===c.getElementsByClassName("i").length});V.getById=ja(function(c){na.appendChild(c).id=X;return!a.getElementsByName||!a.getElementsByName(X).length});V.getById?(Q.find.ID=function(c,a){if("undefined"!==typeof a.getElementById&&la){var d=a.getElementById(c);return d&&d.parentNode?[d]:[]}},Q.filter.ID=function(c){var a=c.replace(va,wa);return function(c){return c.getAttribute("id")===a}}):(delete Q.find.ID,Q.filter.ID=function(c){var a=c.replace(va,wa);return function(c){return(c="undefined"!==typeof c.getAttributeNode&&c.getAttributeNode("id"))&&c.value===a}});Q.find.TAG=V.getElementsByTagName?function(c,a){if("undefined"!==typeof a.getElementsByTagName)return a.getElementsByTagName(c)}:function(c,a){var d,k=[],z=0,f=a.getElementsByTagName(c);if("*"===c){for(;d=f[z++];)1===d.nodeType&&k.push(d);return k}return f};Q.find.CLASS=V.getElementsByClassName&&function(c,a){if("undefined"!==typeof a.getElementsByClassName&&la)return a.getElementsByClassName(c)};Ia=[];fa=[];if(V.qsa=Ab.test(a.querySelectorAll))ja(function(c){c.innerHTML="<select><option selected=''></option></select>";c.querySelectorAll("[selected]").length||fa.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)");c.querySelectorAll(":checked").length||fa.push(":checked")}),ja(function(c){var d=a.createElement("input");d.setAttribute("type","hidden");c.appendChild(d).setAttribute("t","");c.querySelectorAll("[t^='']").length&&fa.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")");c.querySelectorAll(":enabled").length||fa.push(":enabled",":disabled");c.querySelectorAll("*,:x");fa.push(",.*:")});(V.matchesSelector=Ab.test(gb=na.webkitMatchesSelector||na.mozMatchesSelector||na.oMatchesSelector||na.msMatchesSelector))&&ja(function(c){V.disconnectedMatch=gb.call(c,"div");gb.call(c,"[s!='']:x");Ia.push("!=",zb)});fa=fa.length&&RegExp(fa.join("|"));Ia=Ia.length&&RegExp(Ia.join("|"));Ta=Ab.test(na.contains)||na.compareDocumentPosition?function(c,a){var d=9===c.nodeType?c.documentElement:c,k=a&&a.parentNode;return c===k||!(!k||!(1===k.nodeType&&(d.contains?d.contains(k):c.compareDocumentPosition&&c.compareDocumentPosition(k)&16)))}:function(c,a){if(a)for(;a=a.parentNode;)if(a===c)return!0;return!1};yb=na.compareDocumentPosition?function(c,d){if(c===d)return Oa=!0,0;var k=d.compareDocumentPosition&&c.compareDocumentPosition&&c.compareDocumentPosition(d);return k?k&1||!V.sortDetached&&d.compareDocumentPosition(c)===k?c===a||Ta(ra,c)?-1:d===a||Ta(ra,d)?1:Ha?Ga.call(Ha,c)-Ga.call(Ha,d):0:k&4?-1:1:c.compareDocumentPosition?-1:1}:function(c,d){var k,z=0;k=c.parentNode;var f=d.parentNode,e=[c],b=[d];if(c===d)return Oa=!0,0;if(!k||!f)return c===a?-1:d===a?1:k?-1:f?1:Ha?Ga.call(Ha,c)-Ga.call(Ha,d):0;if(k===f)return Ub(c,d);for(k=c;k=k.parentNode;)e.unshift(k);for(k=d;k=k.parentNode;)b.unshift(k);for(;e[z]===b[z];)z++;return z?Ub(e[z],b[z]):e[z]===ra?-1:b[z]===ra?1:0};return a};S.matches=function(c,a){return S(c,null,null,a)};S.matchesSelector=function(c,a){(c.ownerDocument||c)!==aa&&Ea(c);a=a.replace($c,"='$1']");if(V.matchesSelector&&la&&(!Ia||!Ia.test(a))&&(!fa||!fa.test(a)))try{var d=gb.call(c,a);if(d||V.disconnectedMatch||c.document&&11!==c.document.nodeType)return d}catch(k){}return 0<S(a,aa,null,[c]).length};S.contains=function(c,a){(c.ownerDocument||c)!==aa&&Ea(c);return Ta(c,a)};S.attr=function(c,a){(c.ownerDocument||c)!==aa&&Ea(c);var d=Q.attrHandle[a.toLowerCase()],d=d&&Xc.call(Q.attrHandle,a.toLowerCase())?d(c,a,!la):void 0;return void 0===d?V.attributes||!la?c.getAttribute(a):(d=c.getAttributeNode(a))&&d.specified?d.value:null:d};S.error=function(c){throw Error("Syntax error, unrecognized expression: "+c)};S.uniqueSort=function(c){var a,d=[],k=0,f=0;Oa=!V.detectDuplicates;Ha=!V.sortStable&&c.slice(0);c.sort(yb);if(Oa){for(;a=c[f++];)a===c[f]&&(k=d.push(f));for(;k--;)c.splice(d[k],1)}return c};fb=S.getText=function(c){var a,d="",k=0;if(a=c.nodeType)if(1===a||9===a||11===a){if("string"===typeof c.textContent)return c.textContent;for(c=c.firstChild;c;c=c.nextSibling)d+=fb(c)}else{if(3===a||4===a)return c.nodeValue}else for(;a=c[k];k++)d+=fb(a);return d};Q=S.selectors={cacheLength:50,createPseudo:ia,match:bb,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(c){c[1]=c[1].replace(va,wa);c[3]=(c[4]||c[5]||"").replace(va,wa);"~="===c[2]&&(c[3]=" "+c[3]+" ");return c.slice(0,4)},CHILD:function(c){c[1]=c[1].toLowerCase();"nth"===c[1].slice(0,3)?(c[3]||S.error(c[0]),c[4]=+(c[4]?c[5]+(c[6]||1):2*("even"===c[3]||"odd"===c[3])),c[5]=+(c[7]+c[8]||"odd"===c[3])):c[3]&&S.error(c[0]);return c},PSEUDO:function(c){var a,d=!c[5]&&c[2];if(bb.CHILD.test(c[0]))return null;if(c[3]&&void 0!==c[4])c[2]=c[4];else if(d&&ad.test(d)&&(a=Za(d,!0))&&(a=d.indexOf(")",d.length-a)-d.length))c[0]=c[0].slice(0,a),c[2]=d.slice(0,a);return c.slice(0,3)}},filter:{TAG:function(c){var a=c.replace(va,wa).toLowerCase();return"*"===c?function(){return!0}:function(c){return c.nodeName&&c.nodeName.toLowerCase()===a}},CLASS:function(c){var a=Yb[c+" "];return a||(a=RegExp("(^|[\\x20\\t\\r\\n\\f])"+c+"([\\x20\\t\\r\\n\\f]|$)"))&&Yb(c,function(c){return a.test("string"===typeof c.className&&c.className||"undefined"!==typeof c.getAttribute&&c.getAttribute("class")||"")})},ATTR:function(c,a,d){return function(k){k=S.attr(k,c);if(null==k)return"!="===a;if(!a)return!0;k+="";return"="===a?k===d:"!="===a?k!==d:"^="===a?d&&0===k.indexOf(d):"*="===a?d&&-1<k.indexOf(d):"$="===a?d&&k.slice(-d.length)===d:"~="===a?-1<(" "+k+" ").indexOf(d):"|="===a?k===d||k.slice(0,d.length+1)===d+"-":!1}},CHILD:function(c,a,d,k,f){var e="nth"!==c.slice(0,3),b="last"!==c.slice(-4),n="of-type"===a;return 1===k&&0===f?function(c){return!!c.parentNode}:function(a,d,g){var p,y,h,j,q;d=e!==b?"nextSibling":"previousSibling";var l=a.parentNode,C=n&&a.nodeName.toLowerCase();g=!g&&!n;if(l){if(e){for(;d;){for(y=a;y=y[d];)if(n?y.nodeName.toLowerCase()===C:1===y.nodeType)return!1;q=d="only"===c&&!q&&"nextSibling"}return!0}q=[b?l.firstChild:l.lastChild];if(b&&g){g=l[X]||(l[X]={});p=g[c]||[];j=p[0]===ma&&p[1];h=p[0]===ma&&p[2];for(y=j&&l.childNodes[j];y=++j&&y&&y[d]||(h=j=0)||q.pop();)if(1===y.nodeType&&++h&&y===a){g[c]=[ma,j,h];break}}else if(g&&(p=(a[X]||(a[X]={}))[c])&&p[0]===ma)h=p[1];else for(;y=++j&&y&&y[d]||(h=j=0)||q.pop();)if((n?y.nodeName.toLowerCase()===C:1===y.nodeType)&&++h)if(g&&((y[X]||(y[X]={}))[c]=[ma,h]),y===a)break;h-=f;return h===k||0===h%k&&0<=h/k}}},PSEUDO:function(c,a){var d,k=Q.pseudos[c]||Q.setFilters[c.toLowerCase()]||S.error("unsupported pseudo: "+c);return k[X]?k(a):1<k.length?(d=[c,c,"",a],Q.setFilters.hasOwnProperty(c.toLowerCase())?ia(function(c,d){for(var f,e=k(c,a),z=e.length;z--;)f=Ga.call(c,e[z]),c[f]=!(d[f]=e[z])}):function(c){return k(c,0,d)}):k}},pseudos:{not:ia(function(c){var a=[],d=[],k=rb(c.replace(ab,"$1"));return k[X]?ia(function(c,a,d,f){f=k(c,null,f,[]);for(var e=c.length;e--;)if(d=f[e])c[e]=!(a[e]=d)}):function(c,f,e){a[0]=c;k(a,null,e,d);return!d.pop()}}),has:ia(function(c){return function(a){return 0<S(c,a).length}}),contains:ia(function(c){return function(a){return-1<(a.textContent||a.innerText||fb(a)).indexOf(c)}}),lang:ia(function(c){bd.test(c||"")||S.error("unsupported lang: "+c);c=c.replace(va,wa).toLowerCase();return function(a){var d;do{if(d=la?a.lang:a.getAttribute("xml:lang")||a.getAttribute("lang"))return d=d.toLowerCase(),d===c||0===d.indexOf(c+"-")}while((a=a.parentNode)&&1===a.nodeType);return!1}}),target:function(c){var a=pb.location&&pb.location.hash;return a&&a.slice(1)===c.id},root:function(c){return c===na},focus:function(c){return c===aa.activeElement&&(!aa.hasFocus||aa.hasFocus())&&!(!c.type&&!c.href&&!~c.tabIndex)},enabled:function(c){return!1===c.disabled},disabled:function(c){return!0===c.disabled},checked:function(c){var a=c.nodeName.toLowerCase();return"input"===a&&!!c.checked||"option"===a&&!!c.selected},selected:function(c){c.parentNode&&c.parentNode.selectedIndex;return!0===c.selected},empty:function(c){for(c=c.firstChild;c;c=c.nextSibling)if("@"<c.nodeName||3===c.nodeType||4===c.nodeType)return!1;return!0},parent:function(c){return!Q.pseudos.empty(c)},header:function(c){return dd.test(c.nodeName)},input:function(c){return cd.test(c.nodeName)},button:function(c){var a=c.nodeName.toLowerCase();return"input"===a&&"button"===c.type||"button"===a},text:function(c){var a;return"input"===c.nodeName.toLowerCase()&&"text"===c.type&&(null==(a=c.getAttribute("type"))||a.toLowerCase()===c.type)},first:Fa(function(){return[0]}),last:Fa(function(c,a){return[a-1]}),eq:Fa(function(c,a,d){return[0>d?d+a:d]}),even:Fa(function(c,a){for(var d=0;d<a;d+=2)c.push(d);return c}),odd:Fa(function(c,a){for(var d=1;d<a;d+=2)c.push(d);return c}),lt:Fa(function(c,a,d){for(a=0>d?d+a:d;0<=--a;)c.push(a);return c}),gt:Fa(function(c,a,d){for(d=0>d?d+a:d;++d<a;)c.push(d);return c})}};Q.pseudos.nth=Q.pseudos.eq;for(Na in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Q.pseudos[Na]=Sc(Na);for(Na in{submit:!0,reset:!0})Q.pseudos[Na]=Tc(Na);Vb.prototype=Q.filters=Q.pseudos;Q.setFilters=new Vb;rb=S.compile=function(c,a){var d,k=[],f=[],e=Zb[c+" "];if(!e){a||(a=Za(c));for(d=a.length;d--;)e=xb(a[d]),e[X]?k.push(e):f.push(e);var b=0,n=0<k.length,g=0<f.length;d=function(c,a,d,e,z){var p,y,h=[],j=0,q="0",l=c&&[],C=null!=z,m=eb,r=c||g&&Q.find.TAG("*",z&&a.parentNode||a),o=ma+=null==m?1:Math.random()||.1;C&&(eb=a!==aa&&a,cb=b);for(;null!=(z=r[q]);q++){if(g&&z){for(p=0;y=f[p++];)if(y(z,a,d)){e.push(z);break}C&&(ma=o,cb=++b)}n&&((z=!y&&z)&&j--,c&&l.push(z))}j+=q;if(n&&q!==j){for(p=0;y=k[p++];)y(l,h,a,d);if(c){if(0<j)for(;q--;)!l[q]&&!h[q]&&(h[q]=Yc.call(e));h=db(h)}ua.apply(e,h);C&&(!c&&0<h.length&&1<j+k.length)&&S.uniqueSort(e)}C&&(ma=o,eb=m);return l};d=n?ia(d):d;e=Zb(c,d)}return e};V.sortStable=X.split("").sort(yb).join("")===X;V.detectDuplicates=Oa;Ea();V.sortDetached=ja(function(c){return c.compareDocumentPosition(aa.createElement("div"))&1});ja(function(c){c.innerHTML="<a href='#'></a>";return"#"===c.firstChild.getAttribute("href")})||tb("type|href|height|width",function(c,a,d){if(!d)return c.getAttribute(a,"type"===a.toLowerCase()?1:2)});(!V.attributes||!ja(function(c){c.innerHTML="<input/>";c.firstChild.setAttribute("value","");return""===c.firstChild.getAttribute("value")}))&&tb("value",function(c,a,d){if(!d&&"input"===c.nodeName.toLowerCase())return c.defaultValue});ja(function(c){return null==c.getAttribute("disabled")})||tb("checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",function(c,a,d){var k;if(!d)return(k=c.getAttributeNode(a))&&k.specified?k.value:!0===c[a]?a.toLowerCase():null});m.find=S;m.expr=S.selectors;m.expr[":"]=m.expr.pseudos;m.unique=S.uniqueSort;m.text=S.getText;m.isXMLDoc=S.isXML;m.contains=S.contains;var cc={};m.Callbacks=function(c){var a;if("string"===typeof c){if(!(a=cc[c])){a=c;var d=cc[a]={};m.each(a.match(pa)||[],function(c,a){d[a]=!0});a=d}}else a=m.extend({},c);c=a;var k,f,e,b,n,g,p=[],y=!c.once&&[],h=function(a){f=c.memory&&a;e=!0;n=g||0;g=0;b=p.length;for(k=!0;p&&n<b;n++)if(!1===p[n].apply(a[0],a[1])&&c.stopOnFalse){f=!1;break}k=!1;p&&(y?y.length&&h(y.shift()):f?p=[]:j.disable())},j={add:function(){if(p){var a=p.length;(function Ec(a){m.each(a,function(a,d){var k=m.type(d);"function"===k?(!c.unique||!j.has(d))&&p.push(d):d&&(d.length&&"string"!==k)&&Ec(d)})})(arguments);k?b=p.length:f&&(g=a,h(f))}return this},remove:function(){p&&m.each(arguments,function(c,a){for(var d;-1<(d=m.inArray(a,p,d));)p.splice(d,1),k&&(d<=b&&b--,d<=n&&n--)});return this},has:function(c){return c?-1<m.inArray(c,p):!(!p||!p.length)},empty:function(){p=[];b=0;return this},disable:function(){p=y=f=o;return this},disabled:function(){return!p},lock:function(){y=o;f||j.disable();return this},locked:function(){return!y},fireWith:function(c,a){if(p&&(!e||y))a=a||[],a=[c,a.slice?a.slice():a],k?y.push(a):h(a);return this},fire:function(){j.fireWith(this,arguments);return this},fired:function(){return!!e}};return j};m.extend({Deferred:function(c){var a=[["resolve","done",m.Callbacks("once memory"),"resolved"],["reject","fail",m.Callbacks("once memory"),"rejected"],["notify","progress",m.Callbacks("memory")]],d="pending",k={state:function(){return d},always:function(){f.done(arguments).fail(arguments);return this},then:function(){var c=arguments;return m.Deferred(function(d){m.each(a,function(a,e){var b=e[0],z=m.isFunction(c[a])&&c[a];f[e[1]](function(){var c=z&&z.apply(this,arguments);if(c&&m.isFunction(c.promise))c.promise().done(d.resolve).fail(d.reject).progress(d.notify);else d[b+"With"](this===k?d.promise():this,z?[c]:arguments)})});c=null}).promise()},promise:function(c){return null!=c?m.extend(c,k):k}},f={};k.pipe=k.then;m.each(a,function(c,e){var b=e[2],z=e[3];k[e[1]]=b.add;z&&b.add(function(){d=z},a[c^1][2].disable,a[2][2].lock);f[e[0]]=function(){f[e[0]+"With"](this===f?k:this,arguments);return this};f[e[0]+"With"]=b.fireWith});k.promise(f);c&&c.call(f,f);return f},when:function(c){var a=0,d=U.call(arguments),k=d.length,f=1!==k||c&&m.isFunction(c.promise)?k:0,e=1===f?c:m.Deferred(),b=function(c,a,d){return function(k){a[c]=this;d[c]=1<arguments.length?U.call(arguments):k;d===n?e.notifyWith(a,d):--f||e.resolveWith(a,d)}},n,g,p;if(1<k){n=Array(k);g=Array(k);for(p=Array(k);a<k;a++)d[a]&&m.isFunction(d[a].promise)?d[a].promise().done(b(a,p,d)).fail(e.reject).progress(b(a,g,n)):--f}f||e.resolveWith(p,d);return e.promise()}});var ed=m;var N={},Bb,ya,ba,hb,ib,jb,Cb,dc,Ua,P=K.createElement("div");P.setAttribute("className","t");P.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";Bb=P.getElementsByTagName("*")||[];if((ya=P.getElementsByTagName("a")[0])&&ya.style&&Bb.length){hb=K.createElement("select");jb=hb.appendChild(K.createElement("option"));ba=P.getElementsByTagName("input")[0];ya.style.cssText="top:1px;float:left;opacity:.5";N.getSetAttribute="t"!==P.className;N.leadingWhitespace=3===P.firstChild.nodeType;N.tbody=!P.getElementsByTagName("tbody").length;N.htmlSerialize=!!P.getElementsByTagName("link").length;N.style=/top/.test(ya.getAttribute("style"));N.hrefNormalized="/a"===ya.getAttribute("href");N.opacity=/^0.5/.test(ya.style.opacity);N.cssFloat=!!ya.style.cssFloat;N.checkOn=!!ba.value;N.optSelected=jb.selected;N.enctype=!!K.createElement("form").enctype;N.html5Clone="<:nav></:nav>"!==K.createElement("nav").cloneNode(!0).outerHTML;N.inlineBlockNeedsLayout=!1;N.shrinkWrapBlocks=!1;N.pixelPosition=!1;N.deleteExpando=!0;N.noCloneEvent=!0;N.reliableMarginRight=!0;N.boxSizingReliable=!0;ba.checked=!0;N.noCloneChecked=ba.cloneNode(!0).checked;hb.disabled=!0;N.optDisabled=!jb.disabled;try{delete P.test}catch(Hd){N.deleteExpando=!1}ba=K.createElement("input");ba.setAttribute("value","");N.input=""===ba.getAttribute("value");ba.value="t";ba.setAttribute("type","radio");N.radioValue="t"===ba.value;ba.setAttribute("checked","t");ba.setAttribute("name","t");ib=K.createDocumentFragment();ib.appendChild(ba);N.appendChecked=ba.checked;N.checkClone=ib.cloneNode(!0).cloneNode(!0).lastChild.checked;P.attachEvent&&(P.attachEvent("onclick",function(){N.noCloneEvent=!1}),P.cloneNode(!0).click());for(Ua in{submit:!0,change:!0,focusin:!0})P.setAttribute(Cb="on"+Ua,"t"),N[Ua+"Bubbles"]=Cb in b||!1===P.attributes[Cb].expando;P.style.backgroundClip="content-box";P.cloneNode(!0).style.backgroundClip="";N.clearCloneStyle="content-box"===P.style.backgroundClip;for(Ua in m(N))break;N.ownLast="0"!==Ua;m(function(){var c,a,d=K.getElementsByTagName("body")[0];d&&(c=K.createElement("div"),c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",d.appendChild(c).appendChild(P),P.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=P.getElementsByTagName("td"),a[0].style.cssText="padding:0;margin:0;border:0;display:none",dc=0===a[0].offsetHeight,a[0].style.display="",a[1].style.display="none",N.reliableHiddenOffsets=dc&&0===a[0].offsetHeight,P.innerHTML="",P.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",m.swap(d,null!=d.style.zoom?{zoom:1}:{},function(){N.boxSizing=4===P.offsetWidth}),b.getComputedStyle&&(N.pixelPosition="1%"!==(b.getComputedStyle(P,null)||{}).top,N.boxSizingReliable="4px"===(b.getComputedStyle(P,null)||{width:"4px"}).width,a=P.appendChild(K.createElement("div")),a.style.cssText=P.style.cssText="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",a.style.marginRight=a.style.width="0",P.style.width="1px",N.reliableMarginRight=!parseFloat((b.getComputedStyle(a,null)||{}).marginRight)),typeof P.style.zoom!==oa&&(P.innerHTML="",P.style.cssText="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;width:1px;padding:1px;display:inline;zoom:1",N.inlineBlockNeedsLayout=3===P.offsetWidth,P.style.display="block",P.innerHTML="<div></div>",P.firstChild.style.width="5px",N.shrinkWrapBlocks=3!==P.offsetWidth,N.inlineBlockNeedsLayout&&(d.style.zoom=1)),d.removeChild(c),c=P=a=a=null)});Bb=hb=ib=jb=ya=ba=null}ed.support=N;var zc=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,yc=/([A-Z])/g;m.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(c){c=c.nodeType?m.cache[c[m.expando]]:c[m.expando];return!!c&&!a(c)},data:function(c,a,d){return h(c,a,d)},removeData:function(c,a){return g(c,a)},_data:function(c,a,d){return h(c,a,d,!0)},_removeData:function(c,a){return g(c,a,!0)},acceptData:function(c){if(c.nodeType&&1!==c.nodeType&&9!==c.nodeType)return!1;var a=c.nodeName&&m.noData[c.nodeName.toLowerCase()];return!a||!0!==a&&c.getAttribute("classid")===a}});m.fn.extend({data:function(c,a){var d,k,f=null,b=0,n=this[0];if(c===o){if(this.length&&(f=m.data(n),1===n.nodeType&&!m._data(n,"parsedAttrs"))){for(d=n.attributes;b<d.length;b++)k=d[b].name,0===k.indexOf("data-")&&(k=m.camelCase(k.slice(5)),e(n,k,f[k]));m._data(n,"parsedAttrs",!0)}return f}return"object"===typeof c?this.each(function(){m.data(this,c)}):1<arguments.length?this.each(function(){m.data(this,c,a)}):n?e(n,c,m.data(n,c)):null},removeData:function(c){return this.each(function(){m.removeData(this,c)})}});m.extend({queue:function(c,a,d){var k;if(c)return a=(a||"fx")+"queue",k=m._data(c,a),d&&(!k||m.isArray(d)?k=m._data(c,a,m.makeArray(d)):k.push(d)),k||[]},dequeue:function(c,a){a=a||"fx";var d=m.queue(c,a),k=d.length,f=d.shift(),e=m._queueHooks(c,a),b=function(){m.dequeue(c,a)};"inprogress"===f&&(f=d.shift(),k--);f&&("fx"===a&&d.unshift("inprogress"),delete e.stop,f.call(c,b,e));!k&&e&&e.empty.fire()},_queueHooks:function(c,a){var d=a+"queueHooks";return m._data(c,d)||m._data(c,d,{empty:m.Callbacks("once memory").add(function(){m._removeData(c,a+"queue");m._removeData(c,d)})})}});m.fn.extend({queue:function(c,a){var d=2;"string"!==typeof c&&(a=c,c="fx",d--);return arguments.length<d?m.queue(this[0],c):a===o?this:this.each(function(){var d=m.queue(this,c,a)
;m._queueHooks(this,c);"fx"===c&&"inprogress"!==d[0]&&m.dequeue(this,c)})},dequeue:function(c){return this.each(function(){m.dequeue(this,c)})},delay:function(c,a){c=m.fx?m.fx.speeds[c]||c:c;return this.queue(a||"fx",function(a,d){var k=setTimeout(a,c);d.stop=function(){clearTimeout(k)}})},clearQueue:function(c){return this.queue(c||"fx",[])},promise:function(c,a){var d,k=1,f=m.Deferred(),e=this,b=this.length,n=function(){--k||f.resolveWith(e,[e])};"string"!==typeof c&&(a=c,c=o);for(c=c||"fx";b--;)if((d=m._data(e[b],c+"queueHooks"))&&d.empty)k++,d.empty.add(n);n();return f.promise(a)}});var Pa,ec,Db=/[\t\r\n\f]/g,fd=/\r/g,gd=/^(?:input|select|textarea|button|object)$/i,hd=/^(?:a|area)$/i,Eb=/^(?:checked|selected)$/i,Ja=m.support.getSetAttribute,kb=m.support.input;m.fn.extend({attr:function(c,a){return m.access(this,m.attr,c,a,1<arguments.length)},removeAttr:function(c){return this.each(function(){m.removeAttr(this,c)})},prop:function(c,a){return m.access(this,m.prop,c,a,1<arguments.length)},removeProp:function(c){c=m.propFix[c]||c;return this.each(function(){try{this[c]=o,delete this[c]}catch(a){}})},addClass:function(c){var a,d,k,f,e,b=0,n=this.length;a="string"===typeof c&&c;if(m.isFunction(c))return this.each(function(a){m(this).addClass(c.call(this,a,this.className))});if(a)for(a=(c||"").match(pa)||[];b<n;b++)if(d=this[b],k=1===d.nodeType&&(d.className?(" "+d.className+" ").replace(Db," "):" ")){for(e=0;f=a[e++];)0>k.indexOf(" "+f+" ")&&(k+=f+" ");d.className=m.trim(k)}return this},removeClass:function(c){var a,d,k,f,e,b=0,n=this.length;a=0===arguments.length||"string"===typeof c&&c;if(m.isFunction(c))return this.each(function(a){m(this).removeClass(c.call(this,a,this.className))});if(a)for(a=(c||"").match(pa)||[];b<n;b++)if(d=this[b],k=1===d.nodeType&&(d.className?(" "+d.className+" ").replace(Db," "):"")){for(e=0;f=a[e++];)for(;0<=k.indexOf(" "+f+" ");)k=k.replace(" "+f+" "," ");d.className=c?m.trim(k):""}return this},toggleClass:function(c,a){var d=typeof c;return"boolean"===typeof a&&"string"===d?a?this.addClass(c):this.removeClass(c):m.isFunction(c)?this.each(function(d){m(this).toggleClass(c.call(this,d,this.className,a),a)}):this.each(function(){if("string"===d)for(var a,k=0,f=m(this),e=c.match(pa)||[];a=e[k++];)f.hasClass(a)?f.removeClass(a):f.addClass(a);else if(d===oa||"boolean"===d)this.className&&m._data(this,"__className__",this.className),this.className=this.className||!1===c?"":m._data(this,"__className__")||""})},hasClass:function(c){c=" "+c+" ";for(var a=0,d=this.length;a<d;a++)if(1===this[a].nodeType&&0<=(" "+this[a].className+" ").replace(Db," ").indexOf(c))return!0;return!1},val:function(c){var a,d,k,f=this[0];if(arguments.length)return k=m.isFunction(c),this.each(function(a){if(1===this.nodeType&&(a=k?c.call(this,a,m(this).val()):c,null==a?a="":"number"===typeof a?a+="":m.isArray(a)&&(a=m.map(a,function(c){return null==c?"":c+""})),d=m.valHooks[this.type]||m.valHooks[this.nodeName.toLowerCase()],!d||!("set"in d)||d.set(this,a,"value")===o))this.value=a});if(f){if((d=m.valHooks[f.type]||m.valHooks[f.nodeName.toLowerCase()])&&"get"in d&&(a=d.get(f,"value"))!==o)return a;a=f.value;return"string"===typeof a?a.replace(fd,""):null==a?"":a}}});m.extend({valHooks:{option:{get:function(c){var a=m.find.attr(c,"value");return null!=a?a:c.text}},select:{get:function(c){for(var a,d=c.options,k=c.selectedIndex,f=(c="select-one"===c.type||0>k)?null:[],e=c?k+1:d.length,b=0>k?e:c?k:0;b<e;b++)if(a=d[b],(a.selected||b===k)&&(m.support.optDisabled?!a.disabled:null===a.getAttribute("disabled"))&&(!a.parentNode.disabled||!m.nodeName(a.parentNode,"optgroup"))){a=m(a).val();if(c)return a;f.push(a)}return f},set:function(c,a){for(var d,k,f=c.options,e=m.makeArray(a),b=f.length;b--;)if(k=f[b],k.selected=0<=m.inArray(m(k).val(),e))d=!0;d||(c.selectedIndex=-1);return e}}},attr:function(c,a,d){var k,f,e=c.nodeType;if(c&&!(3===e||8===e||2===e)){if(typeof c.getAttribute===oa)return m.prop(c,a,d);if(1!==e||!m.isXMLDoc(c))a=a.toLowerCase(),k=m.attrHooks[a]||(m.expr.match.bool.test(a)?ec:Pa);if(d!==o)if(null===d)m.removeAttr(c,a);else{if(k&&"set"in k&&(f=k.set(c,d,a))!==o)return f;c.setAttribute(a,d+"");return d}else{if(k&&"get"in k&&null!==(f=k.get(c,a)))return f;f=m.find.attr(c,a);return null==f?o:f}}},removeAttr:function(c,a){var d,k,f=0,e=a&&a.match(pa);if(e&&1===c.nodeType)for(;d=e[f++];)k=m.propFix[d]||d,m.expr.match.bool.test(d)?kb&&Ja||!Eb.test(d)?c[k]=!1:c[m.camelCase("default-"+d)]=c[k]=!1:m.attr(c,d,""),c.removeAttribute(Ja?d:k)},attrHooks:{type:{set:function(c,a){if(!m.support.radioValue&&"radio"===a&&m.nodeName(c,"input")){var d=c.value;c.setAttribute("type",a);d&&(c.value=d);return a}}}},propFix:{for:"htmlFor",class:"className"},prop:function(c,a,d){var k,f,e;e=c.nodeType;if(c&&!(3===e||8===e||2===e)){if(e=1!==e||!m.isXMLDoc(c))a=m.propFix[a]||a,f=m.propHooks[a];return d!==o?f&&"set"in f&&(k=f.set(c,d,a))!==o?k:c[a]=d:f&&"get"in f&&null!==(k=f.get(c,a))?k:c[a]}},propHooks:{tabIndex:{get:function(c){var a=m.find.attr(c,"tabindex");return a?parseInt(a,10):gd.test(c.nodeName)||hd.test(c.nodeName)&&c.href?0:-1}}}});ec={set:function(c,a,d){!1===a?m.removeAttr(c,d):kb&&Ja||!Eb.test(d)?c.setAttribute(!Ja&&m.propFix[d]||d,d):c[m.camelCase("default-"+d)]=c[d]=!0;return d}};m.each(m.expr.match.bool.source.match(/\w+/g),function(c,a){var d=m.expr.attrHandle[a]||m.find.attr;m.expr.attrHandle[a]=kb&&Ja||!Eb.test(a)?function(c,a,k){var f=m.expr.attrHandle[a];c=k?o:(m.expr.attrHandle[a]=o)!=d(c,a,k)?a.toLowerCase():null;m.expr.attrHandle[a]=f;return c}:function(c,a,d){return d?o:c[m.camelCase("default-"+a)]?a.toLowerCase():null}});if(!kb||!Ja)m.attrHooks.value={set:function(c,a,d){if(m.nodeName(c,"input"))c.defaultValue=a;else return Pa&&Pa.set(c,a,d)}};Ja||(Pa={set:function(c,a,d){var k=c.getAttributeNode(d);k||c.setAttributeNode(k=c.ownerDocument.createAttribute(d));k.value=a+="";return"value"===d||a===c.getAttribute(d)?a:o}},m.expr.attrHandle.id=m.expr.attrHandle.name=m.expr.attrHandle.coords=function(c,a,d){var k;return d?o:(k=c.getAttributeNode(a))&&""!==k.value?k.value:null},m.valHooks.button={get:function(c,a){var d=c.getAttributeNode(a);return d&&d.specified?d.value:o},set:Pa.set},m.attrHooks.contenteditable={set:function(c,a,d){Pa.set(c,""===a?!1:a,d)}},m.each(["width","height"],function(c,a){m.attrHooks[a]={set:function(c,d){if(""===d)return c.setAttribute(a,"auto"),d}}}));m.support.hrefNormalized||m.each(["href","src"],function(c,a){m.propHooks[a]={get:function(c){return c.getAttribute(a,4)}}});m.support.style||(m.attrHooks.style={get:function(c){return c.style.cssText||o},set:function(c,a){return c.style.cssText=a+""}});m.support.optSelected||(m.propHooks.selected={get:function(c){if(c=c.parentNode)c.selectedIndex,c.parentNode&&c.parentNode.selectedIndex;return null}});m.each("tabIndex readOnly maxLength cellSpacing cellPadding rowSpan colSpan useMap frameBorder contentEditable".split(" "),function(){m.propFix[this.toLowerCase()]=this});m.support.enctype||(m.propFix.enctype="encoding");m.each(["radio","checkbox"],function(){m.valHooks[this]={set:function(c,a){if(m.isArray(a))return c.checked=0<=m.inArray(m(c).val(),a)}};m.support.checkOn||(m.valHooks[this].get=function(c){return null===c.getAttribute("value")?"on":c.value})});var Fb=/^(?:input|select|textarea)$/i,id=/^key/,jd=/^(?:mouse|contextmenu)|click/,fc=/^(?:focusinfocus|focusoutblur)$/,gc=/^([^.]*)(?:\.(.+)|)$/;m.event={global:{},add:function(c,a,d,k,f){var e,b,n,g,p,y,h,j,q;if(n=m._data(c)){d.handler&&(g=d,d=g.handler,f=g.selector);d.guid||(d.guid=m.guid++);if(!(b=n.events))b=n.events={};if(!(p=n.handle))p=n.handle=function(c){return typeof m!==oa&&(!c||m.event.triggered!==c.type)?m.event.dispatch.apply(p.elem,arguments):o},p.elem=c;a=(a||"").match(pa)||[""];for(n=a.length;n--;)if(e=gc.exec(a[n])||[],j=y=e[1],q=(e[2]||"").split(".").sort(),j){e=m.event.special[j]||{};j=(f?e.delegateType:e.bindType)||j;e=m.event.special[j]||{};y=m.extend({type:j,origType:y,data:k,handler:d,guid:d.guid,selector:f,needsContext:f&&m.expr.match.needsContext.test(f),namespace:q.join(".")},g);if(!(h=b[j]))if(h=b[j]=[],h.delegateCount=0,!e.setup||!1===e.setup.call(c,k,q,p))c.addEventListener?c.addEventListener(j,p,!1):c.attachEvent&&c.attachEvent("on"+j,p);e.add&&(e.add.call(c,y),y.handler.guid||(y.handler.guid=d.guid));f?h.splice(h.delegateCount++,0,y):h.push(y);m.event.global[j]=!0}c=null}},remove:function(c,a,d,k,f){var e,b,n,g,p,y,h,j,q,l,C,r=m.hasData(c)&&m._data(c);if(r&&(y=r.events)){a=(a||"").match(pa)||[""];for(p=a.length;p--;)if(n=gc.exec(a[p])||[],q=C=n[1],l=(n[2]||"").split(".").sort(),q){h=m.event.special[q]||{};q=(k?h.delegateType:h.bindType)||q;j=y[q]||[];n=n[2]&&RegExp("(^|\\.)"+l.join("\\.(?:.*\\.|)")+"(\\.|$)");for(g=e=j.length;e--;)if(b=j[e],(f||C===b.origType)&&(!d||d.guid===b.guid)&&(!n||n.test(b.namespace))&&(!k||k===b.selector||"**"===k&&b.selector))j.splice(e,1),b.selector&&j.delegateCount--,h.remove&&h.remove.call(c,b);g&&!j.length&&((!h.teardown||!1===h.teardown.call(c,l,r.handle))&&m.removeEvent(c,q,r.handle),delete y[q])}else for(q in y)m.event.remove(c,q+a[p],d,k,!0);m.isEmptyObject(y)&&(delete r.handle,m._removeData(c,"events"))}},trigger:function(c,a,d,k){var f,e,n,g,p,y,h=[d||K],j=Ma.call(c,"type")?c.type:c;p=Ma.call(c,"namespace")?c.namespace.split("."):[];n=f=d=d||K;if(!(3===d.nodeType||8===d.nodeType)&&!fc.test(j+m.event.triggered))if(0<=j.indexOf(".")&&(p=j.split("."),j=p.shift(),p.sort()),e=0>j.indexOf(":")&&"on"+j,c=c[m.expando]?c:new m.Event(j,"object"===typeof c&&c),c.isTrigger=k?2:3,c.namespace=p.join("."),c.namespace_re=c.namespace?RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c.result=o,c.target||(c.target=d),a=null==a?[c]:m.makeArray(a,[c]),p=m.event.special[j]||{},k||!(p.trigger&&!1===p.trigger.apply(d,a))){if(!k&&!p.noBubble&&!m.isWindow(d)){g=p.delegateType||j;fc.test(g+j)||(n=n.parentNode);for(;n;n=n.parentNode)h.push(n),f=n;if(f===(d.ownerDocument||K))h.push(f.defaultView||f.parentWindow||b)}for(y=0;(n=h[y++])&&!c.isPropagationStopped();)c.type=1<y?g:p.bindType||j,(f=(m._data(n,"events")||{})[c.type]&&m._data(n,"handle"))&&f.apply(n,a),(f=e&&n[e])&&(m.acceptData(n)&&f.apply&&!1===f.apply(n,a))&&c.preventDefault();c.type=j;if(!k&&!c.isDefaultPrevented()&&(!p._default||!1===p._default.apply(h.pop(),a))&&m.acceptData(d)&&e&&d[j]&&!m.isWindow(d)){(f=d[e])&&(d[e]=null);m.event.triggered=j;try{d[j]()}catch(q){}m.event.triggered=o;f&&(d[e]=f)}return c.result}},dispatch:function(c){c=m.event.fix(c);var a,d,k,f,e=[],b=U.call(arguments);a=(m._data(this,"events")||{})[c.type]||[];var n=m.event.special[c.type]||{};b[0]=c;c.delegateTarget=this;if(!(n.preDispatch&&!1===n.preDispatch.call(this,c))){e=m.event.handlers.call(this,c,a);for(a=0;(k=e[a++])&&!c.isPropagationStopped();){c.currentTarget=k.elem;for(f=0;(d=k.handlers[f++])&&!c.isImmediatePropagationStopped();)if(!c.namespace_re||c.namespace_re.test(d.namespace))if(c.handleObj=d,c.data=d.data,d=((m.event.special[d.origType]||{}).handle||d.handler).apply(k.elem,b),d!==o&&!1===(c.result=d))c.preventDefault(),c.stopPropagation()}n.postDispatch&&n.postDispatch.call(this,c);return c.result}},handlers:function(c,a){var d,k,f,e,b=[],n=a.delegateCount,p=c.target;if(n&&p.nodeType&&(!c.button||"click"!==c.type))for(;p!=this;p=p.parentNode||this)if(1===p.nodeType&&(!0!==p.disabled||"click"!==c.type)){f=[];for(e=0;e<n;e++)k=a[e],d=k.selector+" ",f[d]===o&&(f[d]=k.needsContext?0<=m(d,this).index(p):m.find(d,this,null,[p]).length),f[d]&&f.push(k);f.length&&b.push({elem:p,handlers:f})}n<a.length&&b.push({elem:this,handlers:a.slice(n)});return b},fix:function(c){if(c[m.expando])return c;var a,d,k;a=c.type;var f=c,e=this.fixHooks[a];e||(this.fixHooks[a]=e=jd.test(a)?this.mouseHooks:id.test(a)?this.keyHooks:{});k=e.props?this.props.concat(e.props):this.props;c=new m.Event(f);for(a=k.length;a--;)d=k[a],c[d]=f[d];c.target||(c.target=f.srcElement||K);3===c.target.nodeType&&(c.target=c.target.parentNode);c.metaKey=!!c.metaKey;return e.filter?e.filter(c,f):c},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:["char","charCode","key","keyCode"],filter:function(c,a){null==c.which&&(c.which=null!=a.charCode?a.charCode:a.keyCode);return c}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(c,a){var d,k,f=a.button,e=a.fromElement;null==c.pageX&&null!=a.clientX&&(d=c.target.ownerDocument||K,k=d.documentElement,d=d.body,c.pageX=a.clientX+(k&&k.scrollLeft||d&&d.scrollLeft||0)-(k&&k.clientLeft||d&&d.clientLeft||0),c.pageY=a.clientY+(k&&k.scrollTop||d&&d.scrollTop||0)-(k&&k.clientTop||d&&d.clientTop||0));!c.relatedTarget&&e&&(c.relatedTarget=e===c.target?a.toElement:e);!c.which&&f!==o&&(c.which=f&1?1:f&2?3:f&4?2:0);return c}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==f()&&this.focus)try{return this.focus(),!1}catch(c){}},delegateType:"focusin"},blur:{trigger:function(){if(this===f()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(m.nodeName(this,"input")&&"checkbox"===this.type&&this.click)return this.click(),!1},_default:function(c){return m.nodeName(c.target,"a")}},beforeunload:{postDispatch:function(c){c.result!==o&&(c.originalEvent.returnValue=c.result)}}},simulate:function(c,a,d,k){c=m.extend(new m.Event,d,{type:c,isSimulated:!0,originalEvent:{}});k?m.event.trigger(c,null,a):m.event.dispatch.call(a,c);c.isDefaultPrevented()&&d.preventDefault()}};m.removeEvent=K.removeEventListener?function(c,a,d){c.removeEventListener&&c.removeEventListener(a,d,!1)}:function(c,a,d){a="on"+a;c.detachEvent&&(typeof c[a]===oa&&(c[a]=null),c.detachEvent(a,d))};m.Event=function(c,a){if(!(this instanceof m.Event))return new m.Event(c,a);c&&c.type?(this.originalEvent=c,this.type=c.type,this.isDefaultPrevented=c.defaultPrevented||!1===c.returnValue||c.getPreventDefault&&c.getPreventDefault()?d:n):this.type=c;a&&m.extend(this,a);this.timeStamp=c&&c.timeStamp||m.now();this[m.expando]=!0};m.Event.prototype={isDefaultPrevented:n,isPropagationStopped:n,isImmediatePropagationStopped:n,preventDefault:function(){var c=this.originalEvent;this.isDefaultPrevented=d;c&&(c.preventDefault?c.preventDefault():c.returnValue=!1)},stopPropagation:function(){var c=this.originalEvent;this.isPropagationStopped=d;c&&(c.stopPropagation&&c.stopPropagation(),c.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=d;this.stopPropagation()}};m.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(c,a){m.event.special[c]={delegateType:a,bindType:a,handle:function(c){var d,k=c.relatedTarget,f=c.handleObj;if(!k||k!==this&&!m.contains(this,k))c.type=f.origType,d=f.handler.apply(this,arguments),c.type=a;return d}}});m.support.submitBubbles||(m.event.special.submit={setup:function(){if(m.nodeName(this,"form"))return!1;m.event.add(this,"click._submit keypress._submit",function(c){c=c.target;if((c=m.nodeName(c,"input")||m.nodeName(c,"button")?c.form:o)&&!m._data(c,"submitBubbles"))m.event.add(c,"submit._submit",function(c){c._submit_bubble=!0}),m._data(c,"submitBubbles",!0)})},postDispatch:function(c){c._submit_bubble&&(delete c._submit_bubble,this.parentNode&&!c.isTrigger&&m.event.simulate("submit",this.parentNode,c,!0))},teardown:function(){if(m.nodeName(this,"form"))return!1;m.event.remove(this,"._submit")}});m.support.changeBubbles||(m.event.special.change={setup:function(){if(Fb.test(this.nodeName)){if("checkbox"===this.type||"radio"===this.type)m.event.add(this,"propertychange._change",function(c){"checked"===c.originalEvent.propertyName&&(this._just_changed=!0)}),m.event.add(this,"click._change",function(c){this._just_changed&&!c.isTrigger&&(this._just_changed=!1);m.event.simulate("change",this,c,!0)});return!1}m.event.add(this,"beforeactivate._change",function(c){c=c.target;Fb.test(c.nodeName)&&!m._data(c,"changeBubbles")&&(m.event.add(c,"change._change",function(c){this.parentNode&&(!c.isSimulated&&!c.isTrigger)&&m.event.simulate("change",this.parentNode,c,!0)}),m._data(c,"changeBubbles",!0))})},handle:function(c){var a=c.target;if(this!==a||c.isSimulated||c.isTrigger||"radio"!==a.type&&"checkbox"!==a.type)return c.handleObj.handler.apply(this,arguments)},teardown:function(){m.event.remove(this,"._change");return!Fb.test(this.nodeName)}});m.support.focusinBubbles||m.each({focus:"focusin",blur:"focusout"},function(c,a){var d=0,k=function(c){m.event.simulate(a,c.target,m.event.fix(c),!0)};m.event.special[a]={setup:function(){0===d++&&K.addEventListener(c,k,!0)},teardown:function(){0===--d&&K.removeEventListener(c,k,!0)}}});m.fn.extend({on:function(c,a,d,k,f){var e,b;if("object"===typeof c){"string"!==typeof a&&(d=d||a,a=o);for(e in c)this.on(e,a,d,c[e],f);return this}null==d&&null==k?(k=a,d=a=o):null==k&&("string"===typeof a?(k=d,d=o):(k=d,d=a,a=o));if(!1===k)k=n;else if(!k)return this;1===f&&(b=k,k=function(c){m().off(c);return b.apply(this,arguments)},k.guid=b.guid||(b.guid=m.guid++));return this.each(function(){m.event.add(this,c,k,d,a)})},one:function(c,a,d,k){return this.on(c,a,d,k,1)},off:function(c,a,d){var k;if(c&&c.preventDefault&&c.handleObj)return k=c.handleObj,m(c.delegateTarget).off(k.namespace?k.origType+"."+k.namespace:k.origType,k.selector,k.handler),this;if("object"===typeof c){for(k in c)this.off(k,a,c[k]);return this}if(!1===a||"function"===typeof a)d=a,a=o;!1===d&&(d=n);return this.each(function(){m.event.remove(this,c,d,a)})},trigger:function(c,a){return this.each(function(){m.event.trigger(c,a,this)})},triggerHandler:function(c,a){var d=this[0];if(d)return m.event.trigger(c,a,d,!0)}});var Ac=/^.[^:#\[\.,]*$/,kd=/^(?:parents|prev(?:Until|All))/,hc=m.expr.match.needsContext,ld={children:!0,contents:!0,next:!0,prev:!0};m.fn.extend({find:function(c){var a,d=[],k=this,f=k.length;if("string"!==typeof c)return this.pushStack(m(c).filter(function(){for(a=0;a<f;a++)if(m.contains(k[a],this))return!0}));for(a=0;a<f;a++)m.find(c,k[a],d);d=this.pushStack(1<f?m.unique(d):d);d.selector=this.selector?this.selector+" "+c:c;return d},has:function(c){var a,d=m(c,this),k=d.length;return this.filter(function(){for(a=0;a<k;a++)if(m.contains(this,d[a]))return!0})},not:function(c){return this.pushStack(p(this,c||[],!0))},filter:function(c){return this.pushStack(p(this,c||[],!1))},is:function(c){return!!p(this,"string"===typeof c&&hc.test(c)?m(c):c||[],!1).length},closest:function(c,a){for(var d,k=0,f=this.length,e=[],b=hc.test(c)||"string"!==typeof c?m(c,a||this.context):0;k<f;k++)for(d=this[k];d&&d!==a;d=d.parentNode)if(11>d.nodeType&&(b?-1<b.index(d):1===d.nodeType&&m.find.matchesSelector(d,c))){e.push(d);break}return this.pushStack(1<e.length?m.unique(e):e)},index:function(c){return!c?this[0]&&this[0].parentNode?this.first().prevAll().length:-1:"string"===typeof c?m.inArray(this[0],m(c)):m.inArray(c.jquery?c[0]:c,this)},add:function(c,a){var d="string"===typeof c?m(c,a):m.makeArray(c&&c.nodeType?[c]:c),d=m.merge(this.get(),d);return this.pushStack(m.unique(d))},addBack:function(c){return this.add(null==c?this.prevObject:this.prevObject.filter(c))}});m.each({parent:function(c){return(c=c.parentNode)&&11!==c.nodeType?c:null},parents:function(c){return m.dir(c,"parentNode")},parentsUntil:function(c,a,d){return m.dir(c,"parentNode",d)},next:function(c){return y(c,"nextSibling")},prev:function(c){return y(c,"previousSibling")},nextAll:function(c){return m.dir(c,"nextSibling")},prevAll:function(c){return m.dir(c,"previousSibling")},nextUntil:function(c,a,d){return m.dir(c,"nextSibling",d)},prevUntil:function(c,a,d){return m.dir(c,"previousSibling",d)},siblings:function(c){return m.sibling((c.parentNode||{}).firstChild,c)},children:function(c){return m.sibling(c.firstChild)},contents:function(c){return m.nodeName(c,"iframe")?c.contentDocument||c.contentWindow.document:m.merge([],c.childNodes)}},function(c,a){m.fn[c]=function(d,k){var f=m.map(this,a,d);"Until"!==c.slice(-5)&&(k=d);k&&"string"===typeof k&&(f=m.filter(k,f));1<this.length&&(ld[c]||(f=m.unique(f)),kd.test(c)&&(f=f.reverse()));return this.pushStack(f)}});m.extend({filter:function(c,a,d){var k=a[0];d&&(c=":not("+c+")");return 1===a.length&&1===k.nodeType?m.find.matchesSelector(k,c)?[k]:[]:m.find.matches(c,m.grep(a,function(c){return 1===c.nodeType}))},dir:function(c,a,d){var k=[];for(c=c[a];c&&9!==c.nodeType&&(d===o||1!==c.nodeType||!m(c).is(d));)1===c.nodeType&&k.push(c),c=c[a];return k},sibling:function(c,a){for(var d=[];c;c=c.nextSibling)1===c.nodeType&&c!==a&&d.push(c);return d}});var Nb="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",md=/ jQuery\d+="(?:null|\d+)"/g,ic=RegExp("<(?:"+Nb+")[\\s/>]","i"),Gb=/^\s+/,jc=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,kc=/<([\w:]+)/,lc=/<tbody/i,nd=/<|&#?\w+;/,od=/<(?:script|style|link)/i,mb=/^(?:checkbox|radio)$/i,pd=/checked\s*(?:[^=]|=\s*.checked.)/i,mc=/^$|\/(?:java|ecma)script/i,Bc=/^true\/(.*)/,qd=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ha={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:m.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Hb=q(K).appendChild(K.createElement("div"));ha.optgroup=ha.option;ha.tbody=ha.tfoot=ha.colgroup=ha.caption=ha.thead;ha.th=ha.td;m.fn.extend({text:function(c){return m.access(this,function(c){return c===o?m.text(this):this.empty().append((this[0]&&this[0].ownerDocument||K).createTextNode(c))},null,c,arguments.length)},append:function(){return this.domManip(arguments,function(c){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&A(this,c).appendChild(c)})},prepend:function(){return this.domManip(arguments,function(c){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var a=A(this,c);a.insertBefore(c,a.firstChild)}})},before:function(){return this.domManip(arguments,function(c){this.parentNode&&this.parentNode.insertBefore(c,this)})},after:function(){return this.domManip(arguments,function(c){this.parentNode&&this.parentNode.insertBefore(c,this.nextSibling)})},remove:function(c,a){for(var d,k=c?m.filter(c,this):this,f=0;null!=(d=k[f]);f++)!a&&1===d.nodeType&&m.cleanData(w(d)),d.parentNode&&(a&&m.contains(d.ownerDocument,d)&&u(w(d,"script")),d.parentNode.removeChild(d));return this},empty:function(){for(var c,a=0;null!=(c=this[a]);a++){for(1===c.nodeType&&m.cleanData(w(c,!1));c.firstChild;)c.removeChild(c.firstChild);c.options&&m.nodeName(c,"select")&&(c.options.length=0)}return this},clone:function(c,a){c=null==c?!1:c;a=null==a?c:a;return this.map(function(){return m.clone(this,c,a)})},html:function(c){return m.access(this,function(c){var a=this[0]||{},d=0,k=this.length;if(c===o)return 1===a.nodeType?a.innerHTML.replace(md,""):o;if("string"===typeof c&&!od.test(c)&&(m.support.htmlSerialize||!ic.test(c))&&(m.support.leadingWhitespace||!Gb.test(c))&&!ha[(kc.exec(c)||["",""])[1].toLowerCase()]){c=c.replace(jc,"<$1></$2>");try{for(;d<k;d++)a=this[d]||{},1===a.nodeType&&(m.cleanData(w(a,!1)),a.innerHTML=c);a=0}catch(f){}}a&&this.empty().append(c)},null,c,arguments.length)},replaceWith:function(){var c=m.map(this,function(c){return[c.nextSibling,c.parentNode]}),a=0;this.domManip(arguments,function(d){var k=c[a++],f=c[a++];f&&(k&&k.parentNode!==f&&(k=this.nextSibling),m(this).remove(),f.insertBefore(d,k))},!0);return a?this:this.remove()},detach:function(c){return this.remove(c,!0)},domManip:function(c,a,d){c=sa.apply([],c);var k,f,e,b,n=0,p=this.length,g=this,y=p-1,h=c[0],j=m.isFunction(h);if(j||!(1>=p||"string"!==typeof h||m.support.checkClone||!pd.test(h)))return this.each(function(k){var f=g.eq(k);j&&(c[0]=h.call(this,k,f.html()));f.domManip(c,a,d)});if(p&&(b=m.buildFragment(c,this[0].ownerDocument,!1,!d&&this),k=b.firstChild,1===b.childNodes.length&&(b=k),k)){e=m.map(w(b,"script"),r);for(f=e.length;n<p;n++)k=b,n!==y&&(k=m.clone(k,!0,!0),f&&m.merge(e,w(k,"script"))),a.call(this[n],k,n);if(f){b=e[e.length-1].ownerDocument;m.map(e,v);for(n=0;n<f;n++)if(k=e[n],mc.test(k.type||"")&&!m._data(k,"globalEval")&&m.contains(b,k))k.src?m._evalUrl(k.src):m.globalEval((k.text||k.textContent||k.innerHTML||"").replace(qd,""))}b=k=null}return this}});m.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(c,a){m.fn[c]=function(c){for(var d=0,k=[],f=m(c),e=f.length-1;d<=e;d++)c=d===e?this:this.clone(!0),m(f[d])[a](c),qa.apply(k,c.get());return this.pushStack(k)}});m.extend({clone:function(c,a,d){var k,f,e,b,n,p=m.contains(c.ownerDocument,c);m.support.html5Clone||m.isXMLDoc(c)||!ic.test("<"+c.nodeName+">")?e=c.cloneNode(!0):(Hb.innerHTML=c.outerHTML,Hb.removeChild(e=Hb.firstChild));if((!m.support.noCloneEvent||!m.support.noCloneChecked)&&(1===c.nodeType||11===c.nodeType)&&!m.isXMLDoc(c)){k=w(e);n=w(c);for(b=0;null!=(f=n[b]);++b)if(k[b]){var g=k[b],y=void 0,h=void 0,j=void 0;if(1===g.nodeType){y=g.nodeName.toLowerCase();if(!m.support.noCloneEvent&&g[m.expando]){j=m._data(g);for(h in j.events)m.removeEvent(g,h,j.handle);g.removeAttribute(m.expando)}if("script"===y&&g.text!==f.text)r(g).text=f.text,v(g);else if("object"===y)g.parentNode&&(g.outerHTML=f.outerHTML),m.support.html5Clone&&(f.innerHTML&&!m.trim(g.innerHTML))&&(g.innerHTML=f.innerHTML);else if("input"===y&&mb.test(f.type))g.defaultChecked=g.checked=f.checked,g.value!==f.value&&(g.value=f.value);else if("option"===y)g.defaultSelected=g.selected=f.defaultSelected;else if("input"===y||"textarea"===y)g.defaultValue=f.defaultValue}}}if(a)if(d){n=n||w(c);k=k||w(e);for(b=0;null!=(f=n[b]);b++)t(f,k[b])}else t(c,e);k=w(e,"script");0<k.length&&u(k,!p&&w(c,"script"));return e},buildFragment:function(c,a,d,k){for(var f,e,b,n,p,g,y=c.length,h=q(a),j=[],l=0;l<y;l++)if((e=c[l])||0===e)if("object"===m.type(e))m.merge(j,e.nodeType?[e]:e);else if(nd.test(e)){b=b||h.appendChild(a.createElement("div"));n=(kc.exec(e)||["",""])[1].toLowerCase();g=ha[n]||ha._default;b.innerHTML=g[1]+e.replace(jc,"<$1></$2>")+g[2];for(f=g[0];f--;)b=b.lastChild;!m.support.leadingWhitespace&&Gb.test(e)&&j.push(a.createTextNode(Gb.exec(e)[0]));if(!m.support.tbody)for(f=(e="table"===n&&!lc.test(e)?b.firstChild:"<table>"===g[1]&&!lc.test(e)?b:0)&&e.childNodes.length;f--;)m.nodeName(p=e.childNodes[f],"tbody")&&!p.childNodes.length&&e.removeChild(p);m.merge(j,b.childNodes);for(b.textContent="";b.firstChild;)b.removeChild(b.firstChild);b=h.lastChild}else j.push(a.createTextNode(e));b&&h.removeChild(b);m.support.appendChecked||m.grep(w(j,"input"),x);for(l=0;e=j[l++];)if(!(k&&-1!==m.inArray(e,k))&&(c=m.contains(e.ownerDocument,e),b=w(h.appendChild(e),"script"),c&&u(b),d))for(f=0;e=b[f++];)mc.test(e.type||"")&&d.push(e);return h},cleanData:function(c,a){for(var d,k,f,e,b=0,n=m.expando,p=m.cache,g=m.support.deleteExpando,y=m.event.special;null!=(d=c[b]);b++)if(a||m.acceptData(d))if(e=(f=d[n])&&p[f]){if(e.events)for(k in e.events)y[k]?m.event.remove(d,k):m.removeEvent(d,k,e.handle);p[f]&&(delete p[f],g?delete d[n]:typeof d.removeAttribute!==oa?d.removeAttribute(n):d[n]=null,ga.push(f))}},_evalUrl:function(c){return m.ajax({url:c,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})}});m.fn.extend({wrapAll:function(c){if(m.isFunction(c))return this.each(function(a){m(this).wrapAll(c.call(this,a))});if(this[0]){var a=m(c,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&a.insertBefore(this[0]);a.map(function(){for(var c=this;c.firstChild&&1===c.firstChild.nodeType;)c=c.firstChild;return c}).append(this)}return this},wrapInner:function(c){return m.isFunction(c)?this.each(function(a){m(this).wrapInner(c.call(this,a))}):this.each(function(){var a=m(this),d=a.contents();d.length?d.wrapAll(c):a.append(c)})},wrap:function(c){var a=m.isFunction(c);return this.each(function(d){m(this).wrapAll(a?c.call(this,d):c)})},unwrap:function(){return this.parent().each(function(){m.nodeName(this,"body")||m(this).replaceWith(this.childNodes)}).end()}});var Ra,Ba,Ca,Ib=/alpha\([^)]*\)/i,rd=/opacity\s*=\s*([^)]*)/,sd=/^(top|right|bottom|left)$/,td=/^(none|table(?!-c[ea]).+)/,nc=/^margin/,Cc=RegExp("^("+Ya+")(.*)$","i"),Wa=RegExp("^("+Ya+")(?!px)[a-z%]+$","i"),ud=RegExp("^([+-])=("+Ya+")","i"),Pb={BODY:"block"},vd={position:"absolute",visibility:"hidden",display:"block"},oc={letterSpacing:0,fontWeight:400},Aa=["Top","Right","Bottom","Left"],Ob=["Webkit","O","Moz","ms"];m.fn.extend({css:function(c,a){return m.access(this,function(c,a,d){var k,f={},e=0;if(m.isArray(a)){k=Ba(c);for(d=a.length;e<d;e++)f[a[e]]=m.css(c,a[e],!1,k);return f}return d!==o?m.style(c,a,d):m.css(c,a)},c,a,1<arguments.length)},show:function(){return k(this,!0)},hide:function(){return k(this)},toggle:function(a){return"boolean"===typeof a?a?this.show():this.hide():this.each(function(){c(this)?m(this).show():m(this).hide()})}});m.extend({cssHooks:{opacity:{get:function(c,a){if(a){var d=Ca(c,"opacity");return""===d?"1":d}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:m.support.cssFloat?"cssFloat":"styleFloat"},style:function(c,a,d,k){if(c&&!(3===c.nodeType||8===c.nodeType||!c.style)){var f,e,b,n=m.camelCase(a),p=c.style;a=m.cssProps[n]||(m.cssProps[n]=B(p,n));b=m.cssHooks[a]||m.cssHooks[n];if(d!==o){e=typeof d;if("string"===e&&(f=ud.exec(d)))d=(f[1]+1)*f[2]+parseFloat(m.css(c,a)),e="number";if(!(null==d||"number"===e&&isNaN(d)))if("number"===e&&!m.cssNumber[n]&&(d+="px"),!m.support.clearCloneStyle&&(""===d&&0===a.indexOf("background"))&&(p[a]="inherit"),!b||!("set"in b)||(d=b.set(c,d,k))!==o)try{p[a]=d}catch(g){}}else return b&&"get"in b&&(f=b.get(c,!1,k))!==o?f:p[a]}},css:function(c,a,d,k){var f,e;e=m.camelCase(a);a=m.cssProps[e]||(m.cssProps[e]=B(c.style,e));(e=m.cssHooks[a]||m.cssHooks[e])&&"get"in e&&(f=e.get(c,!0,d));f===o&&(f=Ca(c,a,k));"normal"===f&&a in oc&&(f=oc[a]);return""===d||d?(c=parseFloat(f),!0===d||m.isNumeric(c)?c||0:f):f}});b.getComputedStyle?(Ba=function(c){return b.getComputedStyle(c,null)},Ca=function(c,a,d){var k,f=(d=d||Ba(c))?d.getPropertyValue(a)||d[a]:o,e=c.style;d&&(""===f&&!m.contains(c.ownerDocument,c)&&(f=m.style(c,a)),Wa.test(f)&&nc.test(a)&&(c=e.width,a=e.minWidth,k=e.maxWidth,e.minWidth=e.maxWidth=e.width=f,f=d.width,e.width=c,e.minWidth=a,e.maxWidth=k));return f}):K.documentElement.currentStyle&&(Ba=function(c){return c.currentStyle},Ca=function(c,a,d){var k,f,e=(d=d||Ba(c))?d[a]:o,b=c.style;null==e&&(b&&b[a])&&(e=b[a]);if(Wa.test(e)&&!sd.test(a)){d=b.left;if(f=(k=c.runtimeStyle)&&k.left)k.left=c.currentStyle.left;b.left="fontSize"===a?"1em":e;e=b.pixelLeft+"px";b.left=d;f&&(k.left=f)}return""===e?"auto":e});m.each(["height","width"],function(c,a){m.cssHooks[a]={get:function(c,d,k){if(d)return 0===c.offsetWidth&&td.test(m.css(c,"display"))?m.swap(c,vd,function(){return G(c,a,k)}):G(c,a,k)},set:function(c,d,k){var f=k&&Ba(c);return C(c,d,k?D(c,a,k,m.support.boxSizing&&"border-box"===m.css(c,"boxSizing",!1,f),f):0)}}});m.support.opacity||(m.cssHooks.opacity={get:function(c,a){return rd.test((a&&c.currentStyle?c.currentStyle.filter:c.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":a?"1":""},set:function(c,a){var d=c.style,k=c.currentStyle,f=m.isNumeric(a)?"alpha(opacity="+100*a+")":"",e=k&&k.filter||d.filter||"";d.zoom=1;if((1<=a||""===a)&&""===m.trim(e.replace(Ib,""))&&d.removeAttribute)if(d.removeAttribute("filter"),""===a||k&&!k.filter)return;d.filter=Ib.test(e)?e.replace(Ib,f):e+" "+f}});m(function(){m.support.reliableMarginRight||(m.cssHooks.marginRight={get:function(c,a){if(a)return m.swap(c,{display:"inline-block"},Ca,[c,"marginRight"])}})
;!m.support.pixelPosition&&m.fn.position&&m.each(["top","left"],function(c,a){m.cssHooks[a]={get:function(c,d){if(d)return d=Ca(c,a),Wa.test(d)?m(c).position()[a]+"px":d}}})});m.expr&&m.expr.filters&&(m.expr.filters.hidden=function(c){return 0>=c.offsetWidth&&0>=c.offsetHeight||!m.support.reliableHiddenOffsets&&"none"===(c.style&&c.style.display||m.css(c,"display"))},m.expr.filters.visible=function(c){return!m.expr.filters.hidden(c)});m.each({margin:"",padding:"",border:"Width"},function(c,a){m.cssHooks[c+a]={expand:function(d){var k=0,f={};for(d="string"===typeof d?d.split(" "):[d];4>k;k++)f[c+Aa[k]+a]=d[k]||d[k-2]||d[0];return f}};nc.test(c)||(m.cssHooks[c+a].set=C)});var wd=/%20/g,Dc=/\[\]$/,pc=/\r?\n/g,xd=/^(?:submit|button|image|reset|file)$/i,yd=/^(?:input|select|textarea|keygen)/i;m.fn.extend({serialize:function(){return m.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var c=m.prop(this,"elements");return c?m.makeArray(c):this}).filter(function(){var c=this.type;return this.name&&!m(this).is(":disabled")&&yd.test(this.nodeName)&&!xd.test(c)&&(this.checked||!mb.test(c))}).map(function(c,a){var d=m(this).val();return null==d?null:m.isArray(d)?m.map(d,function(c){return{name:a.name,value:c.replace(pc,"\r\n")}}):{name:a.name,value:d.replace(pc,"\r\n")}}).get()}});m.param=function(c,a){var d,k=[],f=function(c,a){a=m.isFunction(a)?a():null==a?"":a;k[k.length]=encodeURIComponent(c)+"="+encodeURIComponent(a)};a===o&&(a=m.ajaxSettings&&m.ajaxSettings.traditional);if(m.isArray(c)||c.jquery&&!m.isPlainObject(c))m.each(c,function(){f(this.name,this.value)});else for(d in c)I(d,c[d],a,f);return k.join("&").replace(wd,"+")};m.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(c,a){m.fn[a]=function(c,d){return 0<arguments.length?this.on(a,null,c,d):this.trigger(a)}});m.fn.extend({hover:function(c,a){return this.mouseenter(c).mouseleave(a||c)},bind:function(c,a,d){return this.on(c,null,a,d)},unbind:function(c,a){return this.off(c,null,a)},delegate:function(c,a,d,k){return this.on(a,c,d,k)},undelegate:function(c,a,d){return 1===arguments.length?this.off(c,"**"):this.off(a,c||"**",d)}});var Ka,za,Jb=m.now(),Kb=/\?/,zd=/#.*$/,qc=/([?&])_=[^&]*/,Ad=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Bd=/^(?:GET|HEAD)$/,Cd=/^\/\//,rc=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,sc=m.fn.load,tc={},nb={},uc="*/".concat("*");try{za=Fc.href}catch(Id){za=K.createElement("a"),za.href="",za=za.href}Ka=rc.exec(za.toLowerCase())||[];m.fn.load=function(c,a,d){if("string"!==typeof c&&sc)return sc.apply(this,arguments);var k,f,e,b=this,n=c.indexOf(" ");0<=n&&(k=c.slice(n,c.length),c=c.slice(0,n));m.isFunction(a)?(d=a,a=o):a&&"object"===typeof a&&(e="POST");0<b.length&&m.ajax({url:c,type:e,dataType:"html",data:a}).done(function(c){f=arguments;b.html(k?m("<div>").append(m.parseHTML(c)).find(k):c)}).complete(d&&function(c,a){b.each(d,f||[c.responseText,a,c])});return this};m.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(c,a){m.fn[a]=function(c){return this.on(a,c)}});m.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:za,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ka[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":uc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":m.parseJSON,"text xml":m.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(c,a){return a?T(T(c,m.ajaxSettings),a):T(m.ajaxSettings,c)},ajaxPrefilter:M(tc),ajaxTransport:M(nb),ajax:function(c,a){function d(c,a,k,f){var y,v,A,z;z=a;if(2!==D){D=2;n&&clearTimeout(n);g=o;b=f||"";t.readyState=0<c?4:0;f=200<=c&&300>c||304===c;if(k){A=h;for(var u=t,w,G,H,x,E=A.contents,B=A.dataTypes;"*"===B[0];)B.shift(),G===o&&(G=A.mimeType||u.getResponseHeader("Content-Type"));if(G)for(x in E)if(E[x]&&E[x].test(G)){B.unshift(x);break}if(B[0]in k)H=B[0];else{for(x in k){if(!B[0]||A.converters[x+" "+B[0]]){H=x;break}w||(w=x)}H=H||w}H?(H!==B[0]&&B.unshift(H),A=k[H]):A=void 0}a:{k=h;w=A;G=t;H=f;var F,I,J,u={},E=k.dataTypes.slice();if(E[1])for(I in k.converters)u[I.toLowerCase()]=k.converters[I];for(x=E.shift();x;)if(k.responseFields[x]&&(G[k.responseFields[x]]=w),!J&&(H&&k.dataFilter)&&(w=k.dataFilter(w,k.dataType)),J=x,x=E.shift())if("*"===x)x=J;else if("*"!==J&&J!==x){I=u[J+" "+x]||u["* "+x];if(!I)for(F in u)if(A=F.split(" "),A[1]===x&&(I=u[J+" "+A[0]]||u["* "+A[0]])){!0===I?I=u[F]:!0!==u[F]&&(x=A[0],E.unshift(A[1]));break}if(!0!==I)if(I&&k["throws"])w=I(w);else try{w=I(w)}catch(M){A={state:"parsererror",error:I?M:"No conversion from "+J+" to "+x};break a}}A={state:"success",data:w}}if(f)h.ifModified&&((z=t.getResponseHeader("Last-Modified"))&&(m.lastModified[e]=z),(z=t.getResponseHeader("etag"))&&(m.etag[e]=z)),204===c||"HEAD"===h.type?z="nocontent":304===c?z="notmodified":(z=A.state,y=A.data,v=A.error,f=!v);else if(v=z,c||!z)z="error",0>c&&(c=0);t.status=c;t.statusText=(a||z)+"";f?l.resolveWith(j,[y,z,t]):l.rejectWith(j,[t,z,v]);t.statusCode(r);r=o;p&&q.trigger(f?"ajaxSuccess":"ajaxError",[t,h,f?y:v]);C.fireWith(j,[t,z]);p&&(q.trigger("ajaxComplete",[t,h]),--m.active||m.event.trigger("ajaxStop"))}}"object"===typeof c&&(a=c,c=o);a=a||{};var k,f,e,b,n,p,g,y,h=m.ajaxSetup({},a),j=h.context||h,q=h.context&&(j.nodeType||j.jquery)?m(j):m.event,l=m.Deferred(),C=m.Callbacks("once memory"),r=h.statusCode||{},v={},A={},D=0,u="canceled",t={readyState:0,getResponseHeader:function(c){var a;if(2===D){if(!y)for(y={};a=Ad.exec(b);)y[a[1].toLowerCase()]=a[2];a=y[c.toLowerCase()]}return null==a?null:a},getAllResponseHeaders:function(){return 2===D?b:null},setRequestHeader:function(c,a){var d=c.toLowerCase();D||(c=A[d]=A[d]||c,v[c]=a);return this},overrideMimeType:function(c){D||(h.mimeType=c);return this},statusCode:function(c){var a;if(c)if(2>D)for(a in c)r[a]=[r[a],c[a]];else t.always(c[t.status]);return this},abort:function(c){c=c||u;g&&g.abort(c);d(0,c);return this}};l.promise(t).complete=C.add;t.success=t.done;t.error=t.fail;h.url=((c||h.url||za)+"").replace(zd,"").replace(Cd,Ka[1]+"//");h.type=a.method||a.type||h.method||h.type;h.dataTypes=m.trim(h.dataType||"*").toLowerCase().match(pa)||[""];null==h.crossDomain&&(k=rc.exec(h.url.toLowerCase()),h.crossDomain=!(!k||!(k[1]!==Ka[1]||k[2]!==Ka[2]||(k[3]||("http:"===k[1]?"80":"443"))!==(Ka[3]||("http:"===Ka[1]?"80":"443")))));h.data&&(h.processData&&"string"!==typeof h.data)&&(h.data=m.param(h.data,h.traditional));J(tc,h,a,t);if(2===D)return t;(p=h.global)&&0===m.active++&&m.event.trigger("ajaxStart");h.type=h.type.toUpperCase();h.hasContent=!Bd.test(h.type);e=h.url;h.hasContent||(h.data&&(e=h.url+=(Kb.test(e)?"&":"?")+h.data,delete h.data),!1===h.cache&&(h.url=qc.test(e)?e.replace(qc,"$1_="+Jb++):e+(Kb.test(e)?"&":"?")+"_="+Jb++));h.ifModified&&(m.lastModified[e]&&t.setRequestHeader("If-Modified-Since",m.lastModified[e]),m.etag[e]&&t.setRequestHeader("If-None-Match",m.etag[e]));(h.data&&h.hasContent&&!1!==h.contentType||a.contentType)&&t.setRequestHeader("Content-Type",h.contentType);t.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+uc+"; q=0.01":""):h.accepts["*"]);for(f in h.headers)t.setRequestHeader(f,h.headers[f]);if(h.beforeSend&&(!1===h.beforeSend.call(j,t,h)||2===D))return t.abort();u="abort";for(f in{success:1,error:1,complete:1})t[f](h[f]);if(g=J(nb,h,a,t)){t.readyState=1;p&&q.trigger("ajaxSend",[t,h]);h.async&&0<h.timeout&&(n=setTimeout(function(){t.abort("timeout")},h.timeout));try{D=1,g.send(v,d)}catch(w){if(2>D)d(-1,w);else throw w}}else d(-1,"No Transport");return t},getJSON:function(c,a,d){return m.get(c,a,d,"json")},getScript:function(c,a){return m.get(c,o,a,"script")}});m.each(["get","post"],function(c,a){m[a]=function(c,d,k,f){m.isFunction(d)&&(f=f||k,k=d,d=o);return m.ajax({url:c,type:a,dataType:f,data:d,success:k})}});m.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(c){m.globalEval(c);return c}}});m.ajaxPrefilter("script",function(c){c.cache===o&&(c.cache=!1);c.crossDomain&&(c.type="GET",c.global=!1)});m.ajaxTransport("script",function(c){if(c.crossDomain){var a,d=K.head||m("head")[0]||K.documentElement;return{send:function(k,f){a=K.createElement("script");a.async=!0;c.scriptCharset&&(a.charset=c.scriptCharset);a.src=c.url;a.onload=a.onreadystatechange=function(c,d){if(d||!a.readyState||/loaded|complete/.test(a.readyState))a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a),a=null,d||f(200,"success")};d.insertBefore(a,d.firstChild)},abort:function(){if(a)a.onload(o,!0)}}}});var vc=[],Lb=/(=)\?(?=&|$)|\?\?/;m.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var c=vc.pop()||m.expando+"_"+Jb++;this[c]=!0;return c}});m.ajaxPrefilter("json jsonp",function(c,a,d){var k,f,e,n=!1!==c.jsonp&&(Lb.test(c.url)?"url":"string"===typeof c.data&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&Lb.test(c.data)&&"data");if(n||"jsonp"===c.dataTypes[0])return k=c.jsonpCallback=m.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,n?c[n]=c[n].replace(Lb,"$1"+k):!1!==c.jsonp&&(c.url+=(Kb.test(c.url)?"&":"?")+c.jsonp+"="+k),c.converters["script json"]=function(){e||m.error(k+" was not called");return e[0]},c.dataTypes[0]="json",f=b[k],b[k]=function(){e=arguments},d.always(function(){b[k]=f;c[k]&&(c.jsonpCallback=a.jsonpCallback,vc.push(k));e&&m.isFunction(f)&&f(e[0]);e=f=o}),"script"});var Qa,Va,Dd=0,Mb=b.ActiveXObject&&function(){for(var c in Qa)Qa[c](o,!0)};m.ajaxSettings.xhr=b.ActiveXObject?function(){var c;if(!(c=!this.isLocal&&F()))a:{try{c=new b.ActiveXObject("Microsoft.XMLHTTP");break a}catch(a){}c=void 0}return c}:F;Va=m.ajaxSettings.xhr();m.support.cors=!!Va&&"withCredentials"in Va;(Va=m.support.ajax=!!Va)&&m.ajaxTransport(function(c){if(!c.crossDomain||m.support.cors){var a;return{send:function(d,k){var f,e,n=c.xhr();c.username?n.open(c.type,c.url,c.async,c.username,c.password):n.open(c.type,c.url,c.async);if(c.xhrFields)for(e in c.xhrFields)n[e]=c.xhrFields[e];c.mimeType&&n.overrideMimeType&&n.overrideMimeType(c.mimeType);!c.crossDomain&&!d["X-Requested-With"]&&(d["X-Requested-With"]="XMLHttpRequest");try{for(e in d)n.setRequestHeader(e,d[e])}catch(p){}n.send(c.hasContent&&c.data||null);a=function(d,e){var b,p,g,h;try{if(a&&(e||4===n.readyState))if(a=o,f&&(n.onreadystatechange=m.noop,Mb&&delete Qa[f]),e)4!==n.readyState&&n.abort();else{h={};b=n.status;p=n.getAllResponseHeaders();"string"===typeof n.responseText&&(h.text=n.responseText);try{g=n.statusText}catch(y){g=""}!b&&c.isLocal&&!c.crossDomain?b=h.text?200:404:1223===b&&(b=204)}}catch(j){e||k(-1,j)}h&&k(b,g,h,p)};c.async?4===n.readyState?setTimeout(a):(f=++Dd,Mb&&(Qa||(Qa={},m(b).unload(Mb)),Qa[f]=a),n.onreadystatechange=a):a()},abort:function(){a&&a(o,!0)}}}});var La,lb,Ed=/^(?:toggle|show|hide)$/,wc=RegExp("^(?:([+-])=|)("+Ya+")([a-z%]*)$","i"),Fd=/queueHooks$/,Xa=[function(a,d,k){var f,e,b,n,p,g=this,h={},y=a.style,j=a.nodeType&&c(a),q=m._data(a,"fxshow");k.queue||(n=m._queueHooks(a,"fx"),null==n.unqueued&&(n.unqueued=0,p=n.empty.fire,n.empty.fire=function(){n.unqueued||p()}),n.unqueued++,g.always(function(){g.always(function(){n.unqueued--;m.queue(a,"fx").length||n.empty.fire()})}));if(1===a.nodeType&&("height"in d||"width"in d))k.overflow=[y.overflow,y.overflowX,y.overflowY],"inline"===m.css(a,"display")&&"none"===m.css(a,"float")&&(!m.support.inlineBlockNeedsLayout||"inline"===E(a.nodeName)?y.display="inline-block":y.zoom=1);k.overflow&&(y.overflow="hidden",m.support.shrinkWrapBlocks||g.always(function(){y.overflow=k.overflow[0];y.overflowX=k.overflow[1];y.overflowY=k.overflow[2]}));for(f in d)if(e=d[f],Ed.exec(e)&&(delete d[f],b=b||"toggle"===e,e!==(j?"hide":"show")))h[f]=q&&q[f]||m.style(a,f);if(!m.isEmptyObject(h))for(f in q?"hidden"in q&&(j=q.hidden):q=m._data(a,"fxshow",{}),b&&(q.hidden=!j),j?m(a).show():g.done(function(){m(a).hide()}),g.done(function(){var c;m._removeData(a,"fxshow");for(c in h)m.style(a,c,h[c])}),h)d=R(j?q[f]:0,f,g),f in q||(q[f]=d.start,j&&(d.end=d.start,d.start="width"===f||"height"===f?1:0))}],Sa={"*":[function(c,a){var d=this.createTween(c,a),k=d.cur(),f=wc.exec(a),e=f&&f[3]||(m.cssNumber[c]?"":"px"),b=(m.cssNumber[c]||"px"!==e&&+k)&&wc.exec(m.css(d.elem,c)),n=1,p=20;if(b&&b[3]!==e){e=e||b[3];f=f||[];b=+k||1;do{n=n||".5",b/=n,m.style(d.elem,c,b+e)}while(n!==(n=d.cur()/k)&&1!==n&&--p)}f&&(b=d.start=+b||+k||0,d.unit=e,d.end=f[1]?b+(f[1]+1)*f[2]:+f[2]);return d}]};m.Animation=m.extend(O,{tweener:function(c,a){m.isFunction(c)?(a=c,c=["*"]):c=c.split(" ");for(var d,k=0,f=c.length;k<f;k++)d=c[k],Sa[d]=Sa[d]||[],Sa[d].unshift(a)},prefilter:function(c,a){a?Xa.unshift(c):Xa.push(c)}});m.Tween=L;L.prototype={constructor:L,init:function(c,a,d,k,f,e){this.elem=c;this.prop=d;this.easing=f||"swing";this.options=a;this.start=this.now=this.cur();this.end=k;this.unit=e||(m.cssNumber[d]?"":"px")},cur:function(){var c=L.propHooks[this.prop];return c&&c.get?c.get(this):L.propHooks._default.get(this)},run:function(c){var a,d=L.propHooks[this.prop];this.pos=this.options.duration?a=m.easing[this.easing](c,this.options.duration*c,0,1,this.options.duration):a=c;this.now=(this.end-this.start)*a+this.start;this.options.step&&this.options.step.call(this.elem,this.now,this);d&&d.set?d.set(this):L.propHooks._default.set(this);return this}};L.prototype.init.prototype=L.prototype;L.propHooks={_default:{get:function(c){if(null!=c.elem[c.prop]&&(!c.elem.style||null==c.elem.style[c.prop]))return c.elem[c.prop];c=m.css(c.elem,c.prop,"");return!c||"auto"===c?0:c},set:function(c){if(m.fx.step[c.prop])m.fx.step[c.prop](c);else c.elem.style&&(null!=c.elem.style[m.cssProps[c.prop]]||m.cssHooks[c.prop])?m.style(c.elem,c.prop,c.now+c.unit):c.elem[c.prop]=c.now}}};L.propHooks.scrollTop=L.propHooks.scrollLeft={set:function(c){c.elem.nodeType&&c.elem.parentNode&&(c.elem[c.prop]=c.now)}};m.each(["toggle","show","hide"],function(c,a){var d=m.fn[a];m.fn[a]=function(c,k,f){return null==c||"boolean"===typeof c?d.apply(this,arguments):this.animate(Z(a,!0),c,k,f)}});m.fn.extend({fadeTo:function(a,d,k,f){return this.filter(c).css("opacity",0).show().end().animate({opacity:d},a,k,f)},animate:function(c,a,d,k){var f=m.isEmptyObject(c),e=m.speed(a,d,k);a=function(){var a=O(this,m.extend({},c),e);(f||m._data(this,"finish"))&&a.stop(!0)};a.finish=a;return f||!1===e.queue?this.each(a):this.queue(e.queue,a)},stop:function(c,a,d){var k=function(c){var a=c.stop;delete c.stop;a(d)};"string"!==typeof c&&(d=a,a=c,c=o);a&&!1!==c&&this.queue(c||"fx",[]);return this.each(function(){var a=!0,f=null!=c&&c+"queueHooks",e=m.timers,b=m._data(this);if(f)b[f]&&b[f].stop&&k(b[f]);else for(f in b)b[f]&&(b[f].stop&&Fd.test(f))&&k(b[f]);for(f=e.length;f--;)if(e[f].elem===this&&(null==c||e[f].queue===c))e[f].anim.stop(d),a=!1,e.splice(f,1);(a||!d)&&m.dequeue(this,c)})},finish:function(c){!1!==c&&(c=c||"fx");return this.each(function(){var a,d=m._data(this),k=d[c+"queue"];a=d[c+"queueHooks"];var f=m.timers,e=k?k.length:0;d.finish=!0;m.queue(this,c,[]);a&&a.stop&&a.stop.call(this,!0);for(a=f.length;a--;)f[a].elem===this&&f[a].queue===c&&(f[a].anim.stop(!0),f.splice(a,1));for(a=0;a<e;a++)k[a]&&k[a].finish&&k[a].finish.call(this);delete d.finish})}});m.each({slideDown:Z("show"),slideUp:Z("hide"),slideToggle:Z("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(c,a){m.fn[c]=function(c,d,k){return this.animate(a,c,d,k)}});m.speed=function(c,a,d){var k=c&&"object"===typeof c?m.extend({},c):{complete:d||!d&&a||m.isFunction(c)&&c,duration:c,easing:d&&a||a&&!m.isFunction(a)&&a};k.duration=m.fx.off?0:"number"===typeof k.duration?k.duration:k.duration in m.fx.speeds?m.fx.speeds[k.duration]:m.fx.speeds._default;if(null==k.queue||!0===k.queue)k.queue="fx";k.old=k.complete;k.complete=function(){m.isFunction(k.old)&&k.old.call(this);k.queue&&m.dequeue(this,k.queue)};return k};m.easing={linear:function(c){return c},swing:function(c){return.5-Math.cos(c*Math.PI)/2}};m.timers=[];m.fx=L.prototype.init;m.fx.tick=function(){var c,a=m.timers,d=0;for(La=m.now();d<a.length;d++)c=a[d],!c()&&a[d]===c&&a.splice(d--,1);a.length||m.fx.stop();La=o};m.fx.timer=function(c){c()&&m.timers.push(c)&&m.fx.start()};m.fx.interval=13;m.fx.start=function(){lb||(lb=setInterval(m.fx.tick,m.fx.interval))};m.fx.stop=function(){clearInterval(lb);lb=null};m.fx.speeds={slow:600,fast:200,_default:400};m.fx.step={};m.expr&&m.expr.filters&&(m.expr.filters.animated=function(c){return m.grep(m.timers,function(a){return c===a.elem}).length});m.fn.offset=function(c){if(arguments.length)return c===o?this:this.each(function(a){m.offset.setOffset(this,c,a)});var a,d,k={top:0,left:0},f=(d=this[0])&&d.ownerDocument;if(f){a=f.documentElement;if(!m.contains(a,d))return k;typeof d.getBoundingClientRect!==oa&&(k=d.getBoundingClientRect());d=Da(f);return{top:k.top+(d.pageYOffset||a.scrollTop)-(a.clientTop||0),left:k.left+(d.pageXOffset||a.scrollLeft)-(a.clientLeft||0)}}};m.offset={setOffset:function(c,a,d){var k=m.css(c,"position");"static"===k&&(c.style.position="relative");var f=m(c),e=f.offset(),b=m.css(c,"top"),n=m.css(c,"left"),p={},g={};("absolute"===k||"fixed"===k)&&-1<m.inArray("auto",[b,n])?(g=f.position(),k=g.top,n=g.left):(k=parseFloat(b)||0,n=parseFloat(n)||0);m.isFunction(a)&&(a=a.call(c,d,e));null!=a.top&&(p.top=a.top-e.top+k);null!=a.left&&(p.left=a.left-e.left+n);"using"in a?a.using.call(c,p):f.css(p)}};m.fn.extend({position:function(){if(this[0]){var c,a,d={top:0,left:0},k=this[0];"fixed"===m.css(k,"position")?a=k.getBoundingClientRect():(c=this.offsetParent(),a=this.offset(),m.nodeName(c[0],"html")||(d=c.offset()),d.top+=m.css(c[0],"borderTopWidth",!0),d.left+=m.css(c[0],"borderLeftWidth",!0));return{top:a.top-d.top-m.css(k,"marginTop",!0),left:a.left-d.left-m.css(k,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var c=this.offsetParent||ca;c&&!m.nodeName(c,"html")&&"static"===m.css(c,"position");)c=c.offsetParent;return c||ca})}});m.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(c,a){var d=/Y/.test(a);m.fn[c]=function(k){return m.access(this,function(c,k,f){var e=Da(c);if(f===o)return e?a in e?e[a]:e.document.documentElement[k]:c[k];e?e.scrollTo(!d?f:m(e).scrollLeft(),d?f:m(e).scrollTop()):c[k]=f},c,k,arguments.length,null)}});m.each({Height:"height",Width:"width"},function(c,a){m.each({padding:"inner"+c,content:a,"":"outer"+c},function(d,k){m.fn[k]=function(k,f){var e=arguments.length&&(d||"boolean"!==typeof k),b=d||(!0===k||!0===f?"margin":"border");return m.access(this,function(a,d,k){return m.isWindow(a)?a.document.documentElement["client"+c]:9===a.nodeType?(d=a.documentElement,Math.max(a.body["scroll"+c],d["scroll"+c],a.body["offset"+c],d["offset"+c],d["client"+c])):k===o?m.css(a,d,b):m.style(a,d,k,b)},a,e?k:o,e,null)}})});m.fn.size=function(){return this.length};m.fn.andSelf=m.fn.addBack;j.jQuery=m})(window,ChemDoodle.lib);(function(b){"function"===typeof define&&define.amd?define(["jquery"],b):"object"===typeof exports?module.exports=b:b(ChemDoodle.lib.jQuery)})(function(b){function j(f){var n=f||window.event,h=g.call(arguments,1),j=0,l=0,v=0,u=0;f=b.event.fix(n);f.type="mousewheel";"detail"in n&&(v=-1*n.detail);"wheelDelta"in n&&(v=n.wheelDelta);"wheelDeltaY"in n&&(v=n.wheelDeltaY);"wheelDeltaX"in n&&(l=-1*n.wheelDeltaX);"axis"in n&&n.axis===n.HORIZONTAL_AXIS&&(l=-1*v,v=0);j=0===v?l:v;"deltaY"in n&&(j=v=-1*n.deltaY);"deltaX"in n&&(l=n.deltaX,0===v&&(j=-1*l));if(!(0===v&&0===l)){1===n.deltaMode?(n=b.data(this,"mousewheel-line-height"),j*=n,v*=n,l*=n):2===n.deltaMode&&(n=b.data(this,"mousewheel-page-height"),j*=n,v*=n,l*=n);u=Math.max(Math.abs(v),Math.abs(l));if(!d||u<d)d=u,120===d&&(e=!0,d/=40);e&&(j/=40,l/=40,v/=40);j=Math[1<=j?"floor":"ceil"](j/d);l=Math[1<=l?"floor":"ceil"](l/d);v=Math[1<=v?"floor":"ceil"](v/d);f.deltaX=l;f.deltaY=v;f.deltaFactor=d;f.deltaMode=0;h.unshift(f,j,l,v);a&&clearTimeout(a);a=setTimeout(o,200);return(b.event.dispatch||b.event.handle).apply(this,h)}}function o(){e=d=null}var l=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],g=Array.prototype.slice,e,a,d;if(b.event.fixHooks)for(var n=l.length;n;)b.event.fixHooks[l[--n]]=b.event.mouseHooks;var f=b.event.special.mousewheel={version:"3.1.8",setup:function(){if(this.addEventListener)for(var a=h.length;a;)this.addEventListener(h[--a],j,!1);else this.onmousewheel=j;b.data(this,"mousewheel-line-height",f.getLineHeight(this));b.data(this,"mousewheel-page-height",f.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var a=h.length;a;)this.removeEventListener(h[--a],j,!1);else this.onmousewheel=null},getLineHeight:function(a){return parseInt(b(a)["offsetParent"in b.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(a){return b(a).height()}};b.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});(function(b,j){"object"===typeof exports?module.exports=j(global):"function"===typeof define&&define.amd?define([],function(){return j(b)}):j(b)})(ChemDoodle.lib,function(b){function j(c){return e=c}function o(){return e="undefined"!==typeof Float32Array?Float32Array:Array}var l={};if("undefined"!=typeof Float32Array){var h=new Float32Array(1),g=new Int32Array(h.buffer);l.invsqrt=function(c){h[0]=c;g[0]=1597463007-(g[0]>>1);var a=h[0];return a*(1.5-.5*c*a*a)}}else l.invsqrt=function(c){return 1/Math.sqrt(c)};var e=null;o();var a={create:function(c){var a=new e(3);c?(a[0]=c[0],a[1]=c[1],a[2]=c[2]):a[0]=a[1]=a[2]=0;return a},createFrom:function(c,a,d){var f=new e(3);f[0]=c;f[1]=a;f[2]=d;return f},set:function(c,a){a[0]=c[0];a[1]=c[1];a[2]=c[2];return a},equal:function(c,a){return c===a||1e-6>Math.abs(c[0]-a[0])&&1e-6>Math.abs(c[1]-a[1])&&1e-6>Math.abs(c[2]-a[2])},add:function(c,a,d){if(!d||c===d)return c[0]+=a[0],c[1]+=a[1],c[2]+=a[2],c;d[0]=c[0]+a[0];d[1]=c[1]+a[1];d[2]=c[2]+a[2];return d},subtract:function(c,a,d){if(!d||c===d)return c[0]-=a[0],c[1]-=a[1],c[2]-=a[2],c;d[0]=c[0]-a[0];d[1]=c[1]-a[1];d[2]=c[2]-a[2];return d},multiply:function(c,a,d){if(!d||c===d)return c[0]*=a[0],c[1]*=a[1],c[2]*=a[2],c;d[0]=c[0]*a[0];d[1]=c[1]*a[1];d[2]=c[2]*a[2];return d},negate:function(c,a){a||(a=c);a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];return a},scale:function(c,a,d){if(!d||c===d)return c[0]*=a,c[1]*=a,c[2]*=a,c;d[0]=c[0]*a;d[1]=c[1]*a;d[2]=c[2]*a;return d},normalize:function(c,a){a||(a=c);var d=c[0],f=c[1],e=c[2],b=Math.sqrt(d*d+f*f+e*e);if(b){if(1===b)return a[0]=d,a[1]=f,a[2]=e,a}else return a[0]=0,a[1]=0,a[2]=0,a;b=1/b;a[0]=d*b;a[1]=f*b;a[2]=e*b;return a},cross:function(c,a,d){d||(d=c);var f=c[0],e=c[1];c=c[2];var b=a[0],n=a[1];a=a[2];d[0]=e*a-c*n;d[1]=c*b-f*a;d[2]=f*n-e*b;return d},length:function(c){var a=c[0],d=c[1];c=c[2];return Math.sqrt(a*a+d*d+c*c)},squaredLength:function(c){var a=c[0],d=c[1];c=c[2];return a*a+d*d+c*c},dot:function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]},direction:function(c,a,d){d||(d=c);var f=c[0]-a[0],e=c[1]-a[1];c=c[2]-a[2];a=Math.sqrt(f*f+e*e+c*c);if(!a)return d[0]=0,d[1]=0,d[2]=0,d;a=1/a;d[0]=f*a;d[1]=e*a;d[2]=c*a;return d},lerp:function(c,a,d,f){f||(f=c);f[0]=c[0]+d*(a[0]-c[0]);f[1]=c[1]+d*(a[1]-c[1]);f[2]=c[2]+d*(a[2]-c[2]);return f},dist:function(c,a){var d=a[0]-c[0],f=a[1]-c[1],e=a[2]-c[2];return Math.sqrt(d*d+f*f+e*e)}},d=null,n=new e(4);a.unproject=function(c,a,f,e,b){b||(b=c);d||(d=r.create());var g=d;n[0]=2*(c[0]-e[0])/e[2]-1;n[1]=2*(c[1]-e[1])/e[3]-1;n[2]=2*c[2]-1;n[3]=1;r.multiply(f,a,g);if(!r.inverse(g))return null;r.multiplyVec4(g,n);if(0===n[3])return null;b[0]=n[0]/n[3];b[1]=n[1]/n[3];b[2]=n[2]/n[3];return b};var f=a.createFrom(1,0,0),y=a.createFrom(0,1,0),p=a.createFrom(0,0,1),q=a.create();a.rotationTo=function(c,d,e){e||(e=v.create());var b=a.dot(c,d);if(1<=b)v.set(u,e);else if(-.999999>b)a.cross(f,c,q),1e-6>a.length(q)&&a.cross(y,c,q),1e-6>a.length(q)&&a.cross(p,c,q),a.normalize(q),v.fromAngleAxis(Math.PI,q,e);else{var b=Math.sqrt(2*(1+b)),n=1/b;a.cross(c,d,q);e[0]=q[0]*n;e[1]=q[1]*n;e[2]=q[2]*n;e[3]=.5*b;v.normalize(e)}1<e[3]?e[3]=1:-1>e[3]&&(e[3]=-1);return e};a.str=function(c){return"["+c[0]+", "+c[1]+", "+c[2]+"]"};var A={create:function(c){var a=new e(9);c?(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8]):a[0]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=0;return a},createFrom:function(c,a,d,f,b,n,g,p,h){var y=new e(9);y[0]=c;y[1]=a;y[2]=d;y[3]=f;y[4]=b;y[5]=n;y[6]=g;y[7]=p;y[8]=h;return y},determinant:function(c){var a=c[3],d=c[4],f=c[5],e=c[6],b=c[7],n=c[8];return c[0]*(n*d-f*b)+c[1]*(-n*a+f*e)+c[2]*(b*a-d*e)},inverse:function(c,a){var d=c[0],f=c[1],e=c[2],b=c[3],n=c[4],g=c[5],p=c[6],h=c[7],y=c[8],j=y*n-g*h,q=-y*b+g*p,l=h*b-n*p,r=d*j+f*q+e*l;if(!r)return null;r=1/r;a||(a=A.create());a[0]=j*r;a[1]=(-y*f+e*h)*r;a[2]=(g*f-e*n)*r;a[3]=q*r;a[4]=(y*d-e*p)*r;a[5]=(-g*d+e*b)*r;a[6]=l*r;a[7]=(-h*d+f*p)*r;a[8]=(n*d-f*b)*r;return a},multiply:function(c,a,d){d||(d=c);var f=c[0],e=c[1],b=c[2],n=c[3],g=c[4],p=c[5],h=c[6],y=c[7];c=c[8];var j=a[0],q=a[1],l=a[2],r=a[3],o=a[4],v=a[5],A=a[6],t=a[7];a=a[8];d[0]=j*f+q*n+l*h;d[1]=j*e+q*g+l*y;d[2]=j*b+q*p+l*c;d[3]=r*f+o*n+v*h;d[4]=r*e+o*g+v*y;d[5]=r*b+o*p+v*c;d[6]=A*f+t*n+a*h;d[7]=A*e+t*g+a*y;d[8]=A*b+t*p+a*c;return d},multiplyVec2:function(c,a,d){d||(d=a);var f=a[0];a=a[1];d[0]=f*c[0]+a*c[3]+c[6];d[1]=f*c[1]+a*c[4]+c[7];return d},multiplyVec3:function(c,a,d){d||(d=a);var f=a[0],e=a[1];a=a[2];d[0]=f*c[0]+e*c[3]+a*c[6];d[1]=f*c[1]+e*c[4]+a*c[7];d[2]=f*c[2]+e*c[5]+a*c[8];return d},set:function(c,a){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];return a},equal:function(c,a){return c===a||1e-6>Math.abs(c[0]-a[0])&&1e-6>Math.abs(c[1]-a[1])&&1e-6>Math.abs(c[2]-a[2])&&1e-6>Math.abs(c[3]-a[3])&&1e-6>Math.abs(c[4]-a[4])&&1e-6>Math.abs(c[5]-a[5])&&1e-6>Math.abs(c[6]-a[6])&&1e-6>Math.abs(c[7]-a[7])&&1e-6>Math.abs(c[8]-a[8])},identity:function(c){c||(c=A.create());c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=1;c[5]=0;c[6]=0;c[7]=0;c[8]=1;return c},transpose:function(c,a){if(!a||c===a){var d=c[1],f=c[2],e=c[5];c[1]=c[3];c[2]=c[6];c[3]=d;c[5]=c[7];c[6]=f;c[7]=e;return c}a[0]=c[0];a[1]=c[3];a[2]=c[6];a[3]=c[1];a[4]=c[4];a[5]=c[7];a[6]=c[2];a[7]=c[5];a[8]=c[8];return a},toMat4:function(c,a){a||(a=r.create());a[15]=1;a[14]=0;a[13]=0;a[12]=0;a[11]=0;a[10]=c[8];a[9]=c[7];a[8]=c[6];a[7]=0;a[6]=c[5];a[5]=c[4];a[4]=c[3];a[3]=0;a[2]=c[2];a[1]=c[1];a[0]=c[0];return a},str:function(c){return"["+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+", "+c[6]+", "+c[7]+", "+c[8]+"]"}},r={create:function(c){var a=new e(16);c&&(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);return a},createFrom:function(c,a,d,f,b,n,g,p,h,y,j,q,l,r,o,v){var A=new e(16);A[0]=c;A[1]=a;A[2]=d;A[3]=f;A[4]=b;A[5]=n;A[6]=g;A[7]=p;A[8]=h;A[9]=y;A[10]=j;A[11]=q;A[12]=l;A[13]=r;A[14]=o;A[15]=v;return A},set:function(c,a){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];a[9]=c[9];a[10]=c[10];a[11]=c[11];a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a},equal:function(c,a){return c===a||1e-6>Math.abs(c[0]-a[0])&&1e-6>Math.abs(c[1]-a[1])&&1e-6>Math.abs(c[2]-a[2])&&1e-6>Math.abs(c[3]-a[3])&&1e-6>Math.abs(c[4]-a[4])&&1e-6>Math.abs(c[5]-a[5])&&1e-6>Math.abs(c[6]-a[6])&&1e-6>Math.abs(c[7]-a[7])&&1e-6>Math.abs(c[8]-a[8])&&1e-6>Math.abs(c[9]-a[9])&&1e-6>Math.abs(c[10]-a[10])&&1e-6>Math.abs(c[11]-a[11])&&1e-6>Math.abs(c[12]-a[12])&&1e-6>Math.abs(c[13]-a[13])&&1e-6>Math.abs(c[14]-a[14])&&1e-6>Math.abs(c[15]-a[15])},identity:function(c){c||(c=r.create());c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c},transpose:function(c,a){if(!a||c===a){var d=c[1],f=c[2],e=c[3],b=c[6],n=c[7],g=c[11];c[1]=c[4];c[2]=c[8];c[3]=c[12];c[4]=d;c[6]=c[9];c[7]=c[13];c[8]=f;c[9]=b;c[11]=c[14];c[12]=e;c[13]=n;c[14]=g;return c}a[0]=c[0];a[1]=c[4];a[2]=c[8];a[3]=c[12];a[4]=c[1];a[5]=c[5];a[6]=c[9];a[7]=c[13];a[8]=c[2];a[9]=c[6];a[10]=c[10];a[11]=c[14];a[12]=c[3];a[13]=c[7];a[14]=c[11];a[15]=c[15];return a},determinant:function(c){var a=c[0],d=c[1],f=c[2],e=c[3],b=c[4],n=c[5],g=c[6],p=c[7],h=c[8],y=c[9],j=c[10],q=c[11],l=c[12],r=c[13],o=c[14];c=c[15];return l*y*g*e-h*r*g*e-l*n*j*e+b*r*j*e+h*n*o*e-b*y*o*e-l*y*f*p+h*r*f*p+l*d*j*p-a*r*j*p-h*d*o*p+a*y*o*p+l*n*f*q-b*r*f*q-l*d*g*q+a*r*g*q+b*d*o*q-a*n*o*q-h*n*f*c+b*y*f*c+h*d*g*c-a*y*g*c-b*d*j*c+a*n*j*c},inverse:function(c,a){a||(a=c);var d=c[0],f=c[1],e=c[2],b=c[3],n=c[4],g=c[5],p=c[6],h=c[7],y=c[8],j=c[9],q=c[10],l=c[11],r=c[12],o=c[13],v=c[14],A=c[15],t=d*g-f*n,u=d*p-e*n,w=d*h-b*n,x=f*p-e*g,B=f*h-b*g,ca=e*h-b*p,da=y*o-j*r,ea=y*v-q*r,Y=y*A-l*r,ga=j*v-q*o,sa=j*A-l*o,qa=q*A-l*v,U=t*qa-u*sa+w*ga+x*Y-B*ea+ca*da;if(!U)return null;U=1/U;a[0]=(g*qa-p*sa+h*ga)*U;a[1]=(-f*qa+e*sa-b*ga)*U;a[2]=(o*ca-v*B+A*x)*U;a[3]=(-j*ca+q*B-l*x)*U;a[4]=(-n*qa+p*Y-h*ea)*U;a[5]=(d*qa-e*Y+b*ea)*U;a[6]=(-r*ca+v*w-A*u)*U;a[7]=(y*ca-q*w+l*u)*U;a[8]=(n*sa-g*Y+h*da)*U;a[9]=(-d*sa+f*Y-b*da)*U;a[10]=(r*B-o*w+A*t)*U;a[11]=(-y*B+j*w-l*t)*U;a[12]=(-n*ga+g*ea-p*da)*U;a[13]=(d*ga-f*ea+e*da)*U;a[14]=(-r*x+o*u-v*t)*U;a[15]=(y*x-j*u+q*t)*U;return a},toRotationMat:function(c,a){a||(a=r.create());a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];a[9]=c[9];a[10]=c[10];a[11]=c[11];a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},toMat3:function(c,a){a||(a=A.create());a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[4];a[4]=c[5];a[5]=c[6];a[6]=c[8];a[7]=c[9];a[8]=c[10];return a},toInverseMat3:function(c,a){var d=c[0],f=c[1],e=c[2],b=c[4],n=c[5],g=c[6],p=c[8],h=c[9],y=c[10],j=y*n-g*h,q=-y*b+g*p,l=h*b-n*p,r=d*j+f*q+e*l;if(!r)return null;r=1/r;a||(a=A.create());a[0]=j*r;a[1]=(-y*f+e*h)*r;a[2]=(g*f-e*n)*r;a[3]=q*r;a[4]=(y*d-e*p)*r;a[5]=(-g*d+e*b)*r;a[6]=l*r;a[7]=(-h*d+f*p)*r;a[8]=(n*d-f*b)*r;return a},multiply:function(c,a,d){d||(d=c);var f=c[0],e=c[1],b=c[2],n=c[3],g=c[4],p=c[5],h=c[6],y=c[7],j=c[8],q=c[9],l=c[10],r=c[11],o=c[12],v=c[13],A=c[14];c=c[15];var t=a[0],u=a[1],w=a[2],x=a[3];d[0]=t*f+u*g+w*j+x*o;d[1]=t*e+u*p+w*q+x*v;d[2]=t*b+u*h+w*l+x*A;d[3]=t*n+u*y+w*r+x*c;t=a[4];u=a[5];w=a[6];x=a[7];d[4]=t*f+u*g+w*j+x*o;d[5]=t*e+u*p+w*q+x*v;d[6]=t*b+u*h+w*l+x*A;d[7]=t*n+u*y+w*r+x*c;t=a[8];u=a[9];w=a[10];x=a[11];d[8]=t*f+u*g+w*j+x*o;d[9]=t*e+u*p+w*q+x*v;d[10]=t*b+u*h+w*l+x*A;d[11]=t*n+u*y+w*r+x*c;t=a[12];u=a[13];w=a[14];x=a[15];d[12]=t*f+u*g+w*j+x*o;d[13]=t*e+u*p+w*q+x*v;d[14]=t*b+u*h+w*l+x*A;d[15]=t*n+u*y+w*r+x*c;return d},multiplyVec3:function(c,a,d){d||(d=a);var f=a[0],e=a[1];a=a[2];d[0]=c[0]*f+c[4]*e+c[8]*a+c[12];d[1]=c[1]*f+c[5]*e+c[9]*a+c[13];d[2]=c[2]*f+c[6]*e+c[10]*a+c[14];return d},multiplyVec4:function(c,a,d){d||(d=a);var f=a[0],e=a[1],b=a[2];a=a[3];d[0]=c[0]*f+c[4]*e+c[8]*b+c[12]*a;d[1]=c[1]*f+c[5]*e+c[9]*b+c[13]*a;d[2]=c[2]*f+c[6]*e+c[10]*b+c[14]*a;d[3]=c[3]*f+c[7]*e+c[11]*b+c[15]*a;return d},translate:function(c,a,d){var f=a[0],e=a[1];a=a[2];var b,n,g,p,h,y,j,q,l,r,o,v;if(!d||c===d)return c[12]=c[0]*f+c[4]*e+c[8]*a+c[12],c[13]=c[1]*f+c[5]*e+c[9]*a+c[13],c[14]=c[2]*f+c[6]*e+c[10]*a+c[14],c[15]=c[3]*f+c[7]*e+c[11]*a+c[15],c;b=c[0];n=c[1];g=c[2];p=c[3];h=c[4];y=c[5];j=c[6];q=c[7];l=c[8];r=c[9];o=c[10];v=c[11];d[0]=b;d[1]=n;d[2]=g;d[3]=p;d[4]=h;d[5]=y;d[6]=j;d[7]=q
;d[8]=l;d[9]=r;d[10]=o;d[11]=v;d[12]=b*f+h*e+l*a+c[12];d[13]=n*f+y*e+r*a+c[13];d[14]=g*f+j*e+o*a+c[14];d[15]=p*f+q*e+v*a+c[15];return d},scale:function(c,a,d){var f=a[0],e=a[1];a=a[2];if(!d||c===d)return c[0]*=f,c[1]*=f,c[2]*=f,c[3]*=f,c[4]*=e,c[5]*=e,c[6]*=e,c[7]*=e,c[8]*=a,c[9]*=a,c[10]*=a,c[11]*=a,c;d[0]=c[0]*f;d[1]=c[1]*f;d[2]=c[2]*f;d[3]=c[3]*f;d[4]=c[4]*e;d[5]=c[5]*e;d[6]=c[6]*e;d[7]=c[7]*e;d[8]=c[8]*a;d[9]=c[9]*a;d[10]=c[10]*a;d[11]=c[11]*a;d[12]=c[12];d[13]=c[13];d[14]=c[14];d[15]=c[15];return d},rotate:function(c,a,d,f){var e=d[0],b=d[1];d=d[2];var n=Math.sqrt(e*e+b*b+d*d),g,p,h,y,j,q,l,r,o,v,A,t,u,w,x,B,ca,da,ea,Y;if(!n)return null;1!==n&&(n=1/n,e*=n,b*=n,d*=n);g=Math.sin(a);p=Math.cos(a);h=1-p;a=c[0];n=c[1];y=c[2];j=c[3];q=c[4];l=c[5];r=c[6];o=c[7];v=c[8];A=c[9];t=c[10];u=c[11];w=e*e*h+p;x=b*e*h+d*g;B=d*e*h-b*g;ca=e*b*h-d*g;da=b*b*h+p;ea=d*b*h+e*g;Y=e*d*h+b*g;e=b*d*h-e*g;b=d*d*h+p;f?c!==f&&(f[12]=c[12],f[13]=c[13],f[14]=c[14],f[15]=c[15]):f=c;f[0]=a*w+q*x+v*B;f[1]=n*w+l*x+A*B;f[2]=y*w+r*x+t*B;f[3]=j*w+o*x+u*B;f[4]=a*ca+q*da+v*ea;f[5]=n*ca+l*da+A*ea;f[6]=y*ca+r*da+t*ea;f[7]=j*ca+o*da+u*ea;f[8]=a*Y+q*e+v*b;f[9]=n*Y+l*e+A*b;f[10]=y*Y+r*e+t*b;f[11]=j*Y+o*e+u*b;return f},rotateX:function(c,a,d){var f=Math.sin(a);a=Math.cos(a);var e=c[4],b=c[5],n=c[6],g=c[7],p=c[8],h=c[9],y=c[10],j=c[11];d?c!==d&&(d[0]=c[0],d[1]=c[1],d[2]=c[2],d[3]=c[3],d[12]=c[12],d[13]=c[13],d[14]=c[14],d[15]=c[15]):d=c;d[4]=e*a+p*f;d[5]=b*a+h*f;d[6]=n*a+y*f;d[7]=g*a+j*f;d[8]=e*-f+p*a;d[9]=b*-f+h*a;d[10]=n*-f+y*a;d[11]=g*-f+j*a;return d},rotateY:function(c,a,d){var f=Math.sin(a);a=Math.cos(a);var e=c[0],b=c[1],n=c[2],g=c[3],p=c[8],h=c[9],y=c[10],j=c[11];d?c!==d&&(d[4]=c[4],d[5]=c[5],d[6]=c[6],d[7]=c[7],d[12]=c[12],d[13]=c[13],d[14]=c[14],d[15]=c[15]):d=c;d[0]=e*a+p*-f;d[1]=b*a+h*-f;d[2]=n*a+y*-f;d[3]=g*a+j*-f;d[8]=e*f+p*a;d[9]=b*f+h*a;d[10]=n*f+y*a;d[11]=g*f+j*a;return d},rotateZ:function(c,a,d){var f=Math.sin(a);a=Math.cos(a);var e=c[0],b=c[1],n=c[2],g=c[3],p=c[4],h=c[5],y=c[6],j=c[7];d?c!==d&&(d[8]=c[8],d[9]=c[9],d[10]=c[10],d[11]=c[11],d[12]=c[12],d[13]=c[13],d[14]=c[14],d[15]=c[15]):d=c;d[0]=e*a+p*f;d[1]=b*a+h*f;d[2]=n*a+y*f;d[3]=g*a+j*f;d[4]=e*-f+p*a;d[5]=b*-f+h*a;d[6]=n*-f+y*a;d[7]=g*-f+j*a;return d},frustum:function(c,a,d,f,e,b,n){n||(n=r.create());var g=a-c,p=f-d,h=b-e;n[0]=2*e/g;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=2*e/p;n[6]=0;n[7]=0;n[8]=(a+c)/g;n[9]=(f+d)/p;n[10]=-(b+e)/h;n[11]=-1;n[12]=0;n[13]=0;n[14]=-(2*b*e)/h;n[15]=0;return n},perspective:function(c,a,d,f,e){c=d*Math.tan(c*Math.PI/360);a*=c;return r.frustum(-a,a,-c,c,d,f,e)},ortho:function(c,a,d,f,e,b,n){n||(n=r.create());var g=a-c,p=f-d,h=b-e;n[0]=2/g;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=2/p;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=-2/h;n[11]=0;n[12]=-(c+a)/g;n[13]=-(f+d)/p;n[14]=-(b+e)/h;n[15]=1;return n},lookAt:function(c,a,d,f){f||(f=r.create());var e,b,n,g,p,h,y,j,q=c[0],l=c[1];c=c[2];n=d[0];g=d[1];b=d[2];y=a[0];d=a[1];e=a[2];if(q===y&&l===d&&c===e)return r.identity(f);a=q-y;d=l-d;y=c-e;j=1/Math.sqrt(a*a+d*d+y*y);a*=j;d*=j;y*=j;e=g*y-b*d;b=b*a-n*y;n=n*d-g*a;(j=Math.sqrt(e*e+b*b+n*n))?(j=1/j,e*=j,b*=j,n*=j):n=b=e=0;g=d*n-y*b;p=y*e-a*n;h=a*b-d*e;(j=Math.sqrt(g*g+p*p+h*h))?(j=1/j,g*=j,p*=j,h*=j):h=p=g=0;f[0]=e;f[1]=g;f[2]=a;f[3]=0;f[4]=b;f[5]=p;f[6]=d;f[7]=0;f[8]=n;f[9]=h;f[10]=y;f[11]=0;f[12]=-(e*q+b*l+n*c);f[13]=-(g*q+p*l+h*c);f[14]=-(a*q+d*l+y*c);f[15]=1;return f},fromRotationTranslation:function(c,a,d){d||(d=r.create());var f=c[0],e=c[1],b=c[2],n=c[3],g=f+f,p=e+e,h=b+b;c=f*g;var y=f*p,f=f*h,j=e*p,e=e*h,b=b*h,g=n*g,p=n*p,n=n*h;d[0]=1-(j+b);d[1]=y+n;d[2]=f-p;d[3]=0;d[4]=y-n;d[5]=1-(c+b);d[6]=e+g;d[7]=0;d[8]=f+p;d[9]=e-g;d[10]=1-(c+j);d[11]=0;d[12]=a[0];d[13]=a[1];d[14]=a[2];d[15]=1;return d},str:function(c){return"["+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+", "+c[6]+", "+c[7]+", "+c[8]+", "+c[9]+", "+c[10]+", "+c[11]+", "+c[12]+", "+c[13]+", "+c[14]+", "+c[15]+"]"}},v={create:function(c){var a=new e(4);c?(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3]):a[0]=a[1]=a[2]=a[3]=0;return a},createFrom:function(c,a,d,f){var b=new e(4);b[0]=c;b[1]=a;b[2]=d;b[3]=f;return b},set:function(c,a){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];return a},equal:function(c,a){return c===a||1e-6>Math.abs(c[0]-a[0])&&1e-6>Math.abs(c[1]-a[1])&&1e-6>Math.abs(c[2]-a[2])&&1e-6>Math.abs(c[3]-a[3])},identity:function(c){c||(c=v.create());c[0]=0;c[1]=0;c[2]=0;c[3]=1;return c}},u=v.identity();v.calculateW=function(c,a){var d=c[0],f=c[1],e=c[2];if(!a||c===a)return c[3]=-Math.sqrt(Math.abs(1-d*d-f*f-e*e)),c;a[0]=d;a[1]=f;a[2]=e;a[3]=-Math.sqrt(Math.abs(1-d*d-f*f-e*e));return a};v.dot=function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3]};v.inverse=function(c,a){var d=c[0],f=c[1],e=c[2],b=c[3],d=(d=d*d+f*f+e*e+b*b)?1/d:0;if(!a||c===a)return c[0]*=-d,c[1]*=-d,c[2]*=-d,c[3]*=d,c;a[0]=-c[0]*d;a[1]=-c[1]*d;a[2]=-c[2]*d;a[3]=c[3]*d;return a};v.conjugate=function(c,a){if(!a||c===a)return c[0]*=-1,c[1]*=-1,c[2]*=-1,c;a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=c[3];return a};v.length=function(c){var a=c[0],d=c[1],f=c[2];c=c[3];return Math.sqrt(a*a+d*d+f*f+c*c)};v.normalize=function(c,a){a||(a=c);var d=c[0],f=c[1],e=c[2],b=c[3],n=Math.sqrt(d*d+f*f+e*e+b*b);if(0===n)return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a;n=1/n;a[0]=d*n;a[1]=f*n;a[2]=e*n;a[3]=b*n;return a};v.add=function(c,a,d){if(!d||c===d)return c[0]+=a[0],c[1]+=a[1],c[2]+=a[2],c[3]+=a[3],c;d[0]=c[0]+a[0];d[1]=c[1]+a[1];d[2]=c[2]+a[2];d[3]=c[3]+a[3];return d};v.multiply=function(c,a,d){d||(d=c);var f=c[0],e=c[1],b=c[2];c=c[3];var n=a[0],g=a[1],p=a[2];a=a[3];d[0]=f*a+c*n+e*p-b*g;d[1]=e*a+c*g+b*n-f*p;d[2]=b*a+c*p+f*g-e*n;d[3]=c*a-f*n-e*g-b*p;return d};v.multiplyVec3=function(c,a,d){d||(d=a);var f=a[0],e=a[1],b=a[2];a=c[0];var n=c[1],g=c[2];c=c[3];var p=c*f+n*b-g*e,h=c*e+g*f-a*b,y=c*b+a*e-n*f,f=-a*f-n*e-g*b;d[0]=p*c+f*-a+h*-g-y*-n;d[1]=h*c+f*-n+y*-a-p*-g;d[2]=y*c+f*-g+p*-n-h*-a;return d};v.scale=function(c,a,d){if(!d||c===d)return c[0]*=a,c[1]*=a,c[2]*=a,c[3]*=a,c;d[0]=c[0]*a;d[1]=c[1]*a;d[2]=c[2]*a;d[3]=c[3]*a;return d};v.toMat3=function(c,a){a||(a=A.create());var d=c[0],f=c[1],e=c[2],b=c[3],n=d+d,g=f+f,p=e+e,h=d*n,y=d*g,d=d*p,j=f*g,f=f*p,e=e*p,n=b*n,g=b*g,b=b*p;a[0]=1-(j+e);a[1]=y+b;a[2]=d-g;a[3]=y-b;a[4]=1-(h+e);a[5]=f+n;a[6]=d+g;a[7]=f-n;a[8]=1-(h+j);return a};v.toMat4=function(c,a){a||(a=r.create());var d=c[0],f=c[1],e=c[2],b=c[3],n=d+d,g=f+f,p=e+e,h=d*n,y=d*g,d=d*p,j=f*g,f=f*p,e=e*p,n=b*n,g=b*g,b=b*p;a[0]=1-(j+e);a[1]=y+b;a[2]=d-g;a[3]=0;a[4]=y-b;a[5]=1-(h+e);a[6]=f+n;a[7]=0;a[8]=d+g;a[9]=f-n;a[10]=1-(h+j);a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};v.slerp=function(c,a,d,f){f||(f=c);var e=c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3],b,n;if(1<=Math.abs(e))return f!==c&&(f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3]),f;b=Math.acos(e);n=Math.sqrt(1-e*e);if(.001>Math.abs(n))return f[0]=.5*c[0]+.5*a[0],f[1]=.5*c[1]+.5*a[1],f[2]=.5*c[2]+.5*a[2],f[3]=.5*c[3]+.5*a[3],f;e=Math.sin((1-d)*b)/n;d=Math.sin(d*b)/n;f[0]=c[0]*e+a[0]*d;f[1]=c[1]*e+a[1]*d;f[2]=c[2]*e+a[2]*d;f[3]=c[3]*e+a[3]*d;return f};v.fromRotationMatrix=function(c,a){a||(a=v.create());var d=c[0]+c[4]+c[8],f;if(0<d)f=Math.sqrt(d+1),a[3]=.5*f,f=.5/f,a[0]=(c[7]-c[5])*f,a[1]=(c[2]-c[6])*f,a[2]=(c[3]-c[1])*f;else{f=v.fromRotationMatrix.s_iNext=v.fromRotationMatrix.s_iNext||[1,2,0];d=0;c[4]>c[0]&&(d=1);c[8]>c[3*d+d]&&(d=2);var e=f[d],b=f[e];f=Math.sqrt(c[3*d+d]-c[3*e+e]-c[3*b+b]+1);a[d]=.5*f;f=.5/f;a[3]=(c[3*b+e]-c[3*e+b])*f;a[e]=(c[3*e+d]+c[3*d+e])*f;a[b]=(c[3*b+d]+c[3*d+b])*f}return a};A.toQuat4=v.fromRotationMatrix;var t=A.create();v.fromAxes=function(a,d,f,e){t[0]=d[0];t[3]=d[1];t[6]=d[2];t[1]=f[0];t[4]=f[1];t[7]=f[2];t[2]=a[0];t[5]=a[1];t[8]=a[2];return v.fromRotationMatrix(t,e)};v.identity=function(a){a||(a=v.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};v.fromAngleAxis=function(a,d,f){f||(f=v.create());a*=.5;var e=Math.sin(a);f[3]=Math.cos(a);f[0]=e*d[0];f[1]=e*d[1];f[2]=e*d[2];return f};v.toAngleAxis=function(a,d){d||(d=a);var f=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<f?(d[3]=2*Math.acos(a[3]),f=l.invsqrt(f),d[0]=a[0]*f,d[1]=a[1]*f,d[2]=a[2]*f):(d[3]=0,d[0]=1,d[1]=0,d[2]=0);return d};v.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var w={create:function(a){var d=new e(2);a?(d[0]=a[0],d[1]=a[1]):(d[0]=0,d[1]=0);return d},createFrom:function(a,d){var f=new e(2);f[0]=a;f[1]=d;return f},add:function(a,d,f){f||(f=d);f[0]=a[0]+d[0];f[1]=a[1]+d[1];return f},subtract:function(a,d,f){f||(f=d);f[0]=a[0]-d[0];f[1]=a[1]-d[1];return f},multiply:function(a,d,f){f||(f=d);f[0]=a[0]*d[0];f[1]=a[1]*d[1];return f},divide:function(a,d,f){f||(f=d);f[0]=a[0]/d[0];f[1]=a[1]/d[1];return f},scale:function(a,d,f){f||(f=a);f[0]=a[0]*d;f[1]=a[1]*d;return f},dist:function(a,d){var f=d[0]-a[0],e=d[1]-a[1];return Math.sqrt(f*f+e*e)},set:function(a,d){d[0]=a[0];d[1]=a[1];return d},equal:function(a,d){return a===d||1e-6>Math.abs(a[0]-d[0])&&1e-6>Math.abs(a[1]-d[1])},negate:function(a,d){d||(d=a);d[0]=-a[0];d[1]=-a[1];return d},normalize:function(a,d){d||(d=a);var f=a[0]*a[0]+a[1]*a[1];0<f?(f=Math.sqrt(f),d[0]=a[0]/f,d[1]=a[1]/f):d[0]=d[1]=0;return d},cross:function(a,d,f){a=a[0]*d[1]-a[1]*d[0];if(!f)return a;f[0]=f[1]=0;f[2]=a;return f},length:function(a){var d=a[0];a=a[1];return Math.sqrt(d*d+a*a)},squaredLength:function(a){var d=a[0];a=a[1];return d*d+a*a},dot:function(a,d){return a[0]*d[0]+a[1]*d[1]},direction:function(a,d,f){f||(f=a);var e=a[0]-d[0];a=a[1]-d[1];d=e*e+a*a;if(!d)return f[0]=0,f[1]=0,f[2]=0,f;d=1/Math.sqrt(d);f[0]=e*d;f[1]=a*d;return f},lerp:function(a,d,f,e){e||(e=a);e[0]=a[0]+f*(d[0]-a[0]);e[1]=a[1]+f*(d[1]-a[1]);return e},str:function(a){return"["+a[0]+", "+a[1]+"]"}},x={create:function(a){var d=new e(4);a?(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]):d[0]=d[1]=d[2]=d[3]=0;return d},createFrom:function(a,d,f,b){var n=new e(4);n[0]=a;n[1]=d;n[2]=f;n[3]=b;return n},set:function(a,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];return d},equal:function(a,d){return a===d||1e-6>Math.abs(a[0]-d[0])&&1e-6>Math.abs(a[1]-d[1])&&1e-6>Math.abs(a[2]-d[2])&&1e-6>Math.abs(a[3]-d[3])},identity:function(a){a||(a=x.create());a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,d){if(!d||a===d){var f=a[1];a[1]=a[2];a[2]=f;return a}d[0]=a[0];d[1]=a[2];d[2]=a[1];d[3]=a[3];return d},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},inverse:function(a,d){d||(d=a);var f=a[0],e=a[1],b=a[2],n=a[3],g=f*n-b*e;if(!g)return null;g=1/g;d[0]=n*g;d[1]=-e*g;d[2]=-b*g;d[3]=f*g;return d},multiply:function(a,d,f){f||(f=a);var e=a[0],b=a[1],n=a[2];a=a[3];f[0]=e*d[0]+b*d[2];f[1]=e*d[1]+b*d[3];f[2]=n*d[0]+a*d[2];f[3]=n*d[1]+a*d[3];return f},rotate:function(a,d,f){f||(f=a);var e=a[0],b=a[1],n=a[2];a=a[3];var g=Math.sin(d);d=Math.cos(d);f[0]=e*d+b*g;f[1]=e*-g+b*d;f[2]=n*d+a*g;f[3]=n*-g+a*d;return f},multiplyVec2:function(a,d,f){f||(f=d);var e=d[0];d=d[1];f[0]=e*a[0]+d*a[1];f[1]=e*a[2]+d*a[3];return f},scale:function(a,d,f){f||(f=a);var e=a[1],b=a[2],n=a[3],g=d[0];d=d[1];f[0]=a[0]*g;f[1]=e*d;f[2]=b*g;f[3]=n*d;return f},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}},B={create:function(a){var d=new e(4);a?(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]):(d[0]=0,d[1]=0,d[2]=0,d[3]=0);return d},createFrom:function(a,d,f,b){var n=new e(4);n[0]=a;n[1]=d;n[2]=f;n[3]=b;return n},add:function(a,d,f){f||(f=d);f[0]=a[0]+d[0];f[1]=a[1]+d[1];f[2]=a[2]+d[2];f[3]=a[3]+d[3];return f},subtract:function(a,d,f){f||(f=d);f[0]=a[0]-d[0];f[1]=a[1]-d[1];f[2]=a[2]-d[2];f[3]=a[3]-d[3];return f},multiply:function(a,d,f){f||(f=d);f[0]=a[0]*d[0];f[1]=a[1]*d[1];f[2]=a[2]*d[2];f[3]=a[3]*d[3];return f},divide:function(a,d,f){f||(f=d);f[0]=a[0]/d[0];f[1]=a[1]/d[1];f[2]=a[2]/d[2];f[3]=a[3]/d[3];return f},scale:function(a,d,f){f||(f=a);f[0]=a[0]*d;f[1]=a[1]*d;f[2]=a[2]*d;f[3]=a[3]*d;return f},set:function(a,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];return d},equal:function(a,d){return a===d||1e-6>Math.abs(a[0]-d[0])&&1e-6>Math.abs(a[1]-d[1])&&1e-6>Math.abs(a[2]-d[2])&&1e-6>Math.abs(a[3]-d[3])},negate:function(a,d){d||(d=a);d[0]=-a[0];d[1]=-a[1];d[2]=-a[2];d[3]=-a[3];return d},length:function(a){var d=a[0],f=a[1],e=a[2];a=a[3];return Math.sqrt(d*d+f*f+e*e+a*a)},squaredLength:function(a){var d=a[0],f=a[1],e=a[2];a=a[3];return d*d+f*f+e*e+a*a},lerp:function(a,d,f,e){e||(e=a);e[0]=a[0]+f*(d[0]-a[0]);e[1]=a[1]+f*(d[1]-a[1]);e[2]=a[2]+f*(d[2]-a[2]);e[3]=a[3]+f*(d[3]-a[3]);return e},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};b&&(b.glMatrixArrayType=e,b.MatrixArray=e,b.setMatrixArrayType=j,b.determineMatrixArrayType=o,b.glMath=l,b.vec2=w,b.vec3=a,b.vec4=B,b.mat2=x,b.mat3=A,b.mat4=r,b.quat4=v);return{glMatrixArrayType:e,MatrixArray:e,setMatrixArrayType:j,determineMatrixArrayType:o,glMath:l,vec2:w,vec3:a,vec4:B,mat2:x,mat3:A,mat4:r,quat4:v}});ChemDoodle.animations=function(b){var j={};b.requestAnimFrame=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(j){b.setTimeout(j,1e3/60)};j.requestInterval=function(j,l){function h(){(new Date).getTime()-g>=l&&(j.call(),g=(new Date).getTime());e.value=b.requestAnimFrame(h)}if(!b.requestAnimationFrame&&!b.webkitRequestAnimationFrame&&(!b.mozRequestAnimationFrame||!b.mozCancelRequestAnimationFrame)&&!b.oRequestAnimationFrame&&!b.msRequestAnimationFrame)return b.setInterval(j,l);var g=(new Date).getTime(),e={};e.value=b.requestAnimFrame(h);return e};j.clearRequestInterval=function(j){b.cancelAnimationFrame?b.cancelAnimationFrame(j.value):b.webkitCancelAnimationFrame?b.webkitCancelAnimationFrame(j.value):b.webkitCancelRequestAnimationFrame?b.webkitCancelRequestAnimationFrame(j.value):b.mozCancelRequestAnimationFrame?b.mozCancelRequestAnimationFrame(j.value):b.oCancelRequestAnimationFrame?b.oCancelRequestAnimationFrame(j.value):b.msCancelRequestAnimationFrame?b.msCancelRequestAnimationFrame(j.value):clearInterval(j)};j.requestTimeout=function(j,l){function h(){(new Date).getTime()-g>=l?j.call():e.value=b.requestAnimFrame(h)}if(!b.requestAnimationFrame&&!b.webkitRequestAnimationFrame&&(!b.mozRequestAnimationFrame||!b.mozCancelRequestAnimationFrame)&&!b.oRequestAnimationFrame&&!b.msRequestAnimationFrame)return b.setTimeout(j,l);var g=(new Date).getTime(),e={};e.value=b.requestAnimFrame(h);return e};j.clearRequestTimeout=function(j){b.cancelAnimationFrame?b.cancelAnimationFrame(j.value):b.webkitCancelAnimationFrame?b.webkitCancelAnimationFrame(j.value):b.webkitCancelRequestAnimationFrame?b.webkitCancelRequestAnimationFrame(j.value):b.mozCancelRequestAnimationFrame?b.mozCancelRequestAnimationFrame(j.value):b.oCancelRequestAnimationFrame?b.oCancelRequestAnimationFrame(j.value):b.msCancelRequestAnimationFrame?b.msCancelRequestAnimationFrame(j.value):clearTimeout(j)};return j}(window);ChemDoodle.extensions=function(b,j,o){return{stringStartsWith:function(b,h){return b.slice(0,h.length)===h},vec3AngleFrom:function(b,h){var g=j.length(b),e=j.length(h),g=j.dot(b,h)/g/e;return o.acos(g)},contextHashTo:function(j,h,g,e,a,d,n){var f=0,y=new b.Point(h,g).distance(new b.Point(e,a)),p=!1,q=h,o=g;h=e-h;for(g=a-g;f<y;){if(p)if(f+n>y){j.moveTo(e,a);break}else{var r=n/y,q=q+r*h,o=o+r*g;j.moveTo(q,o);f+=n}else if(f+d>y){j.lineTo(e,a);break}else r=d/y,q+=r*h,o+=r*g,j.lineTo(q,o),f+=d;p=!p}},contextRoundRect:function(b,h,g,e,a,d){b.beginPath();b.moveTo(h+d,g);b.lineTo(h+e-d,g);b.quadraticCurveTo(h+e,g,h+e,g+d);b.lineTo(h+e,g+a-d);b.quadraticCurveTo(h+e,g+a,h+e-d,g+a);b.lineTo(h+d,g+a);b.quadraticCurveTo(h,g+a,h,g+a-d);b.lineTo(h,g+d);b.quadraticCurveTo(h,g,h+d,g);b.closePath()},contextEllipse:function(b,h,g,e,a){var d=.5522848*(e/2),n=.5522848*(a/2),f=h+e,y=g+a;e=h+e/2;a=g+a/2;b.beginPath();b.moveTo(h,a);b.bezierCurveTo(h,a-n,e-d,g,e,g);b.bezierCurveTo(e+d,g,f,a-n,f,a);b.bezierCurveTo(f,a+n,e+d,y,e,y);b.bezierCurveTo(e-d,y,h,a+n,h,a);b.closePath()},getFontString:function(b,h,g,e){var a=[];g&&a.push("bold ");e&&a.push("italic ");a.push(b+"px ");b=0;for(g=h.length;b<g;b++)e=h[b],-1!==e.indexOf(" ")&&(e='"'+e+'"'),a.push((0!==b?",":"")+e);return a.join("")}}}(ChemDoodle.structures,ChemDoodle.lib.vec3,Math);ChemDoodle.math=function(b,j,o,l,h){var g={},e={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};g.angleBetweenLargest=function(a){if(0===a.length)return{angle:0,largest:2*h.PI};if(1===a.length)return{angle:a[0]+h.PI,largest:2*h.PI};for(var d=0,e=0,f=0,b=a.length-1;f<b;f++){var g=a[f+1]-a[f];g>d&&(d=g,e=(a[f+1]+a[f])/2)}f=a[0]+2*h.PI-a[a.length-1];f>d&&(e=a[0]-f/2,d=f,0>e&&(e+=2*h.PI));return{angle:e,largest:d}};g.isBetween=function(a,d,e){if(d>e){var f=d;d=e;e=f}return a>=d&&a<=e};l(document).ready(function(){b&&(b.iChemLabs&&b.iChemLabs.checkForUpdates)&&b.iChemLabs.checkForUpdates({})});g.getRGB=function(a,d){var b=[0,0,0];e[a.toLowerCase()]&&(a=e[a.toLowerCase()]);if("#"===a.charAt(0))return 4===a.length&&(a="#"+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)+a.charAt(3)+a.charAt(3)),[parseInt(a.substring(1,3),16)/255*d,parseInt(a.substring(3,5),16)/255*d,parseInt(a.substring(5,7),16)/255*d];if(j.stringStartsWith(a,"rgb")){var f=a.replace(/rgb\(|\)/g,"").split(",");return 3!==f.length?b:[parseInt(f[0])/255*d,parseInt(f[1])/255*d,parseInt(f[2])/255*d]}return b};g.idx2color=function(a){a=a.toString(16);for(var d=0,e=6-a.length;d<e;d++)a="0"+a;return"#"+a};g.distanceFromPointToLineInclusive=function(a,d,e){var f=d.distance(e);e=d.angle(e);e=h.PI/2-e;e=d.angle(a)+e;a=d.distance(a);a=new o.Point(a*h.cos(e),-a*h.sin(e));return g.isBetween(-a.y,0,f)?h.abs(a.x):-1};g.calculateDistanceInterior=function(a,d,e){if(this.isBetween(d.x,e.x,e.x+e.w)&&this.isBetween(d.y,e.y,e.y+e.w))return a.distance(d);var f=[];f.push({x1:e.x,y1:e.y,x2:e.x+e.w,y2:e.y});f.push({x1:e.x,y1:e.y+e.h,x2:e.x+e.w,y2:e.y+e.h});f.push({x1:e.x,y1:e.y,x2:e.x,y2:e.y+e.h});f.push({x1:e.x+e.w,y1:e.y,x2:e.x+e.w,y2:e.y+e.h});e=[];for(var b=0;4>b;b++){var g=f[b];(g=this.intersectLines(d.x,d.y,a.x,a.y,g.x1,g.y1,g.x2,g.y2))&&e.push(g)}if(0===e.length)return 0;b=d=0;for(f=e.length;b<f;b++){var g=e[b],j=a.x-g.x,g=a.y-g.y;d=h.max(d,h.sqrt(j*j+g*g))}return d};g.intersectLines=function(a,d,e,f,b,g,h,j){e-=a;f-=d;h-=b;j-=g;var l=f*h-e*j;if(0===l)return!1;h=(j*(a-b)-h*(d-g))/l;b=(f*(a-b)-e*(d-g))/l;return 0<=b&&1>=b&&0<=h&&1>=h?{x:a+h*e,y:d+h*f}:!1};g.hsl2rgb=function(a,d,e){var f=function(a,d,f){0>f?f+=1:1<f&&(f-=1);return f<1/6?a+6*(d-a)*f:.5>f?d:f<2/3?a+6*(d-a)*(2/3-f):a};if(0===d)e=d=a=e;else{var b=.5>e?e*(1+d):e+d-e*d,g=2*e-b;e=f(g,b,a+1/3);d=f(g,b,a);a=f(g,b,a-1/3)}return[255*e,255*d,255*a]};g.isPointInPoly=function(a,d){for(var e=!1,f=-1,b=a.length,g=b-1;++f<b;g=f)(a[f].y<=d.y&&d.y<a[g].y||a[g].y<=d.y&&d.y<a[f].y)&&d.x<(a[g].x-a[f].x)*(d.y-a[f].y)/(a[g].y-a[f].y)+a[f].x&&(e=!e);return e};g.clamp=function(a,d,e){return a<d?d:a>e?e:a};g.rainbowAt=function(a,d,e){1>e.length?e.push("#000000","#FFFFFF"):2>e.length&&e.push("#FFFFFF");var f=d/(e.length-1);d=h.floor(a/f);a=(a-d*f)/f;f=g.getRGB(e[d],1);e=g.getRGB(e[d+1],1);return"rgb("+[255*(f[0]+(e[0]-f[0])*a),255*(f[1]+(e[1]-f[1])*a),255*(f[2]+(e[2]-f[2])*a)].join()+")"};g.angleBounds=function(a,d,e){for(var f=2*h.PI;0>a;)a+=f;for(;a>f;)a-=f;e&&a>h.PI&&(a=2*h.PI-a);d&&(a=180*a/h.PI);return a};return g}(ChemDoodle,ChemDoodle.extensions,ChemDoodle.structures,ChemDoodle.lib.jQuery,Math);(function(b,j){b.Bounds=function(){};var o=b.Bounds.prototype;o.minX=o.minY=o.minZ=Infinity;o.maxX=o.maxY=o.maxZ=-Infinity;o.expand=function(l,h,g,e){l instanceof b.Bounds?(this.minX=j.min(this.minX,l.minX),this.minY=j.min(this.minY,l.minY),this.maxX=j.max(this.maxX,l.maxX),this.maxY=j.max(this.maxY,l.maxY),Infinity!==l.maxZ&&(this.minZ=j.min(this.minZ,l.minZ),this.maxZ=j.max(this.maxZ,l.maxZ))):(this.minX=j.min(this.minX,l),this.maxX=j.max(this.maxX,l),this.minY=j.min(this.minY,h),this.maxY=j.max(this.maxY,h),void 0!==g&&void 0!==e&&(this.minX=j.min(this.minX,g),this.maxX=j.max(this.maxX,g),this.minY=j.min(this.minY,e),this.maxY=j.max(this.maxY,e)))};o.expand3D=function(b,h,g,e,a,d){this.minX=j.min(this.minX,b);this.maxX=j.max(this.maxX,b);this.minY=j.min(this.minY,h);this.maxY=j.max(this.maxY,h);this.minZ=j.min(this.minZ,g);this.maxZ=j.max(this.maxZ,g);void 0!==e&&(void 0!==a&&void 0!==d)&&(this.minX=j.min(this.minX,e),this.maxX=j.max(this.maxX,e),this.minY=j.min(this.minY,a),this.maxY=j.max(this.maxY,a),this.minZ=j.min(this.minZ,d),this.maxZ=j.max(this.maxZ,d))}})(ChemDoodle.math,Math);(function(){var b={subtract:function(a,d){return{x:a.x-d.x,y:a.y-d.y}},dotProduct:function(a,d){return a.x*d.x+a.y*d.y},square:function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},scale:function(a,d){return{x:a.x*d,y:a.y*d}}},j=Math.pow(2,-65),o=function(a,d){for(var e=[],n=d.length-1,g=2*n-1,j=[],o=[],u=[],t=[],w=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],x=0;x<=n;x++)j[x]=b.subtract(d[x],a);for(x=0;x<=n-1;x++)o[x]=b.subtract(d[x+1],d[x]),o[x]=b.scale(o[x],3);for(x=0;x<=n-1;x++)for(var B=0;B<=n;B++)u[x]||(u[x]=[]),u[x][B]=b.dotProduct(o[x],j[B]);for(x=0;x<=g;x++)t[x]||(t[x]=[]),t[x].y=0,t[x].x=parseFloat(x)/g;g=n-1;for(j=0;j<=n+g;j++){x=Math.max(0,j-g);for(o=Math.min(j,n);x<=o;x++)B=j-x,t[x+B].y+=u[B][x]*w[B][x]}n=d.length-1;t=l(t,2*n-1,e,0);g=b.subtract(a,d[0]);u=b.square(g);for(x=w=0;x<t;x++)g=b.subtract(a,h(d,n,e[x],null,null)),g=b.square(g),g<u&&(u=g,w=e[x]);g=b.subtract(a,d[n]);g=b.square(g);g<u&&(u=g,w=1);return{location:w,distance:u}},l=function(a,d,e,b){var n=[],g=[],o=[],u=[],t=0,w,x;x=0==a[0].y?0:0<a[0].y?1:-1;for(var B=1;B<=d;B++)w=0==a[B].y?0:0<a[B].y?1:-1,w!=x&&t++,x=w;switch(t){case 0:return 0;case 1:if(64<=b)return e[0]=(a[0].x+a[d].x)/2,1;var c,k,C,t=a[0].y-a[d].y;w=a[d].x-a[0].x;x=a[0].x*a[d].y-a[d].x*a[0].y;B=c=0;for(k=1;k<d;k++)C=t*a[k].x+w*a[k].y+x,C>c?c=C:C<B&&(B=C);C=w;k=0*C-1*t;c=(1*(x-c)-0*C)*(1/k);C=w;k=0*C-1*t;t=(1*(x-B)-0*C)*(1/k);w=Math.min(c,t);if(Math.max(c,t)-w<j)return o=a[d].x-a[0].x,u=a[d].y-a[0].y,e[0]=0+1*(o*(a[0].y-0)-u*(a[0].x-0))*(1/(0*o-1*u)),1}h(a,d,.5,n,g);a=l(n,d,o,b+1);d=l(g,d,u,b+1);for(b=0;b<a;b++)e[b]=o[b];for(b=0;b<d;b++)e[b+a]=u[b];return a+d},h=function(a,d,e,b,n){for(var g=[[]],h=0;h<=d;h++)g[0][h]=a[h];for(a=1;a<=d;a++)for(h=0;h<=d-a;h++)g[a]||(g[a]=[]),g[a][h]||(g[a][h]={}),g[a][h].x=(1-e)*g[a-1][h].x+e*g[a-1][h+1].x,g[a][h].y=(1-e)*g[a-1][h].y+e*g[a-1][h+1].y;if(null!=b)for(h=0;h<=d;h++)b[h]=g[h][0];if(null!=n)for(h=0;h<=d;h++)n[h]=g[d-h][h];return g[d][0]},g={},e=function(a,d){var e,b=a.length-1;e=g[b];if(!e){e=[];var n=function(a){return function(){return a}},h=function(){return function(a){return a}},j=function(){return function(a){return 1-a}},l=function(a){return function(c){for(var d=1,f=0;f<a.length;f++)d*=a[f](c);return d}};e.push(new function(){return function(a){return Math.pow(a,b)}});for(var o=1;o<b;o++){for(var w=[new n(b)],x=0;x<b-o;x++)w.push(new h);for(x=0;x<o;x++)w.push(new j);e.push(new l(w))}e.push(new function(){return function(a){return Math.pow(1-a,b)}});g[b]=e}for(j=h=n=0;j<a.length;j++)n+=a[j].x*e[j](d),h+=a[j].y*e[j](d);return{x:n,y:h}},a=function(a,d){return Math.sqrt(Math.pow(a.x-d.x,2)+Math.pow(a.y-d.y,2))},d=function(d,b,n){for(var g=e(d,b),h=0,j=0<n?1:-1,l=null;h<Math.abs(n);)b+=.005*j,l=e(d,b),h+=a(l,g),g=l;return{point:l,location:b}},n=function(a,d){var b=e(a,d),n=e(a.slice(0,a.length-1),d),g=n.y-b.y,b=n.x-b.x;return 0==g?Infinity:Math.atan(g/b)};ChemDoodle.math.jsBezier={distanceFromCurve:o,gradientAtPoint:n,gradientAtPointAlongCurveFrom:function(a,e,b){e=d(a,e,b);1<e.location&&(e.location=1);0>e.location&&(e.location=0);return n(a,e.location)},nearestPointOnCurve:function(a,d){var e=o(a,d);return{point:h(d,d.length-1,e.location,null,null),location:e.location}},pointOnCurve:e,pointAlongCurveFrom:function(a,e,b){return d(a,e,b).point},perpendicularToCurveAt:function(a,e,b,g){e=d(a,e,null==g?0:g);a=n(a,e.location);g=Math.atan(-1/a);a=b/2*Math.sin(g);b=b/2*Math.cos(g);return[{x:e.point.x+b,y:e.point.y+a},{x:e.point.x-b,y:e.point.y-a}]},locationAlongCurveFrom:function(a,e,b){return d(a,e,b).location},getLength:function(d){for(var b=e(d,0),n=0,g=0,h=null;1>g;)g+=.005,h=e(d,g),n+=a(h,b),b=h;return n}}})(ChemDoodle.math);ChemDoodle.featureDetection=function(b,j,o,l){var h={supports_canvas:function(){return!!o.createElement("canvas").getContext},supports_canvas_text:function(){return!h.supports_canvas()?!1:"function"===typeof o.createElement("canvas").getContext("2d").fillText},supports_webgl:function(){var b=o.createElement("canvas");try{if(b.getContext("webgl")||b.getContext("experimental-webgl"))return!0}catch(e){}return!1},supports_xhr2:function(){return j.support.cors},supports_touch:function(){return"ontouchstart"in l&&navigator.userAgent.match(/iPhone|iPad|iPod|Android|BlackBerry|BB10/i)},supports_gesture:function(){return"ongesturestart"in l}};return h}(ChemDoodle.iChemLabs,ChemDoodle.lib.jQuery,document,window);ChemDoodle.SYMBOLS="H He Li Be B C N O F Ne Na Mg Al Si P S Cl Ar K Ca Sc Ti V Cr Mn Fe Co Ni Cu Zn Ga Ge As Se Br Kr Rb Sr Y Zr Nb Mo Tc Ru Rh Pd Ag Cd In Sn Sb Te I Xe Cs Ba La Ce Pr Nd Pm Sm Eu Gd Tb Dy Ho Er Tm Yb Lu Hf Ta W Re Os Ir Pt Au Hg Tl Pb Bi Po At Rn Fr Ra Ac Th Pa U Np Pu Am Cm Bk Cf Es Fm Md No Lr Rf Db Sg Bh Hs Mt Ds Rg Cn Uut Uuq Uup Uuh Uus Uuo".split(" ");ChemDoodle.ELEMENT=function(){function b(b,j,h,g,e,a,d,n,f){this.symbol=b;this.name=j;this.atomicNumber=h;this.addH=g;this.jmolColor=this.pymolColor=e;this.covalentRadius=a;this.vdWRadius=d;this.valency=n;this.mass=f}var j=[];j.H=new b("H","Hydrogen",1,!1,"#FFFFFF",.31,1.2,1,1);j.He=new b("He","Helium",2,!1,"#D9FFFF",.28,1.4,0,4);j.Li=new b("Li","Lithium",3,!1,"#CC80FF",1.28,1.82,1,7);j.Be=new b("Be","Beryllium",4,!1,"#C2FF00",.96,0,2,9);j.B=new b("B","Boron",5,!0,"#FFB5B5",.84,0,3,11);j.C=new b("C","Carbon",6,!0,"#909090",.76,1.7,4,12);j.N=new b("N","Nitrogen",7,!0,"#3050F8",.71,1.55,3,14);j.O=new b("O","Oxygen",8,!0,"#FF0D0D",.66,1.52,2,16);j.F=new b("F","Fluorine",9,!0,"#90E050",.57,1.47,1,19);j.Ne=new b("Ne","Neon",10,!1,"#B3E3F5",.58,1.54,0,20);j.Na=new b("Na","Sodium",11,!1,"#AB5CF2",1.66,2.27,1,23);j.Mg=new b("Mg","Magnesium",12,!1,"#8AFF00",1.41,1.73,0,24);j.Al=new b("Al","Aluminum",13,!1,"#BFA6A6",1.21,0,0,27);j.Si=new b("Si","Silicon",14,!0,"#F0C8A0",1.11,2.1,4,28);j.P=new b("P","Phosphorus",15,!0,"#FF8000",1.07,1.8,3,31);j.S=new b("S","Sulfur",16,!0,"#FFFF30",1.05,1.8,2,32);j.Cl=new b("Cl","Chlorine",17,!0,"#1FF01F",1.02,1.75,1,35);j.Ar=new b("Ar","Argon",18,!1,"#80D1E3",1.06,1.88,0,40);j.K=new b("K","Potassium",19,!1,"#8F40D4",2.03,2.75,0,39);j.Ca=new b("Ca","Calcium",20,!1,"#3DFF00",1.76,0,0,40);j.Sc=new b("Sc","Scandium",21,!1,"#E6E6E6",1.7,0,0,45);j.Ti=new b("Ti","Titanium",22,!1,"#BFC2C7",1.6,0,1,48);j.V=new b("V","Vanadium",23,!1,"#A6A6AB",1.53,0,1,51);j.Cr=new b("Cr","Chromium",24,!1,"#8A99C7",1.39,0,2,52);j.Mn=new b("Mn","Manganese",25,!1,"#9C7AC7",1.39,0,3,55);j.Fe=new b("Fe","Iron",26,!1,"#E06633",1.32,0,2,56);j.Co=new b("Co","Cobalt",27,!1,"#F090A0",1.26,0,1,59);j.Ni=new b("Ni","Nickel",28,!1,"#50D050",1.24,1.63,1,58);j.Cu=new b("Cu","Copper",29,!1,"#C88033",1.32,1.4,0,63);j.Zn=new b("Zn","Zinc",30,!1,"#7D80B0",1.22,1.39,0,64);j.Ga=new b("Ga","Gallium",31,!1,"#C28F8F",1.22,1.87,0,69);j.Ge=new b("Ge","Germanium",32,!1,"#668F8F",1.2,0,4,74);j.As=new b("As","Arsenic",33,!0,"#BD80E3",1.19,1.85,3,75);j.Se=new b("Se","Selenium",34,!0,"#FFA100",1.2,1.9,2,80);j.Br=new b("Br","Bromine",35,!0,"#A62929",1.2,1.85,1,79);j.Kr=new b("Kr","Krypton",36,!1,"#5CB8D1",1.16,2.02,0,84);j.Rb=new b("Rb","Rubidium",37,!1,"#702EB0",2.2,0,0,85);j.Sr=new b("Sr","Strontium",38,!1,"#00FF00",1.95,0,0,88);j.Y=new b("Y","Yttrium",39,!1,"#94FFFF",1.9,0,0,89);j.Zr=new b("Zr","Zirconium",40,!1,"#94E0E0",1.75,0,0,90);j.Nb=new b("Nb","Niobium",41,!1,"#73C2C9",1.64,0,1,93);j.Mo=new b("Mo","Molybdenum",42,!1,"#54B5B5",1.54,0,2,98);j.Tc=new b("Tc","Technetium",43,!1,"#3B9E9E",1.47,0,3,0);j.Ru=new b("Ru","Ruthenium",44,!1,"#248F8F",1.46,0,2,102);j.Rh=new b("Rh","Rhodium",45,!1,"#0A7D8C",1.42,0,1,103);j.Pd=new b("Pd","Palladium",46,!1,"#006985",1.39,1.63,0,106);j.Ag=new b("Ag","Silver",47,!1,"#C0C0C0",1.45,1.72,0,107);j.Cd=new b("Cd","Cadmium",48,!1,"#FFD98F",1.44,1.58,0,114);j.In=new b("In","Indium",49,!1,"#A67573",1.42,1.93,0,115);j.Sn=new b("Sn","Tin",50,!1,"#668080",1.39,2.17,4,120);j.Sb=new b("Sb","Antimony",51,!1,"#9E63B5",1.39,0,3,121);j.Te=new b("Te","Tellurium",52,!0,"#D47A00",1.38,2.06,2,130);j.I=new b("I","Iodine",53,!0,"#940094",1.39,1.98,1,127);j.Xe=new b("Xe","Xenon",54,!1,"#429EB0",1.4,2.16,0,132);j.Cs=new b("Cs","Cesium",55,!1,"#57178F",2.44,0,0,133);j.Ba=new b("Ba","Barium",56,!1,"#00C900",2.15,0,0,138);j.La=new b("La","Lanthanum",57,!1,"#70D4FF",2.07,0,0,139);j.Ce=new b("Ce","Cerium",58,!1,"#FFFFC7",2.04,0,0,140);j.Pr=new b("Pr","Praseodymium",59,!1,"#D9FFC7",2.03,0,0,141);j.Nd=new b("Nd","Neodymium",60,!1,"#C7FFC7",2.01,0,0,142);j.Pm=new b("Pm","Promethium",61,!1,"#A3FFC7",1.99,0,0,0);j.Sm=new b("Sm","Samarium",62,!1,"#8FFFC7",1.98,0,0,152);j.Eu=new b("Eu","Europium",63,!1,"#61FFC7",1.98,0,0,153);j.Gd=new b("Gd","Gadolinium",64,!1,"#45FFC7",1.96,0,0,158);j.Tb=new b("Tb","Terbium",65,!1,"#30FFC7",1.94,0,0,159);j.Dy=new b("Dy","Dysprosium",66,!1,"#1FFFC7",1.92,0,0,164);j.Ho=new b("Ho","Holmium",67,!1,"#00FF9C",1.92,0,0,165);j.Er=new b("Er","Erbium",68,!1,"#00E675",1.89,0,0,166);j.Tm=new b("Tm","Thulium",69,!1,"#00D452",1.9,0,0,169);j.Yb=new b("Yb","Ytterbium",70,!1,"#00BF38",1.87,0,0,174);j.Lu=new b("Lu","Lutetium",71,!1,"#00AB24",1.87,0,0,175);j.Hf=new b("Hf","Hafnium",72,!1,"#4DC2FF",1.75,0,0,180)
;j.Ta=new b("Ta","Tantalum",73,!1,"#4DA6FF",1.7,0,1,181);j.W=new b("W","Tungsten",74,!1,"#2194D6",1.62,0,2,184);j.Re=new b("Re","Rhenium",75,!1,"#267DAB",1.51,0,3,187);j.Os=new b("Os","Osmium",76,!1,"#266696",1.44,0,2,192);j.Ir=new b("Ir","Iridium",77,!1,"#175487",1.41,0,3,193);j.Pt=new b("Pt","Platinum",78,!1,"#D0D0E0",1.36,1.75,0,195);j.Au=new b("Au","Gold",79,!1,"#FFD123",1.36,1.66,1,197);j.Hg=new b("Hg","Mercury",80,!1,"#B8B8D0",1.32,1.55,0,202);j.Tl=new b("Tl","Thallium",81,!1,"#A6544D",1.45,1.96,0,205);j.Pb=new b("Pb","Lead",82,!1,"#575961",1.46,2.02,4,208);j.Bi=new b("Bi","Bismuth",83,!1,"#9E4FB5",1.48,0,3,209);j.Po=new b("Po","Polonium",84,!1,"#AB5C00",1.4,0,2,0);j.At=new b("At","Astatine",85,!0,"#754F45",1.5,0,1,0);j.Rn=new b("Rn","Radon",86,!1,"#428296",1.5,0,0,0);j.Fr=new b("Fr","Francium",87,!1,"#420066",2.6,0,0,0);j.Ra=new b("Ra","Radium",88,!1,"#007D00",2.21,0,0,0);j.Ac=new b("Ac","Actinium",89,!1,"#70ABFA",2.15,0,0,0);j.Th=new b("Th","Thorium",90,!1,"#00BAFF",2.06,0,0,232);j.Pa=new b("Pa","Protactinium",91,!1,"#00A1FF",2,0,0,231);j.U=new b("U","Uranium",92,!1,"#008FFF",1.96,1.86,0,238);j.Np=new b("Np","Neptunium",93,!1,"#0080FF",1.9,0,0,0);j.Pu=new b("Pu","Plutonium",94,!1,"#006BFF",1.87,0,0,0);j.Am=new b("Am","Americium",95,!1,"#545CF2",1.8,0,0,0);j.Cm=new b("Cm","Curium",96,!1,"#785CE3",1.69,0,0,0);j.Bk=new b("Bk","Berkelium",97,!1,"#8A4FE3",0,0,0,0);j.Cf=new b("Cf","Californium",98,!1,"#A136D4",0,0,0,0);j.Es=new b("Es","Einsteinium",99,!1,"#B31FD4",0,0,0,0);j.Fm=new b("Fm","Fermium",100,!1,"#B31FBA",0,0,0,0);j.Md=new b("Md","Mendelevium",101,!1,"#B30DA6",0,0,0,0);j.No=new b("No","Nobelium",102,!1,"#BD0D87",0,0,0,0);j.Lr=new b("Lr","Lawrencium",103,!1,"#C70066",0,0,0,0);j.Rf=new b("Rf","Rutherfordium",104,!1,"#CC0059",0,0,0,0);j.Db=new b("Db","Dubnium",105,!1,"#D1004F",0,0,0,0);j.Sg=new b("Sg","Seaborgium",106,!1,"#D90045",0,0,0,0);j.Bh=new b("Bh","Bohrium",107,!1,"#E00038",0,0,0,0);j.Hs=new b("Hs","Hassium",108,!1,"#E6002E",0,0,0,0);j.Mt=new b("Mt","Meitnerium",109,!1,"#EB0026",0,0,0,0);j.Ds=new b("Ds","Darmstadtium",110,!1,"#000000",0,0,0,0);j.Rg=new b("Rg","Roentgenium",111,!1,"#000000",0,0,0,0);j.Cn=new b("Cn","Copernicium",112,!1,"#000000",0,0,0,0);j.Uut=new b("Uut","Ununtrium",113,!1,"#000000",0,0,0,0);j.Uuq=new b("Uuq","Ununquadium",114,!1,"#000000",0,0,0,0);j.Uup=new b("Uup","Ununpentium",115,!1,"#000000",0,0,0,0);j.Uuh=new b("Uuh","Ununhexium",116,!1,"#000000",0,0,0,0);j.Uus=new b("Uus","Ununseptium",117,!1,"#000000",0,0,0,0);j.Uuo=new b("Uuo","Ununoctium",118,!1,"#000000",0,0,0,0);j.H.pymolColor="#E6E6E6";j.C.pymolColor="#33FF33";j.N.pymolColor="#3333FF";j.O.pymolColor="#FF4D4D";j.F.pymolColor="#B3FFFF";j.S.pymolColor="#E6C640";return j}(ChemDoodle.SYMBOLS);ChemDoodle.RESIDUE=function(){function b(b,j,h,g,e,a){this.symbol=b;this.name=j;this.polar=h;this.aminoColor=g;this.shapelyColor=e;this.acidity=a}var j=[];j.Ala=new b("Ala","Alanine",!1,"#C8C8C8","#8CFF8C",0);j.Arg=new b("Arg","Arginine",!0,"#145AFF","#00007C",1);j.Asn=new b("Asn","Asparagine",!0,"#00DCDC","#FF7C70",0);j.Asp=new b("Asp","Aspartic Acid",!0,"#E60A0A","#A00042",-1);j.Cys=new b("Cys","Cysteine",!0,"#E6E600","#FFFF70",0);j.Gln=new b("Gln","Glutamine",!0,"#00DCDC","#FF4C4C",0);j.Glu=new b("Glu","Glutamic Acid",!0,"#E60A0A","#660000",-1);j.Gly=new b("Gly","Glycine",!1,"#EBEBEB","#FFFFFF",0);j.His=new b("His","Histidine",!0,"#8282D2","#7070FF",1);j.Ile=new b("Ile","Isoleucine",!1,"#0F820F","#004C00",0);j.Leu=new b("Leu","Leucine",!1,"#0F820F","#455E45",0);j.Lys=new b("Lys","Lysine",!0,"#145AFF","#4747B8",1);j.Met=new b("Met","Methionine",!1,"#E6E600","#B8A042",0);j.Phe=new b("Phe","Phenylalanine",!1,"#3232AA","#534C52",0);j.Pro=new b("Pro","Proline",!1,"#DC9682","#525252",0);j.Ser=new b("Ser","Serine",!0,"#FA9600","#FF7042",0);j.Thr=new b("Thr","Threonine",!0,"#FA9600","#B84C00",0);j.Trp=new b("Trp","Tryptophan",!0,"#B45AB4","#4F4600",0);j.Tyr=new b("Tyr","Tyrosine",!0,"#3232AA","#8C704C",0);j.Val=new b("Val","Valine",!1,"#0F820F","#FF8CFF",0);j.Asx=new b("Asx","Asparagine/Aspartic Acid",!0,"#FF69B4","#FF00FF",0);j.Glx=new b("Glx","Glutamine/Glutamic Acid",!0,"#FF69B4","#FF00FF",0);j["*"]=new b("*","Other",!1,"#BEA06E","#FF00FF",0);j.A=new b("A","Adenine",!1,"#BEA06E","#A0A0FF",0);j.G=new b("G","Guanine",!1,"#BEA06E","#FF7070",0);j.I=new b("I","",!1,"#BEA06E","#80FFFF",0);j.C=new b("C","Cytosine",!1,"#BEA06E","#FF8C4B",0);j.T=new b("T","Thymine",!1,"#BEA06E","#A0FFA0",0);j.U=new b("U","Uracil",!1,"#BEA06E","#FF8080",0);return j}();(function(b){b.Queue=function(){this.queue=[]};b=b.Queue.prototype;b.queueSpace=0;b.getSize=function(){return this.queue.length-this.queueSpace};b.isEmpty=function(){return 0===this.queue.length};b.enqueue=function(b){this.queue.push(b)};b.dequeue=function(){var b;this.queue.length&&(b=this.queue[this.queueSpace],2*++this.queueSpace>=this.queue.length&&(this.queue=this.queue.slice(this.queueSpace),this.queueSpace=0));return b};b.getOldestElement=function(){var b;this.queue.length&&(b=this.queue[this.queueSpace]);return b}})(ChemDoodle.structures);(function(b,j){b.Point=function(b,h){this.x=b?b:0;this.y=h?h:0};var o=b.Point.prototype;o.sub=function(b){this.x-=b.x;this.y-=b.y};o.add=function(b){this.x+=b.x;this.y+=b.y};o.distance=function(b){var h=b.x-this.x;b=b.y-this.y;return j.sqrt(h*h+b*b)};o.angleForStupidCanvasArcs=function(b){var h=b.x-this.x;b=b.y-this.y;for(var g=0,g=0===h?0===b?0:0<b?j.PI/2:3*j.PI/2:0===b?0<h?0:j.PI:0>h?j.atan(b/h)+j.PI:0>b?j.atan(b/h)+2*j.PI:j.atan(b/h);0>g;)g+=2*j.PI;return g%=2*j.PI};o.angle=function(b){var h=b.x-this.x;b=this.y-b.y;for(var g=0,g=0===h?0===b?0:0<b?j.PI/2:3*j.PI/2:0===b?0<h?0:j.PI:0>h?j.atan(b/h)+j.PI:0>b?j.atan(b/h)+2*j.PI:j.atan(b/h);0>g;)g+=2*j.PI;return g%=2*j.PI}})(ChemDoodle.structures,Math);(function(b,j){var o=/[ ,]+/,l=/\-+/,h=["Helvetica","Arial","Dialog"];j.Query=function(e){this.type=e;this.elements={v:[],not:!1};this.saturation=this.hydrogens=this.connectivityNoH=this.connectivity=this.chirality=this.charge=void 0;this.orders={v:[],not:!1};this.cache=this.ringCount=this.aromatic=this.stereo=void 0};j.Query.TYPE_ATOM=0;j.Query.TYPE_BOND=1;var g=j.Query.prototype;g.parseRange=function(e){var a=[];e=e.split(o);for(var d=0,b=e.length;d<b;d++){var f=e[d],g=!1,h=!1;"-"===f.charAt(0)&&(g=!0,f=f.substring(1));-1!=f.indexOf("--")&&(h=!0);-1!=f.indexOf("-")?(f=f.split(l),g={x:parseInt(f[0])*(g?-1:1),y:parseInt(f[1])*(h?-1:1)},g.y<g.x&&(h=g.y,g.y=g.x,g.x=h),a.push(g)):a.push({x:parseInt(f)*(g?-1:1)})}return a};g.draw=function(e,a,d){this.cache||(this.cache=this.toString());var n=this.cache,f=void 0,g=n.indexOf("(");-1!=g&&(n=this.cache.substring(0,g),f=this.cache.substring(g,this.cache.length));e.textAlign="center";e.textBaseline="middle";e.font=b.getFontString(12,h,!0,!1);g=e.measureText(n).width;e.fillStyle=a.backgroundColor;e.fillRect(d.x-g/2,d.y-6,g,12);e.fillStyle="black";e.fillText(n,d.x,d.y);f&&(e.font=b.getFontString(10,h,!1,!0),g=e.measureText(f).width,e.fillStyle=a.backgroundColor,e.fillRect(d.x-g/2,d.y+6,g,11),e.fillStyle="black",e.fillText(f,d.x,d.y+11))};g.outputRange=function(e){for(var a=!1,d=[],b=0,f=e.length;b<f;b++){a&&d.push(",");var a=!0,g=e[b];g.y?(d.push(g.x),d.push("-"),d.push(g.y)):d.push(g.x)}return d.join("")};g.toString=function(){var e=[],a=[];this.type===j.Query.TYPE_ATOM?(!this.elements||0===this.elements.v.length?e.push("[a]"):(this.elements.not&&e.push("!"),e.push("["),e.push(this.elements.v.join(",")),e.push("]")),this.chirality&&a.push((this.chirality.not?"!":"")+"@="+this.chirality.v),this.aromatic&&a.push((this.aromatic.not?"!":"")+"A"),this.charge&&a.push((this.charge.not?"!":"")+"C="+this.outputRange(this.charge.v)),this.hydrogens&&a.push((this.hydrogens.not?"!":"")+"H="+this.outputRange(this.hydrogens.v)),this.ringCount&&a.push((this.ringCount.not?"!":"")+"R="+this.outputRange(this.ringCount.v)),this.saturation&&a.push((this.saturation.not?"!":"")+"S"),this.connectivity&&a.push((this.connectivity.not?"!":"")+"X="+this.outputRange(this.connectivity.v)),this.connectivityNoH&&a.push((this.connectivityNoH.not?"!":"")+"x="+this.outputRange(this.connectivityNoH.v))):this.type===j.Query.TYPE_BOND&&(!this.orders||0===this.orders.v.length?e.push("[a]"):(this.orders.not&&e.push("!"),e.push("["),e.push(this.orders.v.join(",")),e.push("]")),this.stereo&&a.push((this.stereo.not?"!":"")+"@="+this.stereo.v),this.aromatic&&a.push((this.aromatic.not?"!":"")+"A"),this.ringCount&&a.push((this.ringCount.not?"!":"")+"R="+this.outputRange(this.ringCount.v)));0<a.length&&(e.push("("),e.push(a.join(",")),e.push(")"));return e.join("")}})(ChemDoodle.extensions,ChemDoodle.structures,Math);(function(b,j,o,l,h,g){l.Atom=function(e,a,d,n){this.label=e?e.replace(/\s/g,""):"C";b[this.label]||(this.label="C");this.x=a?a:0;this.y=d?d:0;this.z=n?n:0};l=l.Atom.prototype=new l.Point(0,0);l.charge=0;l.numLonePair=0;l.numRadical=0;l.mass=-1;l.coordinationNumber=0;l.bondNumber=0;l.angleOfLeastInterference=0;l.isHidden=!1;l.altLabel=void 0;l.isLone=!1;l.isHover=!1;l.isSelected=!1;l.add3D=function(e){this.x+=e.x;this.y+=e.y;this.z+=e.z};l.sub3D=function(e){this.x-=e.x;this.y-=e.y;this.z-=e.z};l.distance3D=function(e){var a=e.x-this.x,d=e.y-this.y;e=e.z-this.z;return h.sqrt(a*a+d*d+e*e)};l.draw=function(e,a){if(this.isLassoed){var d=e.createRadialGradient(this.x-1,this.y-1,0,this.x,this.y,7);d.addColorStop(0,"rgba(212, 99, 0, 0)");d.addColorStop(.7,"rgba(212, 99, 0, 0.8)");e.fillStyle=d;e.beginPath();e.arc(this.x,this.y,5,0,2*h.PI,!1);e.fill()}if(!this.query){this.textBounds=[];this.specs&&(a=this.specs);var b=j.getFontString(a.atoms_font_size_2D,a.atoms_font_families_2D,a.atoms_font_bold_2D,a.atoms_font_italic_2D);e.font=b;e.fillStyle=this.getElementColor(a.atoms_useJMOLColors,a.atoms_usePYMOLColors,a.atoms_color,2);"H"===this.label&&a.atoms_HBlack_2D&&(e.fillStyle="black");var f;if(this.isLone&&!a.atoms_displayAllCarbonLabels_2D||a.atoms_circles_2D)e.beginPath(),e.arc(this.x,this.y,a.atoms_circleDiameter_2D/2,0,2*h.PI,!1),e.fill(),0<a.atoms_circleBorderWidth_2D&&(e.lineWidth=a.atoms_circleBorderWidth_2D,e.strokeStyle="black",e.stroke());else if(this.isLabelVisible(a))if(e.textAlign="center",e.textBaseline="middle",void 0!==this.altLabel){e.fillText(this.altLabel,this.x,this.y);var g=e.measureText(this.altLabel).width;this.textBounds.push({x:this.x-g/2,y:this.y-a.atoms_font_size_2D/2+1,w:g,h:a.atoms_font_size_2D-2})}else{e.fillText(this.label,this.x,this.y);g=e.measureText(this.label).width;this.textBounds.push({x:this.x-g/2,y:this.y-a.atoms_font_size_2D/2+1,w:g,h:a.atoms_font_size_2D-2});var p=0;-1!==this.mass&&(d=e.font,e.font=j.getFontString(.7*a.atoms_font_size_2D,a.atoms_font_families_2D,a.atoms_font_bold_2D,a.atoms_font_italic_2D),p=e.measureText(this.mass).width,e.fillText(this.mass,this.x-p-.5,this.y-a.atoms_font_size_2D/2+1),this.textBounds.push({x:this.x-g/2-p-.5,y:this.y-1.7*a.atoms_font_size_2D/2+1,w:p,h:a.atoms_font_size_2D/2-1}),e.font=d);var d=g/2,q=this.getImplicitHydrogenCount();if(a.atoms_implicitHydrogens_2D&&0<q){f=0;var l=e.measureText("H").width,r=!0;if(1<q){var v=g/2+l/2,u=0,t=j.getFontString(.8*a.atoms_font_size_2D,a.atoms_font_families_2D,a.atoms_font_bold_2D,a.atoms_font_italic_2D);e.font=t;var w=e.measureText(q).width;1===this.bondNumber?this.angleOfLeastInterference>h.PI/2&&this.angleOfLeastInterference<3*h.PI/2&&(v=-g/2-w-l/2-p/2,r=!1,f=h.PI):this.angleOfLeastInterference<=h.PI/4||(this.angleOfLeastInterference<3*h.PI/4?(v=0,u=.9*-a.atoms_font_size_2D,0!==this.charge&&(u-=.3*a.atoms_font_size_2D),r=!1,f=h.PI/2):this.angleOfLeastInterference<=5*h.PI/4?(v=-g/2-w-l/2-p/2,r=!1,f=h.PI):this.angleOfLeastInterference<7*h.PI/4&&(v=0,u=.9*a.atoms_font_size_2D,r=!1,f=3*h.PI/2));e.font=b;e.fillText("H",this.x+v,this.y+u);e.font=t;e.fillText(q,this.x+v+l/2+w/2,this.y+u+.3*a.atoms_font_size_2D);this.textBounds.push({x:this.x+v-l/2,y:this.y+u-a.atoms_font_size_2D/2+1,w:l,h:a.atoms_font_size_2D-2});this.textBounds.push({x:this.x+v+l/2,y:this.y+u+.3*a.atoms_font_size_2D-a.atoms_font_size_2D/2+1,w:w,h:.8*a.atoms_font_size_2D-2})}else v=g/2+l/2,u=0,1===this.bondNumber?this.angleOfLeastInterference>h.PI/2&&this.angleOfLeastInterference<3*h.PI/2&&(v=-g/2-l/2-p/2,r=!1,f=h.PI):this.angleOfLeastInterference<=h.PI/4||(this.angleOfLeastInterference<3*h.PI/4?(v=0,u=.9*-a.atoms_font_size_2D,r=!1,f=h.PI/2):this.angleOfLeastInterference<=5*h.PI/4?(v=-g/2-l/2-p/2,r=!1,f=h.PI):this.angleOfLeastInterference<7*h.PI/4&&(v=0,u=.9*a.atoms_font_size_2D,r=!1,f=3*h.PI/2)),e.fillText("H",this.x+v,this.y+u),this.textBounds.push({x:this.x+v-l/2,y:this.y+u-a.atoms_font_size_2D/2+1,w:l,h:a.atoms_font_size_2D-2});r&&(d+=l)}0!==this.charge&&(b=this.charge.toFixed(0),b="1"===b?"+":"-1"===b?"–":j.stringStartsWith(b,"-")?b.substring(1)+"–":b+"+",g=e.measureText(b).width,d+=g/2,e.textAlign="center",e.textBaseline="middle",e.font=j.getFontString(h.floor(.8*a.atoms_font_size_2D),a.atoms_font_families_2D,a.atoms_font_bold_2D,a.atoms_font_italic_2D),e.fillText(b,this.x+d-1,this.y-a.atoms_font_size_2D/2+1),this.textBounds.push({x:this.x+d-g/2-1,y:this.y-1.8*a.atoms_font_size_2D/2+5,w:g,h:a.atoms_font_size_2D/2-1}))}if(0<this.numLonePair||0<this.numRadical){e.fillStyle="black";q=this.angles.slice(0);d=this.angleOfLeastInterference;b=this.largestAngle;void 0!==f&&(q.push(f),q.sort(),b=o.angleBetweenLargest(q),d=b.angle%(2*h.PI),b=b.largest);g=[];for(p=0;p<this.numLonePair;p++)g.push({t:2});for(p=0;p<this.numRadical;p++)g.push({t:1});if(void 0===f&&h.abs(b-2*h.PI/q.length)<h.PI/60){q=h.ceil(g.length/q.length);p=0;for(l=g.length;p<l;p+=q,d+=b)this.drawElectrons(e,a,g.slice(p,h.min(g.length,p+q)),d,b,f)}else this.drawElectrons(e,a,g,d,b,f)}}};l.drawElectrons=function(e,a,d,b,f,g){g=f/(d.length+(0===this.bonds.length&&void 0===g?0:1));f=b-f/2+g;for(var j=0;j<d.length;j++){var q=d[j];b=f+j*g;var l=this.x+Math.cos(b)*a.atoms_lonePairDistance_2D,r=this.y-Math.sin(b)*a.atoms_lonePairDistance_2D;2===q.t?(q=b+Math.PI/2,b=Math.cos(q)*a.atoms_lonePairSpread_2D/2,q=-Math.sin(q)*a.atoms_lonePairSpread_2D/2,e.beginPath(),e.arc(l+b,r+q,a.atoms_lonePairDiameter_2D,0,2*h.PI,!1),e.fill(),e.beginPath(),e.arc(l-b,r-q,a.atoms_lonePairDiameter_2D,0,2*h.PI,!1),e.fill()):1===q.t&&(e.beginPath(),e.arc(l,r,a.atoms_lonePairDiameter_2D,0,2*h.PI,!1),e.fill())}};l.drawDecorations=function(e){if(this.isHover||this.isSelected)e.strokeStyle=this.isHover?"#885110":"#0060B2",e.lineWidth=1.2,e.beginPath(),e.arc(this.x,this.y,this.isHover?7:15,0,2*h.PI,!1),e.stroke();this.isOverlap&&(e.strokeStyle="#C10000",e.lineWidth=1.2,e.beginPath(),e.arc(this.x,this.y,7,0,2*h.PI,!1),e.stroke())};l.render=function(e,a,d){this.specs&&(a=this.specs);var n=g.translate(e.modelViewMatrix,[this.x,this.y,this.z],[]),f=a.atoms_useVDWDiameters_3D?b[this.label].vdWRadius*a.atoms_vdwMultiplier_3D:a.atoms_sphereDiameter_3D/2;0===f&&(f=1);g.scale(n,[f,f,f]);d||(d=a.atoms_color,a.atoms_useJMOLColors?d=b[this.label].jmolColor:a.atoms_usePYMOLColors&&(d=b[this.label].pymolColor),e.material.setDiffuseColor(d));e.setMatrixUniforms(n);e.drawElements(e.TRIANGLES,(this.renderAsStar?e.starBuffer:e.sphereBuffer).vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)};l.renderHighlight=function(e,a){if(this.isSelected||this.isHover){this.specs&&(a=this.specs);var d=g.translate(e.modelViewMatrix,[this.x,this.y,this.z],[]),n=a.atoms_useVDWDiameters_3D?b[this.label].vdWRadius*a.atoms_vdwMultiplier_3D:a.atoms_sphereDiameter_3D/2;0===n&&(n=1);n*=1.3;g.scale(d,[n,n,n]);e.setMatrixUniforms(d);e.material.setDiffuseColor(this.isHover?"#885110":"#0060B2");e.drawElements(e.TRIANGLES,(this.renderAsStar?e.starBuffer:e.sphereBuffer).vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}};l.isLabelVisible=function(e){return e.atoms_displayAllCarbonLabels_2D||"C"!==this.label||this.altLabel||(-1!==this.mass||0!==this.charge)||e.atoms_showAttributedCarbons_2D&&(0!==this.numRadical||0!==this.numLonePair)||this.isHidden&&e.atoms_showHiddenCarbons_2D||e.atoms_displayTerminalCarbonLabels_2D&&1===this.bondNumber?!0:!1};l.getImplicitHydrogenCount=function(){if("H"===this.label||!b[this.label]||!b[this.label].addH)return 0;var e=b[this.label].valency,a=e-this.coordinationNumber;0<this.numRadical&&(a=h.max(0,a-this.numRadical));0<this.charge?(e=4-e,a=this.charge<=e?a+this.charge:4-this.coordinationNumber-this.charge+e):a+=this.charge;return 0>a?0:h.floor(a)};l.getBounds=function(){var e=new o.Bounds;e.expand(this.x,this.y);if(this.textBounds)for(var a=0,d=this.textBounds.length;a<d;a++){var b=this.textBounds[a];e.expand(b.x,b.y,b.x+b.w,b.y+b.h)}return e};l.getBounds3D=function(){var e=new o.Bounds;e.expand3D(this.x,this.y,this.z);return e};l.getElementColor=function(e,a,d){e?d=b[this.label].jmolColor:a&&(d=b[this.label].pymolColor);return d}})(ChemDoodle.ELEMENT,ChemDoodle.extensions,ChemDoodle.math,ChemDoodle.structures,Math,ChemDoodle.lib.mat4);(function(b,j,o,l,h,g,e){o.Bond=function(a,d,e){this.a1=a;this.a2=d;this.bondOrder=void 0!==e?e:1};o.Bond.STEREO_NONE="none";o.Bond.STEREO_PROTRUDING="protruding";o.Bond.STEREO_RECESSED="recessed";o.Bond.STEREO_AMBIGUOUS="ambiguous";b=o.Bond.prototype;b.stereo=o.Bond.STEREO_NONE;b.isHover=!1;b.ring=void 0;b.getCenter=function(){return new o.Point((this.a1.x+this.a2.x)/2,(this.a1.y+this.a2.y)/2)};b.getLength=function(){return this.a1.distance(this.a2)};b.getLength3D=function(){return this.a1.distance3D(this.a2)};b.contains=function(a){return a===this.a1||a===this.a2};b.getNeighbor=function(a){if(a===this.a1)return this.a2;if(a===this.a2)return this.a1};b.draw=function(a,d){if(!(this.a1.x===this.a2.x&&this.a1.y===this.a2.y)){this.specs&&(d=this.specs);var e=this.a1.x,f=this.a2.x,b=this.a1.y,g=this.a2.y,q=this.a1.distance(this.a2),A=f-e,r=g-b;if(this.a1.isLassoed&&this.a2.isLassoed){var v=a.createLinearGradient(e,b,f,g);v.addColorStop(0,"rgba(212, 99, 0, 0)");v.addColorStop(.5,"rgba(212, 99, 0, 0.8)");v.addColorStop(1,"rgba(212, 99, 0, 0)");var u=2.5,t=this.a1.angle(this.a2)+h.PI/2,w=h.cos(t),t=h.sin(t),x=e-w*u,B=b+t*u,c=e+w*u,k=b-t*u,C=f+w*u,D=g-t*u,w=f-w*u,t=g+t*u;a.fillStyle=v;a.beginPath();a.moveTo(x,B);a.lineTo(c,k);a.lineTo(C,D);a.lineTo(w,t);a.closePath();a.fill()}if(d.atoms_display&&!d.atoms_circles_2D&&this.a1.isLabelVisible(d)&&this.a1.textBounds){u=w=0;for(x=this.a1.textBounds.length;u<x;u++)w=Math.max(w,l.calculateDistanceInterior(this.a1,this.a2,this.a1.textBounds[u]));w+=d.bonds_atomLabelBuffer_2D;w/=q;e+=A*w;b+=r*w}if(d.atoms_display&&!d.atoms_circles_2D&&this.a2.isLabelVisible(d)&&this.a2.textBounds){u=w=0;for(x=this.a2.textBounds.length;u<x;u++)w=Math.max(w,l.calculateDistanceInterior(this.a2,this.a1,this.a2.textBounds[u]));w+=d.bonds_atomLabelBuffer_2D;w/=q;f-=A*w;g-=r*w}d.bonds_clearOverlaps_2D&&(w=e+.15*A,t=b+.15*r,u=f-.15*A,q=g-.15*r,a.strokeStyle=d.backgroundColor,a.lineWidth=d.bonds_width_2D+2*d.bonds_overlapClearWidth_2D,a.lineCap="round",a.beginPath(),a.moveTo(w,t),a.lineTo(u,q),a.closePath(),a.stroke());a.strokeStyle=d.bonds_color;a.fillStyle=d.bonds_color;a.lineWidth=d.bonds_width_2D;a.lineCap=d.bonds_ends_2D;if(d.bonds_useJMOLColors||d.bonds_usePYMOLColors)w=a.createLinearGradient(e,b,f,g),t=this.a1.getElementColor(d.bonds_useJMOLColors,d.bonds_usePYMOLColors,d.atoms_color,2),u=this.a2.getElementColor(d.bonds_useJMOLColors,d.bonds_usePYMOLColors,d.atoms_color,2),w.addColorStop(0,t),d.bonds_colorGradient||(w.addColorStop(.5,t),w.addColorStop(.51,u)),w.addColorStop(1,u),a.strokeStyle=w,a.fillStyle=w;if(d.bonds_lewisStyle_2D&&0===this.bondOrder%1)this.drawLewisStyle(a,d,e,b,f,g);else switch(this.query?1:this.bondOrder){case 0:f-=e;g-=b;f=h.sqrt(f*f+g*g);g=h.floor(f/d.bonds_dotSize_2D);f=(f-(g-1)*d.bonds_dotSize_2D)/2;1===g%2?f+=d.bonds_dotSize_2D/4:(f-=d.bonds_dotSize_2D/4,g+=2);g/=2;r=this.a1.angle(this.a2);w=e+f*Math.cos(r);t=b-f*Math.sin(r);a.beginPath();for(u=0;u<g;u++)a.arc(w,t,d.bonds_dotSize_2D/2,0,2*h.PI,!1),w+=2*d.bonds_dotSize_2D*Math.cos(r),t-=2*d.bonds_dotSize_2D*Math.sin(r);a.fill();break;case.5:a.beginPath();a.moveTo(e,b);j.contextHashTo(a,e,b,f,g,d.bonds_hashSpacing_2D,d.bonds_hashSpacing_2D);a.stroke();break;case 1:if(!this.query&&(this.stereo===o.Bond.STEREO_PROTRUDING||this.stereo===o.Bond.STEREO_RECESSED))r=d.bonds_width_2D/2,u=this.a1.distance(this.a2)*d.bonds_wedgeThickness_2D/2,t=this.a1.angle(this.a2)+h.PI/2,w=h.cos(t),t=h.sin(t),x=e-w*r,B=b+t*r,c=e+w*r,k=b-t*r,C=f+w*u,D=g-t*u,w=f-w*u,t=g+t*u,a.beginPath(),a.moveTo(x,B),a.lineTo(c,k),a.lineTo(C,D),a.lineTo(w,t),a.closePath(),this.stereo===o.Bond.STEREO_PROTRUDING?a.fill():(a.save(),a.clip(),a.lineWidth=2*u,a.lineCap="butt",a.beginPath(),a.moveTo(e,b),j.contextHashTo(a,e,b,f,g,d.bonds_hashWidth_2D,d.bonds_hashSpacing_2D),a.stroke(),a.restore());else if(!this.query&&this.stereo===o.Bond.STEREO_AMBIGUOUS){a.beginPath();a.moveTo(e,b);f=h.floor(h.sqrt(A*A+r*r)/d.bonds_wavyLength_2D);t=this.a1.angle(this.a2)+h.PI/2;w=h.cos(t);t=h.sin(t);g=A/f;r/=f;u=0;for(x=f;u<x;u++)e+=g,b+=r,f=d.bonds_wavyLength_2D*w+e-.5*g,q=d.bonds_wavyLength_2D*-t+b-.5*r,A=d.bonds_wavyLength_2D*-w+e-.5*g,B=d.bonds_wavyLength_2D*t+b-.5*r,0===u%2?a.quadraticCurveTo(f,q,e,b):a.quadraticCurveTo(A,B,e,b);a.stroke();break}else a.beginPath(),a.moveTo(e,b),a.lineTo(f,g),a.stroke(),this.query&&this.query.draw(a,d,this.getCenter());break;case 1.5:case 2:this.stereo===o.Bond.STEREO_AMBIGUOUS?(u=this.a1.distance(this.a2)*d.bonds_saturationWidth_2D/2,t=this.a1.angle(this.a2)+h.PI/2,w=h.cos(t),t=h.sin(t),x=e-w*u,B=b+t*u,c=e+w*u,k=b-t*u,C=f+w*u,D=g-t*u,w=f-w*u,t=g+t*u,a.beginPath(),a.moveTo(x,B),a.lineTo(C,D),a.moveTo(c,k),a.lineTo(w,t),a.stroke()):!d.bonds_symmetrical_2D&&(this.ring||"C"===this.a1.label&&"C"===this.a2.label)?(a.beginPath(),a.moveTo(e,b),a.lineTo(f,g),w=0,q=this.a1.distance(this.a2),r=this.a1.angle(this.a2),t=r+h.PI/2,u=q*d.bonds_saturationWidth_2D,A=d.bonds_saturationAngle_2D,A<h.PI/2&&(w=-(u/h.tan(A))),h.abs(w)<q/2&&(A=e-h.cos(r)*w,e=f+h.cos(r)*w,f=b+h.sin(r)*w,b=g-h.sin(r)*w,w=h.cos(t),t=h.sin(t),x=A-w*u,B=f+t*u,c=A+w*u,k=f-t*u,C=e-w*u,D=b+t*u,w=e+w*u,t=b-t*u,!this.ring||this.ring.center.angle(this.a1)>this.ring.center.angle(this.a2)&&!(this.ring.center.angle(this.a1)-this.ring.center.angle(this.a2)>h.PI)||this.ring.center.angle(this.a1)-this.ring.center.angle(this.a2)<-h.PI?(a.moveTo(x,B),2===this.bondOrder?a.lineTo(C,D):j.contextHashTo(a,x,B,C,D,d.bonds_hashSpacing_2D,d.bonds_hashSpacing_2D)):(a.moveTo(c,k),2===this.bondOrder?a.lineTo(w,t):j.contextHashTo(a,c,k,w,t,d.bonds_hashSpacing_2D,d.bonds_hashSpacing_2D)),a.stroke())):(u=this.a1.distance(this.a2)*d.bonds_saturationWidth_2D/2,t=this.a1.angle(this.a2)+h.PI/2,w=h.cos(t),t=h.sin(t),x=e-w*u,B=b+t*u,c=e+w*u,k=b-t*u,C=f+w*u,D=g-t*u,w=f-w*u,t=g+t*u,a.beginPath(),a.moveTo(x,B),a.lineTo(w,t),a.moveTo(c,k),2===this.bondOrder?a.lineTo(C,D):j.contextHashTo(a,c,k,C,D,d.bonds_hashSpacing_2D,d.bonds_hashSpacing_2D),a.stroke());break;case 3:u=this.a1.distance(this.a2)*d.bonds_saturationWidth_2D,t=this.a1.angle(this.a2)+h.PI/2,w=h.cos(t),t=h.sin(t),x=e-w*u,B=b+t*u,c=e+w*u,k=b-t*u,C=f+w*u,D=g-t*u,w=f-w*u,t=g+t*u,a.beginPath(),a.moveTo(x,B),a.lineTo(w,t),a.moveTo(c,k),a.lineTo(C,D),a.moveTo(e,b),a.lineTo(f,g),a.stroke()}}};b.drawDecorations=function(a){if(this.isHover||this.isSelected){var d=2*h.PI,e=(this.a1.angleForStupidCanvasArcs(this.a2)+h.PI/2)%d;a.strokeStyle=this.isHover?"#885110":"#0060B2";a.lineWidth=1.2;a.beginPath();var f=(e+h.PI)%d,f=f%(2*h.PI);a.arc(this.a1.x,this.a1.y,7,e,f,!1);a.stroke();a.beginPath();e+=h.PI;f=(e+h.PI)%d;a.arc(this.a2.x,this.a2.y,7,e,f,!1);a.stroke()}};b.drawLewisStyle=function(a,d,e,f,b,g){var j=this.a1.angle(this.a2),l=j+h.PI/2;b-=e;g-=f;b=h.sqrt(b*b+g*g)/(this.bondOrder+1);g=b*h.cos(j);j=-b*h.sin(j);e+=g;f+=j;for(b=0;b<this.bondOrder;b++){var r=d.atoms_lonePairSpread_2D/2,o=e-h.cos(l)*r,u=f+h.sin(l)*r,t=e+h.cos(l)*r,r=f-h.sin(l)*r;a.beginPath();a.arc(o-d.atoms_lonePairDiameter_2D/2,u-d.atoms_lonePairDiameter_2D/2,d.atoms_lonePairDiameter_2D,0,2*h.PI,!1);a.fill();a.beginPath();a.arc(t-d.atoms_lonePairDiameter_2D/2,r-d.atoms_lonePairDiameter_2D/2,d.atoms_lonePairDiameter_2D,0,2*h.PI,!1);a.fill();e+=g;f+=j}};b.render=function(a,d,b){this.specs&&(d=this.specs);var f=this.a1.distance3D(this.a2);if(0!==f){var y=d.bonds_cylinderDiameter_3D/2,p=d.bonds_color,q,l=g.translate(a.modelViewMatrix,[this.a1.x,this.a1.y,this.a1.z],[]),r,o=[this.a2.x-this.a1.x,this.a2.y-this.a1.y,this.a2.z-this.a1.z],u=[0,1,0],t=0;this.a1.x===this.a2.x&&this.a1.z===this.a2.z?(u=[0,0,1],this.a2.y<this.a1.y&&(t=h.PI)):(t=j.vec3AngleFrom(u,o),u=e.cross(u,o,[]));var w=d.bonds_useJMOLColors,x=d.bonds_usePYMOLColors;if(w||x)p=this.a1.getElementColor(w,x,p),q=this.a2.getElementColor(w,x,d.bonds_color),p!=q&&(r=g.translate(a.modelViewMatrix,[this.a2.x,this.a2.y,this.a2.z],[]));var w=[0],B;if(b){d.bonds_showBondOrders_3D&&1<this.bondOrder&&(w=[d.bonds_cylinderDiameter_3D],B=[0,0,1],b=g.inverse(a.rotationMatrix,[]),g.multiplyVec3(b,B),B=e.cross(o,B,[]),e.normalize(B));var y=1,c=d.bonds_pillSpacing_3D,o=d.bonds_pillHeight_3D;0==this.bondOrder&&(d.bonds_renderAsLines_3D?o=c:(o=d.bonds_pillDiameter_3D,o<d.bonds_cylinderDiameter_3D&&(o/=2),y=o/2,f/=y,c/=y/2));b=o+c;var x=h.floor(f/b),k=(c+d.bonds_pillDiameter_3D+(f-b*x))/2,C=x;r&&(C=h.floor(x/2));f=0;for(c=w.length;f<c;f++){var D=g.set(l,[]);0!==w[f]&&g.translate(D,e.scale(B,w[f],[]));0!==t&&g.rotate(D,t,u);1!=y&&g.scale(D,[y,y,y]);p&&a.material.setDiffuseColor(p);g.translate(D,[0,k,0]);for(var G=0;G<C;G++)d.bonds_renderAsLines_3D?0==this.bondOrder?(a.setMatrixUniforms(D),a.drawArrays(a.POINTS,0,1)):(g.scale(D,[1,o,1]),a.setMatrixUniforms(D),a.drawArrays(a.LINES,0,a.lineBuffer.vertexPositionBuffer.numItems),g.scale(D,[1,1/o,1])):(a.setMatrixUniforms(D),0==this.bondOrder?a.drawElements(a.TRIANGLES,a.sphereBuffer.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0):a.drawElements(a.TRIANGLES,a.pillBuffer.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0)),g.translate(D,[0,b,0]);if(r){var E,H;d.bonds_renderAsLines_3D?(E=o,E/=2,H=0):(E=2/3,H=(1-E)/2);0!=x%2&&(g.scale(D,[1,E,1]),a.setMatrixUniforms(D),d.bonds_renderAsLines_3D?0==this.bondOrder?a.drawArrays(a.POINTS,0,1):a.drawArrays(a.LINES,0,a.lineBuffer.vertexPositionBuffer.numItems):0==this.bondOrder?a.drawElements(a.TRIANGLES,a.sphereBuffer.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0):a.drawElements(a.TRIANGLES,a.pillBuffer.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0),g.translate(D,[0,b*(1+H),0]),g.scale(D,[1,1/E,1]));g.set(r,D);0!==w[f]&&g.translate(D,e.scale(B,w[f],[]));g.rotate(D,t+h.PI,u);1!=y&&g.scale(D,[y,y,y]);q&&a.material.setDiffuseColor(q);g.translate(D,[0,k,0]);for(G=0;G<C;G++)d.bonds_renderAsLines_3D?0==this.bondOrder?(a.setMatrixUniforms(D),a.drawArrays(a.POINTS,0,1)):(g.scale(D,[1,o,1]),a.setMatrixUniforms(D),a.drawArrays(a.LINES,0,a.lineBuffer.vertexPositionBuffer.numItems),g.scale(D,[1,1/o,1])):(a.setMatrixUniforms(D),0==this.bondOrder?a.drawElements(a.TRIANGLES,a.sphereBuffer.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0):a.drawElements(a.TRIANGLES,a.pillBuffer.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0)),g.translate(D,[0,b,0]);0!=x%2&&(g.scale(D,[1,E,1]),a.setMatrixUniforms(D),d.bonds_renderAsLines_3D?0==this.bondOrder?a.drawArrays(a.POINTS,0,1):a.drawArrays(a.LINES,0,a.lineBuffer.vertexPositionBuffer.numItems):0==this.bondOrder?a.drawElements(a.TRIANGLES,a.sphereBuffer.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0):a.drawElements(a.TRIANGLES,a.pillBuffer.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0),g.translate(D,[0,b*(1+H),0]),g.scale(D,[1,1/E,1]))}}}else{if(d.bonds_showBondOrders_3D){switch(this.bondOrder){case 1.5:w=[-d.bonds_cylinderDiameter_3D];break;case 2:w=[-d.bonds_cylinderDiameter_3D,d.bonds_cylinderDiameter_3D];break;case 3:w=[-1.2*d.bonds_cylinderDiameter_3D,0,1.2*d.bonds_cylinderDiameter_3D]}1<this.bondOrder&&(B=[0,0,1],b=g.inverse(a.rotationMatrix,[]),g.multiplyVec3(b,B),B=e.cross(o,B,[]),e.normalize(B))}else switch(this.bondOrder){case 0:y*=.25;break;case.5:case 1.5:y*=.5}r&&(f/=2);y=[y,f,y];f=0;for(c=w.length;f<c;f++)D=g.set(l,[]),0!==w[f]&&g.translate(D,e.scale(B,w[f],[])),0!==t&&g.rotate(D,t,u),g.scale(D,y),p&&a.material.setDiffuseColor(p),a.setMatrixUniforms(D),d.bonds_renderAsLines_3D?a.drawArrays(a.LINES,0,a.lineBuffer.vertexPositionBuffer.numItems):a.drawArrays(a.TRIANGLE_STRIP,0,a.cylinderBuffer.vertexPositionBuffer.numItems),r&&(g.set(r,D),0!==w[f]&&g.translate(D,e.scale(B,w[f],[])),g.rotate(D,t+h.PI,u),g.scale(D,y),q&&a.material.setDiffuseColor(q),a.setMatrixUniforms(D),d.bonds_renderAsLines_3D?a.drawArrays(a.LINES,0,a.lineBuffer.vertexPositionBuffer.numItems):a.drawArrays(a.TRIANGLE_STRIP,0,a.cylinderBuffer.vertexPositionBuffer.numItems))}}};b.renderHighlight=function(a,d){if(this.isSelected||this.isHover){this.specs&&(d=this.specs);this.specs&&(d=this.specs);var b=this.a1.distance3D(this.a2);if(0!==b){var f=d.bonds_cylinderDiameter_3D/1.2,y=g.translate(a.modelViewMatrix,[this.a1.x,this.a1.y,this.a1.z],[]),p=[this.a2.x-this.a1.x,this.a2.y-this.a1.y,this.a2.z-this.a1.z],q=[0,1,0],l=0;this.a1.x===this.a2.x&&this.a1.z===this.a2.z?(p=[0,0,1],this.a2.y<this.a1.y&&(l=h.PI)):(l=j.vec3AngleFrom(q,p),p=e.cross(q,p,[]));b=[f,b,f];0!==l&&g.rotate(y,l,p);g.scale(y,b);a.setMatrixUniforms(y);a.material.setDiffuseColor(this.isHover?"#885110":"#0060B2");a.drawArrays(a.TRIANGLE_STRIP,0,a.cylinderBuffer.vertexPositionBuffer.numItems)}}};b.renderPicker=function(a,d){this.specs&&(d=this.specs);var b=this.a1.distance3D(this.a2);if(0!==b){var f=d.bonds_cylinderDiameter_3D/2,y=g.translate(a.modelViewMatrix,[this.a1.x,this.a1.y,this.a1.z],[]),p=[this.a2.x-this.a1.x,this.a2.y-this.a1.y,this.a2.z-this.a1.z],q=[0,1,0],l=0;this.a1.x===this.a2.x&&this.a1.z===this.a2.z?(q=[0,0,1],this.a2.y<this.a1.y&&(l=h.PI)):(l=j.vec3AngleFrom(q,p),q=e.cross(q,p,[]));var o=[0],v;if(d.bonds_showBondOrders_3D)if(d.bonds_renderAsLines_3D){switch(this.bondOrder){case 1.5:case 2:o=[-d.bonds_cylinderDiameter_3D,d.bonds_cylinderDiameter_3D];break;case 3:o=[-1.2*d.bonds_cylinderDiameter_3D,0,1.2*d.bonds_cylinderDiameter_3D]}if(1<this.bondOrder){v=[0,0,1];var u=g.inverse(a.rotationMatrix,[]);g.multiplyVec3(u,v);v=e.cross(p,v,[]);e.normalize(v)}}else switch(this.bondOrder){case 1.5:case 2:f*=3;break;case 3:f*=3.4}else switch(this.bondOrder){case 0:f*=.25;break;case.5:case 1.5:f*=.5}b=[f,b,f];f=0;for(p=o.length;f<p;f++)u=g.set(y,[]),0!==o[f]&&g.translate(u,e.scale(v,o[f],[])),0!==l&&g.rotate(u,l,q),g.scale(u,b),a.setMatrixUniforms(u),d.bonds_renderAsLines_3D?a.drawArrays(a.LINES,0,a.lineBuffer.vertexPositionBuffer.numItems):a.drawArrays(a.TRIANGLE_STRIP,0,a.cylinderBuffer.vertexPositionBuffer.numItems)}}})(ChemDoodle.ELEMENT,ChemDoodle.extensions,ChemDoodle.structures,ChemDoodle.math,Math,ChemDoodle.lib.mat4,ChemDoodle.lib.vec3);(function(b,j){b.Ring=function(){this.atoms=[];this.bonds=[]};var o=b.Ring.prototype;o.center=void 0;o.setupBonds=function(){for(var b=0,h=this.bonds.length;b<h;b++)this.bonds[b].ring=this;this.center=this.getCenter()};o.getCenter=function(){for(var l=Infinity,h=Infinity,g=-Infinity,e=-Infinity,a=0,d=this.atoms.length;a<d;a++)l=j.min(this.atoms[a].x,l),h=j.min(this.atoms[a].y,h),g=j.max(this.atoms[a].x,g),e=j.max(this.atoms[a].y,e);return new b.Point((g+l)/2,(e+h)/2)}})(ChemDoodle.structures,Math);(function(b,j,o,l,h){o.Molecule=function(){this.atoms=[];this.bonds=[];this.rings=[]};var g=o.Molecule.prototype;g.findRings=!0;g.draw=function(e,a){this.specs&&(a=this.specs);if(a.atoms_display&&!a.atoms_circles_2D)for(var d=0,b=this.atoms.length;d<b;d++)this.atoms[d].draw(e,a);if(a.bonds_display){d=0;for(b=this.bonds.length;d<b;d++)this.bonds[d].draw(e,a)}if(a.atoms_display){d=0;for(b=this.atoms.length;d<b;d++){var f=this.atoms[d];a.atoms_circles_2D&&f.draw(e,a);f.query&&f.query.draw(e,a,f)}}};g.render=function(e,a){this.specs&&(a=this.specs);var d=0<this.atoms.length&&void 0!==this.atoms[0].hetatm;if(d){if(a.macro_displayBonds){0<this.bonds.length&&(a.bonds_renderAsLines_3D&&!this.residueSpecs||this.residueSpecs&&this.residueSpecs.bonds_renderAsLines_3D?(e.lineWidth(this.residueSpecs?this.residueSpecs.bonds_width_2D:a.bonds_width_2D),e.lineBuffer.bindBuffers(e)):e.cylinderBuffer.bindBuffers(e),
e.material.setTempColors(a.bonds_materialAmbientColor_3D,void 0,a.bonds_materialSpecularColor_3D,a.bonds_materialShininess_3D));for(var b=0,f=this.bonds.length;b<f;b++){var g=this.bonds[b];if(!g.a1.hetatm&&(-1===a.macro_atomToLigandDistance||void 0!==g.a1.closestDistance&&a.macro_atomToLigandDistance>=g.a1.closestDistance&&a.macro_atomToLigandDistance>=g.a2.closestDistance))g.render(e,this.residueSpecs?this.residueSpecs:a)}}if(a.macro_displayAtoms){0<this.atoms.length&&(e.sphereBuffer.bindBuffers(e),e.material.setTempColors(a.atoms_materialAmbientColor_3D,void 0,a.atoms_materialSpecularColor_3D,a.atoms_materialShininess_3D));b=0;for(f=this.atoms.length;b<f;b++)if(g=this.atoms[b],!g.hetatm&&(-1===a.macro_atomToLigandDistance||void 0!==g.closestDistance&&a.macro_atomToLigandDistance>=g.closestDistance))g.render(e,this.residueSpecs?this.residueSpecs:a)}}if(a.bonds_display){var h=[],q=[];0<this.bonds.length&&(a.bonds_renderAsLines_3D?(e.lineWidth(a.bonds_width_2D),e.lineBuffer.bindBuffers(e)):e.cylinderBuffer.bindBuffers(e),e.material.setTempColors(a.bonds_materialAmbientColor_3D,void 0,a.bonds_materialSpecularColor_3D,a.bonds_materialShininess_3D));b=0;for(f=this.bonds.length;b<f;b++)if(g=this.bonds[b],!d||g.a1.hetatm)a.bonds_showBondOrders_3D?0==g.bondOrder?q.push(g):.5==g.bondOrder?h.push(g):(1.5==g.bondOrder&&h.push(g),g.render(e,a)):g.render(e,a);if(0<h.length){a.bonds_renderAsLines_3D||e.pillBuffer.bindBuffers(e);b=0;for(f=h.length;b<f;b++)h[b].render(e,a,!0)}if(0<q.length){a.bonds_renderAsLines_3D||e.sphereBuffer.bindBuffers(e);b=0;for(f=q.length;b<f;b++)q[b].render(e,a,!0)}}if(a.atoms_display){b=0;for(f=this.atoms.length;b<f;b++)g=this.atoms[b],g.bondNumber=0,g.renderAsStar=!1;b=0;for(f=this.bonds.length;b<f;b++)g=this.bonds[b],g.a1.bondNumber++,g.a2.bondNumber++;0<this.atoms.length&&(e.sphereBuffer.bindBuffers(e),e.material.setTempColors(a.atoms_materialAmbientColor_3D,void 0,a.atoms_materialSpecularColor_3D,a.atoms_materialShininess_3D));h=[];b=0;for(f=this.atoms.length;b<f;b++)if(g=this.atoms[b],!d||g.hetatm&&(a.macro_showWater||!g.isWater))a.atoms_nonBondedAsStars_3D&&0===g.bondNumber?(g.renderAsStar=!0,h.push(g)):g.render(e,a);if(0<h.length){e.starBuffer.bindBuffers(e);b=0;for(f=h.length;b<f;b++)h[b].render(e,a)}}if(this.chains){e.setMatrixUniforms(e.modelViewMatrix);if(a.proteins_displayRibbon){e.material.setTempColors(a.proteins_materialAmbientColor_3D,void 0,a.proteins_materialSpecularColor_3D,a.proteins_materialShininess_3D);g=a.proteins_ribbonCartoonize?this.cartoons:this.ribbons;d=0;for(h=g.length;d<h;d++)if(q=g[d],"none"!==a.proteins_residueColor){q.front.bindBuffers(e);for(var A="rainbow"===a.proteins_residueColor,b=0,f=q.front.segments.length;b<f;b++)A&&e.material.setDiffuseColor(j.rainbowAt(b,f,a.macro_rainbowColors)),q.front.segments[b].render(e,a);q.back.bindBuffers(e);b=0;for(f=q.back.segments.length;b<f;b++)A&&e.material.setDiffuseColor(j.rainbowAt(b,f,a.macro_rainbowColors)),q.back.segments[b].render(e,a)}else q.front.render(e,a),q.back.render(e,a)}if(a.proteins_displayPipePlank){d=0;for(h=this.pipePlanks.length;d<h;d++)this.pipePlanks[d].render(e,a)}if(a.proteins_displayBackbone){if(!this.alphaCarbonTrace){this.alphaCarbonTrace={nodes:[],edges:[]};d=0;for(h=this.chains.length;d<h;d++)if(q=this.chains[d],!(2<q.length&&l[q[2].name]&&"#BEA06E"===l[q[2].name].aminoColor)&&0<q.length){b=0;for(f=q.length-2;b<f;b++)g=q[b].cp1,g.chainColor=q.chainColor,this.alphaCarbonTrace.nodes.push(g),g=new o.Bond(q[b].cp1,q[b+1].cp1),g.residueName=q[b].name,g.chainColor=q.chainColor,this.alphaCarbonTrace.edges.push(g),b===q.length-3&&(g=q[b+1].cp1,g.chainColor=q.chainColor,this.alphaCarbonTrace.nodes.push(g))}}if(0<this.alphaCarbonTrace.nodes.length){d=new o.VisualSpecifications;d.atoms_display=!0;d.bonds_display=!0;d.atoms_sphereDiameter_3D=a.proteins_backboneThickness;d.bonds_cylinderDiameter_3D=a.proteins_backboneThickness;d.bonds_useJMOLColors=!1;d.atoms_color=a.proteins_backboneColor;d.bonds_color=a.proteins_backboneColor;d.atoms_useVDWDiameters_3D=!1;e.material.setTempColors(a.proteins_materialAmbientColor_3D,void 0,a.proteins_materialSpecularColor_3D,a.proteins_materialShininess_3D);e.material.setDiffuseColor(a.proteins_backboneColor);b=0;for(f=this.alphaCarbonTrace.nodes.length;b<f;b++)g=this.alphaCarbonTrace.nodes[b],a.macro_colorByChain&&(d.atoms_color=g.chainColor),e.sphereBuffer.bindBuffers(e),g.render(e,d);b=0;for(f=this.alphaCarbonTrace.edges.length;b<f;b++){var g=this.alphaCarbonTrace.edges[b],r,h=l[g.residueName]?l[g.residueName]:l["*"];a.macro_colorByChain?r=g.chainColor:"shapely"===a.proteins_residueColor?r=h.shapelyColor:"amino"===a.proteins_residueColor?r=h.aminoColor:"polarity"===a.proteins_residueColor?r=h.polar?"#C10000":"#FFFFFF":"acidity"===a.proteins_residueColor?r=1===h.acidity?"#0000FF":-1===h.acidity?"#FF0000":h.polar?"#FFFFFF":"#773300":"rainbow"===a.proteins_residueColor&&(r=j.rainbowAt(b,f,a.macro_rainbowColors));r&&(d.bonds_color=r);e.cylinderBuffer.bindBuffers(e);g.render(e,d)}}}if(a.nucleics_display){e.material.setTempColors(a.nucleics_materialAmbientColor_3D,void 0,a.nucleics_materialSpecularColor_3D,a.nucleics_materialShininess_3D);d=0;for(h=this.tubes.length;d<h;d++)e.setMatrixUniforms(e.modelViewMatrix),q=this.tubes[d],q.render(e,a)}}if(a.atoms_display){r=!1;b=0;for(f=this.atoms.length;b<f;b++)if(g=this.atoms[b],g.isHover||g.isSelected){r=!0;break}if(!r){b=0;for(f=this.bonds.length;b<f;b++)if(g=this.bonds[b],g.isHover||g.isSelected){r=!0;break}}if(r){e.sphereBuffer.bindBuffers(e);e.blendFunc(e.SRC_ALPHA,e.ONE);e.material.setTempColors(a.atoms_materialAmbientColor_3D,void 0,"#000000",0);e.enable(e.BLEND);e.depthMask(!1);e.material.setAlpha(.4);e.sphereBuffer.bindBuffers(e);b=0;for(f=this.atoms.length;b<f;b++)g=this.atoms[b],(g.isHover||g.isSelected)&&g.renderHighlight(e,a);e.cylinderBuffer.bindBuffers(e);b=0;for(f=this.bonds.length;b<f;b++)g=this.bonds[b],(g.isHover||g.isSelected)&&g.renderHighlight(e,a);e.depthMask(!0);e.disable(e.BLEND);e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}}this.surface&&a.surfaces_display&&(e.setMatrixUniforms(e.modelViewMatrix),this.surface.bindBuffers(e),e.material.setTempColors(a.surfaces_materialAmbientColor_3D,a.surfaces_color,a.surfaces_materialSpecularColor_3D,a.surfaces_materialShininess_3D),"Dot"===a.surfaces_style?e.drawArrays(e.POINTS,0,this.surface.vertexPositionBuffer.numItems):e.drawElements(e.TRIANGLES,this.surface.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0))};g.renderPickFrame=function(e,a,d,b,f){this.specs&&(a=this.specs);var g=0<this.atoms.length&&void 0!==this.atoms[0].hetatm;if(f&&a.bonds_display){0<this.bonds.length&&(a.bonds_renderAsLines_3D?(e.lineWidth(a.bonds_width_2D),e.lineBuffer.bindBuffers(e)):e.cylinderBuffer.bindBuffers(e));f=0;for(var h=this.bonds.length;f<h;f++){var q=this.bonds[f];if(!g||q.a1.hetatm)e.material.setDiffuseColor(j.idx2color(d.length)),q.renderPicker(e,a),d.push(q)}}if(b&&a.atoms_display){f=0;for(h=this.atoms.length;f<h;f++)b=this.atoms[f],b.bondNumber=0,b.renderAsStar=!1;f=0;for(h=this.bonds.length;f<h;f++)q=this.bonds[f],q.a1.bondNumber++,q.a2.bondNumber++;0<this.atoms.length&&e.sphereBuffer.bindBuffers(e);q=[];f=0;for(h=this.atoms.length;f<h;f++)if(b=this.atoms[f],!g||b.hetatm&&(a.macro_showWater||!b.isWater))a.atoms_nonBondedAsStars_3D&&0===b.bondNumber?(b.renderAsStar=!0,q.push(b)):(e.material.setDiffuseColor(j.idx2color(d.length)),b.render(e,a,!0),d.push(b));if(0<q.length){e.starBuffer.bindBuffers(e);f=0;for(h=q.length;f<h;f++)b=q[f],e.material.setDiffuseColor(j.idx2color(d.length)),b.render(e,a,!0),d.push(b)}}};g.getCenter3D=function(){if(1===this.atoms.length)return new o.Atom("C",this.atoms[0].x,this.atoms[0].y,this.atoms[0].z);var e=Infinity,a=Infinity,d=Infinity,b=-Infinity,f=-Infinity,g=-Infinity;if(this.chains)for(var j=0,q=this.chains.length;j<q;j++)for(var l=this.chains[j],r=0,v=l.length;r<v;r++)var u=l[r],e=h.min(u.cp1.x,u.cp2.x,e),a=h.min(u.cp1.y,u.cp2.y,a),d=h.min(u.cp1.z,u.cp2.z,d),b=h.max(u.cp1.x,u.cp2.x,b),f=h.max(u.cp1.y,u.cp2.y,f),g=h.max(u.cp1.z,u.cp2.z,g);j=0;for(q=this.atoms.length;j<q;j++)e=h.min(this.atoms[j].x,e),a=h.min(this.atoms[j].y,a),d=h.min(this.atoms[j].z,d),b=h.max(this.atoms[j].x,b),f=h.max(this.atoms[j].y,f),g=h.max(this.atoms[j].z,g);return new o.Atom("C",(b+e)/2,(f+a)/2,(g+d)/2)};g.getCenter=function(){if(1===this.atoms.length)return new o.Point(this.atoms[0].x,this.atoms[0].y);for(var e=Infinity,a=Infinity,d=-Infinity,b=-Infinity,f=0,g=this.atoms.length;f<g;f++)e=h.min(this.atoms[f].x,e),a=h.min(this.atoms[f].y,a),d=h.max(this.atoms[f].x,d),b=h.max(this.atoms[f].y,b);return new o.Point((d+e)/2,(b+a)/2)};g.getDimension=function(){if(1===this.atoms.length)return new o.Point(0,0);var e=Infinity,a=Infinity,d=-Infinity,b=-Infinity;if(this.chains){for(var f=0,g=this.chains.length;f<g;f++)for(var j=this.chains[f],q=0,l=j.length;q<l;q++)var r=j[q],e=h.min(r.cp1.x,r.cp2.x,e),a=h.min(r.cp1.y,r.cp2.y,a),d=h.max(r.cp1.x,r.cp2.x,d),b=h.max(r.cp1.y,r.cp2.y,b);e-=30;a-=30;d+=30;b+=30}f=0;for(g=this.atoms.length;f<g;f++)e=h.min(this.atoms[f].x,e),a=h.min(this.atoms[f].y,a),d=h.max(this.atoms[f].x,d),b=h.max(this.atoms[f].y,b);return new o.Point(d-e,b-a)};g.check=function(e){if(e&&this.doChecks){if(this.findRings)if(this.bonds.length-this.atoms.length!==this.fjNumCache){this.rings=new b.informatics.SSSRFinder(this).rings;for(var a=0,d=this.bonds.length;a<d;a++)this.bonds[a].ring=void 0;a=0;for(d=this.rings.length;a<d;a++)this.rings[a].setupBonds()}else{a=0;for(d=this.rings.length;a<d;a++){var g=this.rings[a];g.center=g.getCenter()}}a=0;for(d=this.atoms.length;a<d;a++)if(this.atoms[a].isLone=!1,"C"===this.atoms[a].label){for(var f=g=0,h=this.bonds.length;f<h;f++)(this.bonds[f].a1===this.atoms[a]||this.bonds[f].a2===this.atoms[a])&&g++;0===g&&(this.atoms[a].isLone=!0)}g=!1;a=0;for(d=this.atoms.length;a<d;a++)0!==this.atoms[a].z&&(g=!0);g&&(this.sortAtomsByZ(),this.sortBondsByZ());this.setupMetaData();this.atomNumCache=this.atoms.length;this.bondNumCache=this.bonds.length;this.fjNumCache=this.bonds.length-this.atoms.length}this.doChecks=!e};g.getAngles=function(e){for(var a=[],d=0,b=this.bonds.length;d<b;d++)this.bonds[d].contains(e)&&a.push(e.angle(this.bonds[d].getNeighbor(e)));a.sort();return a};g.getCoordinationNumber=function(e){for(var a=0,d=0,b=e.length;d<b;d++)a+=e[d].bondOrder;return a};g.getBonds=function(e){for(var a=[],d=0,b=this.bonds.length;d<b;d++)this.bonds[d].contains(e)&&a.push(this.bonds[d]);return a};g.sortAtomsByZ=function(){for(var e=1,a=this.atoms.length;e<a;e++)for(var d=e;0<d&&this.atoms[d].z<this.atoms[d-1].z;){var b=this.atoms[d];this.atoms[d]=this.atoms[d-1];this.atoms[d-1]=b;d--}};g.sortBondsByZ=function(){for(var e=1,a=this.bonds.length;e<a;e++)for(var d=e;0<d&&this.bonds[d].a1.z+this.bonds[d].a2.z<this.bonds[d-1].a1.z+this.bonds[d-1].a2.z;){var b=this.bonds[d];this.bonds[d]=this.bonds[d-1];this.bonds[d-1]=b;d--}};g.setupMetaData=function(){for(var e=this.getCenter(),a=0,d=this.atoms.length;a<d;a++){var b=this.atoms[a];b.bonds=this.getBonds(b);b.angles=this.getAngles(b);b.isHidden=2===b.bonds.length&&h.abs(h.abs(b.angles[1]-b.angles[0])-h.PI)<h.PI/30&&b.bonds[0].bondOrder===b.bonds[1].bondOrder;var f=j.angleBetweenLargest(b.angles);b.angleOfLeastInterference=f.angle%(2*h.PI);b.largestAngle=f.largest;b.coordinationNumber=this.getCoordinationNumber(b.bonds);b.bondNumber=b.bonds.length;b.molCenter=e}a=0;for(d=this.bonds.length;a<d;a++)this.bonds[a].molCenter=e};g.scaleToAverageBondLength=function(e){var a=this.getAverageBondLength();if(0!==a){e/=a;for(var a=0,d=this.atoms.length;a<d;a++)this.atoms[a].x*=e,this.atoms[a].y*=e}};g.getAverageBondLength=function(){if(0===this.bonds.length)return 0;for(var e=0,a=0,d=this.bonds.length;a<d;a++)e+=this.bonds[a].getLength();return e/=this.bonds.length};g.getBounds=function(){for(var e=new j.Bounds,a=0,d=this.atoms.length;a<d;a++)e.expand(this.atoms[a].getBounds());if(this.chains){a=0;for(d=this.chains.length;a<d;a++)for(var b=this.chains[a],f=0,g=b.length;f<g;f++){var h=b[f];e.expand(h.cp1.x,h.cp1.y);e.expand(h.cp2.x,h.cp2.y)}e.minX-=30;e.minY-=30;e.maxX+=30;e.maxY+=30}return e};g.getBounds3D=function(){for(var e=new j.Bounds,a=0,d=this.atoms.length;a<d;a++)e.expand(this.atoms[a].getBounds3D());if(this.chains){a=0;for(d=this.chains.length;a<d;a++)for(var b=this.chains[a],f=0,g=b.length;f<g;f++){var h=b[f];e.expand3D(h.cp1.x,h.cp1.y,h.cp1.z);e.expand3D(h.cp2.x,h.cp2.y,h.cp2.z)}}return e}})(ChemDoodle,ChemDoodle.math,ChemDoodle.structures,ChemDoodle.RESIDUE,Math);(function(b,j,o,l){var h,g=-1;b.Residue=function(a){this.resSeq=a};var e=b.Residue.prototype;e.setup=function(a,d){this.horizontalResolution=d;var e=[a.x-this.cp1.x,a.y-this.cp1.y,a.z-this.cp1.z],f=l.cross(e,[this.cp2.x-this.cp1.x,this.cp2.y-this.cp1.y,this.cp2.z-this.cp1.z],[]);this.D=l.cross(f,e,[]);l.normalize(f);l.normalize(this.D);this.guidePointsSmall=[];this.guidePointsLarge=[];e=[(a.x+this.cp1.x)/2,(a.y+this.cp1.y)/2,(a.z+this.cp1.z)/2];this.helix&&(l.scale(f,1.5),l.add(e,f));this.guidePointsSmall[0]=new b.Atom("",e[0]-this.D[0]/2,e[1]-this.D[1]/2,e[2]-this.D[2]/2);for(f=1;f<d;f++)this.guidePointsSmall[f]=new b.Atom("",this.guidePointsSmall[0].x+this.D[0]*f/d,this.guidePointsSmall[0].y+this.D[1]*f/d,this.guidePointsSmall[0].z+this.D[2]*f/d);l.scale(this.D,4);this.guidePointsLarge[0]=new b.Atom("",e[0]-this.D[0]/2,e[1]-this.D[1]/2,e[2]-this.D[2]/2);for(f=1;f<d;f++)this.guidePointsLarge[f]=new b.Atom("",this.guidePointsLarge[0].x+this.D[0]*f/d,this.guidePointsLarge[0].y+this.D[1]*f/d,this.guidePointsLarge[0].z+this.D[2]*f/d)};e.getGuidePointSet=function(a){if(0===a)return this.helix||this.sheet?this.guidePointsLarge:this.guidePointsSmall;if(1===a)return this.guidePointsSmall;if(2===a)return this.guidePointsLarge};e.computeLineSegments=function(a,d,e,f,b){this.setVerticalResolution(b);this.split=e.helix!==this.helix||e.sheet!==this.sheet;this.lineSegments=this.innerCompute(0,a,d,e,!1,b);f&&(this.lineSegmentsCartoon=this.innerCompute(this.helix||this.sheet?2:1,a,d,e,!0,b))};e.innerCompute=function(a,d,e,f,g,p){var q=[],A=this.getGuidePointSet(a);d=d.getGuidePointSet(a);e=e.getGuidePointSet(a);for(var r=f.getGuidePointSet(a),v=0,u=A.length;v<u;v++){for(var t=o.multiply([d[v].x,d[v].y,d[v].z,1,e[v].x,e[v].y,e[v].z,1,A[v].x,A[v].y,A[v].z,1,r[v].x,r[v].y,r[v].z,1],h,[]),w=[],x=0;x<p;x++){for(a=3;0<a;a--)for(f=0;4>f;f++)t[4*a+f]+=t[4*(a-1)+f];w[x]=new b.Atom("",t[12]/t[15],t[13]/t[15],t[14]/t[15])}q[v]=w}if(g&&this.arrow)for(a=0;a<p;a++){g=1.5-1.3*a/p;A=j.floor(this.horizontalResolution/2);d=q[A];f=0;for(e=q.length;f<e;f++)f!==A&&(r=d[a],v=q[f][a],u=[v.x-r.x,v.y-r.y,v.z-r.z],l.scale(u,g),v.x=r.x+u[0],v.y=r.y+u[1],v.z=r.z+u[2])}return q};e.setVerticalResolution=function(a){if(a!==g){var d=a*a,e=a*a*a;h=o.multiply([-1/6,.5,-.5,1/6,.5,-1,.5,0,-.5,0,.5,0,1/6,2/3,1/6,0],[6/e,0,0,0,6/e,2/d,0,0,1/e,1/d,1/a,0,0,0,0,1],[]);g=a}}})(ChemDoodle.structures,Math,ChemDoodle.lib.mat4,ChemDoodle.lib.vec3);(function(b,j,o,l,h){j.Spectrum=function(){this.data=[];this.metadata=[];this.dataDisplay=[];this.memory={offsetTop:0,offsetLeft:0,offsetBottom:0,flipXAxis:!1,scale:1,width:0,height:0}};l=j.Spectrum.prototype;l.title=void 0;l.xUnit=void 0;l.yUnit=void 0;l.continuous=!0;l.integrationSensitivity=.01;l.draw=function(g,e,a,d){this.specs&&(e=this.specs);var j=5,f=0,l=0;g.fillStyle=e.text_color;g.textAlign="center";g.textBaseline="alphabetic";g.font=b.getFontString(e.text_font_size,e.text_font_families);this.xUnit&&(l+=e.text_font_size,g.fillText(this.xUnit,a/2,d-2));this.yUnit&&e.plots_showYAxis&&(f+=e.text_font_size,g.save(),g.translate(e.text_font_size,d/2),g.rotate(-h.PI/2),g.fillText(this.yUnit,0,0),g.restore());this.title&&(j+=e.text_font_size,g.fillText(this.title,a/2,e.text_font_size));g.lineCap="square";l+=5+e.text_font_size;e.plots_showYAxis&&(f+=5+g.measureText("1000").width);e.plots_showGrid&&(g.strokeStyle=e.plots_gridColor,g.lineWidth=e.plots_gridLineWidth,g.strokeRect(f,j,a-f,d-l-j));g.textAlign="center";g.textBaseline="top";for(var p=this.maxX-this.minX,q=p/100,o=.001;o<q||25<p/o;)o*=10;for(var r=0,v=e.plots_flipXAxis?a:0,p=h.round(this.minX/o)*o;p<=this.maxX;p+=o/2){var u=this.getTransformedX(p,e,a,f);if(u>f)if(g.strokeStyle="black",g.lineWidth=1,0===r%2){g.beginPath();g.moveTo(u,d-l);g.lineTo(u,d-l+2);g.stroke();for(q=p.toFixed(5);"0"===q.charAt(q.length-1);)q=q.substring(0,q.length-1);"."===q.charAt(q.length-1)&&(q=q.substring(0,q.length-1));var t=g.measureText(q).width;e.plots_flipXAxis&&(t*=-1);var w=u-t/2;if(e.plots_flipXAxis?w<v:w>v)g.fillText(q,u,d-l+2),v=u+t/2;e.plots_showGrid&&(g.strokeStyle=e.plots_gridColor,g.lineWidth=e.plots_gridLineWidth,g.beginPath(),g.moveTo(u,d-l),g.lineTo(u,j),g.stroke())}else g.beginPath(),g.moveTo(u,d-l),g.lineTo(u,d-l+2),g.stroke();r++}if(e.plots_showYAxis||e.plots_showGrid){o=1/e.scale;g.textAlign="right";g.textBaseline="middle";for(p=0;10>=p;p++)if(q=o/10*p,r=j+(d-l-j)*(1-q*e.scale),e.plots_showGrid&&(g.strokeStyle=e.plots_gridColor,g.lineWidth=e.plots_gridLineWidth,g.beginPath(),g.moveTo(f,r),g.lineTo(a,r),g.stroke()),e.plots_showYAxis){g.strokeStyle="black";g.lineWidth=1;g.beginPath();g.moveTo(f,r);g.lineTo(f-3,r);g.stroke();q*=100;v=h.max(0,3-h.floor(q).toString().length);q=q.toFixed(v);if(0<v)for(;"0"===q.charAt(q.length-1);)q=q.substring(0,q.length-1);"."===q.charAt(q.length-1)&&(q=q.substring(0,q.length-1));g.fillText(q,f-3,r)}}g.strokeStyle="black";g.lineWidth=1;g.beginPath();g.moveTo(a,d-l);g.lineTo(f,d-l);e.plots_showYAxis&&g.lineTo(f,j);g.stroke();if(0<this.dataDisplay.length){g.textAlign="left";g.textBaseline="top";p=q=0;for(o=this.dataDisplay.length;p<o;p++)if(this.dataDisplay[p].value)g.fillText([this.dataDisplay[p].display,": ",this.dataDisplay[p].value].join(""),f+10,j+10+q*(e.text_font_size+5)),q++;else if(this.dataDisplay[p].tag){r=0;for(v=this.metadata.length;r<v;r++)if(b.stringStartsWith(this.metadata[r],this.dataDisplay[p].tag)){v=this.metadata[r];this.dataDisplay[p].display&&(v=this.metadata[r].indexOf("="),v=[this.dataDisplay[p].display,": ",-1<v?this.metadata[r].substring(v+2):this.metadata[r]].join(""));g.fillText(v,f+10,j+10+q*(e.text_font_size+5));q++;break}}}this.drawPlot(g,e,a,d,j,f,l);this.memory.offsetTop=j;this.memory.offsetLeft=f;this.memory.offsetBottom=l;this.memory.flipXAxis=e.plots_flipXAxis;this.memory.scale=e.scale;this.memory.width=a;this.memory.height=d};l.drawPlot=function(b,e,a,d,n,f,l){this.specs&&(e=this.specs);b.strokeStyle=e.plots_color;b.lineWidth=e.plots_width;var p=[];b.save();b.rect(f,n,a-f,d-l-n);b.clip();b.beginPath();if(this.continuous)for(var q=!1,o=0,r=!1,v=0,u=this.data.length;v<u;v++){var t=this.getTransformedX(this.data[v].x,e,a,f),w;v<u&&(!q&&this.data[v+1])&&(w=this.getTransformedX(this.data[v+1].x,e,a,f));if(t>=f&&t<a||void 0!==w&&w>=f&&w<a){var x=this.getTransformedY(this.data[v].y,e,d,l,n);e.plots_showIntegration&&h.abs(this.data[v].y)>this.integrationSensitivity&&p.push(new j.Point(this.data[v].x,this.data[v].y));q||(b.moveTo(t,x),q=!0);b.lineTo(t,x);o++;0===o%1e3&&(b.stroke(),b.beginPath(),b.moveTo(t,x));if(r)break}else q&&(r=!0)}else{v=0;for(u=this.data.length;v<u;v++)t=this.getTransformedX(this.data[v].x,e,a,f),t>=f&&t<a&&(b.moveTo(t,d-l),b.lineTo(t,this.getTransformedY(this.data[v].y,e,d,l,n)))}b.stroke();if(e.plots_showIntegration&&1<p.length){b.strokeStyle=e.plots_integrationColor;b.lineWidth=e.plots_integrationLineWidth;b.beginPath();v=p[1].x>p[0].x;if(this.flipXAxis&&!v||!this.flipXAxis&&v){for(v=p.length-2;0<=v;v--)p[v].y+=p[v+1].y;q=p[0].y}else{v=1;for(u=p.length;v<u;v++)p[v].y+=p[v-1].y;q=p[p.length-1].y}v=0;for(u=p.length;v<u;v++)t=this.getTransformedX(p[v].x,e,a,f),x=this.getTransformedY(p[v].y/e.scale/q,e,d,l,n),0===v?b.moveTo(t,x):b.lineTo(t,x);b.stroke()}b.restore()};l.getTransformedY=function(b,e,a,d,h){return h+(a-d-h)*(1-b*e.scale)};l.getInverseTransformedY=function(b){return 100*((1-(b-this.memory.offsetTop)/(this.memory.height-this.memory.offsetBottom-this.memory.offsetTop))/this.memory.scale)};l.getTransformedX=function(b,e,a,d){b=d+(b-this.minX)/(this.maxX-this.minX)*(a-d);e.plots_flipXAxis&&(b=a+d-b);return b};l.getInverseTransformedX=function(b){this.memory.flipXAxis&&(b=this.memory.width+this.memory.offsetLeft-b);return(b-this.memory.offsetLeft)*(this.maxX-this.minX)/(this.memory.width-this.memory.offsetLeft)+this.minX};l.setup=function(){for(var b=Number.MAX_VALUE,e=Number.MIN_VALUE,a=Number.MIN_VALUE,d=0,j=this.data.length;d<j;d++)b=h.min(b,this.data[d].x),e=h.max(e,this.data[d].x),a=h.max(a,this.data[d].y);this.continuous?(this.minX=b,this.maxX=e):(this.minX=b-1,this.maxX=e+1);d=0;for(j=this.data.length;d<j;d++)this.data[d].y/=a};l.zoom=function(b,e,a,d){b=this.getInverseTransformedX(b);e=this.getInverseTransformedX(e);this.minX=h.min(b,e);this.maxX=h.max(b,e);if(d){d=Number.MIN_VALUE;e=0;for(b=this.data.length;e<b;e++)o.isBetween(this.data[e].x,this.minX,this.maxX)&&(d=h.max(d,this.data[e].y));return 1/d}};l.translate=function(b,e){var a=b/(e-this.memory.offsetLeft)*(this.maxX-this.minX)*(this.memory.flipXAxis?1:-1);this.minX+=a;this.maxX+=a};l.alertMetadata=function(){alert(this.metadata.join("\n"))};l.getInternalCoordinates=function(b,e){return new ChemDoodle.structures.Point(this.getInverseTransformedX(b),this.getInverseTransformedY(e))};l.getClosestPlotInternalCoordinates=function(b){var e=this.getInverseTransformedX(b-1);b=this.getInverseTransformedX(b+1);if(e>b){var a=e,e=b;b=a}for(var a=-1,d=-Infinity,h=!1,f=0,j=this.data.length;f<j;f++){var p=this.data[f];if(o.isBetween(p.x,e,b))p.y>d&&(h=!0,d=p.y,a=f);else if(h)break}if(-1!==a)return p=this.data[a],new ChemDoodle.structures.Point(p.x,100*p.y)};l.getClosestPeakInternalCoordinates=function(b){var e=this.getInverseTransformedX(b);b=0;for(var a=Infinity,d=0,j=this.data.length;d<j;d++){var f=h.abs(this.data[d].x-e);if(f<=a)a=f,b=d;else break}for(var a=e=b,f=this.data[b].y,l=this.data[b].y,d=b+1,j=this.data.length;d<j;d++)if(this.data[d].y+.05>l)l=this.data[d].y,a=d;else break;for(d=b-1;0<=d;d--)if(this.data[d].y+.05>f)f=this.data[d].y,e=d;else break;b=this.data[e-b>a-b?a:e];return new ChemDoodle.structures.Point(b.x,100*b.y)}})(ChemDoodle.extensions,ChemDoodle.structures,ChemDoodle.math,ChemDoodle.lib.jQuery,Math);(function(b,j,o){j._Shape=function(){};j=j._Shape.prototype;j.drawDecorations=function(b,h){if(this.isHover)for(var g=this.getPoints(),e=0,a=g.length;e<a;e++){var d=g[e];this.drawAnchor(b,h,d,d===this.hoverPoint)}};j.getBounds=function(){for(var j=new b.Bounds,h=this.getPoints(),g=0,e=h.length;g<e;g++){var a=h[g];j.expand(a.x,a.y)}return j};j.drawAnchor=function(b,h,g,e){b.save();b.translate(g.x,g.y);b.rotate(o.PI/4);b.scale(1/h.scale,1/h.scale);b.beginPath();b.moveTo(-4,-4);b.lineTo(4,-4);b.lineTo(4,4);b.lineTo(-4,4);b.closePath();b.fillStyle=e?"#885110":"white";b.fill();b.beginPath();b.moveTo(-4,-2);b.lineTo(-4,-4);b.lineTo(-2,-4);b.moveTo(2,-4);b.lineTo(4,-4);b.lineTo(4,-2);b.moveTo(4,2);b.lineTo(4,4);b.lineTo(2,4);b.moveTo(-2,4);b.lineTo(-4,4);b.lineTo(-4,2);b.moveTo(-4,-2);b.strokeStyle="rgba(0,0,0,.2)";b.lineWidth=5;b.stroke();b.strokeStyle="blue";b.lineWidth=1;b.stroke();b.restore()}})(ChemDoodle.math,ChemDoodle.structures.d2,Math);(function(b,j,o,l,h){l.Bracket=function(b,e){this.p1=b?b:new o.Point;this.p2=e?e:new o.Point};l=l.Bracket.prototype=new l._Shape;l.charge=0;l.mult=0;l.repeat=0;l.draw=function(g,e){var a=h.min(this.p1.x,this.p2.x),d=h.max(this.p1.x,this.p2.x),j=h.min(this.p1.y,this.p2.y),f=h.max(this.p1.y,this.p2.y),l=f-j,p=l/10;g.beginPath();g.moveTo(a+p,j);g.lineTo(a,j);g.lineTo(a,f);g.lineTo(a+p,f);g.moveTo(d-p,f);g.lineTo(d,f);g.lineTo(d,j);g.lineTo(d-p,j);this.isLassoed&&(p=g.createLinearGradient(this.p1.x,this.p1.y,this.p2.x,this.p2.y),p.addColorStop(0,"rgba(212, 99, 0, 0)"),p.addColorStop(.5,"rgba(212, 99, 0, 0.8)"),p.addColorStop(1,"rgba(212, 99, 0, 0)"),g.lineWidth=e.shapes_lineWidth+5,g.strokeStyle=p,g.lineJoin="miter",g.lineCap="square",g.stroke());g.strokeStyle=e.shapes_color;g.lineWidth=e.shapes_lineWidth;g.lineJoin="miter";g.lineCap="butt";g.stroke();0!==this.charge&&(g.fillStyle=e.text_color,g.textAlign="left",g.textBaseline="alphabetic",g.font=b.getFontString(e.text_font_size,e.text_font_families),p=this.charge.toFixed(0),p="1"===p?"+":"-1"===p?"–":b.stringStartsWith(p,"-")?p.substring(1)+"–":p+"+",g.fillText(p,d+5,j+5));0!==this.mult&&(g.fillStyle=e.text_color,g.textAlign="right",g.textBaseline="middle",g.font=b.getFontString(e.text_font_size,e.text_font_families),g.fillText(this.mult.toFixed(0),a-5,j+l/2));0!==this.repeat&&(g.fillStyle=e.text_color,g.textAlign="left",g.textBaseline="top",g.font=b.getFontString(e.text_font_size,e.text_font_families),p=this.repeat.toFixed(0),g.fillText(p,d+5,f-5))};l.getPoints=function(){return[this.p1,this.p2]};l.isOver=function(b){return j.isBetween(b.x,this.p1.x,this.p2.x)&&j.isBetween(b.y,this.p1.y,this.p2.y)}})(ChemDoodle.extensions,ChemDoodle.math,ChemDoodle.structures,ChemDoodle.structures.d2,Math);(function(b,j,o,l){o.Line=function(b,e){this.p1=b?b:new j.Point;this.p2=e?e:new j.Point};o.Line.ARROW_SYNTHETIC="synthetic";o.Line.ARROW_RETROSYNTHETIC="retrosynthetic";o.Line.ARROW_RESONANCE="resonance";o.Line.ARROW_EQUILIBRIUM="equilibrium";var h=o.Line.prototype=new o._Shape;h.arrowType=void 0;h.topText=void 0;h.bottomText=void 0;h.draw=function(b,e){if(this.isLassoed){var a=b.createLinearGradient(this.p1.x,this.p1.y,this.p2.x,this.p2.y);a.addColorStop(0,"rgba(212, 99, 0, 0)");a.addColorStop(.5,"rgba(212, 99, 0, 0.8)");a.addColorStop(1,"rgba(212, 99, 0, 0)");var d=2.5,h=this.p1.angle(this.p2)+l.PI/2,f=l.cos(h),h=l.sin(h),j=this.p1.x-f*d,p=this.p1.y+h*d,q=this.p1.x+f*d,A=this.p1.y-h*d,r=this.p2.x+f*d,v=this.p2.y-h*d,u=this.p2.x-f*d,t=this.p2.y+h*d;b.fillStyle=a;b.beginPath();b.moveTo(j,p);b.lineTo(q,A);b.lineTo(r,v);b.lineTo(u,t);b.closePath();b.fill()}b.strokeStyle=e.shapes_color;b.fillStyle=e.shapes_color;b.lineWidth=e.shapes_lineWidth;b.lineJoin="miter";b.lineCap="butt";if(this.p1.x!==this.p2.x||this.p1.y!==this.p2.y){if(this.arrowType===o.Line.ARROW_RETROSYNTHETIC){var a=2*l.sqrt(2),d=e.shapes_arrowLength_2D/a,f=this.p1.angle(this.p2),h=f+l.PI/2,a=e.shapes_arrowLength_2D/a,w=l.cos(f),x=l.sin(f),f=l.cos(h),h=l.sin(h),j=this.p1.x-f*d,p=this.p1.y+h*d,q=this.p1.x+f*d,A=this.p1.y-h*d,r=this.p2.x+f*d-w*a,v=this.p2.y-h*d+x*a,u=this.p2.x-f*d-w*a,t=this.p2.y+h*d+x*a,B=this.p2.x+2*f*d-2*w*a,c=this.p2.y-2*h*d+2*x*a,k=this.p2.x-2*f*d-2*w*a,d=this.p2.y+2*h*d+2*x*a;b.beginPath();b.moveTo(q,A);b.lineTo(r,v);b.moveTo(B,c);b.lineTo(this.p2.x,this.p2.y);b.lineTo(k,d);b.moveTo(u,t);b.lineTo(j,p)}else this.arrowType===o.Line.ARROW_EQUILIBRIUM?(a=2*l.sqrt(2),d=e.shapes_arrowLength_2D/a/2,f=this.p1.angle(this.p2),h=f+l.PI/2,a=2*e.shapes_arrowLength_2D/l.sqrt(3),w=l.cos(f),x=l.sin(f),f=l.cos(h),h=l.sin(h),j=this.p1.x-f*d,p=this.p1.y+h*d,q=this.p1.x+f*d,A=this.p1.y-h*d,r=this.p2.x+f*d,v=this.p2.y-h*d,u=this.p2.x-f*d,t=this.p2.y+h*d,b.beginPath(),b.moveTo(q,A),b.lineTo(r,v),b.moveTo(u,t),b.lineTo(j,p),b.stroke(),q=r-.8*w*a,A=v+.8*x*a,B=r+f*e.shapes_arrowLength_2D/3-w*a,c=v-h*e.shapes_arrowLength_2D/3+x*a,b.beginPath(),b.moveTo(r,v),b.lineTo(B,c),b.lineTo(q,A),b.closePath(),b.fill(),b.stroke(),q=j+.8*w*a,A=p-.8*x*a,B=j-f*e.shapes_arrowLength_2D/3+w*a,c=p+h*e.shapes_arrowLength_2D/3-x*a,b.beginPath(),b.moveTo(j,p),b.lineTo(B,c),b.lineTo(q,A),b.closePath(),b.fill()):this.arrowType===o.Line.ARROW_SYNTHETIC?(f=this.p1.angle(this.p2),h=f+l.PI/2,a=2*e.shapes_arrowLength_2D/l.sqrt(3),w=l.cos(f),x=l.sin(f),f=l.cos(h),h=l.sin(h),b.beginPath(),b.moveTo(this.p1.x,this.p1.y),b.lineTo(this.p2.x-w*a/2,this.p2.y+x*a/2),b.stroke(),q=this.p2.x-.8*w*a,A=this.p2.y+.8*x*a,B=this.p2.x+f*e.shapes_arrowLength_2D/3-w*a,c=this.p2.y-h*e.shapes_arrowLength_2D/3+x*a,k=this.p2.x-f*e.shapes_arrowLength_2D/3-w*a,d=this.p2.y+h*e.shapes_arrowLength_2D/3+x*a,b.beginPath(),b.moveTo(this.p2.x,this.p2.y),b.lineTo(k,d),b.lineTo(q,A),b.lineTo(B,c),b.closePath(),b.fill()):this.arrowType===o.Line.ARROW_RESONANCE?(f=this.p1.angle(this.p2),h=f+l.PI/2,a=2*e.shapes_arrowLength_2D/l.sqrt(3),w=l.cos(f),x=l.sin(f),f=l.cos(h),h=l.sin(h),b.beginPath(),b.moveTo(this.p1.x+w*a/2,this.p1.y-x*a/2),b.lineTo(this.p2.x-w*a/2,this.p2.y+x*a/2),b.stroke(),q=this.p2.x-.8*w*a,A=this.p2.y+.8*x*a,B=this.p2.x+f*e.shapes_arrowLength_2D/3-w*a,c=this.p2.y-h*e.shapes_arrowLength_2D/3+x*a,k=this.p2.x-f*e.shapes_arrowLength_2D/3-w*a,d=this.p2.y+h*e.shapes_arrowLength_2D/3+x*a,b.beginPath(),b.moveTo(this.p2.x,this.p2.y),b.lineTo(k,d),b.lineTo(q,A),b.lineTo(B,c),b.closePath(),b.fill(),b.stroke(),q=this.p1.x+.8*w*a,A=this.p1.y-.8*x*a,B=this.p1.x-f*e.shapes_arrowLength_2D/3+w*a,c=this.p1.y+h*e.shapes_arrowLength_2D/3-x*a,k=this.p1.x+f*e.shapes_arrowLength_2D/3+w*a,d=this.p1.y-h*e.shapes_arrowLength_2D/3-x*a,b.beginPath(),b.moveTo(this.p1.x,this.p1.y),b.lineTo(k,d),b.lineTo(q,A),b.lineTo(B,c),b.closePath(),b.fill()):(b.beginPath(),b.moveTo(this.p1.x,this.p1.y),b.lineTo(this.p2.x,this.p2.y));b.stroke();this.topText&&(b.textAlign="center",b.textBaseline="bottom",b.fillText(this.topText,(this.p1.x+this.p2.x)/2,this.p1.y-5));this.bottomText&&(b.textAlign="center",b.textBaseline="top",b.fillText(this.bottomText,(this.p1.x+this.p2.x)/2,this.p1.y+5))}};h.getPoints=function(){return[this.p1,this.p2]};h.isOver=function(g,e){var a=b.distanceFromPointToLineInclusive(g,this.p1,this.p2);return-1!==a&&a<e}})(ChemDoodle.math,ChemDoodle.structures,ChemDoodle.structures.d2,Math);(function(b,j,o,l,h){var g=function(a){var b=[];if(a instanceof o.Atom)if(0===a.bondNumber)b.push(h.PI);else{if(a.angles){if(1===a.angles.length)b.push(a.angles[0]+h.PI);else{for(var f=1,e=a.angles.length;f<e;f++)b.push(a.angles[f-1]+(a.angles[f]-a.angles[f-1])/2);f=a.angles[a.angles.length-1];b.push(f+(a.angles[0]+2*h.PI-f)/2)}a.largestAngle>h.PI&&(b=[a.angleOfLeastInterference]);if(a.bonds){f=0;for(e=a.bonds.length;f<e;f++){var g=a.bonds[f];if(2===g.bondOrder&&(g=g.getNeighbor(a),"O"===g.label)){b=[g.angle(a)];break}}}}}else a=a.a1.angle(a.a2),b.push(a+h.PI/2),b.push(a+3*h.PI/2);f=0;for(e=b.length;f<e;f++){for(;b[f]>2*h.PI;)b[f]-=2*h.PI;for(;0>b[f];)b[f]+=2*h.PI}return b},e=function(a,b){var e=3;if(a instanceof o.Atom){if(a.isLabelVisible(b)&&(e=8),0!==a.charge||0!==a.numRadical||0!==a.numLonePair)e=13}else a instanceof o.Point?e=0:1<a.bondOrder&&(e=5);return e},a=function(a,b,f,g,j,q,l,r,v,u){var t=q.angle(j),w=l.angle(r),x=h.cos(t),t=h.sin(t),B=e(f,b);j.x-=x*B;j.y+=t*B;B=w+h.PI/2;f=2*b.shapes_arrowLength_2D/h.sqrt(3);var x=h.cos(w),t=h.sin(w),c=h.cos(B),k=h.sin(B);r.x-=5*x;r.y+=5*t;w=new o.Point(r.x,r.y);B=e(g,b)/3;w.x-=x*B;w.y+=t*B;r.x-=x*(.8*f+B);r.y+=t*(.8*f+B);g=w.x-.8*x*f;var B=w.y+.8*t*f,C=new o.Point(w.x+c*b.shapes_arrowLength_2D/3-x*f,w.y-k*b.shapes_arrowLength_2D/3+t*f);b=new o.Point(w.x-c*b.shapes_arrowLength_2D/3-x*f,w.y+k*b.shapes_arrowLength_2D/3+t*f);t=x=!0;1===v&&(C.distance(q)>b.distance(q)?t=!1:x=!1);a.beginPath();a.moveTo(w.x,w.y);t&&a.lineTo(b.x,b.y);a.lineTo(g,B);x&&a.lineTo(C.x,C.y);a.closePath();a.fill();a.stroke();a.beginPath();a.moveTo(j.x,j.y);a.bezierCurveTo(q.x,q.y,l.x,l.y,r.x,r.y);a.stroke();u.push([j,q,l,r])};l.Pusher=function(a,b,e){this.o1=a;this.o2=b;this.numElectron=e?e:1};l=l.Pusher.prototype=new l._Shape;l.drawDecorations=function(a,b){if(this.isHover)for(var e=this.o1 instanceof o.Atom?new o.Point(this.o1.x,this.o1.y):this.o1.getCenter(),g=this.o2 instanceof o.Atom?new o.Point(this.o2.x,this.o2.y):this.o2.getCenter(),e=[e,g],g=0,h=e.length;g<h;g++){var j=e[g];this.drawAnchor(a,b,j,j===this.hoverPoint)}};l.draw=function(d,e){if(this.o1&&this.o2){d.strokeStyle=e.shapes_color;d.fillStyle=e.shapes_color;d.lineWidth=e.shapes_lineWidth;d.lineJoin="miter";d.lineCap="butt";for(var f=this.o1 instanceof o.Atom?new o.Point(this.o1.x,this.o1.y):this.o1.getCenter(),j=this.o2 instanceof o.Atom?new o.Point(this.o2.x,this.o2.y):this.o2.getCenter(),p=g(this.o1),q=g(this.o2),l,r,v=Infinity,u=0,t=p.length;u<t;u++)for(var w=0,x=q.length;w<x;w++){
var B=new o.Point(f.x+35*h.cos(p[u]),f.y-35*h.sin(p[u])),c=new o.Point(j.x+35*h.cos(q[w]),j.y-35*h.sin(q[w])),k=B.distance(c);k<v&&(v=k,l=B,r=c)}this.caches=[];-1===this.numElectron?(u=f.distance(j)/2,q=f.angle(j),p=q+h.PI/2,t=h.cos(q),w=h.sin(q),q=new o.Point(f.x+(u-1)*t,f.y-(u-1)*w),v=new o.Point(q.x+35*h.cos(p+h.PI/6),q.y-35*h.sin(p+h.PI/6)),u=new o.Point(f.x+(u+1)*t,f.y-(u+1)*w),p=new o.Point(u.x+35*h.cos(p-h.PI/6),u.y-35*h.sin(p-h.PI/6)),a(d,e,this.o1,q,f,l,v,q,1,this.caches),a(d,e,this.o2,u,j,r,p,u,1,this.caches)):(b.intersectLines(f.x,f.y,l.x,l.y,j.x,j.y,r.x,r.y)&&(p=l,l=r,r=p),p=l.angle(f),q=r.angle(j),v=h.max(p,q)-h.min(p,q),.001>h.abs(v-h.PI)&&this.o1.molCenter===this.o2.molCenter&&(p+=h.PI/2,q-=h.PI/2,l.x=f.x+35*h.cos(p+h.PI),l.y=f.y-35*h.sin(p+h.PI),r.x=j.x+35*h.cos(q+h.PI),r.y=j.y-35*h.sin(q+h.PI)),a(d,e,this.o1,this.o2,f,l,r,j,this.numElectron,this.caches))}};l.getPoints=function(){return[]};l.isOver=function(a,b){for(var e=0,g=this.caches.length;e<g;e++)if(j.distanceFromCurve(a,this.caches[e]).distance<b)return!0;return!1}})(ChemDoodle.math,ChemDoodle.math.jsBezier,ChemDoodle.structures,ChemDoodle.structures.d2,Math);(function(b){b._Mesh=function(){};b=b._Mesh.prototype;b.storeData=function(b,o,l){this.positionData=b;this.normalData=o;this.indexData=l};b.setupBuffers=function(b){this.vertexPositionBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.vertexPositionBuffer);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.positionData),b.STATIC_DRAW);this.vertexPositionBuffer.itemSize=3;this.vertexPositionBuffer.numItems=this.positionData.length/3;this.vertexNormalBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.vertexNormalBuffer);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.normalData),b.STATIC_DRAW);this.vertexNormalBuffer.itemSize=3;this.vertexNormalBuffer.numItems=this.normalData.length/3;this.indexData&&(this.vertexIndexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indexData),b.STATIC_DRAW),this.vertexIndexBuffer.itemSize=1,this.vertexIndexBuffer.numItems=this.indexData.length);if(this.partitions)for(var o=0,l=this.partitions.length;o<l;o++){var h=this.partitions[o],g=this.generateBuffers(b,h.positionData,h.normalData,h.indexData);h.vertexPositionBuffer=g[0];h.vertexNormalBuffer=g[1];h.vertexIndexBuffer=g[2]}};b.generateBuffers=function(b,o,l,h){var g=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,g);b.bufferData(b.ARRAY_BUFFER,new Float32Array(o),b.STATIC_DRAW);g.itemSize=3;g.numItems=o.length/3;o=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,o);b.bufferData(b.ARRAY_BUFFER,new Float32Array(l),b.STATIC_DRAW);o.itemSize=3;o.numItems=l.length/3;var e;h&&(e=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e),b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),b.STATIC_DRAW),e.itemSize=1,e.numItems=h.length);return[g,o,e]};b.bindBuffers=function(b){this.vertexPositionBuffer||this.setupBuffers(b);b.bindBuffer(b.ARRAY_BUFFER,this.vertexPositionBuffer);b.vertexAttribPointer(b.shader.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,this.vertexNormalBuffer);b.vertexAttribPointer(b.shader.vertexNormalAttribute,this.vertexNormalBuffer.itemSize,b.FLOAT,!1,0,0);this.vertexIndexBuffer&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)}})(ChemDoodle.structures.d3,Math);(function(b){b._Measurement=function(){};(b._Measurement.prototype=new b._Mesh).render=function(b,o){b.setMatrixUniforms(b.modelViewMatrix);o.measurement_update_3D&&(this.text=this.vertexPositionBuffer=void 0);this.vertexPositionBuffer||this.calculateData(o);this.bindBuffers(b);b.material.setDiffuseColor(o.shapes_color);b.lineWidth(o.shapes_lineWidth);b.drawElements(b.LINES,this.vertexIndexBuffer.numItems,b.UNSIGNED_SHORT,0);if(o.measurement_displayText_3D){this.text||(this.text=this.getText(o));var l={position:[],texCoord:[],translation:[]};b.textImage.pushVertexData(this.text.value,this.text.pos,1,l);b.textMesh.storeData(b,l.position,l.texCoord,l.translation);b.enable(b.BLEND);b.depthMask(!1);b.enableVertexAttribArray(b.shader.vertexTexCoordAttribute);b.textImage.useTexture(b);b.textMesh.render(b);b.disableVertexAttribArray(b.shader.vertexTexCoordAttribute);b.disable(b.BLEND);b.depthMask(!0)}}})(ChemDoodle.structures.d3);(function(b,j,o,l,h,g,e){o.Angle=function(a,d,b){this.a1=a;this.a2=d;this.a3=b};b=o.Angle.prototype=new o._Measurement;b.calculateData=function(a){var d=[],b=[],f=[],g=this.a2.distance3D(this.a1),p=this.a2.distance3D(this.a3);this.distUse=h.min(g,p)/2;this.vec1=e.normalize([this.a1.x-this.a2.x,this.a1.y-this.a2.y,this.a1.z-this.a2.z]);this.vec2=e.normalize([this.a3.x-this.a2.x,this.a3.y-this.a2.y,this.a3.z-this.a2.z]);this.angle=j.vec3AngleFrom(this.vec1,this.vec2);g=e.normalize(e.cross(this.vec1,this.vec2,[]));g=e.normalize(e.cross(g,this.vec1,[]));a=a.measurement_angleBands_3D;for(p=0;p<=a;++p){var l=this.angle*p/a,o=e.scale(this.vec1,h.cos(l),[]),l=e.scale(g,h.sin(l),[]),o=e.scale(e.normalize(e.add(o,l,[])),this.distUse);d.push(this.a2.x+o[0],this.a2.y+o[1],this.a2.z+o[2]);b.push(0,0,0);p<a&&f.push(p,p+1)}this.storeData(d,b,f)};b.getText=function(){var a=e.scale(e.normalize(e.add(this.vec1,this.vec2,[])),this.distUse+.3);return{pos:[this.a2.x+a[0],this.a2.y+a[1],this.a2.z+a[2]],value:[l.angleBounds(this.angle,!0).toFixed(2)," °"].join("")}}})(ChemDoodle.ELEMENT,ChemDoodle.extensions,ChemDoodle.structures.d3,ChemDoodle.math,Math,ChemDoodle.lib.mat4,ChemDoodle.lib.vec3);(function(b,j){b.Arrow=function(b,l){for(var h=[],g=[],e=0;e<=l;e++){var a=2*e*j.PI/l,d=j.sin(a),a=j.cos(a);g.push(0,0,-1,0,0,-1,a,d,0,a,d,0,0,0,-1,0,0,-1,a,d,1,a,d,1);h.push(0,0,0,b*a,b*d,0,b*a,b*d,0,b*a,b*d,2,b*a,b*d,2,2*b*a,2*b*d,2,2*b*a,2*b*d,2,0,0,3)}e=[];for(d=0;d<l;d++)for(var a=8*d,n=0;7>n;n++){var f=n+a,y=f+7+2;e.push(f,y,f+1,y,f,y-1)}this.storeData(h,g,e)};b.Arrow.prototype=new b._Mesh})(ChemDoodle.structures.d3,Math);(function(b){b.Box=function(b,o,l){b/=2;l/=2;var h=[],g=[];h.push(b,o,-l);h.push(b,o,-l);h.push(-b,o,-l);h.push(b,o,l);h.push(-b,o,l);h.push(-b,o,l);for(var e=6;e--;g.push(0,1,0));h.push(-b,o,l);h.push(-b,o,l);h.push(-b,0,l);h.push(b,o,l);h.push(b,0,l);h.push(b,0,l);for(e=6;e--;g.push(0,0,1));h.push(b,o,l);h.push(b,o,l);h.push(b,0,l);h.push(b,o,-l);h.push(b,0,-l);h.push(b,0,-l);for(e=6;e--;g.push(1,0,0));h.push(b,o,-l);h.push(b,o,-l);h.push(b,0,-l);h.push(-b,o,-l);h.push(-b,0,-l);h.push(-b,0,-l);for(e=6;e--;g.push(0,0,-1));h.push(-b,o,-l);h.push(-b,o,-l);h.push(-b,0,-l);h.push(-b,o,l);h.push(-b,0,l);h.push(-b,0,l);for(e=6;e--;g.push(-1,0,0));h.push(-b,0,l);h.push(-b,0,l);h.push(-b,0,-l);h.push(b,0,l);h.push(b,0,-l);h.push(b,0,-l);for(e=6;e--;g.push(0,-1,0));this.storeData(h,g)};b.Box.prototype=new b._Mesh})(ChemDoodle.structures.d3,Math);(function(b,j,o){b.LineArrow=function(){this.storeData([0,0,-3,.1,0,-2.8,0,0,-3,-.1,0,-2.8,0,0,-3,0,0,3,0,0,3,.1,0,2.8,0,0,3,-.1,0,2.8],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])};b.LineArrow.prototype=new b._Mesh;b.Compass=function(h,g){this.textImage=new b.TextImage;this.textImage.init(h);this.textImage.updateFont(h,g.text_font_size,g.text_font_families,g.text_font_bold,g.text_font_italic,g.text_font_stroke_3D);this.textMesh=new b.TextMesh;this.textMesh.init(h);var e=3/(g.compass_size_3D/h.canvas.clientHeight),a=j.tan(g.projectionPerspectiveVerticalFieldOfView_3D/360*j.PI),d=e/a,n=j.max(d-e,.1),f=h.canvas.clientWidth/h.canvas.clientHeight,l,p;g.projectionPerspective_3D?(p=n,l=o.frustum):(p=d,l=o.ortho);var q=2*(p/h.canvas.clientHeight)*a,a=a*p;p=-a;var A=f*p,f=f*a;if(0===g.compass_type_3D){var r=(-(h.canvas.clientWidth-g.compass_size_3D)/2+this.textImage.charHeight)*q,q=(-(h.canvas.clientHeight-g.compass_size_3D)/2+this.textImage.charHeight)*q,A=A-r,f=f-r;p-=q;a-=q}this.projectionMatrix=l(A,f,p,a,n,d+e);this.translationMatrix=o.translate(o.identity([]),[0,0,-d]);e={position:[],texCoord:[],translation:[]};this.textImage.pushVertexData("X",[3.5,0,0],0,e);this.textImage.pushVertexData("Y",[0,3.5,0],0,e);this.textImage.pushVertexData("Z",[0,0,3.5],0,e);this.textMesh.storeData(h,e.position,e.texCoord,e.translation)};var l=b.Compass.prototype;l.renderArrow=function(b,g,e,a){b.material.setDiffuseColor(e);b.setMatrixUniforms(a);1===g?b.drawArrays(b.LINES,0,b.lineArrowBuffer.vertexPositionBuffer.numItems):b.drawElements(b.TRIANGLES,b.arrowBuffer.vertexIndexBuffer.numItems,b.UNSIGNED_SHORT,0)};l.render=function(b,g){1===g.compass_type_3D?b.lineArrowBuffer.bindBuffers(b):b.arrowBuffer.bindBuffers(b);b.material.setTempColors(g.bonds_materialAmbientColor_3D,void 0,g.bonds_materialSpecularColor_3D,g.bonds_materialShininess_3D);var e=o.multiply(this.translationMatrix,b.rotationMatrix,[]),a=j.PI/2;b.fogging.setMode(0);this.renderArrow(b,g.compass_type_3D,g.compass_axisXColor_3D,o.rotateY(e,a,[]));this.renderArrow(b,g.compass_type_3D,g.compass_axisYColor_3D,o.rotateX(e,-a,[]));this.renderArrow(b,g.compass_type_3D,g.compass_axisZColor_3D,e)};l.renderAxis=function(b){var g=o.multiply(this.translationMatrix,b.rotationMatrix,[]);b.setMatrixUniforms(g);this.textImage.useTexture(b);this.textMesh.render(b)}})(ChemDoodle.structures.d3,Math,ChemDoodle.lib.mat4);(function(b,j){b.Cylinder=function(b,l,h,g){var e=[],a=[];if(g){for(g=0;g<=h;g++){var d=2*(g%h)*j.PI/h,n=j.cos(d),d=j.sin(d);a.push(0,-1,0);e.push(0,0,0);a.push(0,-1,0);e.push(b*n,0,b*d)}for(g=0;g<=h;g++)d=2*(g%h)*j.PI/h,n=j.cos(d),d=j.sin(d),a.push(n,0,d),e.push(b*n,0,b*d),a.push(n,0,d),e.push(b*n,l,b*d);for(g=0;g<=h;g++)d=2*(g%h)*j.PI/h,n=j.cos(d),d=j.sin(d),a.push(0,1,0),e.push(b*n,l,b*d),a.push(0,1,0),e.push(0,l,0)}else{for(g=0;g<h;g++)d=2*g*j.PI/h,n=j.cos(d),d=j.sin(d),a.push(n,0,d),e.push(b*n,0,b*d),a.push(n,0,d),e.push(b*n,l,b*d);a.push(1,0,0);e.push(b,0,0);a.push(1,0,0);e.push(b,l,0)}this.storeData(e,a)};b.Cylinder.prototype=new b._Mesh})(ChemDoodle.structures.d3,Math);(function(b,j,o,l){j.Distance=function(b,g,e,a){this.a1=b;this.a2=g;this.node=e;this.offset=a?a:0};j=j.Distance.prototype=new j._Measurement;j.calculateData=function(h){var g=[this.a1.x,this.a1.y,this.a1.z,this.a2.x,this.a2.y,this.a2.z];this.node&&(this.move=this.offset+o.max(h.atoms_useVDWDiameters_3D?b[this.a1.label].vdWRadius*h.atoms_vdwMultiplier_3D:h.atoms_sphereDiameter_3D/2,h.atoms_useVDWDiameters_3D?b[this.a2.label].vdWRadius*h.atoms_vdwMultiplier_3D:h.atoms_sphereDiameter_3D/2),this.displacement=[(this.a1.x+this.a2.x)/2-this.node.x,(this.a1.y+this.a2.y)/2-this.node.y,(this.a1.z+this.a2.z)/2-this.node.z],l.normalize(this.displacement),h=l.scale(this.displacement,this.move,[]),g[0]+=h[0],g[1]+=h[1],g[2]+=h[2],g[3]+=h[0],g[4]+=h[1],g[5]+=h[2]);this.storeData(g,[0,0,0,0,0,0],[0,1])};j.getText=function(){var b=this.a1.distance3D(this.a2),g=[(this.a1.x+this.a2.x)/2,(this.a1.y+this.a2.y)/2,(this.a1.z+this.a2.z)/2];if(this.node){var e=l.scale(this.displacement,this.move+.1,[]);g[0]+=e[0];g[1]+=e[1];g[2]+=e[2]}return{pos:g,value:[b.toFixed(2)," Å"].join("")}}})(ChemDoodle.ELEMENT,ChemDoodle.structures.d3,Math,ChemDoodle.lib.vec3);(function(b,j){j.Fog=function(b){this.gl=b;this.mUL=b.getUniformLocation(b.program,"u_fog_mode");this.cUL=b.getUniformLocation(b.program,"u_fog_color");this.sUL=b.getUniformLocation(b.program,"u_fog_start");this.eUL=b.getUniformLocation(b.program,"u_fog_end");this.dUL=b.getUniformLocation(b.program,"u_fog_density")};var o=j.Fog.prototype;o.setTempParameter=function(j,h,g,e){if(!this.cCache||this.cCache!==j)this.cCache=j,j=b.getRGB(j,1),this.gl.uniform3f(this.cUL,j[0],j[1],j[2]);if(!this.sCache||this.sCache!==h)this.sCache=h,this.gl.uniform1f(this.sUL,h);if(!this.eCache||this.eCache!==g)this.eCache=g,this.gl.uniform1f(this.eUL,g);if(!this.dCache||this.dCache!==e)this.dCache=e,this.gl.uniform1f(this.dUL,e)};o.setMode=function(b){if(!this.mCache||this.mCache!==b)this.mCache=b,this.gl.uniform1i(this.mUL,b)}})(ChemDoodle.math,ChemDoodle.structures.d3,ChemDoodle.lib.vec3);(function(b,j){j.Label=function(){this.textImage=new j.TextImage};var o=j.Label.prototype;o.init=function(b,h){this.textImage.init(b);this.textImage.updateFont(b,h.atoms_font_size_2D,h.atoms_font_families_2D,h.atoms_font_bold_2D,h.atoms_font_italic_2D,h.text_font_stroke_3D)};o.updateVerticesBuffer=function(j,h,g){for(var e=0,a=h.length;e<a;e++){for(var d=h[e],n=d.labelMesh,f=d.atoms,y=this.textImage,p={position:[],texCoord:[],translation:[]},q=0<f.length&&void 0!=f[0].hetatm,o=0,r=f.length;o<r;o++){var v=f[o],u=v.label,t=.05;g.atoms_useVDWDiameters_3D?(u=b[u].vdWRadius*g.atoms_vdwMultiplier_3D,0===u&&(u=1),t+=u):g.atoms_sphereDiameter_3D&&(t+=1.5*(g.atoms_sphereDiameter_3D/2));if(q)if(v.hetatm){if(v.isWater&&!g.macro_showWaters)continue}else if(!g.macro_displayAtoms)continue;y.pushVertexData(v.altLabel?v.altLabel:v.label,[v.x,v.y,v.z],t,p)}if((d=d.chains)&&(g.proteins_displayRibbon||g.proteins_displayBackbone)){o=0;for(r=d.length;o<r;o++){f=d[o];q=0;for(t=f.length;q<t;q++)u=f[q],u.name&&(v=u.cp1,y.pushVertexData(u.name,[v.x,v.y,v.z],2,p))}}n.storeData(j,p.position,p.texCoord,p.translation,p.zDepth)}};o.render=function(b,h,g){b.setMatrixUniforms(b.modelViewMatrix);this.textImage.useTexture(b);h=0;for(var e=g.length;h<e;h++)g[h].labelMesh&&g[h].labelMesh.render(b)}})(ChemDoodle.ELEMENT,ChemDoodle.structures.d3);(function(b,j){b.Sphere=function(b,l,h){for(var g=[],e=[],a=0;a<=l;a++)for(var d=a*j.PI/l,n=j.sin(d),f=j.cos(d),d=0;d<=h;d++){var y=2*d*j.PI/h,p=j.sin(y),y=j.cos(y)*n,q=f,p=p*n;e.push(y,q,p);g.push(b*y,b*q,b*p)}b=[];h+=1;for(a=0;a<l;a++)for(d=0;d<h;d++)n=a*h+d%h,f=n+h,b.push(n,n+1,f),d<h-1&&b.push(f,n+1,f+1);this.storeData(g,e,b)};b.Sphere.prototype=new b._Mesh})(ChemDoodle.structures.d3,Math);(function(b,j,o,l){function h(b,a,d,g){this.entire=b;this.name=a;this.indexes=d;this.pi=g}var g=h.prototype;g.getColor=function(e){return e.macro_colorByChain?this.entire.chainColor:this.name?this.getResidueColor(b[this.name]?this.name:"*",e):this.helix?this.entire.front?e.proteins_ribbonCartoonHelixPrimaryColor:e.proteins_ribbonCartoonHelixSecondaryColor:this.sheet?e.proteins_ribbonCartoonSheetColor:this.entire.front?e.proteins_primaryColor:e.proteins_secondaryColor};g.getResidueColor=function(e,a){var d=b[e];if("shapely"===a.proteins_residueColor)return d.shapelyColor;if("amino"===a.proteins_residueColor)return d.aminoColor;if("polarity"===a.proteins_residueColor){if(d.polar)return"#C10000"}else if("acidity"===a.proteins_residueColor){if(1===d.acidity)return"#0000FF";if(-1===d.acidity)return"#FF0000";if(!d.polar)return"#773300"}return"#FFFFFF"};g.render=function(b,a,d){if(this.entire.partitions&&this.pi!==this.entire.partitions.lastRender){var g=this.entire.partitions[this.pi];b.bindBuffer(b.ARRAY_BUFFER,g.vertexPositionBuffer);b.vertexAttribPointer(b.shader.vertexPositionAttribute,g.vertexPositionBuffer.itemSize,b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,g.vertexNormalBuffer);b.vertexAttribPointer(b.shader.vertexNormalAttribute,g.vertexNormalBuffer.itemSize,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,g.vertexIndexBuffer);this.entire.partitions.lastRender=this.pi}this.vertexIndexBuffer||(this.vertexIndexBuffer=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indexes),b.STATIC_DRAW),this.vertexIndexBuffer.itemSize=1,this.vertexIndexBuffer.numItems=this.indexes.length);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer);!d&&"rainbow"!==a.proteins_residueColor&&b.material.setDiffuseColor(this.getColor(a));b.drawElements(b.TRIANGLES,this.vertexIndexBuffer.numItems,b.UNSIGNED_SHORT,0)};j.Ribbon=function(b,a,d){var g=b[0].lineSegments.length,f=b[0].lineSegments[0].length;this.partitions=[];this.partitions.lastRender=0;var j;this.front=0<a;for(var p=0,q=b.length;p<q;p++){if(!j||65e3<j.positionData.length)0<this.partitions.length&&p--,j={count:0,positionData:[],normalData:[]},this.partitions.push(j);var A=b[p];j.count++;for(var r=0;r<g;r++)for(var v=d?A.lineSegmentsCartoon[r]:A.lineSegments[r],u=0===r,t=!1,w=0;w<f;w++){var x=v[w],B=p,c=w+1;p===b.length-1&&w===f-1?c--:w===f-1&&(B++,c=0);var c=d?b[B].lineSegmentsCartoon[r][c]:b[B].lineSegments[r][c],B=!1,k=r+1;r===g-1&&(k-=2,B=!0);var k=d?A.lineSegmentsCartoon[k][w]:A.lineSegments[k][w],c=[c.x-x.x,c.y-x.y,c.z-x.z],k=[k.x-x.x,k.y-x.y,k.z-x.z],C=l.cross(c,k,[]);0===w&&(l.normalize(c),l.scale(c,-1),j.normalData.push(c[0],c[1],c[2]),j.positionData.push(x.x,x.y,x.z));u||t?(l.normalize(k),l.scale(k,-1),j.normalData.push(k[0],k[1],k[2]),j.positionData.push(x.x,x.y,x.z),u&&w===f-1&&(u=!1,w=-1)):(l.normalize(C),(B&&!this.front||!B&&this.front)&&l.scale(C,-1),j.normalData.push(C[0],C[1],C[2]),l.scale(C,o.abs(a)),j.positionData.push(x.x+C[0],x.y+C[1],x.z+C[2]),r===g-1&&w===f-1&&(t=!0,w=-1));if(-1===w||w===f-1)l.normalize(c),j.normalData.push(c[0],c[1],c[2]),j.positionData.push(x.x,x.y,x.z)}}g+=2;f+=2;this.segments=[];this.partitionSegments=[];a=0;for(A=this.partitions.length;a<A;a++){j=this.partitions[a];v=[];p=0;for(q=j.count-1;p<q;p++){for(var D=p,r=0;r<a;r++)D+=this.partitions[r].count-1;D=b[D];u=p*g*f;j=[];r=0;for(t=g-1;r<t;r++){x=u+r*f;for(w=0;w<f;w++)B=1,p===q?B=0:w===f-1&&(B=g*f-w),B=[x+w,x+f+w,x+f+w+B,x+w,x+w+B,x+f+w+B],w!==f-1&&(this.front?j.push(B[0],B[1],B[2],B[3],B[5],B[4]):j.push(B[0],B[2],B[1],B[3],B[4],B[5])),w===f-2&&p<q&&(c=g*f-w,B[2]+=c,B[4]+=c,B[5]+=c),this.front?v.push(B[0],B[1],B[2],B[3],B[5],B[4]):v.push(B[0],B[2],B[1],B[3],B[4],B[5])}d&&D.split&&(r=new h(this,void 0,v,a),r.helix=D.helix,r.sheet=D.sheet,this.partitionSegments.push(r),v=[]);this.segments.push(new h(this,D.name,j,a))}r=new h(this,void 0,v,a);r.helix=D.helix;r.sheet=D.sheet;this.partitionSegments.push(r)}this.storeData(this.partitions[0].positionData,this.partitions[0].normalData);1===this.partitions.length&&(this.partitions=void 0)};(j.Ribbon.prototype=new j._Mesh).render=function(b,a){this.bindBuffers(b);var d=a.macro_colorByChain?this.chainColor:void 0;d||(d=this.front?a.proteins_primaryColor:a.proteins_secondaryColor);b.material.setDiffuseColor(d);for(var d=0,g=this.partitionSegments.length;d<g;d++)this.partitionSegments[d].render(b,a,!a.proteins_ribbonCartoonize)}})(ChemDoodle.RESIDUE,ChemDoodle.structures.d3,Math,ChemDoodle.lib.vec3);(function(b,j,o){j.Light=function(j,h,g){this.diffuseRGB=b.getRGB(j,1);this.specularRGB=b.getRGB(h,1);this.direction=g};j.Light.prototype.lightScene=function(b){b.uniform3f(b.getUniformLocation(b.program,"u_light_diffuse_color"),this.diffuseRGB[0],this.diffuseRGB[1],this.diffuseRGB[2]);b.uniform3f(b.getUniformLocation(b.program,"u_light_specular_color"),this.specularRGB[0],this.specularRGB[1],this.specularRGB[2]);var h=o.create(this.direction);o.normalize(h);o.negate(h);b.uniform3f(b.getUniformLocation(b.program,"u_light_direction"),h[0],h[1],h[2]);var g=[0,0,0],h=[g[0]+h[0],g[1]+h[1],g[2]+h[2]],g=o.length(h);0===g?h=[0,0,1]:o.scale(h,1/g);b.uniform3f(b.getUniformLocation(b.program,"u_light_half_vector"),h[0],h[1],h[2])}})(ChemDoodle.math,ChemDoodle.structures.d3,ChemDoodle.lib.vec3);(function(b){b.Line=function(){this.storeData([0,0,0,0,1,0],[0,0,0,0,0,0])};b.Line.prototype=new b._Mesh})(ChemDoodle.structures.d3);(function(b,j){j.Material=function(b){this.gl=b;this.aUL=b.getUniformLocation(b.program,"u_material_ambient_color");this.dUL=b.getUniformLocation(b.program,"u_material_diffuse_color");this.sUL=b.getUniformLocation(b.program,"u_material_specular_color");this.snUL=b.getUniformLocation(b.program,"u_material_shininess");this.alUL=b.getUniformLocation(b.program,"u_material_alpha")};var o=j.Material.prototype;o.setTempColors=function(j,h,g,e){if(!this.aCache||this.aCache!==j)this.aCache=j,j=b.getRGB(j,1),this.gl.uniform3f(this.aUL,j[0],j[1],j[2]);if(h&&(!this.dCache||this.dCache!==h))this.dCache=h,j=b.getRGB(h,1),this.gl.uniform3f(this.dUL,j[0],j[1],j[2]);if(!this.sCache||this.sCache!==g)this.sCache=g,j=b.getRGB(g,1),this.gl.uniform3f(this.sUL,j[0],j[1],j[2]);if(!this.snCache||this.snCache!==e)this.snCache=e,this.gl.uniform1f(this.snUL,e);this.alCache=1;this.gl.uniform1f(this.alUL,1)};o.setDiffuseColor=function(j){if(!this.dCache||this.dCache!==j)this.dCache=j,j=b.getRGB(j,1),this.gl.uniform3f(this.dUL,j[0],j[1],j[2])};o.setAlpha=function(b){if(!this.alCache||this.alCache!==b)this.alCache=b,this.gl.uniform1f(this.alUL,b)}})(ChemDoodle.math,ChemDoodle.structures.d3);(function(b,j,o,l){j.MolecularSurface=function(h,g,e,a,d){function j(a,c,d,b){var e=a.index;if(a.contained)for(var e=-1,f=Infinity,g=0,h=c.length;g<h;g++)for(var p=c[g],n=0,k=p.length;n<k;n++){var q=p[n];if(!q.contained&&q.index!==d&&q.index!==b){var l=q.distance3D(a);l<f&&(e=q.index,f=l)}}return e}for(var f=[],y=[],p=[],q=[],A=0;A<=g;A++)for(var r=A*l.PI/g,v=l.sin(r),u=l.cos(r),r=0;r<=e;r++){var t=2*r*l.PI/e;q.push(l.cos(t)*v,u,l.sin(t)*v)}v=[];A=0;for(r=h.atoms.length;A<r;A++){for(var u=[],w=h.atoms[A],x=o[w.label][d]+a,B=[],t=0,c=h.atoms.length;t<c;t++)if(t!==A){var k=h.atoms[t];k.index=t;w.distance3D(k)<x+o[k.label][d]+a&&B.push(k)}t=0;for(c=q.length;t<c;t+=3){for(var C=new b.Atom("C",w.x+x*q[t],w.y+x*q[t+1],w.z+x*q[t+2]),D=0,G=B.length;D<G;D++)if(k=B[D],C.distance3D(k)<o[k.label][d]+a){C.contained=!0;break}u.push(C)}v.push(u)}h=[];e++;for(A=0;A<g;A++)for(r=0;r<e;r++)d=A*e+r%e,a=d+e,h.push(d),h.push(a),h.push(d+1),r<e-1&&(h.push(a),h.push(a+1),h.push(d+1));A=D=0;for(r=v.length;A<r;A++){u=v[A];t=0;for(c=u.length;t<c;t++)C=u[t],C.contained||(C.index=D,D++,f.push(C.x,C.y,C.z),y.push(q[3*t],q[3*t+1],q[3*t+2]));t=0;for(c=h.length;t<c;t+=3)d=u[h[t]],a=u[h[t+1]],C=u[h[t+2]],!d.contained&&(!a.contained&&!C.contained)&&p.push(d.index,a.index,C.index)}q=[];A=0;for(r=v.length;A<r;A++){u=v[A];t=0;for(c=h.length;t<c;t+=3){d=u[h[t]];a=u[h[t+1]];C=u[h[t+2]];B=[];D=0;for(G=v.length;D<G;D++)D!==A&&B.push(v[D]);if((!d.contained||!a.contained||!C.contained)&&(d.contained||a.contained||C.contained))if(g=j(d,B,-1,-1),e=j(a,B,g,-1),B=j(C,B,g,e),-1!==g&&-1!==e&&-1!==B){a=!1;D=0;for(G=q.length;D<G;D+=3)if(d=q[D],C=q[D+1],w=q[D+2],x=e===d||e===C||e===w,k=B===d||B===C||B===w,(g===d||g===C||g===w)&&x&&k){a=!0;break}a||q.push(g,e,B)}}}p=p.concat(q);this.storeData(f,y,p)};j.MolecularSurface.prototype=new j._Mesh})(ChemDoodle.structures,ChemDoodle.structures.d3,ChemDoodle.ELEMENT,Math);(function(b){b.Picker=function(){};b=b.Picker.prototype;b.init=function(b){this.framebuffer=b.createFramebuffer();var o=b.createTexture(),l=b.createRenderbuffer();b.bindTexture(b.TEXTURE_2D,o);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindRenderbuffer(b.RENDERBUFFER,l);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,o,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,l);b.bindTexture(b.TEXTURE_2D,null);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindFramebuffer(b.FRAMEBUFFER,null)};b.setDimension=function(b,o,l){b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);var h=b.getFramebufferAttachmentParameter(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME);b.isRenderbuffer(h)&&(b.bindRenderbuffer(b.RENDERBUFFER,h),b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,o,l),b.bindRenderbuffer(b.RENDERBUFFER,null));h=b.getFramebufferAttachmentParameter(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME);b.isTexture(h)&&(b.bindTexture(b.TEXTURE_2D,h),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,o,l,0,b.RGBA,b.UNSIGNED_BYTE,null),b.bindTexture(b.TEXTURE_2D,null));b.bindFramebuffer(b.FRAMEBUFFER,null)};b.pick=function(b,o,l,h,g,e,a){var d=void 0,n=b.getParameter(b.COLOR_CLEAR_VALUE);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.clearColor(1,1,1,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.fogging.setMode(0);b.disableVertexAttribArray(b.shader.vertexNormalAttribute);var f=[];b.material.setAlpha(255);for(var y=0,p=o.length;y<p;y++)o[y].renderPickFrame(b,l,f,e,a);b.flush();o=new Uint8Array(4);b.readPixels(h-2,g+2,1,1,b.RGBA,b.UNSIGNED_BYTE,o);0<o[3]&&(d=f[o[2]|o[1]<<8|o[0]<<16]);b.enableVertexAttribArray(b.shader.vertexNormalAttribute);b.fogging.setMode(l.fog_mode_3D);b.bindFramebuffer(b.FRAMEBUFFER,null);b.clearColor(n[0],n[1],n[2],n[3]);return d}})(ChemDoodle.structures.d3,ChemDoodle.math,document);(function(b,j){b.Pill=function(b,l,h,g){var e=1,a=2*b;l-=a;0>l?(e=0,l+=a):l<a&&(e=l/a,l=a);for(var a=[],d=[],n=0;n<=h;n++)for(var f=n*j.PI/h,y=j.sin(f),p=j.cos(f)*e,f=0;f<=g;f++){var q=2*f*j.PI/g,A=j.sin(q),q=j.cos(q)*y,r=p,A=A*y;d.push(q,r,A);a.push(b*q,b*r+(n<h/2?l:0),b*A)}b=[];g+=1;for(n=0;n<h;n++)for(f=0;f<g;f++)l=n*g+f%g,e=l+g,b.push(l,l+1,e),f<g-1&&b.push(e,l+1,e+1);this.storeData(a,d,b)};b.Pill.prototype=new b._Mesh})(ChemDoodle.structures.d3,Math);(function(b,j,o,l,h,g,e){function a(a,d,b){var e=new o.Residue(-1);e.cp1=e.cp2=new o.Atom("",a,d,b);return e}function d(a,d){this.a1=a;this.a2=d}function n(a,d,b){this.a1=a;this.a2=d;this.vx=b}j=d.prototype;j.render=function(a,d){var j=this.a1,n=this.a2,l=1.001*j.distance3D(n),r=d.proteins_cylinderHelixDiameter/2,l=[r,l,r],r=g.translate(a.modelViewMatrix,[j.x,j.y,j.z],[]),o=[0,1,0],u=0;j.x===n.x&&j.z===n.z?(o=[0,0,1],n.y<j.y&&(u=h.PI)):(j=[n.x-j.x,n.y-j.y,n.z-j.z],u=b.vec3AngleFrom(o,j),o=e.cross(o,j,[]));0!==u&&g.rotate(r,u,o);g.scale(r,l);a.setMatrixUniforms(r);a.drawArrays(a.TRIANGLE_STRIP,0,a.cylinderClosedBuffer.vertexPositionBuffer.numItems)};j=n.prototype;j.render=function(a,d){this.specs&&(d=this.specs);var b=1.001*this.a1.distance3D(this.a2),h=[this.a2.x-this.a1.x,this.a2.y-this.a1.y,this.a2.z-this.a1.z],j=e.cross(h,this.vx,[]),n=e.cross(j,h,[]);e.normalize(n);e.normalize(h);e.normalize(j);b=[d.proteins_plankSheetWidth,b,d.proteins_tubeThickness];h=g.multiply(a.modelViewMatrix,[n[0],n[1],n[2],0,h[0],h[1],h[2],0,j[0],j[1],j[2],0,this.a1.x,this.a1.y,this.a1.z,1],[]);g.scale(h,b);a.setMatrixUniforms(h);a.drawArrays(a.TRIANGLE_STRIP,0,a.boxBuffer.vertexPositionBuffer.numItems)};l.PipePlank=function(b,g){this.tubes=[];this.helixCylinders=[];this.sheetPlanks=[];this.chainColor=b.chainColor;var j=[],q=[],A=[],r=[];if(1<b.length){var v=b[0],u=b[1];u.helix?A.push(v):u.sheet?r.push(v):q.push(v)}v=1;for(u=b.length-1;v<=u;v++){var t=b[v];if(t.helix){if(A.push(t),t.arrow){var w=e.create(),x=e.create();if(2==A.length)w=[A[0].cp1.x,A[0].cp1.y,A[0].cp1.z],x=[A[1].cp1.x,A[1].cp1.y,A[1].cp1.z];else{3==A.length&&A.unshift(b[h.max(v-3,0)]);for(var B=[],c=[],k=1,C=A.length-1;k<C;k++){var D=[A[k].cp1.x,A[k].cp1.y,A[k].cp1.z],G=[A[k-1].cp1.x,A[k-1].cp1.y,A[k-1].cp1.z],E=[A[k+1].cp1.x,A[k+1].cp1.y,A[k+1].cp1.z];e.subtract(G,D);e.subtract(E,D);var H=e.scale(G,e.length(E),[]),G=e.scale(E,e.length(G),[]),H=e.normalize(e.add(H,G,[]));B.push(D);c.push(H)}A=[];k=0;for(C=B.length-1;k<C;k++){var G=B[k],E=c[k],D=B[k+1],H=c[k+1],I=e.normalize(e.cross(E,H,[])),M=e.subtract(D,G,[]),J=e.dot(M,I),I=e.scale(I,J,[]),I=e.length(I),M=e.length(M),M=-(I*I-M*M)/(2*e.dot(e.subtract(G,D,[]),H)),G=e.add(G,e.scale(E,M,[]),[]),D=e.add(D,e.scale(H,M,[]),[]);A.push([G,D])}k=A[0][0];C=A[0][1];C=e.subtract(k,C,[]);e.add(k,C,w);k=A[A.length-1][1];C=A[A.length-1][0];C=e.subtract(k,C,[]);e.add(k,C,x)}k=new o.Atom("",w[0],w[1],w[2]);C=new o.Atom("",x[0],x[1],x[2]);this.helixCylinders.push(new d(k,C));A=[];C=e.subtract(w,x,[]);e.normalize(C);e.scale(C,.5);0<q.length&&(k=e.add(w,C,[]),B=q[q.length-1].cp1,B=e.subtract([B.x,B.y,B.z],k,[]),e.normalize(B),e.scale(B,.5),e.add(k,B),B=new o.Residue(-1),B.cp1=B.cp2=new o.Atom("",k[0],k[1],k[2]),q.push(B),B=a(w[0],w[1],w[2]),q.push(B),j.push(q));q=[];v<u&&(B=a(x[0],x[1],x[2]),q.push(B),w=b[v+1],w.sheet?(q.push(t),q.push(t),j.push(q),q=[],r.push(t)):(e.scale(C,-1),k=e.add(x,C,[]),t=w.cp1,t=e.subtract([t.x,t.y,t.z],k,[]),e.normalize(t),e.scale(t,.5),e.add(k,t),B=a(k[0],k[1],k[2]),q.push(B)))}}else if(t.sheet){if(r.push(t),t.arrow){x=[0,0,0];w=[0,0,0];k=0;for(C=r.length;k<C;k++)c=r[k].guidePointsLarge,B=c[0],c=c[c.length-1],e.add(x,[B.x,B.y,B.z]),e.add(w,[c.x,c.y,c.z]);e.scale(x,1/C);e.scale(w,1/C);w=e.subtract(x,w);x=r[r.length-1].guidePointsSmall[0];this.sheetPlanks.push(new n(r[0].guidePointsSmall[0],x,w));r=[];v<u&&(w=b[v+1],w.sheet?r.push(t):(B=a(x.x,x.y,x.z),q.push(B)))}}else q.push(t),v<u&&(w=b[v+1],w.sheet&&(c=t.guidePointsSmall[0],B=a(c.x,c.y,c.z),q.push(B),j.push(q),q=[],r.push(t)))}1<q.length&&(2==q.length&&q.push(q[q.length-1]),j.push(q));q=[];r=0;for(t=j.length;r<t;r++){x=j[r];w=[];v=0;for(u=x.length-1;v<=u;v++)w.push(x[v].cp1);q.push(w)}v=0;for(u=q.length;v<u;v++)j=new l.CatmullTube(q[v],g.proteins_tubeThickness,g.proteins_tubeResolution_3D,g.proteins_horizontalResolution),j.chainColor=b.chainColor,this.tubes.push(j)};j=l.PipePlank.prototype=new l._Mesh;j.render=function(a,d){a.material.setTempColors(d.proteins_materialAmbientColor_3D,void 0,d.proteins_materialSpecularColor_3D,d.proteins_materialShininess_3D);a.material.setDiffuseColor(d.macro_colorByChain?this.chainColor:d.proteins_tubeColor);for(var b=0,e=this.tubes.length;b<e;b++)a.setMatrixUniforms(a.modelViewMatrix),this.tubes[b].render(a,d);d.macro_colorByChain||a.material.setDiffuseColor(d.proteins_ribbonCartoonHelixSecondaryColor);a.cylinderClosedBuffer.bindBuffers(a);b=0;for(e=this.helixCylinders.length;b<e;b++)this.helixCylinders[b].render(a,d);d.macro_colorByChain||a.material.setDiffuseColor(d.proteins_ribbonCartoonSheetColor);a.boxBuffer.bindBuffers(a);b=0;for(e=this.sheetPlanks.length;b<e;b++)this.sheetPlanks[b].render(a,d)}})(ChemDoodle.extensions,ChemDoodle.RESIDUE,ChemDoodle.structures,ChemDoodle.structures.d3,Math,ChemDoodle.lib.mat4,ChemDoodle.lib.vec3,ChemDoodle.math);(function(b,j){b.Shader=function(){};var o=b.Shader.prototype;o.init=function(b){var h=this.getShader(b,"vertex-shader");h||(h=this.loadDefaultVertexShader(b));var g=this.getShader(b,"fragment-shader");g||(g=this.loadDefaultFragmentShader(b));b.attachShader(b.program,h);b.attachShader(b.program,g);this.vertexPositionAttribute=0;b.bindAttribLocation(b.program,this.vertexPositionAttribute,"a_vertex_position");b.linkProgram(b.program);b.getProgramParameter(b.program,b.LINK_STATUS)||alert("Could not initialize shaders: "+b.getProgramInfoLog(b.program));b.useProgram(b.program);b.enableVertexAttribArray(this.vertexPositionAttribute);this.vertexTexCoordAttribute=b.getAttribLocation(b.program,"a_vertex_texcoord");this.vertexNormalAttribute=b.getAttribLocation(b.program,"a_vertex_normal");b.enableVertexAttribArray(this.vertexNormalAttribute);this.dimensionUniform=b.getUniformLocation(b.program,"u_dimension")};o.getShader=function(b,h){var g=j.getElementById(h);if(g){for(var e=[],a=g.firstChild;a;)3===a.nodeType&&e.push(a.textContent),a=a.nextSibling;if("x-shader/x-fragment"===g.type)a=b.createShader(b.FRAGMENT_SHADER);else if("x-shader/x-vertex"===g.type)a=b.createShader(b.VERTEX_SHADER);else return;b.shaderSource(a,e.join(""));b.compileShader(a);if(b.getShaderParameter(a,b.COMPILE_STATUS))return a;alert(g.type+" "+b.getShaderInfoLog(a))}};o.loadDefaultVertexShader=function(b){var h=b.createShader(b.VERTEX_SHADER)
;b.shaderSource(h,"precision mediump float;attribute vec3 a_vertex_position;attribute vec3 a_vertex_normal;attribute vec2 a_vertex_texcoord;uniform vec3 u_light_diffuse_color;uniform vec3 u_material_ambient_color;uniform vec3 u_material_diffuse_color;uniform mat4 u_model_view_matrix;uniform mat4 u_projection_matrix;uniform mat3 u_normal_matrix;uniform vec2 u_dimension;varying vec2 v_texcoord;varying vec3 v_diffuse;varying vec4 v_ambient;varying vec3 v_normal;void main() {v_texcoord = a_vertex_texcoord;if(length(a_vertex_texcoord) != 0.) {gl_Position = u_model_view_matrix * vec4(a_vertex_position, 1.);vec4 depth_pos = vec4(gl_Position);depth_pos.z += a_vertex_normal.z;gl_Position = u_projection_matrix * gl_Position;depth_pos = u_projection_matrix * depth_pos;gl_Position /= gl_Position.w;gl_Position.xy += a_vertex_normal.xy / u_dimension * 2.;gl_Position.z = depth_pos.z / depth_pos.w;} else {v_normal = length(a_vertex_normal)==0. ? a_vertex_normal : normalize(u_normal_matrix * a_vertex_normal);v_ambient = vec4(u_material_ambient_color, 1.);v_diffuse = u_material_diffuse_color * u_light_diffuse_color;gl_Position = u_projection_matrix * u_model_view_matrix * vec4(a_vertex_position, 1.);gl_Position /= gl_Position.w;}}");b.compileShader(h);if(b.getShaderParameter(h,b.COMPILE_STATUS))return h;alert("Vertex shader failed to compile: "+b.getShaderInfoLog(h))};o.loadDefaultFragmentShader=function(b){var h=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(h,"precision mediump float;\nuniform vec3 u_light_specular_color;uniform vec3 u_light_direction;uniform vec3 u_light_half_vector;uniform vec3 u_material_specular_color;uniform float u_material_shininess;uniform float u_material_alpha;uniform int u_fog_mode;uniform vec3 u_fog_color;uniform float u_fog_density;uniform float u_fog_start;uniform float u_fog_end;uniform sampler2D u_image;varying vec2 v_texcoord;varying vec3 v_diffuse;varying vec4 v_ambient;varying vec3 v_normal;void main(void){if(length(v_texcoord)!=0.) {gl_FragColor = texture2D(u_image, v_texcoord);return;}if(length(v_normal)==0.){gl_FragColor = vec4(v_diffuse, u_material_alpha);}else{float nDotL = max(dot(v_normal, u_light_direction), 0.);vec4 color = vec4(v_diffuse*nDotL, 1.);float nDotHV = max(dot(v_normal, u_light_half_vector), 0.);vec3 specular = u_material_specular_color * u_light_specular_color;color+=vec4(specular * pow(nDotHV, u_material_shininess), 1.);gl_FragColor = color+v_ambient;gl_FragColor.a*=u_material_alpha;}float fogCoord = 1.-clamp((u_fog_end - gl_FragCoord.z/gl_FragCoord.w) / (u_fog_end - u_fog_start), 0., 1.);float fogFactor = 1.;if(u_fog_mode == 1){fogFactor = 1.-fogCoord;}else if(u_fog_mode == 2) {fogFactor = clamp(exp(-u_fog_density*fogCoord), 0., 1.);}else if(u_fog_mode == 3) {fogFactor = clamp(exp(-pow(u_fog_density*fogCoord, 2.)), 0., 1.);}gl_FragColor = mix(vec4(u_fog_color, 1.), gl_FragColor, fogFactor);}");b.compileShader(h);if(b.getShaderParameter(h,b.COMPILE_STATUS))return h;alert("Fragment shader failed to compile: "+b.getShaderInfoLog(h))}})(ChemDoodle.structures.d3,document);(function(b,j,o){j.Shape=function(j,h){for(var g=j.length,e=[],a=[],d=new b.Point,n=0,f=g;n<f;n++){var y=n+1;n===f-1&&(y=0);for(var p=j[n],y=j[y],q=o.cross([0,0,1],[y.x-p.x,y.y-p.y,0]),A=0;2>A;A++)e.push(p.x,p.y,h/2),e.push(p.x,p.y,-h/2),e.push(y.x,y.y,h/2),e.push(y.x,y.y,-h/2);for(A=0;4>A;A++)a.push(q[0],q[1],q[2]);a.push(0,0,1);a.push(0,0,-1);a.push(0,0,1);a.push(0,0,-1);d.add(p)}d.x/=g;d.y/=g;a.push(0,0,1);e.push(d.x,d.y,h/2);a.push(0,0,-1);e.push(d.x,d.y,-h/2);d=[];p=8*g;n=0;for(f=g;n<f;n++)g=8*n,d.push(g),d.push(g+3),d.push(g+1),d.push(g),d.push(g+2),d.push(g+3),d.push(g+4),d.push(p),d.push(g+6),d.push(g+5),d.push(g+7),d.push(p+1);this.storeData(e,a,d)};j.Shape.prototype=new j._Mesh})(ChemDoodle.structures,ChemDoodle.structures.d3,ChemDoodle.lib.vec3);(function(b,j,o){b.Star=function(){for(var b=[.8944,.4472,0,.2764,.4472,.8506,.2764,.4472,-.8506,-.7236,.4472,.5257,-.7236,.4472,-.5257,-.3416,.4472,0,-.1056,.4472,.3249,-.1056,.4472,-.3249,.2764,.4472,.2008,.2764,.4472,-.2008,-.8944,-.4472,0,-.2764,-.4472,.8506,-.2764,-.4472,-.8506,.7236,-.4472,.5257,.7236,-.4472,-.5257,.3416,-.4472,0,.1056,-.4472,.3249,.1056,-.4472,-.3249,-.2764,-.4472,.2008,-.2764,-.4472,-.2008,-.5527,.1058,0,-.1708,.1058,.5527,-.1708,.1058,-.5527,.4471,.1058,.3249,.4471,.1058,-.3249,.5527,-.1058,0,.1708,-.1058,.5527,.1708,-.1058,-.5527,-.4471,-.1058,.3249,-.4471,-.1058,-.3249,0,1,0,0,-1,0],h=[0,9,8,2,7,9,4,5,7,3,6,5,1,8,6,0,8,23,30,6,8,3,21,6,11,26,21,13,23,26,2,9,24,30,8,9,1,23,8,13,25,23,14,24,25,4,7,22,30,9,7,0,24,9,14,27,24,12,22,27,3,5,20,30,7,5,2,22,7,12,29,22,10,20,29,1,6,21,30,5,6,4,20,5,10,28,20,11,21,28,10,19,18,12,17,19,14,15,17,13,16,15,11,18,16,31,19,17,14,17,27,2,27,22,4,22,29,10,29,19,31,18,19,12,19,29,4,29,20,3,20,28,11,28,18,31,16,18,10,18,28,3,28,21,1,21,26,13,26,16,31,15,16,11,16,26,1,26,23,0,23,25,14,25,15,31,17,15,13,15,25,0,25,24,2,24,27,12,27,17],g=[],e=[],a=[],d=0,j=h.length;d<j;d+=3){var f=3*h[d],y=3*h[d+1],p=3*h[d+2],f=[b[f],b[f+1],b[f+2]],y=[b[y],b[y+1],b[y+2]],p=[b[p],b[p+1],b[p+2]],q=o.cross([p[0]-y[0],p[1]-y[1],p[2]-y[2]],[f[0]-y[0],f[1]-y[1],f[2]-y[2]],[]);o.normalize(q);g.push(f[0],f[1],f[2],y[0],y[1],y[2],p[0],p[1],p[2]);e.push(q[0],q[1],q[2],q[0],q[1],q[2],q[0],q[1],q[2]);a.push(d,d+1,d+2)}this.storeData(g,e,a)};b.Star.prototype=new b._Mesh})(ChemDoodle.structures.d3,Math,ChemDoodle.lib.vec3);(function(b,j,o,l){var h=1;l.devicePixelRatio&&(h=l.devicePixelRatio);b.TextImage=function(){this.ctx=o.createElement("canvas").getContext("2d");this.data=[];this.text="";this.charHeight=0};b=b.TextImage.prototype;b.init=function(b){this.textureImage=b.createTexture();b.bindTexture(b.TEXTURE_2D,this.textureImage);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.bindTexture(b.TEXTURE_2D,null);this.updateFont(b,12,["Sans-serif"],!1,!1,!1)};b.charData=function(b){b=this.text.indexOf(b);return 0<=b?this.data[b]:null};b.updateFont=function(b,e,a,d,n,f){var l=this.ctx,p=this.ctx.canvas,q=[],o="";e*=h;n=j.getFontString(e,a,d,n);l.font=n;l.save();var r=0;e*=1.5;a=32;for(d=127;a<d;a++){var v=String.fromCharCode(a),u=l.measureText(v).width;q.push({text:v,width:u,height:e});r+=2*u}var t=["°","Å","®"];a=0;for(d=t.length;a<d;a++)v=t[a],u=l.measureText(v).width,q.push({text:v,width:u,height:e}),r+=2*u;a=Math.sqrt(r*e);a=Math.ceil(a/e);r=Math.ceil(r/(a-1));p.width=r;p.height=a*e;l.font=n;l.textAlign="left";l.textBaseline="middle";l.strokeStyle="#000";l.lineWidth=1.4;l.fillStyle="#fff";a=v=n=0;for(d=q.length;a<d;a++){u=q[a];t=2*u.width;e=u.height;var w=u.text;v+t>r&&(n++,v=0);var x=n*e;f&&l.strokeText(w,v,x+e/2);l.fillText(w,v,x+e/2);u.x=v;u.y=x;o+=w;v+=t}this.text=o;this.data=q;this.charHeight=e;b.bindTexture(b.TEXTURE_2D,this.textureImage);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,p);b.bindTexture(b.TEXTURE_2D,null)};b.pushVertexData=function(b,e,a,d){var j=b.toString().split(""),f=this.getHeight(),l=this.getWidth();b=-this.textWidth(b)/2/h;for(var p=-this.charHeight/2/h,q=0,o=j.length;q<o;q++){var r=this.charData(j[q]),v=r.width,u=r.x/l,t=u+1.8*r.width/l,w=r.y/f,r=w+r.height/f,x=b+1.8*v/h,B=this.charHeight/2/h;d.position.push(e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2]);d.texCoord.push(u,w,t,r,t,w,u,w,u,r,t,r);d.translation.push(b,B,a,x,p,a,x,B,a,b,B,a,b,p,a,x,p,a);b=x+(v-1.8*v)/h}};b.getCanvas=function(){return this.ctx.canvas};b.getHeight=function(){return this.getCanvas().height};b.getWidth=function(){return this.getCanvas().width};b.textWidth=function(b){return this.ctx.measureText(b).width};b.test=function(){o.body.appendChild(this.getCanvas())};b.useTexture=function(b){b.bindTexture(b.TEXTURE_2D,this.textureImage)}})(ChemDoodle.structures.d3,ChemDoodle.extensions,document,window);(function(b){b.TextMesh=function(){};b=b.TextMesh.prototype;b.init=function(b){this.vertexPositionBuffer=b.createBuffer();this.vertexTexCoordBuffer=b.createBuffer();this.vertexTranslationBuffer=b.createBuffer()};b.setVertexData=function(b,o,l,h){b.bindBuffer(b.ARRAY_BUFFER,o);b.bufferData(b.ARRAY_BUFFER,new Float32Array(l),b.STATIC_DRAW);o.itemSize=h;o.numItems=l.length/h};b.storeData=function(b,o,l,h){this.setVertexData(b,this.vertexPositionBuffer,o,3);this.setVertexData(b,this.vertexTexCoordBuffer,l,2);this.setVertexData(b,this.vertexTranslationBuffer,h,3)};b.bindBuffers=function(b){b.bindBuffer(b.ARRAY_BUFFER,this.vertexPositionBuffer);b.vertexAttribPointer(b.shader.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,this.vertexTexCoordBuffer);b.vertexAttribPointer(b.shader.vertexTexCoordAttribute,this.vertexTexCoordBuffer.itemSize,b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,this.vertexTranslationBuffer);b.vertexAttribPointer(b.shader.vertexNormalAttribute,this.vertexTranslationBuffer.itemSize,b.FLOAT,!1,0,0)};b.render=function(b){var o=this.vertexPositionBuffer.numItems;o&&(this.bindBuffers(b),b.drawArrays(b.TRIANGLES,0,o))}})(ChemDoodle.structures.d3,Math);(function(b,j,o,l,h,g,e){l.Torsion=function(a,d,b,e){this.a1=a;this.a2=d;this.a3=b;this.a4=e};b=l.Torsion.prototype=new l._Measurement;b.calculateData=function(a){var d=[],b=[],f=[],g=this.a2.distance3D(this.a1),j=this.a2.distance3D(this.a3);this.distUse=h.min(g,j)/2;var j=[this.a2.x-this.a1.x,this.a2.y-this.a1.y,this.a2.z-this.a1.z],g=[this.a3.x-this.a2.x,this.a3.y-this.a2.y,this.a3.z-this.a2.z],q=[this.a4.x-this.a3.x,this.a4.y-this.a3.y,this.a4.z-this.a3.z],l=e.cross(j,g,[]),q=e.cross(g,q,[]);e.scale(j,e.length(g));this.torsion=h.atan2(e.dot(j,q),e.dot(l,q));j=e.normalize(e.cross(l,g,[]));l=e.normalize(e.cross(g,j,[]));this.pos=e.add([this.a2.x,this.a2.y,this.a2.z],e.scale(e.normalize(g,[]),this.distUse));var q=[],o=a.measurement_angleBands_3D;for(a=0;a<=o;++a){var v=this.torsion*a/o,u=e.scale(j,h.cos(v),[]),v=e.scale(l,h.sin(v),[]),u=e.scale(e.normalize(e.add(u,v,[])),this.distUse);0==a&&(q=u);d.push(this.pos[0]+u[0],this.pos[1]+u[1],this.pos[2]+u[2]);b.push(0,0,0);a<o&&f.push(a,a+1)}this.vecText=e.normalize(e.add(q,u,[]));g=e.normalize(g,[]);e.scale(g,.0625);v=this.torsion-2*h.asin(.125)*this.torsion/h.abs(this.torsion);u=e.scale(j,h.cos(v),[]);v=e.scale(l,h.sin(v),[]);u=e.scale(e.normalize(e.add(u,v,[])),this.distUse);d.push(this.pos[0]+g[0]+u[0],this.pos[1]+g[1]+u[1],this.pos[2]+g[2]+u[2]);b.push(0,0,0);d.push(this.pos[0]-g[0]+u[0],this.pos[1]-g[1]+u[1],this.pos[2]-g[2]+u[2]);b.push(0,0,0);f.push(--a,a+1,a,a+2);this.storeData(d,b,f)};b.getText=function(){e.add(this.pos,e.scale(this.vecText,this.distUse+.3,[]));return{pos:this.pos,value:[j.angleBounds(this.torsion,!0,!0).toFixed(2)," °"].join("")}}})(ChemDoodle.ELEMENT,ChemDoodle.math,ChemDoodle.extensions,ChemDoodle.structures.d3,Math,ChemDoodle.lib.mat4,ChemDoodle.lib.vec3);(function(b,j,o,l,h,g,e,a){var d=function(a,d){a.bindBuffer(a.ARRAY_BUFFER,d.vertexPositionBuffer);a.vertexAttribPointer(a.shader.vertexPositionAttribute,d.vertexPositionBuffer.itemSize,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,d.vertexNormalBuffer);a.vertexAttribPointer(a.shader.vertexNormalAttribute,d.vertexNormalBuffer.itemSize,a.FLOAT,!1,0,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d.vertexIndexBuffer)},n=function(a,d,b){var e=h.sqrt(d[1]*d[1]+d[2]*d[2]),j=[1,0,0,0,0,d[2]/e,-d[1]/e,0,0,d[1]/e,d[2]/e,0,0,0,0,1],n=[1,0,0,0,0,d[2]/e,d[1]/e,0,0,-d[1]/e,d[2]/e,0,0,0,0,1],l=[e,0,-d[0],0,0,1,0,0,d[0],0,e,0,0,0,0,1];d=[e,0,d[0],0,0,1,0,0,-d[0],0,e,0,0,0,0,1];b=[h.cos(b),-h.sin(b),0,0,h.sin(b),h.cos(b),0,0,0,0,1,0,0,0,0,1];var o=g.multiply(j,g.multiply(l,g.multiply(b,g.multiply(d,n,[]))));this.rotate=function(){return g.multiplyVec3(o,a)}};l.Tube=function(f,l,p){var q=f[0].lineSegments[0].length;this.partitions=[];var A;this.ends=[];this.ends.push(f[0].lineSegments[0][0]);this.ends.push(f[f.length-1].lineSegments[0][0]);for(var r=[1,0,0],v=0,u=f.length;v<u;v++){if(!A||65e3<A.positionData.length)0<this.partitions.length&&v--,A={count:0,positionData:[],normalData:[],indexData:[]},this.partitions.push(A);var t=f[v];A.count++;for(var w=Infinity,x=new o.Atom("",f[v].cp1.x,f[v].cp1.y,f[v].cp1.z),B=0;B<q;B++){var c=t.lineSegments[0][B],k;k=B===q-1?v===f.length-1?t.lineSegments[0][B-1]:f[v+1].lineSegments[0][0]:t.lineSegments[0][B+1];k=[k.x-c.x,k.y-c.y,k.z-c.z];e.normalize(k);v===f.length-1&&B===q-1&&e.scale(k,-1);var C=e.cross(k,r,[]);e.normalize(C);e.scale(C,l/2);C=new n(C,k,2*Math.PI/p);k=0;for(var D=p;k<D;k++){var G=C.rotate();k===h.floor(p/4)&&(r=[G[0],G[1],G[2]]);A.normalData.push(G[0],G[1],G[2]);A.positionData.push(c.x+G[0],c.y+G[1],c.z+G[2])}x&&(k=c.distance3D(x),k<w&&(w=k,f[v].pPoint=c))}}r=0;for(t=this.partitions.length;r<t;r++){A=this.partitions[r];v=0;for(u=A.count-1;v<u;v++){w=v*q*p;B=0;for(x=q;B<x;B++){c=w+B*p;for(k=0;k<p;k++)C=c+k,A.indexData.push(C),A.indexData.push(C+p),A.indexData.push(C+p+1),A.indexData.push(C),A.indexData.push(C+p+1),A.indexData.push(C+1)}}}this.storeData(this.partitions[0].positionData,this.partitions[0].normalData,this.partitions[0].indexData);p=[new o.Point(2,0)];for(v=0;60>v;v++)q=v/60*h.PI,p.push(new o.Point(2*h.cos(q),-2*h.sin(q)));p.push(new o.Point(-2,0),new o.Point(-2,4),new o.Point(2,4));var E=new o.d3.Shape(p,1);this.render=function(c,n){this.bindBuffers(c);c.material.setDiffuseColor(n.macro_colorByChain?this.chainColor:n.nucleics_tubeColor);c.drawElements(c.TRIANGLES,this.vertexIndexBuffer.numItems,c.UNSIGNED_SHORT,0);if(this.partitions)for(var k=1,p=this.partitions.length;k<p;k++){var q=this.partitions[k];d(c,q);c.drawElements(c.TRIANGLES,q.vertexIndexBuffer.numItems,c.UNSIGNED_SHORT,0)}c.sphereBuffer.bindBuffers(c);for(k=0;2>k;k++)q=this.ends[k],q=g.translate(c.modelViewMatrix,[q.x,q.y,q.z],[]),p=l/2,g.scale(q,[p,p,p]),c.setMatrixUniforms(q),c.drawElements(c.TRIANGLES,c.sphereBuffer.vertexIndexBuffer.numItems,c.UNSIGNED_SHORT,0);c.cylinderBuffer.bindBuffers(c);k=0;for(p=f.length-1;k<p;k++){var r=f[k],v=r.pPoint,t=new o.Atom("",r.cp2.x,r.cp2.y,r.cp2.z),q=1.001*v.distance3D(t),r=[l/4,q,l/4],q=g.translate(c.modelViewMatrix,[v.x,v.y,v.z],[]),u=[0,1,0],A=0,w=[t.x-v.x,t.y-v.y,t.z-v.z];v.x===t.x&&v.z===t.z?(u=[0,0,1],v.y<v.y&&(A=h.PI)):(A=b.vec3AngleFrom(u,w),u=e.cross(u,w,[]));0!==A&&g.rotate(q,A,u);g.scale(q,r);c.setMatrixUniforms(q);c.drawArrays(c.TRIANGLE_STRIP,0,c.cylinderBuffer.vertexPositionBuffer.numItems)}E.bindBuffers(c);"none"===n.nucleics_residueColor&&!n.macro_colorByChain&&c.material.setDiffuseColor(n.nucleics_baseColor);k=0;for(p=f.length-1;k<p;k++)r=f[k],t=r.cp2,q=g.translate(c.modelViewMatrix,[t.x,t.y,t.z],[]),u=[0,1,0],A=0,v=r.cp3,w=[v.x-t.x,v.y-t.y,v.z-t.z],t.x===v.x&&t.z===v.z?(u=[0,0,1],t.y<t.y&&(A=h.PI)):(A=b.vec3AngleFrom(u,w),u=e.cross(u,w,[])),0!==A&&g.rotate(q,A,u),t=[1,0,0],A=g.rotate(g.identity([]),A,u),g.multiplyVec3(A,t),A=r.cp4,v=r.cp5,A.y===v.y&&A.z===v.z||(A=[v.x-A.x,v.y-A.y,v.z-A.z],v=b.vec3AngleFrom(t,A),0>e.dot(w,e.cross(t,A))&&(v*=-1),g.rotateY(q,v)),n.macro_colorByChain||("shapely"===n.nucleics_residueColor?j[r.name]?c.material.setDiffuseColor(j[r.name].shapelyColor):c.material.setDiffuseColor(j["*"].shapelyColor):"rainbow"===n.nucleics_residueColor&&c.material.setDiffuseColor(a.rainbowAt(k,p,n.macro_rainbowColors))),c.setMatrixUniforms(q),c.drawElements(c.TRIANGLES,E.vertexIndexBuffer.numItems,c.UNSIGNED_SHORT,0)}};l.Tube.prototype=new l._Mesh;l.CatmullTube=function(a,d,b,g){var j=[];a.push(a[a.length-1]);for(var l=0,v=a.length-2;l<=v;l++){for(var u=a[0==l?0:l-1],t=a[l+0],w=a[l+1],x=a[l==v?l+1:l+2],B=[],c=0;c<g;c++){var k=c/g;l==v&&(k=c/(g-1));k=new o.Atom("C",.5*(2*t.x+(w.x-u.x)*k+(2*u.x-5*t.x+4*w.x-x.x)*k*k+(3*t.x-u.x-3*w.x+x.x)*k*k*k),.5*(2*t.y+(w.y-u.y)*k+(2*u.y-5*t.y+4*w.y-x.y)*k*k+(3*t.y-u.y-3*w.y+x.y)*k*k*k),.5*(2*t.z+(w.z-u.z)*k+(2*u.z-5*t.z+4*w.z-x.z)*k*k+(3*t.z-u.z-3*w.z+x.z)*k*k*k));B.push(k)}j.push(B)}a=j[0].length;this.partitions=[];var C;this.ends=[];this.ends.push(j[0][0]);this.ends.push(j[j.length-1][0]);u=[1,0,0];l=0;for(v=j.length;l<v;l++){if(!C||65e3<C.positionData.length)0<this.partitions.length&&l--,C={count:0,positionData:[],normalData:[],indexData:[]},this.partitions.push(C);t=j[l];C.count++;for(c=0;c<a;c++){w=t[c];g=c===a-1?l===j.length-1?t[c-1]:j[l+1][0]:t[c+1];g=[g.x-w.x,g.y-w.y,g.z-w.z];e.normalize(g);l===j.length-1&&c===a-1&&e.scale(g,-1);x=e.cross(g,u,[]);e.normalize(x);e.scale(x,d/2);x=new n(x,g,2*Math.PI/b);g=0;for(B=b;g<B;g++)k=x.rotate(),g===h.floor(b/4)&&(u=[k[0],k[1],k[2]]),C.normalData.push(k[0],k[1],k[2]),C.positionData.push(w.x+k[0],w.y+k[1],w.z+k[2])}}d=0;for(j=this.partitions.length;d<j;d++){C=this.partitions[d];l=0;for(v=C.count-1;l<v;l++){u=l*a*b;c=0;for(t=a;c<t;c++){w=u+c*b;for(g=0;g<=b;g++)x=w+g%b,C.indexData.push(x,x+b)}}}this.storeData(this.partitions[0].positionData,this.partitions[0].normalData,this.partitions[0].indexData)};(l.CatmullTube.prototype=new l._Mesh).render=function(a,b){this.bindBuffers(a);for(var e=0,h=this.partitions.length;e<h;e++){var j=this.partitions[e];d(a,j);a.drawElements(a.TRIANGLE_STRIP,j.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0)}a.sphereBuffer.bindBuffers(a);for(e=0;2>e;e++)j=this.ends[e],h=g.translate(a.modelViewMatrix,[j.x,j.y,j.z],[]),j=b.proteins_tubeThickness/2,g.scale(h,[j,j,j]),a.setMatrixUniforms(h),a.drawElements(a.TRIANGLES,a.sphereBuffer.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0)}})(ChemDoodle.extensions,ChemDoodle.RESIDUE,ChemDoodle.structures,ChemDoodle.structures.d3,Math,ChemDoodle.lib.mat4,ChemDoodle.lib.vec3,ChemDoodle.math);(function(b){b.UnitCell=function(b){this.unitCell=b;var o=[],l=[],h=function(b,a,d,g){o.push(b[0],b[1],b[2]);o.push(a[0],a[1],a[2]);o.push(d[0],d[1],d[2]);o.push(g[0],g[1],g[2]);for(b=0;4>b;b++)l.push(0,0,0)};h(b.o,b.x,b.xy,b.y);h(b.o,b.y,b.yz,b.z);h(b.o,b.z,b.xz,b.x);h(b.yz,b.y,b.xy,b.xyz);h(b.xyz,b.xz,b.z,b.yz);h(b.xy,b.x,b.xz,b.xyz);b=[];for(h=0;6>h;h++){var g=4*h;b.push(g,g+1,g+1,g+2,g+2,g+3,g+3,g)}this.storeData(o,l,b)};(b.UnitCell.prototype=new b._Mesh).render=function(b,o){b.setMatrixUniforms(b.modelViewMatrix);this.bindBuffers(b);b.material.setDiffuseColor(o.shapes_color);b.lineWidth(o.shapes_lineWidth);b.drawElements(b.LINES,this.vertexIndexBuffer.numItems,b.UNSIGNED_SHORT,0)}})(ChemDoodle.structures.d3,ChemDoodle.lib.vec3);(function(b,j,o){b.Plate=function(b){this.lanes=Array(b);i=0;for(ii=b;i<ii;i++)this.lanes[i]=[]};var l=b.Plate.prototype;l.sort=function(){i=0;for(ii=this.lanes.length;i<ii;i++)this.lanes[i].sort(function(b,g){return b-g})};l.draw=function(b){var g=b.canvas.width,e=b.canvas.height;this.origin=9*e/10;this.front=e/10;this.laneLength=this.origin-this.front;b.strokeStyle="#000000";b.beginPath();b.moveTo(0,this.front);j.contextHashTo(b,0,this.front,g,this.front,3,3);b.closePath();b.stroke();b.beginPath();b.moveTo(0,this.origin);b.lineTo(g,this.origin);b.closePath();b.stroke();i=0;for(ii=this.lanes.length;i<ii;i++){e=(i+1)*g/(ii+1);b.beginPath();b.moveTo(e,this.origin);b.lineTo(e,this.origin+3);b.closePath();b.stroke();s=0;for(ss=this.lanes[i].length;s<ss;s++){var a=this.origin-this.laneLength*this.lanes[i][s].rf;switch(this.lanes[i][s].type){case"compact":b.beginPath();b.arc(e,a,3,0,2*o.PI,!1);b.closePath();break;case"expanded":b.beginPath();b.arc(e,a,7,0,2*o.PI,!1);b.closePath();break;case"widened":j.contextOval(b,e-18,a-10,36,10);break;case"cresent":b.beginPath(),b.arc(e,a,9,0,o.PI,!0),b.closePath()}switch(this.lanes[i][s].style){case"solid":b.fillStyle="#000000";b.fill();break;case"transparent":b.stroke()}}}};b.Plate.Spot=function(b,g,e){this.type=b;this.rf=g;this.style=e?e:"solid"}})(ChemDoodle.structures,ChemDoodle.extensions,Math);(function(b,j,o){b.default_backgroundColor="#FFFFFF";b.default_scale=1;b.default_rotateAngle=0;b.default_bondLength_2D=20;b.default_angstromsPerBondLength=1.25;b.default_lightDirection_3D=[-.1,-.1,-1];b.default_lightDiffuseColor_3D="#FFFFFF";b.default_lightSpecularColor_3D="#FFFFFF";b.default_projectionPerspective_3D=!0;b.default_projectionPerspectiveVerticalFieldOfView_3D=45;b.default_projectionOrthoWidth_3D=40;b.default_projectionWidthHeightRatio_3D=void 0;b.default_projectionFrontCulling_3D=.1;b.default_projectionBackCulling_3D=1e4;b.default_cullBackFace_3D=!0;b.default_fog_mode_3D=0;b.default_fog_color_3D="#000000";b.default_fog_start_3D=0;b.default_fog_end_3D=1;b.default_fog_density_3D=1;b.default_atoms_display=!0;b.default_atoms_color="#000000";b.default_atoms_font_size_2D=12;b.default_atoms_font_families_2D=["Helvetica","Arial","Dialog"];b.default_atoms_font_bold_2D=!1;b.default_atoms_font_italic_2D=!1;b.default_atoms_circles_2D=!1;b.default_atoms_circleDiameter_2D=10;b.default_atoms_circleBorderWidth_2D=1;b.default_atoms_lonePairDistance_2D=8;b.default_atoms_lonePairSpread_2D=4;b.default_atoms_lonePairDiameter_2D=1;b.default_atoms_useJMOLColors=!1;b.default_atoms_usePYMOLColors=!1;b.default_atoms_resolution_3D=60;b.default_atoms_sphereDiameter_3D=.8;b.default_atoms_useVDWDiameters_3D=!1;b.default_atoms_vdwMultiplier_3D=1;b.default_atoms_materialAmbientColor_3D="#000000";b.default_atoms_materialSpecularColor_3D="#555555";b.default_atoms_materialShininess_3D=32;b.default_atoms_implicitHydrogens_2D=!0;b.default_atoms_displayTerminalCarbonLabels_2D=!1;b.default_atoms_showHiddenCarbons_2D=!0;b.default_atoms_showAttributedCarbons_2D=!0;b.default_atoms_displayAllCarbonLabels_2D=!1;b.default_atoms_nonBondedAsStars_3D=!1;b.default_atoms_displayLabels_3D=!1;b.default_atoms_HBlack_2D=!0;b.default_bonds_display=!0;b.default_bonds_color="#000000";b.default_bonds_width_2D=1;b.default_bonds_saturationWidth_2D=.2;b.default_bonds_ends_2D="round";b.default_bonds_useJMOLColors=!1;b.default_bonds_usePYMOLColors=!1;b.default_bonds_colorGradient=!1;b.default_bonds_saturationAngle_2D=o.PI/3;b.default_bonds_symmetrical_2D=!1;b.default_bonds_clearOverlaps_2D=!1;b.default_bonds_overlapClearWidth_2D=.5;b.default_bonds_atomLabelBuffer_2D=1;b.default_bonds_wedgeThickness_2D=.22;b.default_bonds_hashWidth_2D=1;b.default_bonds_hashSpacing_2D=2.5;b.default_bonds_dotSize_2D=2;b.default_bonds_lewisStyle_2D=!1;b.default_bonds_showBondOrders_3D=!1;b.default_bonds_resolution_3D=60;b.default_bonds_renderAsLines_3D=!1;b.default_bonds_cylinderDiameter_3D=.3;b.default_bonds_pillLatitudeResolution_3D=10;b.default_bonds_pillLongitudeResolution_3D=20;b.default_bonds_pillHeight_3D=.3;b.default_bonds_pillSpacing_3D=.1;b.default_bonds_pillDiameter_3D=.3;b.default_bonds_materialAmbientColor_3D="#222222";b.default_bonds_materialSpecularColor_3D="#555555";b.default_bonds_materialShininess_3D=32;b.default_proteins_displayRibbon=!0;b.default_proteins_displayBackbone=!1;b.default_proteins_backboneThickness=1.5;b.default_proteins_backboneColor="#CCCCCC";b.default_proteins_ribbonCartoonize=!1;b.default_proteins_displayPipePlank=!1;b.default_proteins_residueColor="none";b.default_proteins_primaryColor="#FF0D0D";b.default_proteins_secondaryColor="#FFFF30";b.default_proteins_ribbonCartoonHelixPrimaryColor="#00E740";b.default_proteins_ribbonCartoonHelixSecondaryColor="#9905FF";b.default_proteins_ribbonCartoonSheetColor="#E8BB99";b.default_proteins_tubeColor="#FF0D0D";b.default_proteins_tubeResolution_3D=30;b.default_proteins_ribbonThickness=.2;b.default_proteins_tubeThickness=.5;b.default_proteins_plankSheetWidth=3.5;b.default_proteins_cylinderHelixDiameter=4;b.default_proteins_verticalResolution=10;b.default_proteins_horizontalResolution=9;b.default_proteins_materialAmbientColor_3D="#222222";b.default_proteins_materialSpecularColor_3D="#555555";b.default_proteins_materialShininess_3D=32;b.default_nucleics_display=!0;b.default_nucleics_tubeColor="#CCCCCC";b.default_nucleics_baseColor="#C10000";b.default_nucleics_residueColor="none";b.default_nucleics_tubeThickness=1.5;b.default_nucleics_tubeResolution_3D=60;b.default_nucleics_verticalResolution=10;b.default_nucleics_materialAmbientColor_3D="#222222";b.default_nucleics_materialSpecularColor_3D="#555555";b.default_nucleics_materialShininess_3D=32;b.default_macro_displayAtoms=!1;b.default_macro_displayBonds=!1;b.default_macro_atomToLigandDistance=-1;b.default_macro_showWater=!1;b.default_macro_colorByChain=!1;b.default_macro_rainbowColors=["#0000FF","#00FFFF","#00FF00","#FFFF00","#FF0000"];b.default_surfaces_display=!0;b.default_surfaces_style="Dot";b.default_surfaces_color="#E9B862";b.default_surfaces_materialAmbientColor_3D="#000000";b.default_surfaces_materialSpecularColor_3D="#000000";b.default_surfaces_materialShininess_3D=32;b.default_plots_color="#000000";b.default_plots_width=1;b.default_plots_showIntegration=!1;b.default_plots_integrationColor="#c10000";b.default_plots_integrationLineWidth=1;b.default_plots_showGrid=!1;b.default_plots_gridColor="gray";b.default_plots_gridLineWidth=.5;b.default_plots_showYAxis=!0;b.default_plots_flipXAxis=!1;b.default_text_font_size=12;b.default_text_font_families=["Helvetica","Arial","Dialog"];b.default_text_font_bold=!0;b.default_text_font_italic=!1;b.default_text_font_stroke_3D=!0;b.default_text_color="#000000";b.default_shapes_color="#000000";b.default_shapes_lineWidth=1;b.default_shapes_arrowLength_2D=8;b.default_compass_display=!1;b.default_compass_axisXColor_3D="#FF0000";b.default_compass_axisYColor_3D="#00FF00";b.default_compass_axisZColor_3D="#0000FF";b.default_compass_size_3D=50;b.default_compass_resolution_3D=10;b.default_compass_displayText_3D=!0;b.default_compass_type_3D=0;b.default_measurement_update_3D=!1;b.default_measurement_angleBands_3D=10;b.default_measurement_displayText_3D=!0;j.VisualSpecifications=function(){this.backgroundColor=b.default_backgroundColor;this.scale=b.default_scale;this.rotateAngle=b.default_rotateAngle;this.bondLength_2D=b.default_bondLength_2D;this.angstromsPerBondLength=b.default_angstromsPerBondLength;this.lightDirection_3D=b.default_lightDirection_3D.slice(0);this.lightDiffuseColor_3D=b.default_lightDiffuseColor_3D;this.lightSpecularColor_3D=b.default_lightSpecularColor_3D;this.projectionPerspective_3D=b.default_projectionPerspective_3D;this.projectionPerspectiveVerticalFieldOfView_3D=b.default_projectionPerspectiveVerticalFieldOfView_3D;this.projectionOrthoWidth_3D=b.default_projectionOrthoWidth_3D;this.projectionWidthHeightRatio_3D=b.default_projectionWidthHeightRatio_3D;this.projectionFrontCulling_3D=b.default_projectionFrontCulling_3D;this.projectionBackCulling_3D=b.default_projectionBackCulling_3D;this.cullBackFace_3D=b.default_cullBackFace_3D;this.fog_mode_3D=b.default_fog_mode_3D;this.fog_color_3D=b.default_fog_color_3D;this.fog_start_3D=b.default_fog_start_3D;this.fog_end_3D=b.default_fog_end_3D;this.fog_density_3D=b.default_fog_density_3D;this.atoms_display=b.default_atoms_display;this.atoms_color=b.default_atoms_color;this.atoms_font_size_2D=b.default_atoms_font_size_2D;this.atoms_font_families_2D=b.default_atoms_font_families_2D.slice(0);this.atoms_font_bold_2D=b.default_atoms_font_bold_2D;this.atoms_font_italic_2D=b.default_atoms_font_italic_2D;this.atoms_circles_2D=b.default_atoms_circles_2D;this.atoms_circleDiameter_2D=b.default_atoms_circleDiameter_2D;this.atoms_circleBorderWidth_2D=b.default_atoms_circleBorderWidth_2D;this.atoms_lonePairDistance_2D=b.default_atoms_lonePairDistance_2D;this.atoms_lonePairSpread_2D=b.default_atoms_lonePairSpread_2D;this.atoms_lonePairDiameter_2D=b.default_atoms_lonePairDiameter_2D;this.atoms_useJMOLColors=b.default_atoms_useJMOLColors;this.atoms_usePYMOLColors=b.default_atoms_usePYMOLColors;this.atoms_resolution_3D=b.default_atoms_resolution_3D;this.atoms_sphereDiameter_3D=b.default_atoms_sphereDiameter_3D;this.atoms_useVDWDiameters_3D=b.default_atoms_useVDWDiameters_3D;this.atoms_vdwMultiplier_3D=b.default_atoms_vdwMultiplier_3D;this.atoms_materialAmbientColor_3D=b.default_atoms_materialAmbientColor_3D;this.atoms_materialSpecularColor_3D=b.default_atoms_materialSpecularColor_3D;this.atoms_materialShininess_3D=b.default_atoms_materialShininess_3D;this.atoms_implicitHydrogens_2D=b.default_atoms_implicitHydrogens_2D;this.atoms_displayTerminalCarbonLabels_2D=b.default_atoms_displayTerminalCarbonLabels_2D;this.atoms_showHiddenCarbons_2D=b.default_atoms_showHiddenCarbons_2D;this.atoms_showAttributedCarbons_2D=b.default_atoms_showAttributedCarbons_2D;this.atoms_displayAllCarbonLabels_2D=b.default_atoms_displayAllCarbonLabels_2D;this.atoms_nonBondedAsStars_3D=b.default_atoms_nonBondedAsStars_3D;this.atoms_displayLabels_3D=b.default_atoms_displayLabels_3D;this.atoms_HBlack_2D=b.default_atoms_HBlack_2D;this.bonds_display=b.default_bonds_display;this.bonds_color=b.default_bonds_color;this.bonds_width_2D=b.default_bonds_width_2D;this.bonds_saturationWidth_2D=b.default_bonds_saturationWidth_2D;this.bonds_ends_2D=b.default_bonds_ends_2D;this.bonds_useJMOLColors=b.default_bonds_useJMOLColors;this.bonds_usePYMOLColors=b.default_bonds_usePYMOLColors;this.bonds_colorGradient=b.default_bonds_colorGradient;this.bonds_saturationAngle_2D=b.default_bonds_saturationAngle_2D;this.bonds_symmetrical_2D=b.default_bonds_symmetrical_2D;this.bonds_clearOverlaps_2D=b.default_bonds_clearOverlaps_2D;this.bonds_overlapClearWidth_2D=b.default_bonds_overlapClearWidth_2D;this.bonds_atomLabelBuffer_2D=b.default_bonds_atomLabelBuffer_2D;this.bonds_wedgeThickness_2D=b.default_bonds_wedgeThickness_2D;this.bonds_hashWidth_2D=b.default_bonds_hashWidth_2D;this.bonds_hashSpacing_2D=b.default_bonds_hashSpacing_2D;this.bonds_dotSize_2D=b.default_bonds_dotSize_2D;this.bonds_lewisStyle_2D=b.default_bonds_lewisStyle_2D;this.bonds_showBondOrders_3D=b.default_bonds_showBondOrders_3D;this.bonds_resolution_3D=b.default_bonds_resolution_3D;this.bonds_renderAsLines_3D=b.default_bonds_renderAsLines_3D;this.bonds_cylinderDiameter_3D=b.default_bonds_cylinderDiameter_3D;this.bonds_pillHeight_3D=b.default_bonds_pillHeight_3D;this.bonds_pillLatitudeResolution_3D=b.default_bonds_pillLatitudeResolution_3D;this.bonds_pillLongitudeResolution_3D=b.default_bonds_pillLongitudeResolution_3D;this.bonds_pillSpacing_3D=b.default_bonds_pillSpacing_3D;this.bonds_pillDiameter_3D=b.default_bonds_pillDiameter_3D;this.bonds_materialAmbientColor_3D=b.default_bonds_materialAmbientColor_3D;this.bonds_materialSpecularColor_3D=b.default_bonds_materialSpecularColor_3D;this.bonds_materialShininess_3D=b.default_bonds_materialShininess_3D;this.proteins_displayRibbon=b.default_proteins_displayRibbon;this.proteins_displayBackbone=b.default_proteins_displayBackbone;this.proteins_backboneThickness=b.default_proteins_backboneThickness;this.proteins_backboneColor=b.default_proteins_backboneColor;this.proteins_ribbonCartoonize=b.default_proteins_ribbonCartoonize;this.proteins_residueColor=b.default_proteins_residueColor;this.proteins_primaryColor=b.default_proteins_primaryColor;this.proteins_secondaryColor=b.default_proteins_secondaryColor;this.proteins_ribbonCartoonHelixPrimaryColor=b.default_proteins_ribbonCartoonHelixPrimaryColor;this.proteins_ribbonCartoonHelixSecondaryColor=b.default_proteins_ribbonCartoonHelixSecondaryColor;this.proteins_tubeColor=b.default_proteins_tubeColor;this.proteins_tubeResolution_3D=b.default_proteins_tubeResolution_3D;this.proteins_displayPipePlank=b.default_proteins_displayPipePlank;this.proteins_ribbonCartoonSheetColor=b.default_proteins_ribbonCartoonSheetColor;this.proteins_ribbonThickness=b.default_proteins_ribbonThickness;this.proteins_tubeThickness=b.default_proteins_tubeThickness;this.proteins_plankSheetWidth=b.default_proteins_plankSheetWidth;this.proteins_cylinderHelixDiameter=b.default_proteins_cylinderHelixDiameter;this.proteins_verticalResolution=b.default_proteins_verticalResolution;this.proteins_horizontalResolution=b.default_proteins_horizontalResolution;this.proteins_materialAmbientColor_3D=b.default_proteins_materialAmbientColor_3D;this.proteins_materialSpecularColor_3D=b.default_proteins_materialSpecularColor_3D;this.proteins_materialShininess_3D=b.default_proteins_materialShininess_3D;this.macro_displayAtoms=b.default_macro_displayAtoms
;this.macro_displayBonds=b.default_macro_displayBonds;this.macro_atomToLigandDistance=b.default_macro_atomToLigandDistance;this.nucleics_display=b.default_nucleics_display;this.nucleics_tubeColor=b.default_nucleics_tubeColor;this.nucleics_baseColor=b.default_nucleics_baseColor;this.nucleics_residueColor=b.default_nucleics_residueColor;this.nucleics_tubeThickness=b.default_nucleics_tubeThickness;this.nucleics_tubeResolution_3D=b.default_nucleics_tubeResolution_3D;this.nucleics_verticalResolution=b.default_nucleics_verticalResolution;this.nucleics_materialAmbientColor_3D=b.default_nucleics_materialAmbientColor_3D;this.nucleics_materialSpecularColor_3D=b.default_nucleics_materialSpecularColor_3D;this.nucleics_materialShininess_3D=b.default_nucleics_materialShininess_3D;this.macro_showWater=b.default_macro_showWater;this.macro_colorByChain=b.default_macro_colorByChain;this.macro_rainbowColors=b.default_macro_rainbowColors.slice(0);this.surfaces_display=b.default_surfaces_display;this.surfaces_style=b.default_surfaces_style;this.surfaces_color=b.default_surfaces_color;this.surfaces_materialAmbientColor_3D=b.default_surfaces_materialAmbientColor_3D;this.surfaces_materialSpecularColor_3D=b.default_surfaces_materialSpecularColor_3D;this.surfaces_materialShininess_3D=b.default_surfaces_materialShininess_3D;this.plots_color=b.default_plots_color;this.plots_width=b.default_plots_width;this.plots_showIntegration=b.default_plots_showIntegration;this.plots_integrationColor=b.default_plots_integrationColor;this.plots_integrationLineWidth=b.default_plots_integrationLineWidth;this.plots_showGrid=b.default_plots_showGrid;this.plots_gridColor=b.default_plots_gridColor;this.plots_gridLineWidth=b.default_plots_gridLineWidth;this.plots_showYAxis=b.default_plots_showYAxis;this.plots_flipXAxis=b.default_plots_flipXAxis;this.text_font_size=b.default_text_font_size;this.text_font_families=b.default_text_font_families.slice(0);this.text_font_bold=b.default_text_font_bold;this.text_font_italic=b.default_text_font_italic;this.text_font_stroke_3D=b.default_text_font_stroke_3D;this.text_color=b.default_text_color;this.shapes_color=b.default_shapes_color;this.shapes_lineWidth=b.default_shapes_lineWidth;this.shapes_arrowLength_2D=b.default_shapes_arrowLength_2D;this.compass_display=b.default_compass_display;this.compass_axisXColor_3D=b.default_compass_axisXColor_3D;this.compass_axisYColor_3D=b.default_compass_axisYColor_3D;this.compass_axisZColor_3D=b.default_compass_axisZColor_3D;this.compass_size_3D=b.default_compass_size_3D;this.compass_resolution_3D=b.default_compass_resolution_3D;this.compass_displayText_3D=b.default_compass_displayText_3D;this.compass_type_3D=b.default_compass_type_3D;this.measurement_update_3D=b.default_measurement_update_3D;this.measurement_angleBands_3D=b.default_measurement_angleBands_3D;this.measurement_displayText_3D=b.default_measurement_displayText_3D};j.VisualSpecifications.prototype.set3DRepresentation=function(j){this.bonds_display=this.atoms_display=!0;this.bonds_color="#777777";this.bonds_showBondOrders_3D=this.bonds_useJMOLColors=this.atoms_useJMOLColors=this.atoms_useVDWDiameters_3D=!0;this.bonds_renderAsLines_3D=!1;"Ball and Stick"===j?(this.atoms_vdwMultiplier_3D=.3,this.bonds_useJMOLColors=!1,this.bonds_cylinderDiameter_3D=.3,this.bonds_materialAmbientColor_3D=b.default_atoms_materialAmbientColor_3D,this.bonds_pillDiameter_3D=.15):"van der Waals Spheres"===j?(this.bonds_display=!1,this.atoms_vdwMultiplier_3D=1):"Stick"===j?(this.bonds_showBondOrders_3D=this.atoms_useVDWDiameters_3D=!1,this.bonds_cylinderDiameter_3D=this.atoms_sphereDiameter_3D=.8,this.bonds_materialAmbientColor_3D=this.atoms_materialAmbientColor_3D):"Wireframe"===j?(this.atoms_useVDWDiameters_3D=!1,this.bonds_cylinderDiameter_3D=this.bonds_pillDiameter_3D=.05,this.atoms_sphereDiameter_3D=.15,this.bonds_materialAmbientColor_3D=b.default_atoms_materialAmbientColor_3D):"Line"===j?(this.atoms_display=!1,this.bonds_renderAsLines_3D=!0,this.bonds_width_2D=1,this.bonds_cylinderDiameter_3D=.05):alert('"'+j+'" is not recognized. Use one of the following strings:\n\n1. Ball and Stick\n2. van der Waals Spheres\n3. Stick\n4. Wireframe\n5. Line\n')}})(ChemDoodle,ChemDoodle.structures,Math);(function(b,j,o,l){o.getPointsPerAngstrom=function(){return b.default_bondLength_2D/b.default_angstromsPerBondLength};o.BondDeducer=function(){};var h=o.BondDeducer.prototype;h.margin=1.1;h.deduceCovalentBonds=function(b,e){var a=o.getPointsPerAngstrom();e&&(a=e);for(var d=0,h=b.atoms.length;d<h;d++)for(var f=d+1;f<h;f++){var y=b.atoms[d],p=b.atoms[f];y.distance3D(p)<(j[y.label].covalentRadius+j[p.label].covalentRadius)*a*this.margin&&b.bonds.push(new l.Bond(y,p,1))}}})(ChemDoodle,ChemDoodle.ELEMENT,ChemDoodle.informatics,ChemDoodle.structures);(function(b,j){b.HydrogenDeducer=function(){};b.HydrogenDeducer.prototype.removeHydrogens=function(b,l){for(var h=[],g=[],e=0,a=b.bonds.length;e<a;e++){var d=b.bonds[e],n="H"!==d.a1.label&&"H"!==d.a2.label;!n&&(!l&&d.stereo!==j.Bond.STEREO_NONE)&&(n=!0);n?(d.a1.tag=!0,g.push(d)):("H"===d.a1.label&&(d.a1.remove=!0),"H"===d.a2.label&&(d.a2.remove=!0))}e=0;for(a=b.atoms.length;e<a;e++)d=b.atoms[e],d.remove?d.remove=void 0:h.push(d);b.atoms=h;b.bonds=g}})(ChemDoodle.informatics,ChemDoodle.structures);(function(b,j,o){j.MolecularSurfaceGenerator=function(){};j.MolecularSurfaceGenerator.prototype.generateSurface=function(b,h,g,e,a){return new o.MolecularSurface(b,h,g,e,a)}})(ChemDoodle,ChemDoodle.informatics,ChemDoodle.structures.d3);(function(b,j){b.Splitter=function(){};b.Splitter.prototype.split=function(b){for(var l=[],h=0,g=b.atoms.length;h<g;h++)b.atoms[h].visited=!1;h=0;for(g=b.bonds.length;h<g;h++)b.bonds[h].visited=!1;h=0;for(g=b.atoms.length;h<g;h++){var e=b.atoms[h];if(!e.visited){var a=new j.Molecule;a.atoms.push(e);e.visited=!0;var d=new j.Queue;for(d.enqueue(e);!d.isEmpty();)for(var e=d.dequeue(),n=0,f=b.bonds.length;n<f;n++){var y=b.bonds[n];y.contains(e)&&!y.visited&&(y.visited=!0,a.bonds.push(y),y=y.getNeighbor(e),y.visited||(y.visited=!0,a.atoms.push(y),d.enqueue(y)))}l.push(a)}}return l}})(ChemDoodle.informatics,ChemDoodle.structures);(function(b,j){b.StructureBuilder=function(){};b.StructureBuilder.prototype.copy=function(b){var l=new j.JSONInterpreter;return l.molFrom(l.molTo(b))}})(ChemDoodle.informatics,ChemDoodle.io,ChemDoodle.structures);(function(b){b._Counter=function(){};b=b._Counter.prototype;b.value=0;b.molecule=void 0;b.setMolecule=function(b){this.value=0;this.molecule=b;this.innerCalculate&&this.innerCalculate()}})(ChemDoodle.informatics);(function(b){b.FrerejacqueNumberCounter=function(b){this.setMolecule(b)};(b.FrerejacqueNumberCounter.prototype=new b._Counter).innerCalculate=function(){this.value=this.molecule.bonds.length-this.molecule.atoms.length+new b.NumberOfMoleculesCounter(this.molecule).value}})(ChemDoodle.informatics);(function(b,j){j.NumberOfMoleculesCounter=function(b){this.setMolecule(b)};(j.NumberOfMoleculesCounter.prototype=new j._Counter).innerCalculate=function(){for(var j=0,l=this.molecule.atoms.length;j<l;j++)this.molecule.atoms[j].visited=!1;j=0;for(l=this.molecule.atoms.length;j<l;j++)if(!this.molecule.atoms[j].visited){this.value++;var h=new b.Queue;this.molecule.atoms[j].visited=!0;for(h.enqueue(this.molecule.atoms[j]);!h.isEmpty();)for(var g=h.dequeue(),e=0,a=this.molecule.bonds.length;e<a;e++){var d=this.molecule.bonds[e];d.contains(g)&&(d=d.getNeighbor(g),d.visited||(d.visited=!0,h.enqueue(d)))}}}})(ChemDoodle.structures,ChemDoodle.informatics);(function(b){b._RingFinder=function(){};b=b._RingFinder.prototype;b.atoms=void 0;b.bonds=void 0;b.rings=void 0;b.reduce=function(b){for(var o=0,l=b.atoms.length;o<l;o++)b.atoms[o].visited=!1;o=0;for(l=b.bonds.length;o<l;o++)b.bonds[o].visited=!1;for(var h=!0;h;){h=!1;o=0;for(l=b.atoms.length;o<l;o++){for(var g=0,e,a=0,d=b.bonds.length;a<d;a++)if(b.bonds[a].contains(b.atoms[o])&&!b.bonds[a].visited){g++;if(2===g)break;e=b.bonds[a]}1===g&&(h=!0,e.visited=!0,b.atoms[o].visited=!0)}}o=0;for(l=b.atoms.length;o<l;o++)b.atoms[o].visited||this.atoms.push(b.atoms[o]);o=0;for(l=b.bonds.length;o<l;o++)b.bonds[o].visited||this.bonds.push(b.bonds[o]);0===this.bonds.length&&0!==this.atoms.length&&(this.atoms=[])};b.setMolecule=function(b){this.atoms=[];this.bonds=[];this.rings=[];this.reduce(b);2<this.atoms.length&&this.innerGetRings&&this.innerGetRings()};b.fuse=function(){for(var b=0,o=this.rings.length;b<o;b++)for(var l=0,h=this.bonds.length;l<h;l++)-1!==this.rings[b].atoms.indexOf(this.bonds[l].a1)&&-1!==this.rings[b].atoms.indexOf(this.bonds[l].a2)&&this.rings[b].bonds.push(this.bonds[l])}})(ChemDoodle.informatics);(function(b,j){function o(b,g){this.atoms=[];if(g)for(var e=0,a=g.atoms.length;e<a;e++)this.atoms[e]=g.atoms[e];this.atoms.push(b)}var l=o.prototype;l.grow=function(b,g){for(var e=this.atoms[this.atoms.length-1],a=[],d=0,j=b.length;d<j;d++)if(b[d].contains(e)){var f=b[d].getNeighbor(e);-1===g.indexOf(f)&&a.push(f)}e=[];d=0;for(j=a.length;d<j;d++)e.push(new o(a[d],this));return e};l.check=function(b,g,e){for(var a=0,d=g.atoms.length-1;a<d;a++)if(-1!==this.atoms.indexOf(g.atoms[a]))return;var n;if(g.atoms[g.atoms.length-1]===this.atoms[this.atoms.length-1]){n=new j.Ring;n.atoms[0]=e;a=0;for(d=this.atoms.length;a<d;a++)n.atoms.push(this.atoms[a]);for(a=g.atoms.length-2;0<=a;a--)n.atoms.push(g.atoms[a])}else{for(var f=[],a=0,d=b.length;a<d;a++)b[a].contains(g.atoms[g.atoms.length-1])&&f.push(b[a]);a=0;for(d=f.length;a<d;a++)if((1===g.atoms.length||!f[a].contains(g.atoms[g.atoms.length-2]))&&f[a].contains(this.atoms[this.atoms.length-1])){n=new j.Ring;n.atoms[0]=e;b=0;for(e=this.atoms.length;b<e;b++)n.atoms.push(this.atoms[b]);for(b=g.atoms.length-1;0<=b;b--)n.atoms.push(g.atoms[b]);break}}return n};b.EulerFacetRingFinder=function(b){this.setMolecule(b)};l=b.EulerFacetRingFinder.prototype=new b._RingFinder;l.fingerBreak=5;l.innerGetRings=function(){for(var b=0,g=this.atoms.length;b<g;b++){for(var e=[],a=0,d=this.bonds.length;a<d;a++)this.bonds[a].contains(this.atoms[b])&&e.push(this.bonds[a].getNeighbor(this.atoms[b]));a=0;for(d=e.length;a<d;a++)for(var j=a+1;j<e.length;j++){var f=[];f[0]=new o(e[a]);f[1]=new o(e[j]);var l=[];l[0]=this.atoms[b];for(var p=0,q=e.length;p<q;p++)p!==a&&p!==j&&l.push(e[p]);var A=[];for((p=f[0].check(this.bonds,f[1],this.atoms[b]))&&(A[0]=p);0===A.length&&0<f.length&&f[0].atoms.length<this.fingerBreak;){for(var r=[],p=0,q=f.length;p<q;p++)for(var v=f[p].grow(this.bonds,l),u=0,t=v.length;u<t;u++)r.push(v[u]);f=r;p=0;for(q=f.length;p<q;p++)for(u=p+1;u<q;u++)(t=f[p].check(this.bonds,f[u],this.atoms[b]))&&A.push(t);if(0===A.length){r=[];p=0;for(q=l.length;p<q;p++){u=0;for(t=this.bonds.length;u<t;u++)this.bonds[u].contains(l[p])&&(e=this.bonds[u].getNeighbor(l[p]),-1===l.indexOf(e)&&-1===r.indexOf(e)&&r.push(e))}p=0;for(q=r.length;p<q;p++)l.push(r[p])}}if(0<A.length){f=void 0;p=0;for(q=A.length;p<q;p++)if(!f||f.atoms.length>A[p].atoms.length)f=A[p];A=!1;p=0;for(q=this.rings.length;p<q;p++){l=!0;u=0;for(t=f.atoms.length;u<t;u++)if(-1===this.rings[p].atoms.indexOf(f.atoms[u])){l=!1;break}if(l){A=!0;break}}A||this.rings.push(f)}}}this.fuse()}})(ChemDoodle.informatics,ChemDoodle.structures);(function(b){b.SSSRFinder=function(j){this.rings=[];if(0<j.atoms.length){var o=new b.FrerejacqueNumberCounter(j).value,l=new b.EulerFacetRingFinder(j).rings;l.sort(function(a,b){return a.atoms.length-b.atoms.length});for(var h=0,g=j.bonds.length;h<g;h++)j.bonds[h].visited=!1;h=0;for(g=l.length;h<g;h++){j=!1;for(var e=0,a=l[h].bonds.length;e<a;e++)if(!l[h].bonds[e].visited){j=!0;break}if(j){e=0;for(a=l[h].bonds.length;e<a;e++)l[h].bonds[e].visited=!0;this.rings.push(l[h])}if(this.rings.length===o)break}}}})(ChemDoodle.informatics);(function(b){b._Interpreter=function(){};b._Interpreter.prototype.fit=function(b,o,l){for(var h=b.length,g=[],e=0;e<o-h;e++)g.push(" ");return l?b+g.join(""):g.join("")+b}})(ChemDoodle.io);(function(b,j,o,l,h,g,e){var a=/\s+/g,d=/\(|\)|\s+/g,n=/\'|\s+/g,f=/,|\'|\s+/g,y=/^\s+/,p=/[0-9]/g,q=/[0-9]|\+|\-/g,A=function(a){return 0!==a.length},r={P:[],A:[[0,.5,.5]],B:[[.5,0,.5]],C:[[.5,.5,0]],I:[[.5,.5,.5]],R:[[2/3,1/3,1/3],[1/3,2/3,2/3]],S:[[1/3,1/3,2/3],[2/3,2/3,1/3]],T:[[1/3,2/3,1/3],[2/3,1/3,2/3]],F:[[0,.5,.5],[.5,0,.5],[.5,.5,0]]},v=function(a){var b=0,d=0,e=0,c=0,f=a.indexOf("x"),g=a.indexOf("y"),h=a.indexOf("z");-1!==f&&(d++,0<f&&"+"!==a.charAt(f-1)&&(d*=-1));-1!==g&&(e++,0<g&&"+"!==a.charAt(g-1)&&(e*=-1));-1!==h&&(c++,0<h&&"+"!==a.charAt(h-1)&&(c*=-1));if(2<a.length){f="+";g=0;for(h=a.length;g<h;g++){var j=a.charAt(g);if(("-"===j||"/"===j)&&(g===a.length-1||a.charAt(g+1).match(p)))f=j;j.match(p)&&("+"===f?b+=parseInt(j):"-"===f?b-=parseInt(j):"/"===f&&(b/=parseInt(j)))}}return[b,d,e,c]};o.CIFInterpreter=function(){};(o.CIFInterpreter.prototype=new o._Interpreter).read=function(p,o,u,B){o=o?o:1;u=u?u:1;B=B?B:1;var c=new l.Molecule;if(!p)return c;for(var k=p.split("\n"),C=0,D=0,G=0,E=p=0,H=0,I="P",M,J,T,F,W=!0;0<k.length;)if(W?F=k.shift():W=!0,0<F.length)if(j.stringStartsWith(F,"_cell_length_a"))C=parseFloat(F.split(d)[1]);else if(j.stringStartsWith(F,"_cell_length_b"))D=parseFloat(F.split(d)[1]);else if(j.stringStartsWith(F,"_cell_length_c"))G=parseFloat(F.split(d)[1]);else if(j.stringStartsWith(F,"_cell_angle_alpha"))p=g.PI*parseFloat(F.split(d)[1])/180;else if(j.stringStartsWith(F,"_cell_angle_beta"))E=g.PI*parseFloat(F.split(d)[1])/180;else if(j.stringStartsWith(F,"_cell_angle_gamma"))H=g.PI*parseFloat(F.split(d)[1])/180;else if(j.stringStartsWith(F,"_symmetry_space_group_name_H-M"))I=F.split(n)[1];else if(j.stringStartsWith(F,"loop_")){for(var R={fields:[],lines:[]},O=!1;void 0!==(F=k.shift())&&!j.stringStartsWith(F=F.replace(y,""),"loop_")&&0<F.length;)if(j.stringStartsWith(F,"_")){if(O)break;R.fields=R.fields.concat(F.split(a).filter(A))}else O=!0,R.lines.push(F);if(0!==k.length&&(j.stringStartsWith(F,"loop_")||j.stringStartsWith(F,"_")))W=!1;-1!==R.fields.indexOf("_symmetry_equiv_pos_as_xyz")||-1!==R.fields.indexOf("_space_group_symop_operation_xyz")?M=R:-1!==R.fields.indexOf("_atom_site_label")?J=R:-1!==R.fields.indexOf("_geom_bond_atom_site_label_1")&&(T=R)}F=C;p=(g.cos(p)-g.cos(H)*g.cos(E))/g.sin(H);p=[F,0,0,0,D*g.cos(H),D*g.sin(H),0,0,G*g.cos(E),G*p,G*g.sqrt(1-g.pow(g.cos(E),2)-p*p),0,0,0,0,1];if(J){R=W=C=k=G=-1;H=0;for(E=J.fields.length;H<E;H++)F=J.fields[H],"_atom_site_type_symbol"===F?G=H:"_atom_site_label"===F?k=H:"_atom_site_fract_x"===F?C=H:"_atom_site_fract_y"===F?W=H:"_atom_site_fract_z"===F&&(R=H);H=0;for(E=J.lines.length;H<E;H++)F=J.lines[H],D=F.split(a).filter(A),F=new l.Atom(D[-1===G?k:G].split(q)[0],parseFloat(D[C]),parseFloat(D[W]),parseFloat(D[R])),c.atoms.push(F),-1!==k&&(F.cifId=D[k],F.cifPart=0)}if(M&&!T){H=D=0;for(E=M.fields.length;H<E;H++)if(F=M.fields[H],"_symmetry_equiv_pos_as_xyz"===F||"_space_group_symop_operation_xyz"===F)D=H;W=r[I];k=[];H=0;for(E=M.lines.length;H<E;H++){F=M.lines[H].split(f).filter(A);for(var R=v(F[D]),O=v(F[D+1]),L=v(F[D+2]),I=0,C=c.atoms.length;I<C;I++){F=c.atoms[I];var Z=F.x*R[1]+F.y*R[2]+F.z*R[3]+R[0],Da=F.x*O[1]+F.y*O[2]+F.z*O[3]+O[0],ka=F.x*L[1]+F.y*L[2]+F.z*L[3]+L[0];J=new l.Atom(F.label,Z,Da,ka);k.push(J);void 0!==F.cifId&&(J.cifId=F.cifId,J.cifPart=H+1);if(W){J=0;for(G=W.length;J<G;J++){var $=W[J],$=new l.Atom(F.label,Z+$[0],Da+$[1],ka+$[2]);k.push($);void 0!==F.cifId&&($.cifId=F.cifId,$.cifPart=H+1)}}}}H=0;for(E=k.length;H<E;H++){for(F=k[H];1<=F.x;)F.x--;for(;0>F.x;)F.x++;for(;1<=F.y;)F.y--;for(;0>F.y;)F.y++;for(;1<=F.z;)F.z--;for(;0>F.z;)F.z++}J=[];H=0;for(E=k.length;H<E;H++){G=!1;F=k[H];I=0;for(C=c.atoms.length;I<C;I++)if(1e-4>c.atoms[I].distance3D(F)){G=!0;break}if(!G){I=0;for(C=J.length;I<C;I++)if(1e-4>J[I].distance3D(F)){G=!0;break}G||J.push(F)}}c.atoms=c.atoms.concat(J)}E=[];for(H=0;H<o;H++)for(I=0;I<u;I++)for(J=0;J<B;J++)if(!(0===H&&0===I&&0===J)){G=0;for(D=c.atoms.length;G<D;G++)F=c.atoms[G],k=new l.Atom(F.label,F.x+H,F.y+I,F.z+J),E.push(k),void 0!==F.cifId&&(k.cifId=F.cifId,k.cifPart=F.cifPart+(M?M.lines.length:0)+H+10*I+100*J)}c.atoms=c.atoms.concat(E);H=0;for(E=c.atoms.length;H<E;H++)F=c.atoms[H],M=e.multiplyVec3(p,[F.x,F.y,F.z]),F.x=M[0],F.y=M[1],F.z=M[2];if(T){k=M=-1;H=0;for(E=T.fields.length;H<E;H++)F=T.fields[H],"_geom_bond_atom_site_label_1"===F?M=H:"_geom_bond_atom_site_label_2"===F&&(k=H);J=0;for(G=T.lines.length;J<G;J++){D=T.lines[J].split(a).filter(A);F=D[M];D=D[k];H=0;for(E=c.atoms.length;H<E;H++)for(I=H+1;I<E;I++){C=c.atoms[H];W=c.atoms[I];if(C.cifPart!==W.cifPart)break;(C.cifId===F&&W.cifId===D||C.cifId===D&&W.cifId===F)&&c.bonds.push(new l.Bond(C,W))}}}else(new b.informatics.BondDeducer).deduceCovalentBonds(c,1);o=[-o/2,-u/2,-B/2];o={o:e.multiplyVec3(p,o,[]),x:e.multiplyVec3(p,[o[0]+1,o[1],o[2]]),y:e.multiplyVec3(p,[o[0],o[1]+1,o[2]]),z:e.multiplyVec3(p,[o[0],o[1],o[2]+1]),xy:e.multiplyVec3(p,[o[0]+1,o[1]+1,o[2]]),xz:e.multiplyVec3(p,[o[0]+1,o[1],o[2]+1]),yz:e.multiplyVec3(p,[o[0],o[1]+1,o[2]+1]),xyz:e.multiplyVec3(p,[o[0]+1,o[1]+1,o[2]+1])};return{molecule:c,unitCell:new h.UnitCell(o)}};var u=new o.CIFInterpreter;b.readCIF=function(a,b,d,e){return u.read(a,b,d,e)}})(ChemDoodle,ChemDoodle.extensions,ChemDoodle.io,ChemDoodle.structures,ChemDoodle.structures.d3,Math,ChemDoodle.lib.mat4,ChemDoodle.lib.vec3);(function(b,j,o,l){j.CMLInterpreter=function(){};var h=j.CMLInterpreter.prototype=new j._Interpreter;h.read=function(b){var a=[];b=l.parseXML(b);b=l(b).find("cml");for(var d=0,g=b.length;d<g;d++)for(var f=l(b[d]).find("molecule"),h=0,j=f.length;h<j;h++){for(var q=a[h]=new o.Molecule,A=[],r=l(f[h]).find("atom"),v=0,u=r.length;v<u;v++){var t=l(r[v]),w=t.attr("elementType"),x,B,c;void 0==t.attr("x2")?(x=t.attr("x3"),B=t.attr("y3"),c=t.attr("z3")):(x=t.attr("x2"),B=t.attr("y2"),c=0);w=a[h].atoms[v]=new o.Atom(w,x,B,c);A[v]=t.attr("id");void 0!=t.attr("formalCharge")&&(w.charge=t.attr("formalCharge"))}r=l(f[h]).find("bond");v=0;for(u=r.length;v<u;v++){t=l(r[v]);x=t.attr("atomRefs2").split(" ");w=q.atoms[l.inArray(x[0],A)];x=q.atoms[l.inArray(x[1],A)];switch(t.attr("order")){case"2":case"D":B=2;break;case"3":case"T":B=3;break;case"A":B=1.5;break;default:B=1}w=a[h].bonds[v]=new o.Bond(w,x,B);switch(t.find("bondStereo").text()){case"W":w.stereo=o.Bond.STEREO_PROTRUDING;break;case"H":w.stereo=o.Bond.STEREO_RECESSED}}}return a};h.write=function(b){var a=[];a.push('<?xml version="1.0" encoding="UTF-8"?>\n');a.push('<cml convention="conventions:molecular" xmlns="http://www.xml-cml.org/schema" xmlns:conventions="http://www.xml-cml.org/convention/" xmlns:dc="http://purl.org/dc/elements/1.1/">\n');for(var d=0,g=b.length;d<g;d++){a.push('<molecule id="m');a.push(d);a.push('">');a.push("<atomArray>");for(var f=0,h=b[d].atoms.length;f<h;f++){var j=b[d].atoms[f];a.push('<atom elementType="');a.push(j.label);a.push('" id="a');a.push(f);a.push('" ');a.push('x3="');a.push(j.x);a.push('" y3="');a.push(j.y);a.push('" z3="');a.push(j.z);a.push('" ');0!=j.charge&&(a.push('formalCharge="'),a.push(j.charge),a.push('" '));a.push("/>")}a.push("</atomArray>");a.push("<bondArray>");f=0;for(h=b[d].bonds.length;f<h;f++){j=b[d].bonds[f];a.push('<bond atomRefs2="a');a.push(b[d].atoms.indexOf(j.a1));a.push(" a");a.push(b[d].atoms.indexOf(j.a2));a.push('" order="');switch(j.bondOrder){case 1.5:a.push("A");break;case 1:case 2:case 3:a.push(j.bondOrder);break;default:a.push("S")}a.push('"/>')}a.push("</bondArray>");a.push("</molecule>")}a.push("</cml>");return a.join("")};var g=new j.CMLInterpreter;b.readCML=function(b){return g.read(b)};b.writeCML=function(b){return g.write(b)}})(ChemDoodle,ChemDoodle.io,ChemDoodle.structures,ChemDoodle.lib.jQuery);(function(b,j,o,l){o.MOLInterpreter=function(){};var h=o.MOLInterpreter.prototype=new o._Interpreter;h.read=function(e,a){a||(a=b.default_bondLength_2D);var d=new l.Molecule;if(!e)return d;for(var g=e.split("\n"),f=g[3],h=parseInt(f.substring(0,3)),f=parseInt(f.substring(3,6)),p=0;p<h;p++){var q=g[4+p];d.atoms[p]=new l.Atom(q.substring(31,34),parseFloat(q.substring(0,10))*a,(1===a?1:-1)*parseFloat(q.substring(10,20))*a,parseFloat(q.substring(20,30))*a);var o=parseInt(q.substring(34,36));0!==o&&j[d.atoms[p].label]&&(d.atoms[p].mass=j[d.atoms[p].label].mass+o);switch(parseInt(q.substring(36,39))){case 1:d.atoms[p].charge=3;break;case 2:d.atoms[p].charge=2;break;case 3:d.atoms[p].charge=1;break;case 5:d.atoms[p].charge=-1;break;case 6:d.atoms[p].charge=-2;break;case 7:d.atoms[p].charge=-3}}for(p=0;p<f;p++){var q=g[4+h+p],r=parseInt(q.substring(6,9)),o=parseInt(q.substring(9,12));if(3<r)switch(r){case 4:r=1.5;break;default:r=1}q=new l.Bond(d.atoms[parseInt(q.substring(0,3))-1],d.atoms[parseInt(q.substring(3,6))-1],r);switch(o){case 3:q.stereo=l.Bond.STEREO_AMBIGUOUS;break;case 1:q.stereo=l.Bond.STEREO_PROTRUDING;break;case 6:q.stereo=l.Bond.STEREO_RECESSED}d.bonds[p]=q}return d};h.write=function(e){var a=[];a.push("Molecule from ChemDoodle Web Components\n\nhttp://www.ichemlabs.com\n");a.push(this.fit(e.atoms.length.toString(),3));a.push(this.fit(e.bonds.length.toString(),3));a.push("  0  0  0  0            999 V2000\n");for(var d=e.getCenter(),g=0,f=e.atoms.length;g<f;g++){var h=e.atoms[g],p=" 0";if(-1!==h.mass&&j[h.label]){var q=h.mass-j[h.label].mass;5>q&&-4<q&&(p=(-1<q?" ":"")+q)}q="  0";if(0!==h.charge)switch(h.charge){case 3:q="  1";break;case 2:q="  2";break;case 1:q="  3";break;case-1:q="  5";break;case-2:q="  6";break;case-3:q="  7"}a.push(this.fit(((h.x-d.x)/b.default_bondLength_2D).toFixed(4),10));a.push(this.fit((-(h.y-d.y)/b.default_bondLength_2D).toFixed(4),10));a.push(this.fit((h.z/b.default_bondLength_2D).toFixed(4),10));a.push(" ");a.push(this.fit(h.label,3,!0));a.push(p);a.push(q);a.push("  0  0  0  0\n")}g=0;for(f=e.bonds.length;g<f;g++){h=e.bonds[g];d=0;h.stereo===l.Bond.STEREO_AMBIGUOUS?d=3:h.stereo===l.Bond.STEREO_PROTRUDING?d=1:h.stereo===l.Bond.STEREO_RECESSED&&(d=6);a.push(this.fit((e.atoms.indexOf(h.a1)+1).toString(),3));a.push(this.fit((e.atoms.indexOf(h.a2)+1).toString(),3));h=h.bondOrder;if(1.5==h)h=4;else if(3<h||0!=h%1)h=1;a.push(this.fit(h,3));a.push("  ");a.push(d);a.push("     0  0\n")}a.push("M  END");return a.join("")};var g=new o.MOLInterpreter;b.readMOL=function(b,a){return g.read(b,a)};b.writeMOL=function(b){return g.write(b)}})(ChemDoodle,ChemDoodle.ELEMENT,ChemDoodle.io,ChemDoodle.structures);(function(b,j,o,l,h,g,e){function a(a,b,d,e,g){for(var h=0,j=b.length;h<j;h++){var n=b[h];if(n.id===d&&e>=n.start&&e<=n.end){g?a.helix=!0:a.sheet=!0;e===n.end&&(a.arrow=!0);break}}}o.PDBInterpreter=function(){};var d=o.PDBInterpreter.prototype=new o._Interpreter;d.calculateRibbonDistances=!1;d.deduceResidueBonds=!1;d.read=function(d,n){var p=new l.Molecule;p.chains=[];if(!d)return p;var q=d.split("\n");n||(n=1);for(var o=[],r=[],v,u=[],t=[],w=[],x=0,B=q.length;x<B;x++){var c=q[x];if(j.stringStartsWith(c,"HELIX"))o.push({id:c.substring(19,20),start:parseInt(c.substring(21,25)),end:parseInt(c.substring(33,37))});else if(j.stringStartsWith(c,"SHEET"))r.push({id:c.substring(21,22),start:parseInt(c.substring(22,26)),end:parseInt(c.substring(33,37))});else if(j.stringStartsWith(c,"ATOM")){var k=c.substring(16,17);if(" "===k||"A"===k){k=g(c.substring(76,78));if(0===k.length){var C=g(c.substring(12,14));"HD"===C?k="H":0<C.length&&(k=1<C.length?C.charAt(0)+C.substring(1).toLowerCase():C)}C=new l.Atom(k,parseFloat(c.substring(30,38))*n,parseFloat(c.substring(38,46))*n,parseFloat(c.substring(46,54))*n);C.hetatm=!1;t.push(C);var D=parseInt(c.substring(22,26));if(0===u.length)for(k=0;3>k;k++){var G=new l.Residue(-1);G.cp1=C;G.cp2=C;u.push(G)}D!==Number.NaN&&u[u.length-1].resSeq!==D&&(k=new l.Residue(D),k.name=g(c.substring(17,20)),3===k.name.length?k.name=k.name.substring(0,1)+k.name.substring(1).toLowerCase():2===k.name.length&&"D"===k.name.charAt(0)&&(k.name=k.name.substring(1)),u.push(k),G=c.substring(21,22),a(k,o,G,D,!0),a(k,r,G,D,!1));c=g(c.substring(12,16));k=u[u.length-1];if("CA"===c||"P"===c||"O5'"===c)k.cp1||(k.cp1=C);else if("N3"===c&&("C"===k.name||"U"===k.name||"T"===k.name)||"N1"===c&&("A"===k.name||"G"===k.name))k.cp3=C;else if("C2"===c)k.cp4=C;else if("C4"===c&&("C"===k.name||"U"===k.name||"T"===k.name)||"C6"===c&&("A"===k.name||"G"===k.name))k.cp5=C;else if("O"===c||"C6"===c&&("C"===k.name||"U"===k.name||"T"===k.name)||"N9"===c){if(!u[u.length-1].cp2){if("C6"===c||"N9"===c)v=C;k.cp2=C}}else"C"===c&&(v=C)}}else if(j.stringStartsWith(c,"HETATM"))k=g(c.substring(76,78)),0===k.length&&(k=g(c.substring(12,16))),1<k.length&&(k=k.substring(0,1)+k.substring(1).toLowerCase()),k=new l.Atom(k,parseFloat(c.substring(30,38))*n,parseFloat(c.substring(38,46))*n,parseFloat(c.substring(46,54))*n),k.hetatm=!0,"HOH"===g(c.substring(17,20))&&(k.isWater=!0),p.atoms.push(k),w[parseInt(g(c.substring(6,11)))]=k;else if(j.stringStartsWith(c,"CONECT")){if(k=parseInt(g(c.substring(6,11))),w[k]){C=w[k];for(D=0;4>D;D++)if(k=g(c.substring(11+5*D,16+5*D)),0!==k.length&&(k=parseInt(k),w[k])){for(var G=w[k],E=!1,k=0,H=p.bonds.length;k<H;k++){var I=p.bonds[k];if(I.a1===C&&I.a2===G||I.a1===G&&I.a2===C){E=!0;break}}E||p.bonds.push(new l.Bond(C,G))}}}else if(j.stringStartsWith(c,"TER"))this.endChain(p,u,v,t),u=[];else if(j.stringStartsWith(c,"ENDMDL"))break}this.endChain(p,u,v,t);0===p.bonds.size&&(new b.informatics.BondDeducer).deduceCovalentBonds(p,n);if(this.deduceResidueBonds){x=0;for(B=t.length;x<B;x++){q=e.min(B,x+20);for(k=x+1;k<q;k++)o=t[x],r=t[k],o.distance3D(r)<1.1*(h[o.label].covalentRadius+h[r.label].covalentRadius)&&p.bonds.push(new l.Bond(o,r,1))}}p.atoms=p.atoms.concat(t);this.calculateRibbonDistances&&this.calculateDistances(p,t);return p};d.endChain=function(a,b,d,e){if(0<b.length){var g=b[b.length-1];g.cp1||(g.cp1=e[e.length-2]);g.cp2||(g.cp2=e[e.length-1]);for(e=0;4>e;e++)g=new l.Residue(-1),g.cp1=d,g.cp2=b[b.length-1].cp2,b.push(g);a.chains.push(b)}};d.calculateDistances=function(a,b){for(var d=[],e=0,g=a.atoms.length;e<g;e++){var h=a.atoms[e];h.hetatm&&(h.isWater||d.push(h))}e=0;for(g=b.length;e<g;e++)if(h=b[e],h.closestDistance=Number.POSITIVE_INFINITY,0===d.length)h.closestDistance=0;else for(var j=0,n=d.length;j<n;j++)h.closestDistance=Math.min(h.closestDistance,h.distance3D(d[j]))};var n=new o.PDBInterpreter;b.readPDB=function(a,b){return n.read(a,b)}})(ChemDoodle,ChemDoodle.extensions,ChemDoodle.io,ChemDoodle.structures,ChemDoodle.ELEMENT,ChemDoodle.lib.jQuery.trim,Math);(function(b,j,o,l){var h={"@":0,A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,a:-1,b:-2,c:-3,d:-4,e:-5,f:-6,g:-7,h:-8,i:-9},g={"%":0,J:1,K:2,L:3,M:4,N:5,O:6,P:7,Q:8,R:9,j:-1,k:-2,l:-3,m:-4,n:-5,o:-6,p:-7,q:-8,r:-9},e={S:1,T:2,U:3,V:4,W:5,X:6,Y:7,Z:8,s:9};o.JCAMPInterpreter=function(){};var a=o.JCAMPInterpreter.prototype=new o._Interpreter;a.convertHZ2PPM=!1;a.read=function(a){this.isBreak=function(a){return void 0!==h[a]||void 0!==g[a]||void 0!==e[a]||" "===a||"-"===a||"+"===a};this.getValue=function(a,b){var c=a.charAt(0),d=a.substring(1);return void 0!==h[c]?parseFloat(h[c]+d):void 0!==g[c]?parseFloat(g[c]+d)+b:parseFloat(d)};var b=new l.Spectrum;if(void 0===a||0===a.length)return b;a=a.split("\n");for(var d=[],p,q,o,r,v=1,u=1,t=1,w=-1,x=-1,B=-1,c=!0,k=!1,C=0,D=a.length;C<D;C++){var G=a[C].trim(),E=G.indexOf("$$");-1!==E&&(G=G.substring(0,E));if(0===d.length||!j.stringStartsWith(a[C],"##"))G=G.trim(),0!==d.length&&0!==G.length&&d.push("\n"),d.push(G);else if(E=d.join(""),c&&100>E.length&&b.metadata.push(E),d=[G],j.stringStartsWith(E,"##TITLE="))b.title=E.substring(8).trim();else if(j.stringStartsWith(E,"##XUNITS="))b.xUnit=E.substring(9).trim(),this.convertHZ2PPM&&"HZ"===b.xUnit.toUpperCase()&&(b.xUnit="PPM",k=!0);else if(j.stringStartsWith(E,"##YUNITS="))b.yUnit=E.substring(9).trim();else if(!j.stringStartsWith(E,"##XYPAIRS="))if(j.stringStartsWith(E,"##FIRSTX="))q=parseFloat(E.substring(9).trim());else if(j.stringStartsWith(E,"##LASTX="))p=parseFloat(E.substring(8).trim());else if(j.stringStartsWith(E,"##FIRSTY="))o=parseFloat(E.substring(9).trim());else if(j.stringStartsWith(E,"##NPOINTS="))r=parseFloat(E.substring(10).trim());else if(j.stringStartsWith(E,"##XFACTOR="))v=parseFloat(E.substring(10).trim());else if(j.stringStartsWith(E,"##YFACTOR="))u=parseFloat(E.substring(10).trim());else if(j.stringStartsWith(E,"##DELTAX="))w=parseFloat(E.substring(9).trim());else if(j.stringStartsWith(E,"##.OBSERVE FREQUENCY="))this.convertHZ2PPM&&(t=parseFloat(E.substring(21).trim()));else if(j.stringStartsWith(E,"##.SHIFT REFERENCE="))this.convertHZ2PPM&&(B=E.substring(19).split(","),x=parseInt(B[2].trim()),B=parseFloat(B[3].trim()));else if(j.stringStartsWith(E,"##XYDATA=")){k||(t=1);var H=c=!1,G=E.split("\n"),I=(p-q)/(r-1);if(-1!==w)for(var E=1,M=G.length;E<M;E++)if("|"===G[E].charAt(0)){I=w;break}for(var J=q-I,T=o,F=0,W,E=1,M=G.length;E<M;E++){for(var R=[],J=G[E].trim(),d=[],O=!1,L=0,Z=J.length;L<Z;L++)this.isBreak(J.charAt(L))?(0<d.length&&!(1===d.length&&" "===d[0])&&R.push(d.join("")),d=[J.charAt(L)]):"|"===J.charAt(L)?O=!0:d.push(J.charAt(L));R.push(d.join(""));J=parseFloat(R[0])*v-I;L=1;for(Z=R.length;L<Z;L++)if(T=R[L],void 0!==e[T.charAt(0)])for(var Da=parseInt(e[T.charAt(0)]+T.substring(1))-1,ka=0;ka<Da;ka++)J+=I,F=this.getValue(W,F),T=F*u,$++,b.data[b.data.length-1]=new l.Point(J/t,T);else void 0!==h[T.charAt(0)]&&H?(T=this.getValue(T,F)*u,O&&(J+=I,b.data.push(new l.Point(J/t,T)))):(H=void 0!==g[T.charAt(0)],W=T,J+=I,F=this.getValue(T,F),T=F*u,$++,b.data.push(new l.Point(J/t,T)))}if(-1!==x){G=B-b.data[x-1].x;C=0;for(D=b.data.length;C<D;C++)b.data[C].x+=G}}else if(j.stringStartsWith(E,"##PEAK TABLE=")){c=!1;b.continuous=!1;for(var G=E.split("\n"),$=0,H=/[\s,]+/,E=1,M=G.length;E<M;E++){O=G[E].split(H);$+=O.length/2;L=0;for(Z=O.length;L+1<Z;L+=2)b.data.push(new l.Point(parseFloat(O[L].trim()),parseFloat(O[L+1].trim())))}}else if(j.stringStartsWith(E,"##ATOMLIST=")){b.molecule=new l.Molecule;G=E.split("\n");H=/[\s]+/;E=1;for(M=G.length;E<M;E++)O=G[E].split(H),b.molecule.atoms.push(new l.Atom(O[1]))}else if(j.stringStartsWith(E,"##BONDLIST=")){G=E.split("\n");H=/[\s]+/;E=1;for(M=G.length;E<M;E++)O=G[E].split(H),L=1,"D"===O[2]?L=2:"T"===O[2]&&(L=3),b.molecule.bonds.push(new l.Bond(b.molecule.atoms[parseInt(O[0])-1],b.molecule.atoms[parseInt(O[1])-1],L))}else if(b.molecule&&j.stringStartsWith(E,"##XY_RASTER=")){G=E.split("\n");H=/[\s]+/;E=1;for(M=G.length;E<M;E++)O=G[E].split(H),I=b.molecule.atoms[parseInt(O[0])-1],I.x=parseInt(O[1]),I.y=parseInt(O[2]),4==O.length&&(I.z=parseInt(O[3]));b.molecule.scaleToAverageBondLength(20)}else if(j.stringStartsWith(E,"##PEAK ASSIGNMENTS=")){G=E.split("\n");H=/[\s,()<>]+/;b.assignments=[];E=1;for(M=G.length;E<M;E++){O=G[E].split(H);F=parseFloat(O[1]);R=parseFloat(O[2]);I=b.molecule.atoms[parseInt(O[3])-1];O=!1;L=0;for(Z=b.assignments.length;L<Z;L++)if(J=b.assignments[L],J.x===F){J.as.push(I);I.assigned=J;O=!0;break}O||(J={x:F,y:R,as:[I]},I.assigned=J,b.assignments.push(J))}}}b.setup();return b};a.makeStructureSpectrumSet=function(a,d){this.convertHZ2PPM=!0;var e=this.read(d),g=new b.ViewerCanvas(a+"_molecule",200,200);g.specs.atoms_displayTerminalCarbonLabels_2D=!0;g.specs.atoms_displayImplicitHydrogens_2D=!0;g.mouseout=function(){if(0!==this.molecules.length){for(var a=0,b=this.molecules[0].atoms.length;a<b;a++)this.molecules[0].atoms[a].isHover=!1;e.hovered=void 0;this.repaint();h.repaint()}};g.touchend=g.mouseout;g.mousemove=function(a){if(0!==this.molecules.length){for(var b=void 0,d=0,f=this.molecules[0].atoms.length;d<f;d++){var g=this.molecules[0].atoms[d];g.isHover=!1;if(g.assigned&&(void 0===b||a.p.distance(g)<a.p.distance(b)))b=g}e.hovered=void 0;if(20>a.p.distance(b)){d=0;for(f=b.assigned.as.length;d<f;d++)b.assigned.as[d].isHover=!0;h.spectrum.hovered=b.assigned}this.repaint();h.repaint()}};g.touchmove=g.mousemove;g.drawChildExtras=function(a){if(0!==this.molecules.length)for(var b=0,d=this.molecules[0].atoms.length;b<d;b++)this.molecules[0].atoms[b].drawDecorations(a)};var h=new b.ObserverCanvas(a+"_spectrum",400,200);h.specs.plots_showYAxis=!1;h.specs.plots_flipXAxis=!0;h.mouseout=function(){if(this.spectrum&&this.spectrum.assignments){
for(var a=0,b=g.molecules[0].atoms.length;a<b;a++)g.molecules[0].atoms[a].isHover=!1;this.spectrum.hovered=void 0;g.repaint();this.repaint()}};h.touchend=h.mouseout;h.mousemove=function(a){if(this.spectrum&&this.spectrum.assignments){for(var b=void 0,d=0,e=g.molecules[0].atoms.length;d<e;d++)g.molecules[0].atoms[d].isHover=!1;this.spectrum.hovered=void 0;d=0;for(e=this.spectrum.assignments.length;d<e;d++){var f=this.spectrum.assignments[d];if(void 0===b||Math.abs(this.spectrum.getTransformedX(f.x,this.specs,this.spectrum.memory.width,this.spectrum.memory.offsetLeft)-a.p.x)<Math.abs(this.spectrum.getTransformedX(b.x,this.specs,this.spectrum.memory.width,this.spectrum.memory.offsetLeft)-a.p.x))b=f}if(20>Math.abs(this.spectrum.getTransformedX(b.x,this.specs,this.spectrum.memory.width,this.spectrum.memory.offsetLeft)-a.p.x)){d=0;for(e=b.as.length;d<e;d++)b.as[d].isHover=!0;this.spectrum.hovered=b}g.repaint();this.repaint()}};h.touchmove=h.mousemove;h.drawChildExtras=function(a){if(this.spectrum&&this.spectrum.hovered){var b=this.spectrum.getTransformedX(this.spectrum.hovered.x,h.specs,this.spectrum.memory.width,this.spectrum.memory.offsetLeft);b>=this.spectrum.memory.offsetLeft&&b<this.spectrum.memory.width&&(a.save(),a.strokeStyle="#885110",a.lineWidth=3,a.beginPath(),a.moveTo(b,this.spectrum.memory.height-this.spectrum.memory.offsetBottom),a.lineTo(b,this.spectrum.getTransformedY(this.spectrum.hovered.y,h.specs,this.spectrum.memory.height,this.spectrum.memory.offsetBottom,this.spectrum.memory.offsetTop)),a.stroke(),a.restore())}};e&&(h.loadSpectrum(e),e.molecule&&g.loadMolecule(e.molecule));return[g,h]};var d=new o.JCAMPInterpreter;d.convertHZ2PPM=!0;b.readJCAMP=function(a){return d.read(a)}})(ChemDoodle,ChemDoodle.extensions,ChemDoodle.io,ChemDoodle.structures,ChemDoodle.lib.jQuery);(function(b,j,o,l,h,g){j.JSONInterpreter=function(){};var e=j.JSONInterpreter.prototype;e.contentTo=function(a,b){for(var e=0,g=0,h=0,j=a.length;h<j;h++){for(var l=a[h],o=0,v=l.atoms.length;o<v;o++)l.atoms[o].tmpid="a"+e++;o=0;for(v=l.bonds.length;o<v;o++)l.bonds[o].tmpid="b"+g++}h=e=0;for(j=b.length;h<j;h++)b[h].tmpid="s"+e++;e={};if(a&&0<a.length){e.m=[];h=0;for(j=a.length;h<j;h++)e.m.push(this.molTo(a[h]))}if(b&&0<b.length){e.s=[];h=0;for(j=b.length;h<j;h++)e.s.push(this.shapeTo(b[h]))}h=0;for(j=a.length;h<j;h++){l=a[h];o=0;for(v=l.atoms.length;o<v;o++)l.atoms[o].tmpid=void 0;o=0;for(v=l.bonds.length;o<v;o++)l.bonds[o].tmpid=void 0}h=0;for(j=b.length;h<j;h++)b[h].tmpid=void 0;return e};e.contentFrom=function(a){var b={molecules:[],shapes:[]};if(a.m)for(var e=0,g=a.m.length;e<g;e++)b.molecules.push(this.molFrom(a.m[e]));if(a.s){e=0;for(g=a.s.length;e<g;e++)b.shapes.push(this.shapeFrom(a.s[e],b.molecules))}e=0;for(g=b.molecules.length;e<g;e++){a=b.molecules[e];for(var h=0,j=a.atoms.length;h<j;h++)a.atoms[h].tmpid=void 0;h=0;for(j=a.bonds.length;h<j;h++)a.bonds[h].tmpid=void 0}e=0;for(g=b.shapes.length;e<g;e++)b.shapes[e].tmpid=void 0;return b};e.queryTo=function(a){var b={},e=function(b,e,f,g){e&&(b[f]={v:g?a.outputRange(e.v):e.v,n:e.not})};a.type===o.Query.TYPE_ATOM?(e(b,a.elements,"as"),e(b,a.chirality,"@"),e(b,a.aromatic,"A"),e(b,a.charge,"C",!0),e(b,a.hydrogens,"H",!0),e(b,a.ringCount,"R",!0),e(b,a.saturation,"S"),e(b,a.connectivity,"X",!0),e(b,a.connectivityNoH,"x",!0)):(e(b,a.orders,"bs"),e(b,a.stereo,"@"),e(b,a.aromatic,"A"),e(b,a.ringCount,"R",!0));return b};e.molTo=function(a){for(var b={a:[]},e=0,g=a.atoms.length;e<g;e++){var h=a.atoms[e],j={x:h.x,y:h.y};h.tmpid&&(j.i=h.tmpid);"C"!==h.label&&(j.l=h.label);0!==h.z&&(j.z=h.z);0!==h.charge&&(j.c=h.charge);-1!==h.mass&&(j.m=h.mass);0!==h.numRadical&&(j.r=h.numRadical);0!==h.numLonePair&&(j.p=h.numLonePair);h.query&&(j.q=this.queryTo(h.query));b.a.push(j)}if(0<a.bonds.length){b.b=[];e=0;for(g=a.bonds.length;e<g;e++)h=a.bonds[e],j={b:a.atoms.indexOf(h.a1),e:a.atoms.indexOf(h.a2)},h.tmpid&&(j.i=h.tmpid),1!==h.bondOrder&&(j.o=h.bondOrder),h.stereo!==o.Bond.STEREO_NONE&&(j.s=h.stereo),h.query&&(j.q=this.queryTo(h.query)),b.b.push(j)}return b};e.queryFrom=function(a){var b=new o.Query(a.as?o.Query.TYPE_ATOM:o.Query.TYPE_BOND),e=function(a,b,d,e){b&&(a[d]={},a[d].v=e?a.parseRange(b.v):b.v,b.n&&(a[d].not=!0))};b.type===o.Query.TYPE_ATOM?(e(b,a.as,"elements"),e(b,a["@"],"chirality"),e(b,a.A,"aromatic"),e(b,a.C,"charge",!0),e(b,a.H,"hydrogens",!0),e(b,a.R,"ringCount",!0),e(b,a.S,"saturation"),e(b,a.X,"connectivity",!0),e(b,a.x,"connectivityNoH",!0)):(e(b,a.bs,"orders"),e(b,a["@"],"stereo"),e(b,a.A,"aromatic"),e(b,a.R,"ringCount",!0));return b};e.molFrom=function(a){for(var b=new o.Molecule,e=0,g=a.a.length;e<g;e++){var h=a.a[e],j=new o.Atom(h.l?h.l:"C",h.x,h.y);h.i&&(j.tmpid=h.i);h.z&&(j.z=h.z);h.c&&(j.charge=h.c);h.m&&(j.mass=h.m);h.r&&(j.numRadical=h.r);h.p&&(j.numLonePair=h.p);h.q&&(j.query=this.queryFrom(h.q));void 0!==h.p_h&&(j.hetatm=h.p_h);void 0!==h.p_w&&(j.isWater=h.p_w);void 0!==h.p_d&&(j.closestDistance=h.p_d);b.atoms.push(j)}if(a.b){e=0;for(g=a.b.length;e<g;e++)h=a.b[e],j=new o.Bond(b.atoms[h.b],b.atoms[h.e],void 0===h.o?1:h.o),h.i&&(j.tmpid=h.i),h.s&&(j.stereo=h.s),h.q&&(j.query=this.queryFrom(h.q)),b.bonds.push(j)}return b};e.shapeTo=function(a){var b={};a.tmpid&&(b.i=a.tmpid);if(a instanceof l.Line)b.t="Line",b.x1=a.p1.x,b.y1=a.p1.y,b.x2=a.p2.x,b.y2=a.p2.y,b.a=a.arrowType;else if(a instanceof l.Pusher)b.t="Pusher",b.o1=a.o1.tmpid,b.o2=a.o2.tmpid,1!==a.numElectron&&(b.e=a.numElectron);else if(a instanceof l.Bracket)b.t="Bracket",b.x1=a.p1.x,b.y1=a.p1.y,b.x2=a.p2.x,b.y2=a.p2.y,0!==a.charge&&(b.c=a.charge),0!==a.mult&&(b.m=a.mult),0!==a.repeat&&(b.r=a.repeat);else if(a instanceof h.Distance)b.t="Distance",b.a1=a.a1.tmpid,b.a2=a.a2.tmpid,a.node&&(b.n=a.node,b.o=a.offset);else if(a instanceof h.Angle)b.t="Angle",b.a1=a.a1.tmpid,b.a2=a.a2.tmpid,b.a3=a.a3.tmpid;else if(a instanceof h.Torsion)b.t="Torsion",b.a1=a.a1.tmpid,b.a2=a.a2.tmpid,b.a3=a.a3.tmpid,b.a4=a.a4.tmpid;else if(a instanceof h.UnitCell){b.t="UnitCell";for(var e in a.unitCell)b[e]=a.unitCell[e]}return b};e.shapeFrom=function(a,b){var e;if("Line"===a.t)e=new l.Line(new o.Point(a.x1,a.y1),new o.Point(a.x2,a.y2)),e.arrowType=a.a;else if("Pusher"===a.t){var g,j,q=0;for(e=b.length;q<e;q++){for(var A=b[q],r=0,v=A.atoms.length;r<v;r++){var u=A.atoms[r];u.tmpid===a.o1?g=u:u.tmpid===a.o2&&(j=u)}r=0;for(v=A.bonds.length;r<v;r++){var t=A.bonds[r];t.tmpid===a.o1?g=t:t.tmpid===a.o2&&(j=t)}}e=new l.Pusher(g,j);a.e&&(e.numElectron=a.e)}else if("Bracket"===a.t)e=new l.Bracket(new o.Point(a.x1,a.y1),new o.Point(a.x2,a.y2)),void 0!==a.c&&(e.charge=a.c),void 0!==a.m&&(e.mult=a.m),void 0!==a.r&&(e.repeat=a.r);else if("Distance"===a.t){var w,q=0;for(e=b.length;q<e;q++){A=b[q];r=0;for(v=A.atoms.length;r<v;r++)u=A.atoms[r],u.tmpid===a.a1?t=u:u.tmpid===a.a2&&(w=u)}e=new h.Distance(t,w,a.n,a.o)}else if("Angle"===a.t){var x,q=0;for(e=b.length;q<e;q++){A=b[q];r=0;for(v=A.atoms.length;r<v;r++)u=A.atoms[r],u.tmpid===a.a1?t=u:u.tmpid===a.a2?w=u:u.tmpid===a.a3&&(x=u)}e=new h.Angle(t,w,x)}else if("Torsion"===a.t){var B,q=0;for(e=b.length;q<e;q++){A=b[q];r=0;for(v=A.atoms.length;r<v;r++)u=A.atoms[r],u.tmpid===a.a1?t=u:u.tmpid===a.a2?w=u:u.tmpid===a.a3?x=u:u.tmpid===a.a4&&(B=u)}e=new h.Torsion(t,w,x,B)}else if("UnitCell"===a.t){g={};for(q in a)g[q]=a[q];e=new h.UnitCell(g)}return e};e.pdbFrom=function(a){var b=this.molFrom(a.mol);b.findRings=!1;b.fromJSON=!0;b.chains=this.chainsFrom(a.ribbons);return b};e.chainsFrom=function(a){for(var b=[],e=0,g=a.cs.length;e<g;e++){for(var h=a.cs[e],j=[],l=0,r=h.length;l<r;l++){var v=h[l],u=new o.Residue;u.name=v.n;u.cp1=new o.Atom("",v.x1,v.y1,v.z1);u.cp2=new o.Atom("",v.x2,v.y2,v.z2);v.x3&&(u.cp3=new o.Atom("",v.x3,v.y3,v.z3),u.cp4=new o.Atom("",v.x4,v.y4,v.z4),u.cp5=new o.Atom("",v.x5,v.y5,v.z5));u.helix=v.h;u.sheet=v.s;u.arrow=0<l&&h[l-1].a;j.push(u)}b.push(j)}return b};var a=new j.JSONInterpreter;b.readJSON=function(b){var e;try{e=g.parse(b)}catch(f){return}if(e)return e.m||e.s?a.contentFrom(e):e.a?{molecules:[a.molFrom(e)],shapes:[]}:{molecules:[],shapes:[]}};b.writeJSON=function(b,e){return g.stringify(a.contentTo(b,e))}})(ChemDoodle,ChemDoodle.io,ChemDoodle.structures,ChemDoodle.structures.d2,ChemDoodle.structures.d3,JSON);(function(b,j,o){j.RXNInterpreter=function(){};var l=j.RXNInterpreter.prototype=new j._Interpreter;l.read=function(g,e){e||(e=b.default_bondLength_2D);var a=[],d;if(g){d=g.split("$MOL\n");for(var h=d[0].split("\n")[4],f=parseInt(h.substring(0,3)),h=parseInt(h.substring(3,6)),j=1,l=0,q=0,A=f+h;q<A;q++){a[q]=b.readMOL(d[j],e);var r=a[q].getBounds(),r=r.maxX-r.minX,l=l-(r+40);j++}q=0;for(A=f;q<A;q++){var r=a[q].getBounds(),r=r.maxX-r.minX,j=a[q].getCenter(),v=0;for(d=a[q].atoms.length;v<d;v++){var u=a[q].atoms[v];u.x+=l+r/2-j.x;u.y-=j.y}l+=r+40}d=new o.d2.Line(new o.Point(l,0),new o.Point(l+40,0));l+=80;q=f;for(A=f+h;q<A;q++){r=a[q].getBounds();r=r.maxX-r.minX;j=a[q].getCenter();for(v=0;v<a[q].atoms.length;v++)u=a[q].atoms[v],u.x+=l+r/2-j.x,u.y-=j.y;l+=r+40}}else a.push(new o.Molecule),d=new o.d2.Line(new o.Point(-20,0),new o.Point(20,0));d.arrowType=o.d2.Line.ARROW_SYNTHETIC;return{molecules:a,shapes:[d]}};l.write=function(g,e){var a=[[],[]],d=void 0;if(g&&e){h=0;for(f=e.length;h<f;h++)if(e[h]instanceof o.d2.Line){d=e[h].getPoints();break}if(!d)return"";for(var h=0,f=g.length;h<f;h++)g[h].getCenter().x<d[1].x?a[0].push(g[h]):a[1].push(g[h]);d=[];d.push("$RXN\nReaction from ChemDoodle Web Components\n\nhttp://www.ichemlabs.com\n");d.push(this.fit(a[0].length.toString(),3));d.push(this.fit(a[1].length.toString(),3));d.push("\n");for(h=0;2>h;h++)for(var f=0,j=a[h].length;f<j;f++)d.push("$MOL\n"),d.push(b.writeMOL(a[h][f])),d.push("\n");return d.join("")}};var h=new j.RXNInterpreter;b.readRXN=function(b,e){return h.read(b,e)};b.writeRXN=function(b,e){return h.write(b,e)}})(ChemDoodle,ChemDoodle.io,ChemDoodle.structures);(function(b,j,o,l,h,g){l.XYZInterpreter=function(){};j=l.XYZInterpreter.prototype=new l._Interpreter;j.deduceCovalentBonds=!0;j.read=function(a){var d=new h.Molecule;if(!a)return d;a=a.split("\n");for(var e=parseInt(g(a[0])),f=0;f<e;f++){var j=a[f+2].split(/\s+/g);d.atoms[f]=new h.Atom(isNaN(j[0])?j[0]:o[parseInt(j[0])-1],parseFloat(j[1]),parseFloat(j[2]),parseFloat(j[3]))}this.deduceCovalentBonds&&(new b.informatics.BondDeducer).deduceCovalentBonds(d,1);return d};var e=new l.XYZInterpreter;b.readXYZ=function(a){return e.read(a)}})(ChemDoodle,ChemDoodle.ELEMENT,ChemDoodle.SYMBOLS,ChemDoodle.io,ChemDoodle.structures,ChemDoodle.lib.jQuery.trim);ChemDoodle.monitor=function(b,j,o){var l={CANVAS_DRAGGING:void 0,CANVAS_OVER:void 0,ALT:!1,SHIFT:!1,META:!1};b.supports_touch()||j(o).ready(function(){j(o).mousemove(function(b){l.CANVAS_DRAGGING&&l.CANVAS_DRAGGING.drag&&(l.CANVAS_DRAGGING.prehandleEvent(b),l.CANVAS_DRAGGING.drag(b))});j(o).mouseup(function(b){l.CANVAS_DRAGGING&&l.CANVAS_DRAGGING!==l.CANVAS_OVER&&l.CANVAS_DRAGGING.mouseup&&(l.CANVAS_DRAGGING.prehandleEvent(b),l.CANVAS_DRAGGING.mouseup(b));l.CANVAS_DRAGGING=void 0});j(o).keydown(function(b){l.SHIFT=b.shiftKey;l.ALT=b.altKey;l.META=b.metaKey||b.ctrlKey;var g=l.CANVAS_OVER;l.CANVAS_DRAGGING&&(g=l.CANVAS_DRAGGING);g&&g.keydown&&(g.prehandleEvent(b),g.keydown(b))});j(o).keypress(function(b){var g=l.CANVAS_OVER;l.CANVAS_DRAGGING&&(g=l.CANVAS_DRAGGING);g&&g.keypress&&(g.prehandleEvent(b),g.keypress(b))});j(o).keyup(function(b){l.SHIFT=b.shiftKey;l.ALT=b.altKey;l.META=b.metaKey||b.ctrlKey;var g=l.CANVAS_OVER;l.CANVAS_DRAGGING&&(g=l.CANVAS_DRAGGING);g&&g.keyup&&(g.prehandleEvent(b),g.keyup(b))})});return l}(ChemDoodle.featureDetection,ChemDoodle.lib.jQuery,document);(function(b,j,o,l,h,g,e,a,d,n){b._Canvas=function(){};var f=b._Canvas.prototype;f.molecules=void 0;f.shapes=void 0;f.emptyMessage=void 0;f.image=void 0;f.repaint=function(){if(!this.test){var b=a.getElementById(this.id);if(b.getContext){var d=b.getContext("2d");1!==this.pixelRatio&&b.width===this.width&&(b.width=this.width*this.pixelRatio,b.height=this.height*this.pixelRatio,d.scale(this.pixelRatio,this.pixelRatio));this.image?d.drawImage(this.image,0,0):(this.specs.backgroundColor&&this.bgCache!==b.style.backgroundColor&&(b.style.backgroundColor=this.specs.backgroundColor,this.bgCache=b.style.backgroundColor),d.fillStyle=this.specs.backgroundColor,d.fillRect(0,0,this.width,this.height));if(this.innerRepaint)this.innerRepaint(d);else if(0!==this.molecules.length||0!==this.shapes.length){d.save();d.translate(this.width/2,this.height/2);d.rotate(this.specs.rotateAngle);d.scale(this.specs.scale,this.specs.scale);d.translate(-this.width/2,-this.height/2);for(var b=0,e=this.molecules.length;b<e;b++)this.molecules[b].check(!0),this.molecules[b].draw(d,this.specs);b=0;for(e=this.shapes.length;b<e;b++)this.shapes[b].draw(d,this.specs);d.restore()}else this.emptyMessage&&(d.fillStyle="#737683",d.textAlign="center",d.textBaseline="middle",d.font="18px Helvetica, Verdana, Arial, Sans-serif",d.fillText(this.emptyMessage,this.width/2,this.height/2));this.drawChildExtras&&this.drawChildExtras(d)}}};f.resize=function(a,d){var e=g("#"+this.id);e.attr({width:a,height:d});e.css("width",a);e.css("height",d);this.width=a;this.height=d;if(b._Canvas3D&&this instanceof b._Canvas3D){var e=a,f=d;1!==this.pixelRatio&&(e*=this.pixelRatio,f*=this.pixelRatio,this.gl.canvas.width=e,this.gl.canvas.height=f);this.gl.viewport(0,0,e,f);this.afterLoadContent()}else if(0<this.molecules.length){this.center();e=0;for(f=this.molecules.length;e<f;e++)this.molecules[e].check()}this.repaint()};f.setBackgroundImage=function(a){this.image=new Image;var b=this;this.image.onload=function(){b.repaint()};this.image.src=a};f.loadMolecule=function(a){this.clear();this.molecules.push(a);this.center();b._Canvas3D&&this instanceof b._Canvas3D||a.check();this.afterLoadContent&&this.afterLoadContent();this.repaint()};f.loadContent=function(a,d){this.molecules=a?a:[];this.shapes=d?d:[];this.center();if(!(b._Canvas3D&&this instanceof b._Canvas3D))for(var e=0,f=this.molecules.length;e<f;e++)this.molecules[e].check();this.afterLoadContent&&this.afterLoadContent();this.repaint()};f.addMolecule=function(a){this.molecules.push(a);b._Canvas3D&&this instanceof b._Canvas3D||a.check();this.repaint()};f.removeMolecule=function(a){this.molecules=g.grep(this.molecules,function(b){return b!==a});this.repaint()};f.getMolecule=function(){return 0<this.molecules.length?this.molecules[0]:void 0};f.getMolecules=function(){return this.molecules};f.addShape=function(a){this.shapes.push(a);this.repaint()};f.removeShape=function(a){this.shapes=g.grep(this.shapes,function(b){return b!==a});this.repaint()};f.getShapes=function(){return this.shapes};f.clear=function(){this.molecules=[];this.shapes=[];this.specs.scale=1;this.repaint()};f.center=function(){for(var a=this.getContentBounds(),b=new h.Point((this.width-a.minX-a.maxX)/2,(this.height-a.minY-a.maxY)/2),d=0,f=this.molecules.length;d<f;d++)for(var g=this.molecules[d],j=0,l=g.atoms.length;j<l;j++)g.atoms[j].add(b);d=0;for(f=this.shapes.length;d<f;d++){g=this.shapes[d].getPoints();j=0;for(l=g.length;j<l;j++)g[j].add(b)}this.specs.scale=1;b=a.maxX-a.minX;a=a.maxY-a.minY;if(b>this.width||a>this.height)this.specs.scale=.85*e.min(this.width/b,this.height/a)};f.bondExists=function(a,b){for(var d=0,e=this.molecules.length;d<e;d++)for(var f=this.molecules[d],g=0,h=f.bonds.length;g<h;g++){var j=f.bonds[g];if(j.contains(a)&&j.contains(b))return!0}return!1};f.getBond=function(a,b){for(var d=0,e=this.molecules.length;d<e;d++)for(var f=this.molecules[d],g=0,h=f.bonds.length;g<h;g++){var j=f.bonds[g];if(j.contains(a)&&j.contains(b))return j}};f.getMoleculeByAtom=function(a){for(var b=0,d=this.molecules.length;b<d;b++){var e=this.molecules[b];if(-1!==e.atoms.indexOf(a))return e}};f.getAllAtoms=function(){for(var a=[],b=0,d=this.molecules.length;b<d;b++)a=a.concat(this.molecules[b].atoms);return a};f.getAllPoints=function(){for(var a=[],b=0,d=this.molecules.length;b<d;b++)a=a.concat(this.molecules[b].atoms);b=0;for(d=this.shapes.length;b<d;b++)a=a.concat(this.shapes[b].getPoints());return a};f.getContentBounds=function(){for(var a=new o.Bounds,b=0,d=this.molecules.length;b<d;b++)a.expand(this.molecules[b].getBounds());b=0;for(d=this.shapes.length;b<d;b++)a.expand(this.shapes[b].getBounds());return a};f.create=function(f,p,o){this.id=f;this.width=p;this.height=o;this.molecules=[];this.shapes=[];if(a.getElementById(f)){var A=g("#"+f);p?A.attr("width",p):this.width=A.attr("width");o?A.attr("height",o):this.height=A.attr("height");A.attr("class","ChemDoodleWebComponent")}else{if(!b.featureDetection.supports_canvas_text()&&-1!=n.indexOf("MSIE")){a.writeln('<div style="border: 1px solid black;" width="'+p+'" height="'+o+'">Please install <a href="http://code.google.com/chrome/chromeframe/">Google Chrome Frame</a>, then restart Internet Explorer.</div>');return}a.writeln('<canvas class="ChemDoodleWebComponent" id="'+f+'" width="'+p+'" height="'+o+'" alt="ChemDoodle Web Component">This browser does not support HTML5/Canvas.</canvas>')}f=g("#"+f);f.css("width",this.width);f.css("height",this.height);this.pixelRatio=d.devicePixelRatio?d.devicePixelRatio:1;this.specs=new h.VisualSpecifications;var r=this;j.supports_touch()?(f.bind("touchstart",function(a){var b=(new Date).getTime();if(!j.supports_gesture()&&2===a.originalEvent.touches.length){var d=a.originalEvent.touches,e=new h.Point(d[0].pageX,d[0].pageY),d=new h.Point(d[1].pageX,d[1].pageY);r.implementedGestureDist=e.distance(d);r.implementedGestureAngle=e.angle(d);r.gesturestart&&(r.prehandleEvent(a),r.gesturestart(a))}r.lastTouch&&1===a.originalEvent.touches.length&&500>b-r.lastTouch?r.dbltap?(r.prehandleEvent(a),r.dbltap(a)):r.dblclick?(r.prehandleEvent(a),r.dblclick(a)):r.touchstart?(r.prehandleEvent(a),r.touchstart(a)):r.mousedown&&(r.prehandleEvent(a),r.mousedown(a)):r.touchstart?(r.prehandleEvent(a),r.touchstart(a),this.hold&&clearTimeout(this.hold),this.touchhold&&(this.hold=setTimeout(function(){r.touchhold(a)},1e3))):r.mousedown&&(r.prehandleEvent(a),r.mousedown(a));r.lastTouch=b}),f.bind("touchmove",function(a){this.hold&&(clearTimeout(this.hold),this.hold=void 0);if(!j.supports_gesture()&&2===a.originalEvent.touches.length&&r.gesturechange){var b=a.originalEvent.touches,d=new h.Point(b[0].pageX,b[0].pageY),f=new h.Point(b[1].pageX,b[1].pageY),b=d.distance(f),d=d.angle(f);a.originalEvent.scale=b/r.implementedGestureDist;a.originalEvent.rotation=180*(r.implementedGestureAngle-d)/e.PI;r.prehandleEvent(a);r.gesturechange(a)}if(1<a.originalEvent.touches.length&&r.multitouchmove){d=a.originalEvent.touches.length;r.prehandleEvent(a);b=new h.Point(-a.offset.left*d,-a.offset.top*d);for(f=0;f<d;f++)b.x+=a.originalEvent.changedTouches[f].pageX,b.y+=a.originalEvent.changedTouches[f].pageY;b.x/=d;b.y/=d;a.p=b;r.multitouchmove(a,d)}else r.touchmove?(r.prehandleEvent(a),r.touchmove(a)):r.drag&&(r.prehandleEvent(a),r.drag(a))}),f.bind("touchend",function(a){this.hold&&(clearTimeout(this.hold),this.hold=void 0);!j.supports_gesture()&&r.implementedGestureDist&&(r.implementedGestureDist=void 0,r.implementedGestureAngle=void 0,r.gestureend&&(r.prehandleEvent(a),r.gestureend(a)));r.touchend?(r.prehandleEvent(a),r.touchend(a)):r.mouseup&&(r.prehandleEvent(a),r.mouseup(a));250>(new Date).getTime()-r.lastTouch&&(r.tap?(r.prehandleEvent(a),r.tap(a)):r.click&&(r.prehandleEvent(a),r.click(a)))}),f.bind("gesturestart",function(a){r.gesturestart&&(r.prehandleEvent(a),r.gesturestart(a))}),f.bind("gesturechange",function(a){r.gesturechange&&(r.prehandleEvent(a),r.gesturechange(a))}),f.bind("gestureend",function(a){r.gestureend&&(r.prehandleEvent(a),r.gestureend(a))})):(f.click(function(a){switch(a.which){case 1:r.click&&(r.prehandleEvent(a),r.click(a));break;case 2:r.middleclick&&(r.prehandleEvent(a),r.middleclick(a));break;case 3:r.rightclick&&(r.prehandleEvent(a),r.rightclick(a))}}),f.dblclick(function(a){r.dblclick&&(r.prehandleEvent(a),r.dblclick(a))}),f.mousedown(function(a){switch(a.which){case 1:l.CANVAS_DRAGGING=r;r.mousedown&&(r.prehandleEvent(a),r.mousedown(a));break;case 2:r.middlemousedown&&(r.prehandleEvent(a),r.middlemousedown(a));break;case 3:r.rightmousedown&&(r.prehandleEvent(a),r.rightmousedown(a))}}),f.mousemove(function(a){!l.CANVAS_DRAGGING&&r.mousemove&&(r.prehandleEvent(a),r.mousemove(a))}),f.mouseout(function(a){l.CANVAS_OVER=void 0;r.mouseout&&(r.prehandleEvent(a),r.mouseout(a))}),f.mouseover(function(a){l.CANVAS_OVER=r;r.mouseover&&(r.prehandleEvent(a),r.mouseover(a))}),f.mouseup(function(a){switch(a.which){case 1:r.mouseup&&(r.prehandleEvent(a),r.mouseup(a));break;case 2:r.middlemouseup&&(r.prehandleEvent(a),r.middlemouseup(a));break;case 3:r.rightmouseup&&(r.prehandleEvent(a),r.rightmouseup(a))}}),f.mousewheel(function(a,b){r.mousewheel&&(r.prehandleEvent(a),r.mousewheel(a,b))}));this.subCreate&&this.subCreate()};f.prehandleEvent=function(a){a.originalEvent.changedTouches&&(a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY);a.preventDefault();a.offset=g("#"+this.id).offset();a.p=new h.Point(a.pageX-a.offset.left,a.pageY-a.offset.top)}})(ChemDoodle,ChemDoodle.featureDetection,ChemDoodle.math,ChemDoodle.monitor,ChemDoodle.structures,ChemDoodle.lib.jQuery,Math,document,window,navigator.userAgent);(function(b,j){b._AnimatorCanvas=function(b,h,g){b&&this.create(b,h,g)};var o=b._AnimatorCanvas.prototype=new b._Canvas;o.timeout=33;o.startAnimation=function(){this.stopAnimation();this.lastTime=(new Date).getTime();var b=this;this.nextFrame&&(this.handle=j.requestInterval(function(){var h=(new Date).getTime();b.nextFrame(h-b.lastTime);b.repaint();b.lastTime=h},this.timeout))};o.stopAnimation=function(){this.handle&&(j.clearRequestInterval(this.handle),this.handle=void 0)};o.isRunning=function(){return void 0!==this.handle}})(ChemDoodle,ChemDoodle.animations);(function(b,j){b.FileCanvas=function(b,l,h,g){b&&this.create(b,l,h);j.writeln('<br><form name="FileForm" enctype="multipart/form-data" method="POST" action="'+g+'" target="HiddenFileFrame"><input type="file" name="f" /><input type="submit" name="submitbutton" value="Show File" /></form><iframe id="HFF-'+b+'" name="HiddenFileFrame" height="0" width="0" style="display:none;" onLoad="GetMolFromFrame(\'HFF-'+b+"', "+b+')"></iframe>');this.emptyMessage="Click below to load file";this.repaint()};b.FileCanvas.prototype=new b._Canvas})(ChemDoodle,document);(function(b){b.HyperlinkCanvas=function(b,o,l,h,g,e){b&&this.create(b,o,l);this.urlOrFunction=h;this.color=g?g:"blue";this.size=e?e:2};b=b.HyperlinkCanvas.prototype=new b._Canvas;b.openInNewWindow=!0;b.hoverImage=void 0;b.drawChildExtras=function(b){this.e&&(this.hoverImage?b.drawImage(this.hoverImage,0,0):(b.strokeStyle=this.color,b.lineWidth=2*this.size,b.strokeRect(0,0,this.width,this.height)))};b.setHoverImage=function(b){this.hoverImage=new Image;this.hoverImage.src=b};b.click=function(){this.e=void 0;this.repaint();this.urlOrFunction instanceof Function?this.urlOrFunction():this.openInNewWindow?window.open(this.urlOrFunction):location.href=this.urlOrFunction};b.mouseout=function(){this.e=void 0;this.repaint()};b.mouseover=function(b){this.e=b;this.repaint()}})(ChemDoodle);(function(b,j,o,l){b.MolGrabberCanvas=function(b,g,e){b&&this.create(b,g,e);g=[];g.push('<br><input type="text" id="');g.push(b);g.push('_query" size="32" value="" />');g.push("<br><nobr>");g.push('<select id="');g.push(b);g.push('_select">');g.push('<option value="chemexper">ChemExper');g.push('<option value="chemspider">ChemSpider');g.push('<option value="pubchem" selected>PubChem');g.push("</select>");g.push('<button id="');g.push(b);g.push('_submit">Show Molecule</button>');g.push("</nobr>");l.getElementById(b);o("#"+b).after(g.join(""));var a=this;o("#"+b+"_submit").click(function(){a.search()});o("#"+b+"_query").keypress(function(b){13===b.which&&a.search()});this.emptyMessage="Enter search term below";this.repaint()};b=b.MolGrabberCanvas.prototype=new b._Canvas;b.setSearchTerm=function(b){o("#"+this.id+"_query").val(b);this.search()};b.search=function(){this.emptyMessage="Searching...";this.clear();var b=this;j.getMoleculeFromDatabase(o("#"+this.id+"_query").val(),{database:o("#"+this.id+"_select").val()},function(g){b.loadMolecule(g)})}})(ChemDoodle,ChemDoodle.iChemLabs,ChemDoodle.lib.jQuery,document);(function(b,j,o){var l=[],h=[1,0,0],g=[0,1,0],e=[0,0,1];b.RotatorCanvas=function(a,b,e,f){a&&this.create(a,b,e);this.rotate3D=f};b=b.RotatorCanvas.prototype=new b._AnimatorCanvas;j=j.PI/15;b.xIncrement=j;b.yIncrement=j;b.zIncrement=j;b.nextFrame=function(a){if(0===this.molecules.length&&0===this.shapes.length)this.stopAnimation();else if(a/=1e3,this.rotate3D){o.identity(l);o.rotate(l,this.xIncrement*a,h);o.rotate(l,this.yIncrement*a,g);o.rotate(l,this.zIncrement*a,e);a=0;for(var b=this.molecules.length;a<b;a++){for(var j=this.molecules[a],f=0,y=j.atoms.length;f<y;f++){var p=j.atoms[f],q=[p.x-this.width/2,p.y-this.height/2,p.z];o.multiplyVec3(l,q);p.x=q[0]+this.width/2;p.y=q[1]+this.height/2;p.z=q[2]}f=0;for(y=j.rings.length;f<y;f++)j.rings[f].center=j.rings[f].getCenter();this.specs.atoms_display&&this.specs.atoms_circles_2D&&j.sortAtomsByZ();this.specs.bonds_display&&this.specs.bonds_clearOverlaps_2D&&j.sortBondsByZ()}a=0;for(b=this.shapes.length;a<b;a++){j=this.shapes[a].getPoints();f=0;for(y=j.length;f<y;f++)p=j[f],q=[p.x-this.width/2,p.y-this.height/2,0],o.multiplyVec3(l,q),p.x=q[0]+this.width/2,p.y=q[1]+this.height/2}}else this.specs.rotateAngle+=this.zIncrement*a};b.dblclick=function(){this.isRunning()?this.stopAnimation():this.startAnimation()}})(ChemDoodle,Math,ChemDoodle.lib.mat4);(function(b,j,o){b.SlideshowCanvas=function(b,h,g){b&&this.create(b,h,g)};b=b.SlideshowCanvas.prototype=new b._AnimatorCanvas;b.frames=[];b.curIndex=0;b.timeout=5e3;b.alpha=0;b.innerHandle=void 0;b.phase=0;b.drawChildExtras=function(b){var h=o.getRGB(this.specs.backgroundColor,255);b.fillStyle="rgba("+h[0]+", "+h[1]+", "+h[2]+", "+this.alpha+")";b.fillRect(0,0,this.width,this.height)};b.nextFrame=function(){if(0===this.frames.length)this.stopAnimation();else{this.phase=0;var b=this,h=1;this.innerHandle=setInterval(function(){b.alpha=h/15;b.repaint();15===h&&b.breakInnerHandle();h++},33)}};b.breakInnerHandle=function(){this.innerHandle&&(clearInterval(this.innerHandle),this.innerHandle=void 0);if(0===this.phase){this.curIndex++;this.curIndex>this.frames.length-1&&(this.curIndex=0);this.alpha=1;var b=this.frames[this.curIndex];this.loadContent(b.mols,b.shapes);this.phase=1;var h=this,g=1;this.innerHandle=setInterval(function(){h.alpha=(15-g)/15;h.repaint();15===g&&h.breakInnerHandle();g++},33)}else 1===this.phase&&(this.alpha=0,this.repaint())};b.addFrame=function(b,h){0===this.frames.length&&this.loadContent(b,h);this.frames.push({mols:b,shapes:h})}})(ChemDoodle,ChemDoodle.animations,ChemDoodle.math);(function(b,j,o,l,h){b.TransformCanvas=function(b,e,a,d){b&&this.create(b,e,a);this.rotate3D=d};b=b.TransformCanvas.prototype=new b._Canvas;b.lastPoint=void 0;b.rotationMultMod=1.3;b.lastPinchScale=1;b.lastGestureRotate=0;b.mousedown=function(b){this.lastPoint=b.p};b.dblclick=function(){this.center();this.repaint()};b.drag=function(b){if(!this.lastPoint.multi){if(j.ALT){var e=new o.Point(b.p.x,b.p.y);e.sub(this.lastPoint);for(var a=0,d=this.molecules.length;a<d;a++){for(var n=this.molecules[a],f=0,y=n.atoms.length;f<y;f++)n.atoms[f].add(e);n.check()}a=0;for(d=this.shapes.length;a<d;a++){n=this.shapes[a].getPoints();f=0;for(y=n.length;f<y;f++)n[f].add(e)}this.lastPoint=b.p}else if(!0===this.rotate3D){y=l.max(this.width/4,this.height/4);f=(b.p.x-this.lastPoint.x)/y*this.rotationMultMod;y=-(b.p.y-this.lastPoint.y)/y*this.rotationMultMod;e=[];h.identity(e);h.rotate(e,y,[1,0,0]);h.rotate(e,f,[0,1,0]);a=0;for(d=this.molecules.length;a<d;a++){n=this.molecules[a];f=0;for(y=n.atoms.length;f<y;f++)a=n.atoms[f],d=[a.x-this.width/2,a.y-this.height/2,a.z],h.multiplyVec3(e,d),a.x=d[0]+this.width/2,a.y=d[1]+this.height/2,a.z=d[2];a=0;for(d=n.rings.length;a<d;a++)n.rings[a].center=n.rings[a].getCenter();this.lastPoint=b.p;this.specs.atoms_display&&this.specs.atoms_circles_2D&&n.sortAtomsByZ();this.specs.bonds_display&&this.specs.bonds_clearOverlaps_2D&&n.sortBondsByZ()}}else y=new o.Point(this.width/2,this.height/2),f=y.angle(this.lastPoint),y=y.angle(b.p),this.specs.rotateAngle-=y-f,this.lastPoint=b.p;this.repaint()}};b.mousewheel=function(b,e){this.specs.scale+=e/50;.01>this.specs.scale&&(this.specs.scale=.01);this.repaint()};b.multitouchmove=function(b,e){if(2===e)if(this.lastPoint.multi){var a=new o.Point(b.p.x,b.p.y);a.sub(this.lastPoint);for(var d=0,h=this.molecules.length;d<h;d++){for(var f=this.molecules[d],j=0,l=f.atoms.length;j<l;j++)f.atoms[j].add(a);f.check()}d=0;for(h=this.shapes.length;d<h;d++){f=this.shapes[d].getPoints();j=0;for(l=f.length;j<l;j++)f[j].add(a)}this.lastPoint=b.p;this.lastPoint.multi=!0;this.repaint()}else this.lastPoint=b.p,this.lastPoint.multi=!0};b.gesturechange=function(b){0!==b.originalEvent.scale-this.lastPinchScale&&(this.specs.scale*=b.originalEvent.scale/this.lastPinchScale,.01>this.specs.scale&&(this.specs.scale=.01),this.lastPinchScale=b.originalEvent.scale);if(0!==this.lastGestureRotate-b.originalEvent.rotation){for(var e=(this.lastGestureRotate-b.originalEvent.rotation)/180*l.PI,a=new o.Point(this.width/2,this.height/2),d=0,h=this.molecules.length;d<h;d++){for(var f=this.molecules[d],j=0,p=f.atoms.length;j<p;j++){var q=f.atoms[j],A=a.distance(q),r=a.angle(q)+e;q.x=a.x+A*l.cos(r);q.y=a.y-A*l.sin(r)}f.check()}this.lastGestureRotate=b.originalEvent.rotation}this.repaint()};b.gestureend=function(){this.lastPinchScale=1;this.lastGestureRotate=0}})(ChemDoodle,ChemDoodle.monitor,ChemDoodle.structures,Math,ChemDoodle.lib.mat4);(function(b){b.ViewerCanvas=function(b,o,l){b&&this.create(b,o,l)};b.ViewerCanvas.prototype=new b._Canvas})(ChemDoodle);(function(b){b._SpectrumCanvas=function(b,o,l){b&&this.create(b,o,l)};b=b._SpectrumCanvas.prototype=new b._Canvas;b.spectrum=void 0;b.emptyMessage="No Spectrum Loaded or Recognized";b.loadMolecule=void 0;b.getMolecule=void 0;b.innerRepaint=function(b){this.spectrum&&0<this.spectrum.data.length?this.spectrum.draw(b,this.specs,this.width,this.height):this.emptyMessage&&(b.fillStyle="#737683",b.textAlign="center",b.textBaseline="middle",b.font="18px Helvetica, Verdana, Arial, Sans-serif",b.fillText(this.emptyMessage,this.width/2,this.height/2))};b.loadSpectrum=function(b){this.spectrum=b;this.repaint()};b.getSpectrum=function(){return this.spectrum};b.getSpectrumCoordinates=function(b,o){return spectrum.getInternalCoordinates(b,o,this.width,this.height)}})(ChemDoodle,document);(function(b){b.ObserverCanvas=function(b,o,l){b&&this.create(b,o,l)};b.ObserverCanvas.prototype=new b._SpectrumCanvas})(ChemDoodle);(function(b){b.OverlayCanvas=function(b,o,l){b&&this.create(b,o,l)};b=b.OverlayCanvas.prototype=new b._SpectrumCanvas;b.overlaySpectra=[];b.superRepaint=b.innerRepaint;b.innerRepaint=function(b){this.superRepaint(b);if(this.spectrum&&0<this.spectrum.data.length)for(var o=0,l=this.overlaySpectra.length;o<l;o++){var h=this.overlaySpectra[o];h&&0<h.data.length&&(h.minX=this.spectrum.minX,h.maxX=this.spectrum.maxX,h.drawPlot(b,this.specs,this.width,this.height,this.spectrum.memory.offsetTop,this.spectrum.memory.offsetLeft,this.spectrum.memory.offsetBottom))}};b.addSpectrum=function(b){this.spectrum?this.overlaySpectra.push(b):this.spectrum=b}})(ChemDoodle);(function(b,j,o){b.PerspectiveCanvas=function(b,g,e){b&&this.create(b,g,e)};var l=b.PerspectiveCanvas.prototype=new b._SpectrumCanvas;l.dragRange=void 0;l.rescaleYAxisOnZoom=!0;l.lastPinchScale=1;l.mousedown=function(h){this.dragRange=new b.structures.Point(h.p.x,h.p.x)};l.mouseup=function(b){this.dragRange&&this.dragRange.x!==this.dragRange.y&&(this.dragRange.multi||(b=this.spectrum.zoom(this.dragRange.x,b.p.x,this.width,this.rescaleYAxisOnZoom),this.rescaleYAxisOnZoom&&(this.specs.scale=b)),this.dragRange=void 0,this.repaint())};l.drag=function(b){
this.dragRange&&(this.dragRange.multi?this.dragRange=void 0:(j.SHIFT&&(this.spectrum.translate(b.p.x-this.dragRange.x,this.width),this.dragRange.x=b.p.x),this.dragRange.y=b.p.x),this.repaint())};l.drawChildExtras=function(b){if(this.dragRange){var g=o.min(this.dragRange.x,this.dragRange.y),e=o.max(this.dragRange.x,this.dragRange.y);b.strokeStyle="gray";b.lineStyle=1;b.beginPath();for(b.moveTo(g,this.height/2);g<=e;g++)5>g%10?b.lineTo(g,o.round(this.height/2)):b.moveTo(g,o.round(this.height/2));b.stroke()}};l.mousewheel=function(b,g){this.specs.scale+=g/10;.01>this.specs.scale&&(this.specs.scale=.01);this.repaint()};l.dblclick=function(){this.spectrum.setup();this.specs.scale=1;this.repaint()};l.multitouchmove=function(h,g){2===g&&(!this.dragRange||!this.dragRange.multi?(this.dragRange=new b.structures.Point(h.p.x,h.p.x),this.dragRange.multi=!0):(this.spectrum.translate(h.p.x-this.dragRange.x,this.width),this.dragRange.x=h.p.x,this.dragRange.y=h.p.x,this.repaint()))};l.gesturechange=function(b){this.specs.scale*=b.originalEvent.scale/this.lastPinchScale;.01>this.specs.scale&&(this.specs.scale=.01);this.lastPinchScale=b.originalEvent.scale;this.repaint()};l.gestureend=function(){this.lastPinchScale=1}})(ChemDoodle,ChemDoodle.monitor,Math);(function(b,j,o){b.SeekerCanvas=function(b,g,e,a){b&&this.create(b,g,e);this.seekType=a};var l=b.SeekerCanvas.prototype=new b._SpectrumCanvas;l.superRepaint=l.innerRepaint;l.innerRepaint=function(h){this.superRepaint(h);if(this.spectrum&&0<this.spectrum.data.length&&this.p){var g,e;if(this.seekType===b.SeekerCanvas.SEEK_POINTER)g=this.p,e=this.spectrum.getInternalCoordinates(g.x,g.y);else if(this.seekType===b.SeekerCanvas.SEEK_PLOT||this.seekType===b.SeekerCanvas.SEEK_PEAK){e=this.seekType===b.SeekerCanvas.SEEK_PLOT?this.spectrum.getClosestPlotInternalCoordinates(this.p.x):this.spectrum.getClosestPeakInternalCoordinates(this.p.x);if(!e)return;g={x:this.spectrum.getTransformedX(e.x,this.specs,this.width,this.spectrum.memory.offsetLeft),y:this.spectrum.getTransformedY(e.y/100,this.specs,this.height,this.spectrum.memory.offsetBottom,this.spectrum.memory.offsetTop)}}h.fillStyle="white";h.strokeStyle=this.specs.plots_color;h.lineWidth=this.specs.plots_width;h.beginPath();h.arc(g.x,g.y,3,0,2*o.PI,!1);h.fill();h.stroke();h.font=j.getFontString(this.specs.text_font_size,this.specs.text_font_families);h.textAlign="left";h.textBaseline="bottom";e="x:"+e.x.toFixed(3)+", y:"+e.y.toFixed(3);var a=g.x+3,d=h.measureText(e).width;a+d>this.width-2&&(a-=6+d);g=g.y;0>g-this.specs.text_font_size-2&&(g+=this.specs.text_font_size);h.fillRect(a,g-this.specs.text_font_size,d,this.specs.text_font_size);h.fillStyle="black";h.fillText(e,a,g)}};l.mouseout=function(){this.p=void 0;this.repaint()};l.mousemove=function(b){this.p={x:b.p.x-2,y:b.p.y-3};this.repaint()};l.touchstart=function(b){this.mousemove(b)};l.touchmove=function(b){this.mousemove(b)};l.touchend=function(b){this.mouseout(b)};b.SeekerCanvas.SEEK_POINTER="pointer";b.SeekerCanvas.SEEK_PLOT="plot";b.SeekerCanvas.SEEK_PEAK="peak"})(ChemDoodle,ChemDoodle.extensions,Math);(function(b,j,o,l,h,g,e,a,d,n,f,y){b._Canvas3D=function(a,b,d){a&&this.create(a,b,d)};var p=b._Canvas3D.prototype=new b._Canvas;p.rotationMatrix=void 0;p.translationMatrix=void 0;p.lastPoint=void 0;p.emptyMessage="WebGL is Unavailable!";p.lastPinchScale=1;p.lastGestureRotate=0;p.afterLoadContent=function(){for(var a=new o.Bounds,b=0,g=this.molecules.length;b<g;b++)a.expand(this.molecules[b].getBounds3D());var h=f.dist([a.maxX,a.maxY,a.maxZ],[a.minX,a.minY,a.minZ])/2+1.5;Infinity===h&&(h=10);b=45;g=Math.tan(b/360*Math.PI)/.8;this.depth=h/g;var g=e.max(this.depth-h,.1),h=this.depth+h,j=this.gl.canvas.clientWidth/this.gl.canvas.clientHeight;1>j&&(b/=j);this.specs.projectionOrthoWidth_3D=2*(Math.tan(b/360*Math.PI)*this.depth)*j;this.specs.projectionPerspectiveVerticalFieldOfView_3D=b;this.specs.projectionFrontCulling_3D=g;this.specs.projectionBackCulling_3D=h;this.specs.projectionWidthHeightRatio_3D=j;this.translationMatrix=d.translate(d.identity([]),[0,0,-this.depth]);this.maxDimension=e.max(a.maxX-a.minX,a.maxY-a.minY);this.setupScene()};p.setViewDistance=function(a){this.specs.projectionPerspectiveVerticalFieldOfView_3D=o.clamp(this.specs.projectionPerspectiveVerticalFieldOfView_3D/a,.1,179.9);this.specs.projectionOrthoWidth_3D=2*(e.tan(this.specs.projectionPerspectiveVerticalFieldOfView_3D/360*Math.PI)*this.depth)*this.specs.projectionWidthHeightRatio_3D;this.updateScene()};p.repaint=function(){if(this.gl){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.modelViewMatrix=d.multiply(this.translationMatrix,this.rotationMatrix,[]);this.gl.rotationMatrix=this.rotationMatrix;var a=this.gl.getUniformLocation(this.gl.program,"u_projection_matrix");this.gl.uniformMatrix4fv(a,!1,this.gl.projectionMatrix);this.gl.fogging.setMode(this.specs.fog_mode_3D);for(var b=0,e=this.molecules.length;b<e;b++)this.molecules[b].render(this.gl,this.specs);b=0;for(e=this.shapes.length;b<e;b++)this.shapes[b].render(this.gl,this.specs);this.specs.compass_display&&(this.gl.uniformMatrix4fv(a,!1,this.compass.projectionMatrix),this.compass.render(this.gl,this.specs),this.gl.setMatrixUniforms(this.gl.modelViewMatrix),this.gl.uniformMatrix4fv(a,!1,this.gl.projectionMatrix));this.gl.enable(this.gl.BLEND);this.gl.depthMask(!1);this.gl.enableVertexAttribArray(this.gl.shader.vertexTexCoordAttribute);this.specs.atoms_displayLabels_3D&&this.label3D.render(this.gl,this.specs,this.getMolecules());this.specs.compass_display&&this.specs.compass_displayText_3D&&(this.gl.uniformMatrix4fv(a,!1,this.compass.projectionMatrix),this.compass.renderAxis(this.gl),this.gl.setMatrixUniforms(this.gl.modelViewMatrix),this.gl.uniformMatrix4fv(a,!1,this.gl.projectionMatrix));this.gl.disableVertexAttribArray(this.gl.shader.vertexTexCoordAttribute);this.gl.disable(this.gl.BLEND);this.gl.depthMask(!0);this.gl.disable(this.gl.DEPTH_TEST);this.drawChildExtras&&this.drawChildExtras(this.gl);this.gl.enable(this.gl.DEPTH_TEST);this.gl.flush()}};p.pick=function(a,b,e,f){if(this.gl){d.multiply(this.translationMatrix,this.rotationMatrix,this.gl.modelViewMatrix);this.gl.rotationMatrix=this.rotationMatrix;var g=this.gl.getUniformLocation(this.gl.program,"u_projection_matrix");this.gl.uniformMatrix4fv(g,!1,this.gl.projectionMatrix);b=this.height-b;1!==this.pixelRatio&&(a*=this.pixelRatio,b*=this.pixelRatio);return this.picker.pick(this.gl,this.molecules,this.specs,a,b,e,f)}};p.center=function(){for(var a=new l.Atom,b=0,d=this.molecules.length;b<d;b++){var e=this.molecules[b];a.add3D(e.getCenter3D())}a.x/=this.molecules.length;a.y/=this.molecules.length;b=0;for(d=this.molecules.length;b<d;b++){for(var e=this.molecules[b],f=0,g=e.atoms.length;f<g;f++)e.atoms[f].sub3D(a);if(e.chains&&e.fromJSON){f=0;for(g=e.chains.length;f<g;f++)for(var h=e.chains[f],j=0,n=h.length;j<n;j++){var c=h[j];c.cp1.sub3D(a);c.cp2.sub3D(a);c.cp3&&(c.cp3.sub3D(a),c.cp4.sub3D(a),c.cp5.sub3D(a))}}}};p.subCreate=function(){try{var b=a.getElementById(this.id);this.gl=b.getContext("webgl");this.gl||(this.gl=b.getContext("experimental-webgl"))}catch(e){}this.gl?(1!==this.pixelRatio&&this.gl.canvas.width===this.width&&(this.gl.canvas.style.width=this.width+"px",this.gl.canvas.style.height=this.height+"px",this.gl.canvas.width=this.width*this.pixelRatio,this.gl.canvas.height=this.height*this.pixelRatio),this.rotationMatrix=d.identity([]),this.translationMatrix=d.identity([]),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.program=this.gl.createProgram(),this.gl.shader=new h.Shader,this.gl.shader.init(this.gl),this.gl.programLabel=this.gl.createProgram(),this.setupScene()):this.displayMessage()};b._Canvas.prototype.displayMessage=function(){var b=a.getElementById(this.id);b.getContext&&(b=b.getContext("2d"),this.specs.backgroundColor&&(b.fillStyle=this.specs.backgroundColor,b.fillRect(0,0,this.width,this.height)),this.emptyMessage&&(b.fillStyle="#737683",b.textAlign="center",b.textBaseline="middle",b.font="18px Helvetica, Verdana, Arial, Sans-serif",b.fillText(this.emptyMessage,this.width/2,this.height/2)))};p.renderText=function(a,b){if(this.gl){var d={position:[],texCoord:[],translation:[]};this.gl.textImage.pushVertexData(a,b,0,d);this.gl.textMesh.storeData(this.gl,d.position,d.texCoord,d.translation);this.gl.enable(this.gl.BLEND);this.gl.depthMask(!1);this.gl.enableVertexAttribArray(this.gl.shader.vertexTexCoordAttribute);this.gl.textImage.useTexture(this.gl);this.gl.textMesh.render(this.gl);this.gl.disableVertexAttribArray(this.gl.shader.vertexTexCoordAttribute);this.gl.disable(this.gl.BLEND);this.gl.depthMask(!0)}};p.setupScene=function(){if(this.gl){y("#"+this.id).css("background-color",this.specs.backgroundColor);var a=o.getRGB(this.specs.backgroundColor,1);this.gl.clearColor(a[0],a[1],a[2],1);this.gl.clearDepth(1);this.gl.enable(this.gl.DEPTH_TEST);this.gl.depthFunc(this.gl.LEQUAL);this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA);this.specs.cullBackFace_3D?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE);this.gl.sphereBuffer=new h.Sphere(1,this.specs.atoms_resolution_3D,this.specs.atoms_resolution_3D);this.gl.starBuffer=new h.Star;this.gl.cylinderBuffer=new h.Cylinder(1,1,this.specs.bonds_resolution_3D);this.gl.cylinderClosedBuffer=new h.Cylinder(1,1,this.specs.bonds_resolution_3D,!0);this.gl.boxBuffer=new h.Box(1,1,1);this.gl.pillBuffer=new h.Pill(this.specs.bonds_pillDiameter_3D/2,this.specs.bonds_pillHeight_3D,this.specs.bonds_pillLatitudeResolution_3D,this.specs.bonds_pillLongitudeResolution_3D);this.gl.lineBuffer=new h.Line;this.gl.lineArrowBuffer=new h.LineArrow;this.gl.arrowBuffer=new h.Arrow(.3,this.specs.compass_resolution_3D);this.gl.textMesh=new h.TextMesh;this.gl.textMesh.init(this.gl);this.gl.textImage=new h.TextImage;this.gl.textImage.init(this.gl);this.gl.textImage.updateFont(this.gl,this.specs.text_font_size,this.specs.text_font_families,this.specs.text_font_bold,this.specs.text_font_italic,this.specs.text_font_stroke_3D);this.label3D=new h.Label;this.label3D.init(this.gl,this.specs);for(var p=0,r=this.molecules.length;p<r;p++)if(a=this.molecules[p],a.labelMesh instanceof h.TextMesh||(a.labelMesh=new h.TextMesh,a.labelMesh.init(this.gl)),a.chains){a.ribbons=[];a.cartoons=[];a.tubes=[];a.pipePlanks=[];for(var v=0,u=a.chains.length;v<u;v++){var t=a.chains[v],w=2<t.length&&g[t[2].name]&&"#BEA06E"===g[t[2].name].aminoColor;if(0<t.length&&!t[0].lineSegments){for(var x=0,B=t.length-1;x<B;x++)t[x].setup(t[x+1].cp1,w?1:this.specs.proteins_horizontalResolution);if(!w){x=1;for(B=t.length-1;x<B;x++)j.vec3AngleFrom(t[x-1].D,t[x].D)>e.PI/2&&(t[x].guidePointsSmall.reverse(),t[x].guidePointsLarge.reverse(),f.scale(t[x].D,-1))}x=2;for(B=t.length-3;x<B;x++)t[x].computeLineSegments(t[x-2],t[x-1],t[x+1],!w,w?this.specs.nucleics_verticalResolution:this.specs.proteins_verticalResolution);t.pop();t.pop();t.pop();t.shift();t.shift()}x=o.hsl2rgb(1===u?.5:v/u,1,.5);x="rgb("+x[0]+","+x[1]+","+x[2]+")";t.chainColor=x;w?(w=new h.Tube(t,this.specs.nucleics_tubeThickness,this.specs.nucleics_tubeResolution_3D),w.chainColor=x,a.tubes.push(w)):(w=new h.PipePlank(t,this.specs),a.pipePlanks.push(w),w=t.shift(),B={front:new h.Ribbon(t,this.specs.proteins_ribbonThickness,!1),back:new h.Ribbon(t,-this.specs.proteins_ribbonThickness,!1)},B.front.chainColor=x,B.back.chainColor=x,a.ribbons.push(B),B={front:new h.Ribbon(t,this.specs.proteins_ribbonThickness,!0),back:new h.Ribbon(t,-this.specs.proteins_ribbonThickness,!0)},B.front.chainColor=x,B.back.chainColor=x,a.cartoons.push(B),t.unshift(w))}}this.label3D.updateVerticesBuffer(this.gl,this.getMolecules(),this.specs);if(this instanceof b.MovieCanvas3D&&this.frames){x=0;for(B=this.frames.length;x<B;x++){p=this.frames[x];v=0;for(u=p.mols.length;v<u;v++)a=p.mols[v],a.labelMesh instanceof l.d3.TextMesh||(a.labelMesh=new l.d3.TextMesh,a.labelMesh.init(this.gl));this.label3D.updateVerticesBuffer(this.gl,p.mols,this.specs)}}this.gl.lighting=new h.Light(this.specs.lightDiffuseColor_3D,this.specs.lightSpecularColor_3D,this.specs.lightDirection_3D);this.gl.lighting.lightScene(this.gl);this.gl.material=new h.Material(this.gl);this.gl.fogging=new h.Fog(this.gl);this.gl.fogging.setTempParameter(this.specs.fog_color_3D||this.specs.backgroundColor,this.specs.fog_start_3D,this.specs.fog_end_3D,this.specs.fog_density_3D);this.compass=new h.Compass(this.gl,this.specs);a=this.width/this.height;this.specs.projectionWidthHeightRatio_3D&&(a=this.specs.projectionWidthHeightRatio_3D);this.gl.projectionMatrix=this.specs.projectionPerspective_3D?d.perspective(this.specs.projectionPerspectiveVerticalFieldOfView_3D,a,this.specs.projectionFrontCulling_3D,this.specs.projectionBackCulling_3D):d.ortho(-this.specs.projectionOrthoWidth_3D/2,this.specs.projectionOrthoWidth_3D/2,-this.specs.projectionOrthoWidth_3D/2/a,this.specs.projectionOrthoWidth_3D/2/a,this.specs.projectionFrontCulling_3D,this.specs.projectionBackCulling_3D);a=this.gl.getUniformLocation(this.gl.program,"u_projection_matrix");this.gl.uniformMatrix4fv(a,!1,this.gl.projectionMatrix);var c=this.gl.getUniformLocation(this.gl.program,"u_model_view_matrix"),k=this.gl.getUniformLocation(this.gl.program,"u_normal_matrix");this.gl.setMatrixUniforms=function(a){this.uniformMatrix4fv(c,!1,a);a=n.transpose(d.toInverseMat3(a,[]));this.uniformMatrix3fv(k,!1,a)};v=this.gl.getUniformLocation(this.gl.program,"u_dimension");this.gl.uniformMatrix4fv(a,!1,this.gl.projectionMatrix);this.gl.uniform2f(v,this.gl.canvas.clientWidth,this.gl.canvas.clientHeight);this.picker=new h.Picker;this.picker.init(this.gl);this.picker.setDimension(this.gl,this.gl.canvas.width,this.gl.canvas.height)}};p.updateScene=function(){this.gl.fogging.setTempParameter(this.specs.fog_color_3D||this.specs.backgroundColor,this.specs.fog_start_3D,this.specs.fog_end_3D,this.specs.fog_density_3D);var a=this.width/this.height;this.specs.projectionWidthHeightRatio_3D&&(a=this.specs.projectionWidthHeightRatio_3D);this.gl.projectionMatrix=this.specs.projectionPerspective_3D?d.perspective(this.specs.projectionPerspectiveVerticalFieldOfView_3D,a,this.specs.projectionFrontCulling_3D,this.specs.projectionBackCulling_3D):d.ortho(-this.specs.projectionOrthoWidth_3D/2,this.specs.projectionOrthoWidth_3D/2,-this.specs.projectionOrthoWidth_3D/2/a,this.specs.projectionOrthoWidth_3D/2/a,this.specs.projectionFrontCulling_3D,this.specs.projectionBackCulling_3D);this.repaint()};p.mousedown=function(a){this.lastPoint=a.p};p.mouseup=function(){this.lastPoint=void 0};p.rightmousedown=function(a){this.lastPoint=a.p};p.drag=function(a){if(this.lastPoint){if(b.monitor.ALT){var f=new l.Point(a.p.x,a.p.y);f.sub(this.lastPoint);var g=e.tan(this.specs.projectionPerspectiveVerticalFieldOfView_3D/360*e.PI),g=this.depth/(this.height/2/g);d.translate(this.translationMatrix,[f.x*g,-f.y*g,0])}else g=a.p.x-this.lastPoint.x,f=a.p.y-this.lastPoint.y,g=d.rotate(d.identity([]),g*e.PI/180,[0,1,0]),d.rotate(g,f*e.PI/180,[1,0,0]),this.rotationMatrix=d.multiply(g,this.rotationMatrix);this.lastPoint=a.p;this.repaint()}};p.mousewheel=function(a,b){var d=this.specs.projectionPerspectiveVerticalFieldOfView_3D+b;this.specs.projectionPerspectiveVerticalFieldOfView_3D=.1>d?.1:179.9<d?179.9:d;this.specs.projectionOrthoWidth_3D=2*(Math.tan(this.specs.projectionPerspectiveVerticalFieldOfView_3D/360*Math.PI)*this.depth)*this.specs.projectionWidthHeightRatio_3D;this.updateScene()};p.multitouchmove=function(a,b){if(2===b)if(this.lastPoint&&this.lastPoint.multi){var f=new l.Point(a.p.x,a.p.y);f.sub(this.lastPoint);var g=e.tan(this.specs.projectionPerspectiveVerticalFieldOfView_3D/360*e.PI),g=this.depth/(this.height/2/g);d.translate(this.translationMatrix,[f.x*g,-f.y*g,0]);this.lastPoint=a.p;this.repaint()}else this.lastPoint=a.p,this.lastPoint.multi=!0};p.gesturechange=function(a){if(0!==a.originalEvent.scale-this.lastPinchScale){var b=30*-(a.originalEvent.scale/this.lastPinchScale-1);if(isNaN(b))return;b=this.specs.projectionPerspectiveVerticalFieldOfView_3D+b;this.specs.projectionPerspectiveVerticalFieldOfView_3D=.1>b?.1:179.9<b?179.9:b;this.specs.projectionOrthoWidth_3D=2*(Math.tan(this.specs.projectionPerspectiveVerticalFieldOfView_3D/360*Math.PI)*this.depth)*this.specs.projectionWidthHeightRatio_3D;this.updateScene();this.lastPinchScale=a.originalEvent.scale}this.repaint()};p.gestureend=function(){this.lastPinchScale=1;this.lastGestureRotate=0}})(ChemDoodle,ChemDoodle.extensions,ChemDoodle.math,ChemDoodle.structures,ChemDoodle.structures.d3,ChemDoodle.RESIDUE,Math,document,ChemDoodle.lib.mat4,ChemDoodle.lib.mat3,ChemDoodle.lib.vec3,ChemDoodle.lib.jQuery,window);(function(b,j,o,l){b.MolGrabberCanvas3D=function(b,g,e){b&&this.create(b,g,e);g=[];g.push('<br><input type="text" id="');g.push(b);g.push('_query" size="32" value="" />');g.push("<br><nobr>");g.push('<select id="');g.push(b);g.push('_select">');g.push('<option value="pubchem" selected>PubChem');g.push("</select>");g.push('<button id="');g.push(b);g.push('_submit">Show Molecule</button>');g.push("</nobr>");l.writeln(g.join(""));var a=this;o("#"+b+"_submit").click(function(){a.search()});o("#"+b+"_query").keypress(function(b){13===b.which&&a.search()})};b=b.MolGrabberCanvas3D.prototype=new b._Canvas3D;b.setSearchTerm=function(b){o("#"+this.id+"_query").val(b);this.search()};b.search=function(){var b=this;j.getMoleculeFromDatabase(o("#"+this.id+"_query").val(),{database:o("#"+this.id+"_select").val(),dimension:3},function(g){b.loadMolecule(g)})}})(ChemDoodle,ChemDoodle.iChemLabs,ChemDoodle.lib.jQuery,document);(function(b,j){b.MovieCanvas3D=function(b,h,g){b&&this.create(b,h,g);this.frames=[]};b.MovieCanvas3D.PLAY_ONCE=0;b.MovieCanvas3D.PLAY_LOOP=1;b.MovieCanvas3D.PLAY_SPRING=2;var o=b.MovieCanvas3D.prototype=new b._Canvas3D;o.timeout=50;o.frameNumber=0;o.playMode=2;o.reverse=!1;o.startAnimation=b._AnimatorCanvas.prototype.startAnimation;o.stopAnimation=b._AnimatorCanvas.prototype.stopAnimation;o.isRunning=b._AnimatorCanvas.prototype.isRunning;o.dblclick=b.RotatorCanvas.prototype.dblclick;o.nextFrame=function(){var b=this.frames[this.frameNumber];this.molecules=b.mols;this.shapes=b.shapes;2===this.playMode&&this.reverse?(this.frameNumber--,0>this.frameNumber&&(this.frameNumber=1,this.reverse=!1)):(this.frameNumber++,this.frameNumber>=this.frames.length&&(2===this.playMode?(this.frameNumber-=2,this.reverse=!0):(this.frameNumber=0,0===this.playMode&&this.stopAnimation())))};o.center=function(){for(var b=new j.Atom,h=this.frames[0],g=0,e=h.mols.length;g<e;g++)b.add3D(h.mols[g].getCenter3D());b.x/=h.mols.length;b.y/=h.mols.length;h=new j.Atom;h.sub3D(b);for(var b=0,a=this.frames.length;b<a;b++)for(var d=this.frames[b],g=0,e=d.mols.length;g<e;g++)for(var n=d.mols[g],f=0,o=n.atoms.length;f<o;f++)n.atoms[f].add3D(h)};o.addFrame=function(b,h){this.frames.push({mols:b,shapes:h})}})(ChemDoodle,ChemDoodle.structures);(function(b,j,o){var l=[],h=[1,0,0],g=[0,1,0],e=[0,0,1];b.RotatorCanvas3D=function(a,b,e){a&&this.create(a,b,e)};var a=b.RotatorCanvas3D.prototype=new b._Canvas3D;a.timeout=33;j=j.PI/15;a.xIncrement=j;a.yIncrement=j;a.zIncrement=j;a.startAnimation=b._AnimatorCanvas.prototype.startAnimation;a.stopAnimation=b._AnimatorCanvas.prototype.stopAnimation;a.isRunning=b._AnimatorCanvas.prototype.isRunning;a.dblclick=b.RotatorCanvas.prototype.dblclick;a.mousedown=void 0;a.rightmousedown=void 0;a.drag=void 0;a.mousewheel=void 0;a.nextFrame=function(a){0===this.molecules.length&&0===this.shapes.length?this.stopAnimation():(o.identity(l),a/=1e3,o.rotate(l,this.xIncrement*a,h),o.rotate(l,this.yIncrement*a,g),o.rotate(l,this.zIncrement*a,e),o.multiply(this.rotationMatrix,l))}})(ChemDoodle,Math,ChemDoodle.lib.mat4);(function(b){b.TransformCanvas3D=function(b,o,l){b&&this.create(b,o,l)};b.TransformCanvas3D.prototype=new b._Canvas3D})(ChemDoodle);(function(b){b.ViewerCanvas3D=function(b,o,l){b&&this.create(b,o,l)};b=b.ViewerCanvas3D.prototype=new b._Canvas3D;b.mousedown=void 0;b.rightmousedown=void 0;b.drag=void 0;b.mousewheel=void 0})(ChemDoodle);(function(b,j,o){function l(b,e,a,d){this.element=b;this.x=e;this.y=a;this.dimension=d;this.allowMultipleSelections=!1}b.PeriodicTableCanvas=function(b,e){this.padding=5;b&&this.create(b,18*e+2*this.padding,10*e+2*this.padding);this.cellDimension=e?e:20;this.setupTable();this.repaint()};var h=b.PeriodicTableCanvas.prototype=new b._Canvas;h.loadMolecule=void 0;h.getMolecule=void 0;h.getHoveredElement=function(){if(this.hovered)return this.hovered.element};h.innerRepaint=function(b){for(var e=0,a=this.cells.length;e<a;e++)this.drawCell(b,this.specs,this.cells[e]);this.hovered&&this.drawCell(b,this.specs,this.hovered);this.selected&&this.drawCell(b,this.specs,this.selected)};h.setupTable=function(){this.cells=[];for(var g=this.padding,e=this.padding,a=0,d=0,h=b.SYMBOLS.length;d<h;d++){18===a&&(a=0,e+=this.cellDimension,g=this.padding);var f=b.ELEMENT[b.SYMBOLS[d]];if(2===f.atomicNumber)g+=16*this.cellDimension,a+=16;else if(5===f.atomicNumber||13===f.atomicNumber)g+=10*this.cellDimension,a+=10;if((58>f.atomicNumber||71<f.atomicNumber&&90>f.atomicNumber||103<f.atomicNumber)&&113>f.atomicNumber)this.cells.push(new l(f,g,e,this.cellDimension)),g+=this.cellDimension,a++}e+=2*this.cellDimension;g=3*this.cellDimension+this.padding;for(d=57;104>d;d++)if(f=b.ELEMENT[b.SYMBOLS[d]],90===f.atomicNumber&&(e+=this.cellDimension,g=3*this.cellDimension+this.padding),58<=f.atomicNumber&&71>=f.atomicNumber||90<=f.atomicNumber&&103>=f.atomicNumber)this.cells.push(new l(f,g,e,this.cellDimension)),g+=this.cellDimension};h.drawCell=function(b,e,a){var d=b.createRadialGradient(a.x+a.dimension/3,a.y+a.dimension/3,1.5*a.dimension,a.x+a.dimension/3,a.y+a.dimension/3,a.dimension/10);d.addColorStop(0,"#000000");d.addColorStop(.7,a.element.jmolColor);d.addColorStop(1,"#FFFFFF");b.fillStyle=d;j.contextRoundRect(b,a.x,a.y,a.dimension,a.dimension,a.dimension/8);if(a===this.hovered||a===this.selected||a.selected)b.lineWidth=2,b.strokeStyle="#c10000",b.stroke(),b.fillStyle="white";b.fill();b.font=j.getFontString(e.text_font_size,e.text_font_families);b.fillStyle=e.text_color;b.textAlign="center";b.textBaseline="middle";b.fillText(a.element.symbol,a.x+a.dimension/2,a.y+a.dimension/2)};h.click=function(){this.hovered&&(this.allowMultipleSelections?this.hovered.selected=!this.hovered.selected:this.selected=this.hovered,this.repaint())};h.touchstart=function(b){this.mousemove(b)};h.mousemove=function(b){var e=b.p.x;b=b.p.y;this.hovered=void 0;for(var a=0,d=this.cells.length;a<d;a++){var h=this.cells[a];if(o.isBetween(e,h.x,h.x+h.dimension)&&o.isBetween(b,h.y,h.y+h.dimension)){this.hovered=h;break}}this.repaint()};h.mouseout=function(){this.hovered=void 0;this.repaint()}})(ChemDoodle,ChemDoodle.extensions,ChemDoodle.math,document);(function(b,j,o){b.png={};b.png.create=function(b){o.open(j.getElementById(b.id).toDataURL("image/png"))}})(ChemDoodle.io,document,window);(function(b,j){b.file={};b.file.content=function(b,l){j.get(b,"",l)}})(ChemDoodle.io,ChemDoodle.lib.jQuery);(function(b,j,o,l,h,g){j.SERVER_URL="http://ichemlabs.cloud.chemdoodle.com/icl_cdc_v070000/WebHQ";j.inRelay=!1;j.asynchronous=!0;j.INFO={userAgent:navigator.userAgent,v_cwc:b.getVersion(),v_jQuery:h.version,v_jQuery_ui:h.ui?h.ui.version:"N/A"};var e=new o.JSONInterpreter,a=new l.Queue;j.useHTTPS=function(){j.SERVER_URL="https"+j.SERVER_URL.substr(4)};j._contactServer=function(b,e,f,g,l){this.inRelay?a.enqueue({call:b,content:e,options:f,callback:g,errorback:l}):(j.inRelay=!0,h.ajax({dataType:"text",type:"POST",data:JSON.stringify({call:b,content:e,options:f,info:j.INFO}),url:this.SERVER_URL,success:function(b){b=JSON.parse(b);b.message&&alert(b.message);j.inRelay=!1;g&&(b.content&&!b.stop)&&g(b.content);b.stop&&l&&l();a.isEmpty()||(b=a.dequeue(),j.contactServer(b.call,b.content,b.options,b.callback,b.errorback))},error:function(){"checkForUpdates"!=b&&alert("Call failed. Please try again. If you continue to see this message, please contact iChemLabs customer support.");j.inRelay=!1;l&&l();if(!a.isEmpty()){var e=a.dequeue();j.contactServer(e.call,e.content,e.options,e.callback,e.errorback)}},xhrFields:{withCredentials:!0},async:j.asynchronous}))};j.authenticate=function(a,b,e,g){this._contactServer("authenticate",{credential:a},b,function(a){e(a)},g)};j.calculate=function(a,b,f,g){this._contactServer("calculate",{mol:e.molTo(a)},b,function(a){f(a)},g)};j.createLewisDotStructure=function(a,b,f,g){this._contactServer("createLewisDot",{mol:e.molTo(a)},b,function(a){f(e.molFrom(a.mol))},g)};j.generateImage=function(a,b,f,g){this._contactServer("generateImage",{mol:e.molTo(a)},b,function(a){f(a.link)},g)};j.generateIUPACName=function(a,b,f,g){this._contactServer("generateIUPACName",{mol:e.molTo(a)},b,function(a){f(a.iupac)},g)};j.getAd=function(a,b){this._contactServer("getAd",{},{},function(b){a(b.image_url,b.target_url)},b)};j.getMoleculeFromContent=function(a,b,f,g){this._contactServer("getMoleculeFromContent",{content:a},b,function(a){for(var b=!1,d=0,g=a.mol.a.length;d<g;d++)if(0!==a.mol.a[d].z){b=!0;break}if(b){d=0;for(g=a.mol.a.length;d<g;d++)a.mol.a[d].x/=20,a.mol.a[d].y/=20,a.mol.a[d].z/=20}f(e.molFrom(a.mol))},g)};j.getMoleculeFromDatabase=function(a,b,f,g){this._contactServer("getMoleculeFromDatabase",{query:a},b,function(a){if(3===b.dimension)for(var d=0,g=a.mol.a.length;d<g;d++)a.mol.a[d].x/=20,a.mol.a[d].y/=-20,a.mol.a[d].z/=20;f(e.molFrom(a.mol))},g)};j.getOptimizedPDBStructure=function(a,b,f,g){this._contactServer("getOptimizedPDBStructure",{id:a},b,function(a){var b;b=a.mol?e.molFrom(a.mol):new l.Molecule;b.chains=e.chainsFrom(a.ribbons);b.fromJSON=!0;f(b)},g)};j.getZeoliteFromIZA=function(a,b,e,g){this._contactServer("getZeoliteFromIZA",{query:a},b,function(a){e(ChemDoodle.readCIF(a.cif,b.xSuper,b.ySuper,b.zSuper))},g)};j.isGraphIsomorphism=function(a,b,f,g,h){this._contactServer("isGraphIsomorphism",{arrow:e.molTo(a),target:e.molTo(b)},f,function(a){g(a.value)},h)};j.isSubgraphIsomorphism=function(a,b,f,g,h){this._contactServer("isSubgraphIsomorphism",{arrow:e.molTo(a),target:e.molTo(b)},f,function(a){g(a.value)},h)};j.isSupergraphIsomorphism=function(a,b,f,g,h){this._contactServer("isSupergraphIsomorphism",{arrow:e.molTo(a),target:e.molTo(b)},f,function(a){g(a.value)},h)};j.getSimilarityMeasure=function(a,b,f,g,h){this._contactServer("getSimilarityMeasure",{first:e.molTo(a),second:e.molTo(b)},f,function(a){g(a.value)},h)};j.kekulize=function(a,b,f,g){this._contactServer("kekulize",{mol:e.molTo(a)},b,function(a){f(e.molFrom(a.mol))},g)};j.optimize=function(a,b,f,g){this._contactServer("optimize",{mol:e.molTo(a)},b,function(g){g=e.molFrom(g.mol);if(2===b.dimension){for(var h=0,j=g.atoms.length;h<j;h++)a.atoms[h].x=g.atoms[h].x,a.atoms[h].y=g.atoms[h].y;f()}else if(3===b.dimension){h=0;for(j=g.atoms.length;h<j;h++)g.atoms[h].x/=20,g.atoms[h].y/=-20,g.atoms[h].z/=20;f(g)}},g)};j.readIUPACName=function(a,b,f,g){this._contactServer("readIUPACName",{iupac:a},b,function(a){f(e.molFrom(a.mol))},g)};j.readSMILES=function(a,b,f,g){this._contactServer("readSMILES",{smiles:a},b,function(a){f(e.molFrom(a.mol))},g)};j.saveFile=function(a,b,f,g){this._contactServer("saveFile",{mol:e.molTo(a)},b,function(a){f(a.link)},g)};j.simulate13CNMR=function(a,g,f,h){g.nucleus="C";g.isotope=13;this._contactServer("simulateNMR",{mol:e.molTo(a)},g,function(a){f(b.readJCAMP(a.jcamp))},h)};j.simulate1HNMR=function(a,g,f,h){g.nucleus="H";g.isotope=1;this._contactServer("simulateNMR",{mol:e.molTo(a)},g,function(a){f(b.readJCAMP(a.jcamp))},h)};j.simulateMassParentPeak=function(a,g,f,h){this._contactServer("simulateMassParentPeak",{mol:e.molTo(a)},g,function(a){f(b.readJCAMP(a.jcamp))},h)};j.writeSMILES=function(a,b,f,g){this._contactServer("writeSMILES",{mol:e.molTo(a)},b,function(a){f(a.smiles)},g)};j.version=function(a,b,e){this._contactServer("version",{},a,function(a){b(a.value)},e)};j.checkForUpdates=function(a){this._contactServer("checkForUpdates",{value:g.href},a,function(){},function(){})}})(ChemDoodle,ChemDoodle.iChemLabs,ChemDoodle.io,ChemDoodle.structures,ChemDoodle.lib.jQuery,location);var Utils={characters:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",number:{sign:function(x){return x?x<0?-1:1:0}},formatNumber:function(position){return position.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},formatText:function(text,spaceChar){text=text.replace(new RegExp(spaceChar,"gi")," ");text=text.charAt(0).toUpperCase()+text.slice(1);return text},titleCase:function(str){return str.charAt(0).toUpperCase()+str.slice(1)},camelCase:function(str){return str.toLowerCase().replace(/[.-_\s](.)/g,function(match,group1){return group1.toUpperCase()})},camelToSpace:function(str){var result=str.replace(/([A-Z])/g," $1").toLowerCase().trim();return result.charAt(0).toUpperCase()+result.slice(1)},closest:function(element,selector){while(element){if(element.matches(selector)){break}element=element.parentElement}return element},isFunction:function(s){return typeof s==="function"||s instanceof Function},parseDate:function(strDate){return strDate.substring(0,4)+"-"+strDate.substring(4,6)+"-"+strDate.substring(6,8)+" "+strDate.substring(8,10)+":"+strDate.substring(10,12)+":"+strDate.substring(12,14)},genId:function(prefix){prefix=prefix||"";prefix=prefix.length==0?prefix:prefix+"-";return prefix+this.randomString()},randomString:function(length){length=length||10;var str="";for(var i=0;i<length;i++){str+=this.characters.charAt(this.getRandomInt(0,this.characters.length-1))}return str},getRandomInt:function(min,max){return Math.floor(Math.random()*(max-min+1))+min},endsWithIgnoreCase:function(str,test){var regex=new RegExp("^.*\\.("+test+")$","i");return regex.test(str)},endsWith:function(str,test){return str.length>=test.length&&str.substr(str.length-test.length)==test},addQueryParamtersToUrl:function(paramsWS,url){var chr="?";if(url.indexOf("?")!=-1){chr="&"}var query=Utils.queryString(paramsWS);if(query!="")query=chr+query;return url+query},queryString:function(obj){var items=[];for(var key in obj){if(obj[key]!=null&&obj[key]!=undefined){items.push(key+"="+obj[key])}}return items.join("&")},randomColor:function(){var color="";for(var i=0;i<6;i++){color+=[0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f"][Math.floor(Math.random()*16)]}return"#"+color},colorLuminance:function(hex,lum){hex=String(hex).replace(/[^0-9a-f]/gi,"");hex=String(hex).replace(/#/gi,"");if(hex.length<6){hex=hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2]}lum=lum||0;var rgb="#",c,i;for(i=0;i<3;i++){c=parseInt(hex.substr(i*2,2),16);c=Math.round(Math.min(Math.max(0,c+c*lum),255)).toString(16);rgb+=("00"+c).substr(c.length)}return rgb},getSpeciesFromAvailable:function(availableSpecies,speciesCode){for(var phylos in availableSpecies){for(var i=0;i<availableSpecies[phylos].length;i++){var species=availableSpecies[phylos][i];if(species.id===speciesCode||species.scientificName.toLowerCase()===speciesCode.toLowerCase()){return species}}}},getSpeciesCode:function(speciesName){var pair=speciesName.split(" ");var code;if(pair.length<3){code=(pair[0].charAt(0)+pair[1]).toLowerCase()}else{code=(pair[0].charAt(0)+pair[1]+pair[pair.length-1].replace(/[\/_().\-]/g,"")).toLowerCase()}return code},basicValidationForm:function(scope){var validated=true;var msg="";if(scope.$.outdir.selectedFile===undefined||scope.$.outdir.selectedFile.type!="FOLDER"){msg+="Error: Please select an output folder.\n";validated=false}if(scope.$.inputFile.selectedFile===undefined||scope.$.inputFile.selectedFile.type!="FILE"){msg+="Error: Please select an input file.\n";validated=false}if(scope.$.jobName.value==""){msg+="Error: Please add a job name.\n";validated=false}if(!validated){alert(msg)}return validated},getUrl:function(fileId){return OpencgaManager.files.download({id:fileId,query:{sid:Cookies("bioinfo_sid")},request:{url:true}})},getFileContent:function(callback,fileId){OpencgaManager.files.content({id:fileId,query:{sid:Cookies("bioinfo_sid")},
request:{success:function(response){callback(response)},error:function(){this.message="Server error, try again later."}}})},loadExampleFile:function(callback,toolName,exampleFileName){var me=this;OpencgaManager.files.contentExample({query:{toolName:toolName,fileName:exampleFileName},request:{success:function(response){callback(response)},error:function(){alert("Server error, try again later.")}}})},downloadExampleFile:function(toolName,fileName){var url=OpencgaManager.files.downloadExample({query:{toolName:toolName,fileName:fileName},request:{url:true}});var link=document.createElement("a");link.href=url;var event=new MouseEvent("click",{view:window,bubbles:true,cancelable:true});link.dispatchEvent(event)},argsParser:function(form,args){if(form.toolName==args.tool){for(var key in args){if(typeof args[key]=="object"){if(form.$[key]!==undefined)form.$[key].selectedFile=args[key]}else{var elems=form.shadowRoot.querySelectorAll('input[name="'+key+'"]');if(form.$[key]!==undefined){switch(form.$[key].type){case"checkbox":form.$[key].checked=args[key];default:form.$[key].value=args[key]}}for(var i=0;i<elems.length;i++){var elem=elems[i];if(elem.value==args[key])elem.checked=true}}}}},getLinks:function(terms){var links=[];for(var i=0;i<terms.length;i++){var term=terms[i];links.push(Utils.getLink(term))}return links},getLink:function(term){var link="http://www.ebi.ac.uk/QuickGO/GTerm?id=";if(term.indexOf("(")>=0){var id=term.split("(");if(id.length>1)id=id[1];id=id.split(")")[0]}else id=term;if(id.indexOf("IPR")==0)link="http://www.ebi.ac.uk/interpro/entry/";link=link+id;return link},myRound:function(value,decimals){decimals=typeof decimals!=="undefined"?decimals:2;value=parseFloat(value);if(Math.abs(value)>=1)value=value.toFixed(decimals);else value=value.toPrecision(decimals);value=parseFloat(value);return value},formatNumber:function(value,decimals){value=Utils.myRound(value,decimals);if(Math.abs(value)>0&&Math.abs(value)<.001)value=value.toExponential();return value},getSpecies:function(specieValue,species){for(var i=0;i<species.length;i++){var specie=species[i];if(specie.value==specieValue){return specie}}return null},test:function(){return this},cancelFullscreen:function(){if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}},launchFullScreen:function(element){if(element.requestFullScreen){element.requestFullScreen()}else if(element.mozRequestFullScreen){element.mozRequestFullScreen()}else if(element.webkitRequestFullScreen){element.webkitRequestFullScreen()}},parseJobCommand:function(item){var commandObject={};var commandArray=item.commandLine.split(/ -{1,2}/g);var tableHtml='<table cellspacing="0" style="max-width:400px;border-collapse: collapse;border:1px solid #ccc;"><tbody>';tableHtml+='<tr style="border-collapse: collapse;border:1px solid #ccc;font-weight:bold;">';tableHtml+='<td style="min-width:50px;border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">Parameter</td>';tableHtml+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">Value</td>';tableHtml+="</tr>";for(var i=1;i<commandArray.length;i++){var paramenter=commandArray[i];var paramenterArray=paramenter.split(/ {1}/g);var name="";var value="";if(paramenterArray.length<2){name=paramenterArray[0];value="<span color:darkgray;font-weight:bold;>This paramenter is a flag</span>"}else{name=paramenterArray[0];value=paramenterArray[1]}commandObject[name]=value;value=value.replace(/\/httpd\/bioinfo\/opencga\/analysis\/.+\/examples\//,"");value=value.replace("/httpd/bioinfo/opencga/accounts/","");value=value.replace(/,/g,", ");tableHtml+='<tr style="border-collapse: collapse;border:1px solid #ccc;">';tableHtml+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;color:steelblue;font-weight:bold;white-space: nowrap;">'+name+"</td>";tableHtml+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">'+value+"</td>";tableHtml+="</tr>"}tableHtml+="</tbody></table>";return{html:tableHtml,data:commandObject}},htmlTable:function(object){var tableHtml="";tableHtml+='<table cellspacing="0" style="border-collapse: collapse;border:1px solid #ccc;"><tbody>';for(var key in object){tableHtml+='<tr style="border-collapse: collapse;border:1px solid #ccc;">';tableHtml+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;color:steelblue;font-weight:bold;white-space: nowrap;">'+key+"</td>";tableHtml+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">'+object[key]+"</td>";tableHtml+="</tr>"}tableHtml+="</tbody></table>";return tableHtml},msg:function(title,msg){var div=document.createElement("div");div.classList.add("jso-msg-hidden");var titleDiv=document.createElement("div");titleDiv.textContent=title;var msgDiv=document.createElement("div");msgDiv.textContent=msg;div.appendChild(titleDiv);div.appendChild(msgDiv);document.body.appendChild(div);setTimeout(function(){div.classList.add("jso-msg-shown")},10);setTimeout(function(){div.classList.remove("jso-msg-shown")},2e3);setTimeout(function(){document.body.removeChild(div);div=null},2200)},repeat:function(string,count){if(string==null){throw new TypeError("can't convert "+string+" to object")}var str=""+string;count=+count;if(count!=count){count=0}if(count<0){throw new RangeError("repeat count must be non-negative")}if(count==Infinity){throw new RangeError("repeat count must be less than infinity")}count=Math.floor(count);if(str.length==0||count==0){return""}if(str.length*count>=1<<28){throw new RangeError("repeat count must not overflow maximum string size")}var rpt="";for(;;){if((count&1)==1){rpt+=str}count>>>=1;if(count==0){break}str+=str}return rpt},clone:function(obj){return JSON.parse(JSON.stringify(obj))},deleteIndexedDB:function(){window.indexedDB.webkitGetDatabaseNames().onsuccess=function(sender,args){var r=sender.target.result;for(var i in r){indexedDB.deleteDatabase(r[i])}}}};Utils.images={add:"data:image/gif;base64,R0lGODlhEAAQAIcAAD2GNUKNNkOPOESMO0WNPEmPP0iNQUmPQlOVTFWWTVCZQVeeRV6cVmGeWGSgVWSgV2aiWGejW2WrVWirU2uqWGqsW2yqWm61WG+1WG+1WXS3W3S3XHC4WXK5W3O6XHG+X3asZ3iuaHe8YHi0ZH+yany6ZH28Zn2+Z3m9bn25an25a3+5bUD/QHDBY3nBZHrGa3zDa37BaX7Hb4K1boO1boa3cYi4d4y7doq5eYm+eI2+e5O/f4HMdYbJeobJfIXNeYrCeY/CfYnIf4rPfZW/gozLgY7MhI7Sg5LFgJXAgpfHhZfMhZPNiJjLhpjMh5jMipvBl5vBmJTTipbTiZXUipbUi5fVi5nRi53YkqTOlKbPlqbQlqDZlaDZlqXbm6rUnavUnKbIoKfJoa/fpa/fprPZpbTZpbTaprLbqLPdqbXbqLfaqrTdqrXfrLbdrLjVr7jdr7vcr7rWsbfgr77itr3ktsTcuMXducXowMvmw87pydTrz9fu0tzx2ODy3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAACwALAAAAAAQABAAAAi/AFkIHEiwoME7SWrMwCHH4MAdWfLs0QNnRQiHN+L4qeOlyxg8QCAU3LGmDxYmRqpQOTJHRYSBdpTw4SJFyJ8/P2DIaLNAjEAibsgU8YHiZgURHq4gaSCQBh0rPW5K/cMhxpcCAkmkGcJj6k0OJ8AMEGjjyZQXLSR85dBhiY4EAt9MYOPig4ivFzacEQBlIIgUaJByyIBBQxkLBwo6GKHGiYkSTcxQAODwgYIgW7TkCGDAocAwDAoQQBDFs2mCAQEAOw==",del:"data:image/gif;base64,R0lGODlhEAAQAIcAAED/QLpSNL9TOr5WOb5cQL9cQMFNM8RQNMBVPcBZP8xSPNBPPttWS9ddUcJnTMRkTMdrVM1gUc5iVMxmVclrVs1oWNZgVNZuZNtpZdxraN5ratxuadRxZd14c955dOZWTOZYTOZZTulZTelbT+ZWUOZaUuddWepcUOxfVOBlXO5mUuljW+pmXO5qXvBkVvNzXeNrYeNuY+FvcOJwZuJ7deR4ceJ5eeN4eeJ/feN/fOl7cOh6del/ePJ3Y/N5Y+qDfe6Efe+Gfu6KdfaCaPaEbPCFcPCDe/CMd/GOeviGcPiMdvCRf/eRfveTfvmSfvqTf/iUf9ymltynl+6Mge2Tju6Sj/SOgfqah/qdi/GclvGdluGpnvSgnvSinvWjn/qjkfupnPqrneGroOqwrOuzr/Ono/WmoferofarovWsofWvpfKtqvivpPS0qvi2qPm5r/q6rvC1tfC2tvjDvvzHuvnLxPnTzPzUzf3b1P3c2P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAAALAAAAAAQABAAAAi6AAEIHEiwoEE5ODRk8EDG4EAbVObYqdNmxgWHMtbkgfMFCxg6OiQUvFEGz5UlSKA4UeImRoWBcX7cwdJECJGbRHywWSBGYA41YY6gGEq0hxUeFARuePOkiJ6nUEW00IJAIIYzSYZAjcoiywCBHaYweSGirNkRRmg8EDiGARoXKsyKAFHCy4EoAznASIPihIgQH0h0sVCgYIQUZoKsMAGES4MADico2FGlSg0DBBwK3AIhgQAHUjSLJhgQADs=",enable:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAKfSURBVDjLpZPrS1NhHMf9O3bOdmwDCWREIYKEUHsVJBI7mg3FvCxL09290jZj2EyLMnJexkgpLbPUanNOberU5taUMnHZUULMvelCtWF0sW/n7MVMEiN64AsPD8/n83uucQDi/id/DBT4Dolypw/qsz0pTMbj/WHpiDgsdSUyUmeiPt2+V7SrIM+bSss8ySGdR4abQQv6lrui6VxsRonrGCS9VEjSQ9E7CtiqdOZ4UuTqnBHO1X7YXl6Daa4yGq7vWO1D40wVDtj4kWQbn94myPGkCDPdSesczE2sCZShwl8CzcwZ6NiUs6n2nYX99T1cnKqA2EKui6+TwphA5k4yqMayopU5mANV3lNQTBdCMVUA9VQh3GuDMHiVcLCS3J4jSLhCGmKCjBEx0xlshjXYhApfMZRP5CyYD+UkG08+xt+4wLVQZA1tzxthm2tEfD3JxARH7QkbD1ZuozaggdZbxK5kAIsf5qGaKMTY2lAU/rH5HW3PLsEwUYy+YCcERmIjJpDcpzb6l7th9KtQ69fi09ePUej9l7cx2DJbD7UrG3r3afQHOyCo+V3QQzE35pvQvnAZukk5zL5qRL59jsKbPzdheXoBZc4saFhBS6AO7V4zqCpiawuptwQG+UAa7Ct3UT0hh9p9EnXT5Vh6t4C22QaUDh6HwnECOmcO7K+6kW49DKqS2DrEZCtfuI+9GrNHg4fMHVSO5kE7nAPVkAxKBxcOzsajpS4Yh4ohUPPWKTUh3PaQEptIOr6BiJjcZXCwktaAGfrRIpwblqOV3YKdhfXOIvBLeREWpnd8ynsaSJoyESFphwTtfjN6X1jRO2+FxWtCWksqBApeiFIR9K6fiTpPiigDoadqCEag5YUFKl6Yrciw0VOlhOivv/Ff8wtn0KzlebrUYwAAAABJRU5ErkJggg==",warning:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAIsSURBVDjLpVNLSJQBEP7+h6uu62vLVAJDW1KQTMrINQ1vPQzq1GOpa9EppGOHLh0kCEKL7JBEhVCHihAsESyJiE4FWShGRmauu7KYiv6Pma+DGoFrBQ7MzGFmPr5vmDFIYj1mr1WYfrHPovA9VVOqbC7e/1rS9ZlrAVDYHig5WB0oPtBI0TNrUiC5yhP9jeF4X8NPcWfopoY48XT39PjjXeF0vWkZqOjd7LJYrmGasHPCCJbHwhS9/F8M4s8baid764Xi0Ilfp5voorpJfn2wwx/r3l77TwZUvR+qajXVn8PnvocYfXYH6k2ioOaCpaIdf11ivDcayyiMVudsOYqFb60gARJYHG9DbqQFmSVNjaO3K2NpAeK90ZCqtgcrjkP9aUCXp0moetDFEeRXnYCKXhm+uTW0CkBFu4JlxzZkFlbASz4CQGQVBFeEwZm8geyiMuRVntzsL3oXV+YMkvjRsydC1U+lhwZsWXgHb+oWVAEzIwvzyVlk5igsi7DymmHlHsFQR50rjl+981Jy1Fw6Gu0ObTtnU+cgs28AKgDiy+Awpj5OACBAhZ/qh2HOo6i+NeA73jUAML4/qWux8mt6NjW1w599CS9xb0mSEqQBEDAtwqALUmBaG5FV3oYPnTHMjAwetlWksyByaukxQg2wQ9FlccaK/OXA3/uAEUDp3rNIDQ1ctSk6kHh1/jRFoaL4M4snEMeD73gQx4M4PsT1IZ5AfYH68tZY7zv/ApRMY9mnuVMvAAAAAElFTkSuQmCC",edit:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB80lEQVR42o2T30tTURzArb8ioiAI6kHoZeF7CGE/IISCUDNCqAeL3rIWPfSwByskYUEJIhSChBhJFAiNqMVYPqRuc4tcW3NLt3C7u3d3d3c/+nS+0GRK0134cC6c8/ncc+7ltgFt6jqgcCg6duGQYq84deoBR6lU0iqVSq1arfI/1Dxut3u0Htke6BC5UChgmuYm+XyeXC5HOp1GIsnQNJHJi3x/7WJh/CSLT9r7Rd4jAVlgWRa2bSOjYBgGmqaRyWQwkq9Y8wyhLb0BI0VuaRrfo671xoDIwmakWCyi6zrr36bILt/HXp1l7cNDioEZqnEvgYmr1paAOgYy1u/l3NrqHNngPWpFL8XodTa+3CD8YoCvz/o078i5o1sC29FT78kG7lCzfJgrl7ESvejLThLPuxk8fbhP3KaBVFCdeX7on9yP9bOHfPAu0bEzmKkg4jQNpEKzhOduqW1/xIoNUEpcQlM7WXl6Cj39Q9Y0D4Q/TRJ662Tx3WOS/guYsV42Fm4THe/G/B2T97Jz4OVwJ+hxImPn8Tj381k91TfShfErIvLuAde1Y9g+N7Z/FL/rBDODR8gmgpTL5To7B3o69zF8pR3Pg7PMT90kn47LJ22kaeCPghapidP4Lxy3bduUiVZktdaQH7AxcFAiUm0Rhzji/gUhbp0s2Zf2xwAAAABJRU5ErkJggg==",info:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJ1SURBVHjafJJdSJNhFMd/z3QzLWdZrnQmSA2DPqRCK4KuhIq66kLoAy/qoqCguqqL6JsgLwoKKhCMSIy6CDKKRFZZYYQRVhJl02nWmG5uc19u7/vuPV0lW7QOnIsHnt+P8z/Pg4gw26aZ0263uzEUCn2IxWJjXq/3JqBETLIZ8gkePLhfKyKy/Z5HHJf7xe0Jic/n65mejizPK0inUiSTKUSE0dHRhxf6JoSDb4Rjr4QDz0REJBgMtmczFrJKKYVSCjCYnPR/W1FuAwQSGjbHXAA0LRXKZnIm0NJpgAKvd/hSOBz2iIj0eiPS2vtDYsmUPH/uPg9YshklIrOyCb+/eUG5ve3au5C99W2AqGbgKivk8R4X1lSkv2pJZaNmmBQVWWeZnAiGoa+3KovdyBjsW2kn/SvK4Jcgtaf7cDqrGkQMUDkBcgXVS2tOHjp8dG2jOXT1yo5lYOpgFTB0wKTAOqdQMlqOoDD7EE8kREwGXr/oWTg4HjxONAklBayuKSUeT/hFTxrwnwlAMa8I1qyrP3H95RiQgUiC/RsWM+wZ6jIME0M38wtSM0mmojM4nc6mzr5xKDQgnWb/pmoedT29EU3pTMUS+QVKKerq6kqnI3EVHwmAplO8qBh7WTFnzpz9bOg6FovlfxGEixfOrfT6YxCOQ1rDUaIAG4EJ38+PAwNb/95Bzj8ITAZwLHbMT0yHw3N33YVwEnQDqss41VzPkaalX6Iz+m6Xy/Xp34JAAICR7187nLWuvbe6h9C0DA2uRTTVV9J++87OlpaWJxUVFf9+xj+1cfOWls6OO93Nq1zblMVm9flG3pcvXNPm90+E/777ewB+UIqdqtYXHAAAAABJRU5ErkJggg==",bucket:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QkQDC8RTstxRAAAAGBJREFUOMtjYBgswIWBgeE/idiFgYGBgRFqwH8GBoYGEi1tYGBgYGRBE9QjUvMlGANmgCsDA8NuElzRANXDwAQV2ENGuO1BNoBsMGoAlQ3wJTIdNEDVYgU+ROQBH6rmQgAWgB19xco60wAAAABJRU5ErkJggg==",dir:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDNzU0RUNBNzU3OEIxMUUyOEM3QzkxOEZDOTU1RTdFMCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDNzU0RUNBODU3OEIxMUUyOEM3QzkxOEZDOTU1RTdFMCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkM3NTRFQ0E1NTc4QjExRTI4QzdDOTE4RkM5NTVFN0UwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkM3NTRFQ0E2NTc4QjExRTI4QzdDOTE4RkM5NTVFN0UwIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+S/WxbAAAAERJREFUeNpi/P//PwMlgJFSA1g2bNiAzYQLQOwIxB8IGcCEQ9wAiPcDsQBBF+CRAxnynlwXEA1GDRg1gCqZiWIDAAIMADidE0PBoGsZAAAAAElFTkSuQmCC",r:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90CDRIvNbHTpbwAAADjSURBVDjLpZFBbsIwEEUfVRZYahcVK3qKXoauMFK5C91nkyUB+xC5BqeAA7SKq1B5ugl2EiC04UkjayzN17NnROTRWvvJFbTWL8CBHqbGWOlSlqVkWSbGWAGm3aGHZiMiAByPP6FOd1rP2W7NvhvSCvDe10E+VJPFQpPnm1ZIcsmgPgJVVZGmaejX63y/XL4/AV/JJYPTCeDcN7PZWyuwKAqA8wARqSsGKDVGqXGjV8H07AnRQPq21TK8+YSBAQMN4hb6Df7wB/5eA+4zmEyehxk451itPrhFksSxUeP+lf+z+wXwdayJk/mqtgAAAABJRU5ErkJggg==",box:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMHAwRAVvTmTAAAAK/SURBVDjLpZM9bFxFGEXPNzPvZ+39sb2xHceREjDQBwlDCqqIiiotokAghYKEjvSkQkKJkEiB0lOkoAHaBAokFCQKUATIIOLIMbHWrHfX+7zvvZk3MzQODUgU3PJK5+g2F/5n5N/Kb66/1NNK3hAxr4HcFqVuvfju18V/Cu58sPmMVnJZ4K32Qr+t8za+KnCz4kCUuiGibm5euTv5h+CL958/nxj1XivVF+e6C9TVhPmFdbROgEhwNU1d4m09UaJuInLjhct3DgDUh5ee7j14PLxulLvYP/0seadPkub88Wib0eB3bDkmxgbRoFPpxeCuKvjsyQIzOyqImT7/y8Mh++NveW7jLFmrx6m1NlWxz6PHA7otQ7tloAmYJE9isOeeCJRtIrULLLUTjsqG7+//xs72z7jZgCTNONlVJKEiuobW0jqSaoiet19dFQATJcc2FSFEciNoLYwOHcPDASvdjM5cQntxlbR9gqacoFSK84VsnOrkH11Zdmp0FFXjobSeCFgXSDS0Eo11ge7yGXSaU092UUlCaEpC8FK4tDcu4rzZ2a/S+bWI94HSAgFigDQD24Cvp4gIOp0juBJvC2L07B1Uc/Mtg9k7sHMbywZrA3lLECV4AtaCpAp79CcmzXHlhOBrAJrGyNbOVBY7qTO1C9r5EKyPSttAiJEs01SuQStFkrdp6gKd5AzHjixVxCDxp+1paZRUxoc4Kp36bndYbS53U5WlCq0CMYIPMY7GI0mNpiqmGK0oK4jIveGkPgRqfTBt3A8Pqtvrq52HtglnGh9XIaKUkCQ6nj6RyWBsmdXCtFI/bu2Fq5c+3roGzIAgWokCDNACOhfOLb781Ip+vd+RC2dXWibROkxKvvp1z376yZe7d4HpMdz8/YVjiQYyoA30Ti6la2++0n/n83vTW/e3ix1gcgzXgPchBoC/AFu/UBF5InryAAAAAElFTkSuQmCC",bluebox:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMHAwTE5pcivoAAALsSURBVDjLXZPPaxxlGMc/77wz+3N2k822tWsTIrQFe/BWEKxKCV5UohdFhJ60p6rgUfpP6C0K4kHx0ENEkV7aElHwUikhFVosRGoTm83+3pnZnXfed2beHtItIQ98+Z6+H57nga8AsNYKDkYcEofcHvKZEEJYcSTszPzqL3fmf3+w/+a51tytby9d6D0N5UecGeBZ8MPv/jh9fy/6dKzMpVPHmvWdbl/XCvKn5Wbl6+ufrNwGssMgYa2VgFj58sZr7VB/LqX3zlKrydJzTTzXxdqcx90hO+0Bk2l8Z74i1z6+cOba5VfOqGeAb3579M/NR53T40xwrDGHFALPEUjn4LoMi0ktwWTKXqCIqAVrbyycvHj2hHYBR+bO8Q/Ov0imEzZ2xrRDRalQwC9LLBalUgaJQy+tU6gvIBJbv3j2RA4IFxDdICFa9ulMCrz/UgOs5kEwpeh57I4Nt/dzsmLOYlEThgFjUePp33IHoD9SJAbuTVyudRweixJvnVtg3/i00wpLPiwQ0hkO6YYKawWj0UjONqAfKHwDkxTqqeW/RHA3hO2+Zqk05e5wTD9KmOqMKDEUqoLNzU0PyF2AQaBoaIhiw0h6TIwgUDCODb5NiWJNlKREyhAozXwOW1tbFSmlcAHbD2KaytCdGgyWglfEs4LeNKeaa4axYRgpwlgTTTXVDDqdTslaewAYh4kNlKUbZsTGonOwCYwm1vq5Ft1AMYgU08SQR5o0gziOcRxHuoCNtdl6uPHX6/Vmi3Yyh9I5IoEgMdkgT9x+qJhEGrdQo77cJMuy+4DJskwLa60DOCtf3HhZpfZKtVx+L3x+sfCv8CFxTINd72HfodQ4aQp5fP24/v/Hd4Nf/5RSJmma6lkXZn1wPvvq5qndsbhS9esf/Zy/UEtzxnURfn8+/fuHV7m353mecV1XSym1lDI72kaxvr5e3N7eruyP0tpG/e3LK/rW2mLNUb7vm3K5nFarVdNqtbJer2dXV1fzJ6cDpboAZRAGAAAAAElFTkSuQmCC",refresh:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAK8AAACvABQqw0mAAAAAd0SU1FB90CFA8bKScXIjIAAAJ1SURBVDjLlVJdSJNRGH7es+/7NlduWFLTKAskwjJqZYiBglJhLKguqou6EFkFIkLQH9IPBFI3BsouzMJupGYRajcqmeBFhWBU5oUgpZikrSnzZ9v3nW/ndKEbziXUAwfOOe/7Puc9z/MCq1DwMmB1NX/rzfCNnsc/gK08lPgnnT8Cs33BULg0HI4YKdkHX9DqKwKArXXv1bTMTFcoyruC89E8MxaDw659t6rKhIUwRBLdP2t2v/5bBwQA+5pH8ibnIj3BucgWIQRASw8RERTGYFUtsGmWYUXKmqmr7t4UAnal54GQ8lq8MBlyOU0CEnA67MiwqfvHbhZ+Smgg6o9eV2L8Nhk6wI2lZeggrpvE+TTjxgxxQ4IbmJsJYSa00JQiotnguacJ8zIZOmDosAnzTpowt8tGj0s0ejZqprnDKmPHSNebjHDkUPatt4cTTbZ+LsmO79XK52dZxTNp9/ovAEDnaM62lo8HHrd9SVfiOelVryrSq9vrEx0s8sW2tuEzDgDgT875bcIsjy6owwAwHhjnYT5bGTL29PiHyuwAMO873aL/Ct5PiPjwXe5vq7KJW2hdJxENMFInGCkhIblLj80WRoyxGxZmh1XJGlSIlV8s6A8kuVDXn+MF6JHC7GBkBSNlOSRgiihMsQhAgJGGNNU1atc2HPG6O8YSBABwt2/nGyFlGSCSB4UIBMuyoQKMFNiUjIApRH5t8YfpFOOrO/JrhZBVUiJLxq2ipIkY8Z36uivpC6txqb3YbhqhIingFlLmxmLSKyXAGAaYqh13aFjfcHJwfE2ClSitK9psc85PMVC3M999orX4Kcf/wuPb27VW7A+O2QVVA1M1CQAAAABJRU5ErkJggg==",newitem:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAtxJREFUeNqM0llIVHEUBvDv3vlfZ8ac6zZtWpmamtliUUHRDlFJWlEYLdBLtG/QBlFJQUTSU089RZRlG4EvkS9NlqkpldHyYLk1OurcOzp30vHO/y6nBwsSIvzgvBw+fpyHA8MwwDmHbdsjQwSbCACkYDBYp6pqU3Fxcfyf/Z+eYRjQOQf+Bnw+30IiIsMwhizL4n3lV6mn7BzZtm1yzn8SETU0NKz+J2ARobe3t85/+SI1506j9hOHqTEO9FYEtR/ZTx/n5FDH6eOkquoni2g00NjUtEzTtBYioneLCulVHKg2yUkNmelUn5VOtUlueu0SqDE/m4iIIpFI64fm5vU65xAMIlicR9rOn/UEKytgmQbYuARAEDAqRLCiQxBFhtTNWzDzxk1LcjgkFhuKIhLR2qJKcN5Al/q7reF/cXUHoA0MtA9Gh4klJIxz6ro+PZiVC0uOw1jimJEDWZbTDhw8lCi0+/3PtUeV696ePIPUnIwxAf3fOjG/7AK8e/e9ZH2K0uWdPRdivANm3NguED1OJBYWQunvDwgAXIqifO54+CC7/tSxMQELL11B/r6D3cnJybniQDis25Ikfn1wD2GdQLIMISkF5JFhudwgjwySkyCkpILkRER0wpf7d2FJkqSoapQRRPCYjoLDR+EY70VXbS2YxCC4nAARbAAQBJBlwTIMZJRsQN7W7eA6t9O8XkE0jRhWLV2y+Gdm9q0dT6rMhLw8dPn7EAoEMBSLIcpjCPUEEPD3gU1Kw+6qZ6TPKrizq3TbAjUUIkFRVYAIkkfG99bWp4P1b7Z0vq5BXtFGPN6zE6Zuo7SiAh01PkycV4jJRRt96VOmrOHhMESHiBEAgMkNlGwqmXC78mG1DXtQdruTgx/eF5g6x9Tly1pCmtYjMSnxatnFTeXXyn8wxiCMAgxz5EmcTjCXCynxblf1C9910eFwrl254nh/dDhqcQ5zeBgAwBiDIAr4NQAWJarVjshqqgAAAABJRU5ErkJggg=="};var OpencgaManager={host:typeof OPENCGA_HOST==="undefined"?"http://cafetal:8080/opencga/rest":OPENCGA_HOST,version:typeof OPENCGA_VERSION==="undefined"?"v1":OPENCGA_VERSION,users:{login:function(args){return OpencgaManager._doRequest(args,"users","login")},logout:function(args){return OpencgaManager._doRequest(args,"users","logout")},read:function(args){return OpencgaManager._doRequest(args,"users","info")},update:function(args){return OpencgaManager._doRequest(args,"users","update")},updateEmail:function(args){return OpencgaManager._doRequest(args,"users","change-email")},updatePassword:function(args){return OpencgaManager._doRequest(args,"users","change-password")},resetPassword:function(args){return OpencgaManager._doRequest(args,"users","reset-password")},create:function(args){return OpencgaManager._doRequest(args,"users","create")},delete:function(args){return OpencgaManager._doRequest(args,"users","delete")}},projects:{list:function(args){return OpencgaManager._doRequest(args,"projects","all-projects")},read:function(args){return OpencgaManager._doRequest(args,"projects","info")},update:function(args){return OpencgaManager._doRequest(args,"projects","update")},create:function(args){return OpencgaManager._doRequest(args,"projects","create")},delete:function(args){return OpencgaManager._doRequest(args,"projects","delete")},studies:function(args){return OpencgaManager._doRequest(args,"projects","studies")}},studies:{list:function(args){return OpencgaManager._doRequest(args,"studies","all-studies")},read:function(args){return OpencgaManager._doRequest(args,"studies","info")},update:function(args){return OpencgaManager._doRequest(args,"studies","update")},create:function(args){return OpencgaManager._doRequest(args,"studies","create")},delete:function(args){return OpencgaManager._doRequest(args,"studies","delete")},analysis:function(args){return OpencgaManager._doRequest(args,"studies","analysis")},jobs:function(args){return OpencgaManager._doRequest(args,"studies","jobs")}},files:{list:function(args){return OpencgaManager._doRequest(args,"files","list")},fetch:function(args){return OpencgaManager._doRequest(args,"files","fetch")},alignments:function(args){return OpencgaManager._doRequest(args,"files","alignments")},variants:function(args){return OpencgaManager._doRequest(args,"files","variants")},read:function(args){return OpencgaManager._doRequest(args,"files","info")},info:function(args){return OpencgaManager._doRequest(args,"files","info")},delete:function(args){return OpencgaManager._doRequest(args,"files","delete")},index:function(args){return OpencgaManager._doRequest(args,"files","index")},search:function(args){return OpencgaManager._doRequest(args,"files","search")},filesByFolder:function(args){return OpencgaManager._doRequest(args,"files","files")},content:function(args){return OpencgaManager._doRequest(args,"files","content")},contentGrep:function(args){return OpencgaManager._doRequest(args,"files","content-grep")},createFolder:function(args){return OpencgaManager._doRequest(args,"files","create-folder")},setHeader:function(args){return OpencgaManager._doRequest(args,"files","set-header")},contentExample:function(args){return OpencgaManager._doRequest(args,"files","content-example")},downloadExample:function(args){return OpencgaManager._doRequest(args,"files","download-example")},update:function(args){return OpencgaManager._doRequest(args,"files","update")},download:function(args){return OpencgaManager._doRequest(args,"files","download")},upload:function(args){return OpencgaManager._doRequest(args,"files","upload")},upload2:function(args){var query={sid:Cookies("bioinfo_sid"),studyId:args.studyId};if(window.OPENCGA_OLD_URL_FORMAT!=null&&OPENCGA_OLD_URL_FORMAT===true){var splitIndex=args.relativeFilePath.lastIndexOf("/")+1;query.name=args.relativeFilePath.substring(splitIndex);query.directory=args.relativeFilePath.substring(0,splitIndex)}else{query.path=args.relativeFilePath}OpencgaManager.files.search({query:query,request:{success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){if(response.response[0].result.length==0){var url=OpencgaManager._url({query:{sid:args.sid},request:{}},"files","upload");args.url=url;OpencgaManager._uploadFile(args)}else{args.error("File already exists")}}else{args.error(response.response[0].errorMsg)}},error:function(){args.error("Server error, try again later.")}}})}},jobs:{create:function(args){return OpencgaManager._doRequest(args,"jobs","create")},delete:function(args){return OpencgaManager._doRequest(args,"jobs","delete")}},samples:{search:function(args){return OpencgaManager._doRequest(args,"samples","search")}},util:{proxy:function(args){return OpencgaManager._doRequest(args,"util","proxy")}},_url:function(args,api,action){var host=OpencgaManager.host;if(typeof args.request.host!=="undefined"&&args.request.host!=null){host=args.request.host}var version=OpencgaManager.version;if(typeof args.request.version!=="undefined"&&args.request.version!=null){version=args.request.version}var id="";if(typeof args.id!=="undefined"&&args.id!=null){id="/"+args.id}var url=host+"/webservices/rest/"+version+"/"+api+id+"/"+action;if(window.OPENCGA_OLD_URL_FORMAT!=null&&OPENCGA_OLD_URL_FORMAT===true){if(action=="jobs"){action="job"}if(api=="jobs"){api="job"}url=host+"/rest/"+api+id+"/"+action}url=Utils.addQueryParamtersToUrl(args.query,url);return url},_doRequest:function(args,api,action){var url=OpencgaManager._url(args,api,action);if(args.request.url===true){return url}else{var method="GET";if(typeof args.request.method!=="undefined"&&args.request.method!=null){method=args.request.method}var async=true;if(typeof args.request.async!=="undefined"&&args.request.async!=null){async=args.request.async}console.log(url);var request=new XMLHttpRequest;request.onload=function(){var contentType=this.getResponseHeader("Content-Type");if(contentType==="application/json"){args.request.success(JSON.parse(this.response),this)}else{args.request.success(this.response,this)}};request.onerror=function(){args.request.error(this)};request.open(method,url,async);request.send();return url}},_uploadFile:function(args){var url=args.url;var inputFile=args.inputFile;var fileName=args.fileName;var userId=args.userId;var studyId=args.studyId;var relativeFilePath=args.relativeFilePath;var fileFormat=args.fileFormat;var bioFormat=args.bioFormat;var description=args.description;var callbackProgress=args.callbackProgress;var resume=true;var resumeInfo={};var chunkMap={};var chunkId=0;var blob=inputFile;var BYTES_PER_CHUNK=2*1024*1024;var SIZE=blob.size;var NUM_CHUNKS=Math.max(Math.ceil(SIZE/BYTES_PER_CHUNK),1);var start;var end;var getResumeInfo=function(formData){var xhr=new XMLHttpRequest;xhr.open("POST",url,false);xhr.send(formData);var response=JSON.parse(xhr.responseText);return response.response[0]};var checkChunk=function(id,size,resumeInfo){if(typeof resumeInfo[id]==="undefined"){return false}else if(resumeInfo[id].size!=size){return false}return true};var processChunk=function(c){var chunkBlob=blob.slice(c.start,c.end);if(checkChunk(c.id,chunkBlob.size,resumeInfo)==false){var formData=new FormData;formData.append("chunk_content",chunkBlob);formData.append("chunk_id",c.id);formData.append("chunk_size",chunkBlob.size);formData.append("filename",fileName);formData.append("userId",userId);formData.append("studyId",studyId);formData.append("relativeFilePath",relativeFilePath);if(c.last){formData.append("last_chunk",true);formData.append("total_size",SIZE);formData.append("fileFormat",fileFormat);formData.append("bioFormat",bioFormat);formData.append("description",description)}uploadChunk(formData,c,function(chunkResponse){callbackProgress(c,NUM_CHUNKS,chunkResponse);if(!c.last){processChunk(chunkMap[c.id+1])}else{}})}else{callbackProgress(c,NUM_CHUNKS);if(!c.last){processChunk(chunkMap[c.id+1])}else{}}};var uploadChunk=function(formData,chunk,callback){var xhr=new XMLHttpRequest;xhr.open("POST",url,true);xhr.onload=function(e){chunk.done=true;console.log("chunk done");callback(JSON.parse(xhr.responseText))};xhr.send(formData)};if(resume){var resumeFormData=new FormData;resumeFormData.append("resume_upload",resume);resumeFormData.append("filename",fileName);resumeFormData.append("userId",userId);resumeFormData.append("studyId",studyId);resumeFormData.append("relativeFilePath",relativeFilePath);resumeInfo=getResumeInfo(resumeFormData)}start=0;end=BYTES_PER_CHUNK;while(start<SIZE){var last=false;if(chunkId==NUM_CHUNKS-1){last=true}chunkMap[chunkId]={id:chunkId,start:start,end:end,done:false,last:last};start=end;end=start+BYTES_PER_CHUNK;chunkId++}processChunk(chunkMap[0])},resourceTypes:{USERS:"users",PROJECTS:"projects",STUDIES:"studies",FILES:"files",ANALYSES:"analyses",JOBS:"jobs"},actions:{LOGIN:"login",LOGOUT:"logout",CREATE:"create",UPLOAD:"upload",INFO:"info",LIST:"list",FETCH:"fetch",UPDATE:"update",DELETE:"delete"},httpMethods:{},login:function(userId,queryParams,args){
this._call(this.resourceTypes.USERS,userId,this.actions.LOGIN,queryParams,args)},logout:function(userId,queryParams,args){this._call(this.resourceTypes.USERS,"",this.actions.LOGOUT,queryParams,args)},create:function(resourceType,queryParams,args){this._call(resourceType,"",this.actions.CREATE,queryParam,args)},upload:function(resourceType,queryParams,args){this._call(resourceType,"",this.actions.UPLOAD,queryParams,args)},get:function(resourceType,resourceId,action,queryParams,args){_.extend(queryParams,{sid:"RNk4P0ttFGHyqLA3YGS8",view_as_pairs:"false",include_coverage:"true",process_differences:"false"});this._call(resourceType,resourceId,action,queryParams,args)},list:function(resourceType,queryParams,args){this._call(resourceType,"",this.actions.LIST,queryParams,args)},update:function(resourceType,resourceId,queryParams,args){this._call(resourceType,resourceId,this.actions.UPDATE,queryParams,args)},delete:function(resourceType,resourceId,queryParams,args){this._call(resourceType,resourceId,this.actions.DELETE,queryParams,args)},_call:function(resourceType,resourceId,action,queryParams,args){var url=this._url(resourceType,resourceId,action,queryParams,args);if(typeof url==="undefined"||url==null){return}console.log(url);var async=_.isUndefined(args.async)||_.isNull(args.async)?true:args.async;var success=args.success;var error=args.error;var d;$.ajax({type:OpencgaManager.httpMethods[resourceType],url:url,dataType:"json",async:async,success:function(data,textStatus,jqXHR){if($.isPlainObject(data)||$.isArray(data)){if(_.isFunction(success)){success(data)}d=data}else{console.log("Cellbase returned a non json object or list, please check the url.");console.log(url);console.log(data)}},error:function(jqXHR,textStatus,errorThrown){console.log("CellBaseManager: Ajax call returned : "+errorThrown+"\t"+textStatus+"\t"+jqXHR.statusText+" END");if(_.isFunction(error)){error(jqXHR,textStatus,errorThrown)}}});return url},_url2:function(resourceType,resourceId,action,queryParams,args){if(resourceId==undefined||resourceId==null){resourceId=""}else{resourceId=resourceId+"/"}var host=this.host;if(typeof args.host!=="undefined"&&args.host!=null){host=args.host}var opencga=this.opencga;if(typeof args.opencga!=="undefined"&&args.opencga!=null){opencga=args.opencga}var url=host+opencga+resourceType+"/"+resourceId+action;url=Utils.addQueryParamtersToUrl(queryParams,url);return url}};OpencgaManager.httpMethods[OpencgaManager.actions.LOGIN]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.LOGOUT]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.CREATE]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.UPLOAD]="POST";OpencgaManager.httpMethods[OpencgaManager.actions.INFO]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.LIST]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.FETCH]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.UPDATE]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.DELETE]="GET";var CellBaseManager={host:typeof CELLBASE_HOST==="undefined"?"http://bioinfo.hpc.cam.ac.uk/cellbase":CELLBASE_HOST,version:"v3",get:function(args){var success=args.success;var error=args.error;var async=args.async==false?false:true;var ignoreKeys=["success","error","async"];var urlConfig={};for(var prop in args){if(hasOwnProperty.call(args,prop)&&args[prop]!=null&&ignoreKeys.indexOf(prop)==-1){urlConfig[prop]=args[prop]}}var url=CellBaseManager.url(urlConfig);if(typeof url==="undefined"){return}console.log(url);var d;var request=new XMLHttpRequest;request.onload=function(){var contentType=this.getResponseHeader("Content-Type");if(contentType==="application/json"){var parsedResponse=JSON.parse(this.response);if(typeof success==="function")success(parsedResponse);d=parsedResponse}else{console.log("Cellbase returned a non json object or list, please check the url.");console.log(url);console.log(this.response)}};request.onerror=function(){console.log("CellBaseManager: Ajax call returned "+this.statusText);if(typeof error==="function")error(this)};request.open("GET",url,async);request.send();return d},url:function(args){if(args==null){args={}}if(args.params==null){args.params={}}var version=this.version;if(args.version!=null){version=args.version}var host=this.host;if(args.host!=null){host=args.host}delete args.host;delete args.version;var config={host:host,version:version};for(var prop in args){if(hasOwnProperty.call(args,prop)&&args[prop]!=null){config[prop]=args[prop]}}var query="";if(config.query!=null){query="/"+config.query.toString()}if(config.species&&config.species.id!=null){if(config.species.assembly!=null){config.params["assembly"]=config.species.assembly.name}if(config.subCategory==="chromosome"){delete config.params["assembly"]}config.species=Utils.getSpeciesCode(config.species.scientificName)}var url;if(config.category==="meta"){url=config.host+"/webservices/rest/"+config.version+"/"+config.category+"/"+config.subCategory}else{url=config.host+"/webservices/rest/"+config.version+"/"+config.species+"/"+config.category+"/"+config.subCategory+query+"/"+config.resource}url=Utils.addQueryParamtersToUrl(config.params,url);return url}};function EvaAdapter(args){_.extend(this,Backbone.Events);_.extend(this,args);this.on(this.handlers);this.configureCache();this.debug=false}EvaAdapter.prototype={setSpecies:function(species){this.species=species;this.configureCache()},setHost:function(host){this.host=host;this.configureCache()},configureCache:function(){var host=this.host||EvaManager.host;var cacheId=host+(this.species.text+this.species.assembly).replace(/[\/_().\ -]/g,"");if(!this.cacheConfig){this.cacheConfig={chunkSize:3e3}}this.cacheConfig.cacheId=cacheId;this.cache=new FeatureChunkCache(this.cacheConfig)},getData:function(args){var _this=this;var params={};_.extend(params,this.params);_.extend(params,args.params);var region=args.region;if(region.start>3e8||region.end<1){return}region.start=region.start<1?1:region.start;region.end=region.end>3e8?3e8:region.end;var categories=[this.category+this.subCategory+this.resource+Utils.queryString(params)];var dataType=args.dataType;if(_.isUndefined(dataType)){console.log("dataType must be provided!!!")}var chunkSize=params.interval?params.interval:this.cacheConfig.chunkSize;if(this.debug){console.log(chunkSize)}this.cache.get(region,categories,dataType,chunkSize,function(cachedChunks,uncachedRegions){var category=categories[0];var categoriesName="";for(var j=0;j<categories.length;j++){categoriesName+=","+categories[j]}categoriesName=categoriesName.slice(1);var chunks=cachedChunks[category];var queriesList=_this._groupQueries(uncachedRegions[category]);if(queriesList.length>0){args.webServiceCallCount=0;for(var i=0;i<queriesList.length;i++){args.webServiceCallCount++;var queryRegion=queriesList[i];EvaManager.get({host:_this.host,version:_this.version,species:_this.species,category:_this.category,query:queryRegion.toString(),resource:_this.resource,params:params,success:function(response){var responseChunks=_this._success(response,categories,dataType,chunkSize);args.webServiceCallCount--;chunks=chunks.concat(responseChunks);if(args.webServiceCallCount===0){args.done({items:chunks,dataType:dataType,chunkSize:chunkSize,sender:_this})}},error:function(){console.log("Server error")}})}}else{args.done({items:chunks,dataType:dataType,chunkSize:chunkSize,sender:_this})}})},_success:function(data,categories,dataType,chunkSize){var timeId=Utils.randomString(4)+this.resource+" save";console.time(timeId);var regions=[];var chunks=[];for(var i=0;i<data.response.length;i++){var queryResult=data.response[i];if(dataType=="histogram"){for(var j=0;j<queryResult.result.length;j++){var interval=queryResult.result[j];var region=new Region(interval);regions.push(region);chunks.push(interval)}}else{regions.push(new Region(queryResult.id));chunks.push(queryResult.result)}}var items=this.cache.putByRegions(regions,chunks,categories,dataType,chunkSize);console.timeEnd(timeId);return items},_groupQueries:function(uncachedRegions){var groupSize=50;var queriesLists=[];while(uncachedRegions.length>0){queriesLists.push(uncachedRegions.splice(0,groupSize).toString())}return queriesLists}};var EvaManager={host:"http://www.ebi.ac.uk/eva/webservices/rest",version:"v1",get:function(args){var success=args.success;var error=args.error;var async=_.isUndefined(args.async)||_.isNull(args.async)?true:args.async;var urlConfig=_.omit(args,["success","error","async"]);var url=EvaManager.url(urlConfig);if(typeof url==="undefined"){return}console.log(url);var d;$.ajax({type:"GET",url:url,dataType:"json",async:async,success:function(data,textStatus,jqXHR){if($.isPlainObject(data)||$.isArray(data)){data.query=args.query;if(_.isFunction(success))success(data);d=data}else{console.log("Eva returned a non json object or list, please check the url.");console.log(url);console.log(data)}},error:function(jqXHR,textStatus,errorThrown){console.log("EvaManager: Ajax call returned : "+errorThrown+"\t"+textStatus+"\t"+jqXHR.statusText+" END");if(_.isFunction(error))error(jqXHR,textStatus,errorThrown)}});return d},url:function(args){if(!$.isPlainObject(args))args={};if(!$.isPlainObject(args.params))args.params={};var version=this.version;if(typeof args.version!=="undefined"&&args.version!=null){version=args.version}var host=this.host;if(typeof args.host!=="undefined"&&args.host!=null){host=args.host}delete args.host;delete args.version;var config={host:host,version:version};var params={};_.extend(config,args);if($.isPlainObject(config.species)){config.params["species"]=Utils.getSpeciesCode(config.species.text)+"_"+config.species.assembly.split(".")[0].toLowerCase()}else{config.params["species"]=config.species}_.extend(config.params,params);var query="";if(typeof config.query!=="undefined"&&config.query!=null){if($.isArray(config.query)){config.query=config.query.toString()}query="/"+config.query}var url=config.host+"/"+config.version+"/"+config.category+query+"/"+config.resource;url=Utils.addQueryParamtersToUrl(config.params,url);return url}};(function(){function resolve(){document.body.removeAttribute("unresolved")}if(window.WebComponents){addEventListener("WebComponentsReady",resolve)}else{if(document.readyState==="interactive"||document.readyState==="complete"){resolve()}else{addEventListener("DOMContentLoaded",resolve)}}})();window.Polymer={Settings:function(){var user=window.Polymer||{};location.search.slice(1).split("&").forEach(function(o){o=o.split("=");o[0]&&(user[o[0]]=o[1]||true)});var wantShadow=user.dom==="shadow";var hasShadow=Boolean(Element.prototype.createShadowRoot);var nativeShadow=hasShadow&&!window.ShadowDOMPolyfill;var useShadow=wantShadow&&hasShadow;var hasNativeImports=Boolean("import"in document.createElement("link"));var useNativeImports=hasNativeImports;var useNativeCustomElements=!window.CustomElements||window.CustomElements.useNative;return{wantShadow:wantShadow,hasShadow:hasShadow,nativeShadow:nativeShadow,useShadow:useShadow,useNativeShadow:useShadow&&nativeShadow,useNativeImports:useNativeImports,useNativeCustomElements:useNativeCustomElements}}()};(function(){var userPolymer=window.Polymer;window.Polymer=function(prototype){if(typeof prototype==="function"){prototype=prototype.prototype}if(!prototype){prototype={}}var factory=desugar(prototype);prototype=factory.prototype;var options={prototype:prototype};if(prototype.extends){options.extends=prototype.extends}Polymer.telemetry._registrate(prototype);document.registerElement(prototype.is,options);return factory};var desugar=function(prototype){var base=Polymer.Base;if(prototype.extends){base=Polymer.Base._getExtendedPrototype(prototype.extends)}prototype=Polymer.Base.chainObject(prototype,base);prototype.registerCallback();return prototype.constructor};window.Polymer=Polymer;if(userPolymer){for(var i in userPolymer){Polymer[i]=userPolymer[i]}}Polymer.Class=desugar})();Polymer.telemetry={registrations:[],_regLog:function(prototype){console.log("["+prototype.is+"]: registered")},_registrate:function(prototype){this.registrations.push(prototype);Polymer.log&&this._regLog(prototype)},dumpRegistrations:function(){this.registrations.forEach(this._regLog)}};Object.defineProperty(window,"currentImport",{enumerable:true,configurable:true,get:function(){return(document._currentScript||document.currentScript).ownerDocument}});Polymer.RenderStatus={_ready:false,_callbacks:[],whenReady:function(cb){if(this._ready){cb()}else{this._callbacks.push(cb)}},_makeReady:function(){this._ready=true;this._callbacks.forEach(function(cb){cb()});this._callbacks=[]},_catchFirstRender:function(){requestAnimationFrame(function(){Polymer.RenderStatus._makeReady()})}};if(window.HTMLImports){HTMLImports.whenReady(function(){Polymer.RenderStatus._catchFirstRender()})}else{Polymer.RenderStatus._catchFirstRender()}Polymer.ImportStatus=Polymer.RenderStatus;Polymer.ImportStatus.whenLoaded=Polymer.ImportStatus.whenReady;Polymer.Base={__isPolymerInstance__:true,_addFeature:function(feature){this.extend(this,feature)},registerCallback:function(){this._desugarBehaviors();this._doBehavior("beforeRegister");this._registerFeatures();this._doBehavior("registered")},createdCallback:function(){Polymer.telemetry.instanceCount++;this.root=this;this._doBehavior("created");this._initFeatures()},attachedCallback:function(){Polymer.RenderStatus.whenReady(function(){this.isAttached=true;this._doBehavior("attached")}.bind(this))},detachedCallback:function(){this.isAttached=false;this._doBehavior("detached")},attributeChangedCallback:function(name){this._attributeChangedImpl(name);this._doBehavior("attributeChanged",arguments)},_attributeChangedImpl:function(name){this._setAttributeToProperty(this,name)},extend:function(prototype,api){if(prototype&&api){Object.getOwnPropertyNames(api).forEach(function(n){this.copyOwnProperty(n,api,prototype)},this)}return prototype||api},mixin:function(target,source){for(var i in source){target[i]=source[i]}return target},copyOwnProperty:function(name,source,target){var pd=Object.getOwnPropertyDescriptor(source,name);if(pd){Object.defineProperty(target,name,pd)}},_log:console.log.apply.bind(console.log,console),_warn:console.warn.apply.bind(console.warn,console),_error:console.error.apply.bind(console.error,console),_logf:function(){return this._logPrefix.concat([this.is]).concat(Array.prototype.slice.call(arguments,0))}};Polymer.Base._logPrefix=function(){var color=window.chrome||/firefox/i.test(navigator.userAgent);return color?["%c[%s::%s]:","font-weight: bold; background-color:#EEEE00;"]:["[%s::%s]:"]}();Polymer.Base.chainObject=function(object,inherited){if(object&&inherited&&object!==inherited){if(!Object.__proto__){object=Polymer.Base.extend(Object.create(inherited),object)}object.__proto__=inherited}return object};Polymer.Base=Polymer.Base.chainObject(Polymer.Base,HTMLElement.prototype);if(window.CustomElements){Polymer.instanceof=CustomElements.instanceof}else{Polymer.instanceof=function(obj,ctor){return obj instanceof ctor}}Polymer.isInstance=function(obj){return Boolean(obj&&obj.__isPolymerInstance__)};Polymer.telemetry.instanceCount=0;(function(){var modules={};var lcModules={};var findModule=function(id){return modules[id]||lcModules[id.toLowerCase()]};var DomModule=function(){return document.createElement("dom-module")};DomModule.prototype=Object.create(HTMLElement.prototype);Polymer.Base.extend(DomModule.prototype,{constructor:DomModule,createdCallback:function(){this.register()},register:function(id){var id=id||this.id||this.getAttribute("name")||this.getAttribute("is");if(id){this.id=id;modules[id]=this;lcModules[id.toLowerCase()]=this}},import:function(id,selector){if(id){var m=findModule(id);if(!m){forceDocumentUpgrade();m=findModule(id)}if(m&&selector){m=m.querySelector(selector)}return m}}});var cePolyfill=window.CustomElements&&!CustomElements.useNative;document.registerElement("dom-module",DomModule);function forceDocumentUpgrade(){if(cePolyfill){var script=document._currentScript||document.currentScript;var doc=script&&script.ownerDocument;if(doc){CustomElements.upgradeAll(doc)}}}})();Polymer.Base._addFeature({_prepIs:function(){if(!this.is){var module=(document._currentScript||document.currentScript).parentNode;if(module.localName==="dom-module"){var id=module.id||module.getAttribute("name")||module.getAttribute("is");this.is=id}}if(this.is){this.is=this.is.toLowerCase()}}});Polymer.Base._addFeature({behaviors:[],_desugarBehaviors:function(){if(this.behaviors.length){this.behaviors=this._desugarSomeBehaviors(this.behaviors)}},_desugarSomeBehaviors:function(behaviors){behaviors=this._flattenBehaviorsList(behaviors);for(var i=behaviors.length-1;i>=0;i--){this._mixinBehavior(behaviors[i])}return behaviors},_flattenBehaviorsList:function(behaviors){var flat=[];behaviors.forEach(function(b){if(b instanceof Array){flat=flat.concat(this._flattenBehaviorsList(b))}else if(b){flat.push(b)}else{this._warn(this._logf("_flattenBehaviorsList","behavior is null, check for missing or 404 import"))}},this);return flat},_mixinBehavior:function(b){Object.getOwnPropertyNames(b).forEach(function(n){switch(n){case"hostAttributes":case"registered":case"properties":case"observers":case"listeners":case"created":case"attached":case"detached":case"attributeChanged":case"configure":case"ready":break;default:if(!this.hasOwnProperty(n)){this.copyOwnProperty(n,b,this)}break}},this)},_prepBehaviors:function(){this._prepFlattenedBehaviors(this.behaviors)},_prepFlattenedBehaviors:function(behaviors){for(var i=0,l=behaviors.length;i<l;i++){this._prepBehavior(behaviors[i])}this._prepBehavior(this)},_doBehavior:function(name,args){this.behaviors.forEach(function(b){this._invokeBehavior(b,name,args)},this);this._invokeBehavior(this,name,args)},_invokeBehavior:function(b,name,args){var fn=b[name];if(fn){fn.apply(this,args||Polymer.nar)}},_marshalBehaviors:function(){this.behaviors.forEach(function(b){this._marshalBehavior(b)},this);this._marshalBehavior(this)}});Polymer.Base._addFeature({_getExtendedPrototype:function(tag){return this._getExtendedNativePrototype(tag)},_nativePrototypes:{},_getExtendedNativePrototype:function(tag){var p=this._nativePrototypes[tag];if(!p){var np=this.getNativePrototype(tag);p=this.extend(Object.create(np),Polymer.Base);this._nativePrototypes[tag]=p}return p},getNativePrototype:function(tag){return Object.getPrototypeOf(document.createElement(tag))}});Polymer.Base._addFeature({_prepConstructor:function(){this._factoryArgs=this.extends?[this.extends,this.is]:[this.is];var ctor=function(){return this._factory(arguments)};if(this.hasOwnProperty("extends")){ctor.extends=this.extends}Object.defineProperty(this,"constructor",{value:ctor,writable:true,configurable:true});ctor.prototype=this},_factory:function(args){var elt=document.createElement.apply(document,this._factoryArgs);if(this.factoryImpl){this.factoryImpl.apply(elt,args)}return elt}});Polymer.nob=Object.create(null);Polymer.Base._addFeature({properties:{},getPropertyInfo:function(property){var info=this._getPropertyInfo(property,this.properties);if(!info){this.behaviors.some(function(b){return info=this._getPropertyInfo(property,b.properties)},this)}return info||Polymer.nob},_getPropertyInfo:function(property,properties){var p=properties&&properties[property];if(typeof p==="function"){p=properties[property]={type:p}}if(p){p.defined=true}return p}});Polymer.CaseMap={_caseMap:{},dashToCamelCase:function(dash){var mapped=Polymer.CaseMap._caseMap[dash];if(mapped){return mapped}if(dash.indexOf("-")<0){return Polymer.CaseMap._caseMap[dash]=dash}return Polymer.CaseMap._caseMap[dash]=dash.replace(/-([a-z])/g,function(m){return m[1].toUpperCase()})},camelToDashCase:function(camel){var mapped=Polymer.CaseMap._caseMap[camel];if(mapped){return mapped}return Polymer.CaseMap._caseMap[camel]=camel.replace(/([a-z][A-Z])/g,function(g){return g[0]+"-"+g[1].toLowerCase()})}};Polymer.Base._addFeature({_prepAttributes:function(){this._aggregatedAttributes={}},_addHostAttributes:function(attributes){if(attributes){this.mixin(this._aggregatedAttributes,attributes)}},_marshalHostAttributes:function(){this._applyAttributes(this,this._aggregatedAttributes)},_applyAttributes:function(node,attr$){for(var n in attr$){if(!this.hasAttribute(n)&&n!=="class"){this.serializeValueToAttribute(attr$[n],n,this)}}},_marshalAttributes:function(){this._takeAttributesToModel(this)},_takeAttributesToModel:function(model){for(var i=0,l=this.attributes.length;i<l;i++){this._setAttributeToProperty(model,this.attributes[i].name)}},_setAttributeToProperty:function(model,attrName){if(!this._serializing){var propName=Polymer.CaseMap.dashToCamelCase(attrName);var info=this.getPropertyInfo(propName);if(info.defined||this._propertyEffects&&this._propertyEffects[propName]){var val=this.getAttribute(attrName);model[propName]=this.deserialize(val,info.type)}}},_serializing:false,reflectPropertyToAttribute:function(name){this._serializing=true;this.serializeValueToAttribute(this[name],Polymer.CaseMap.camelToDashCase(name));this._serializing=false},serializeValueToAttribute:function(value,attribute,node){var str=this.serialize(value);(node||this)[str===undefined?"removeAttribute":"setAttribute"](attribute,str)},deserialize:function(value,type){switch(type){case Number:value=Number(value);break;case Boolean:value=value!==null;break;case Object:try{value=JSON.parse(value)}catch(x){}break;case Array:try{value=JSON.parse(value)}catch(x){value=null;console.warn("Polymer::Attributes: couldn`t decode Array as JSON")}break;case Date:value=new Date(value);break;case String:default:break}return value},serialize:function(value){switch(typeof value){case"boolean":return value?"":undefined;case"object":if(value instanceof Date){return value}else if(value){try{return JSON.stringify(value)}catch(x){return""}}default:return value!=null?value:undefined}}});Polymer.Base._addFeature({_setupDebouncers:function(){this._debouncers={}},debounce:function(jobName,callback,wait){return this._debouncers[jobName]=Polymer.Debounce.call(this,this._debouncers[jobName],callback,wait)},isDebouncerActive:function(jobName){var debouncer=this._debouncers[jobName];return debouncer&&debouncer.finish},flushDebouncer:function(jobName){var debouncer=this._debouncers[jobName];if(debouncer){debouncer.complete()}},cancelDebouncer:function(jobName){var debouncer=this._debouncers[jobName];if(debouncer){debouncer.stop()}}});Polymer.version="1.1.5";Polymer.Base._addFeature({_registerFeatures:function(){this._prepIs();this._prepAttributes();this._prepBehaviors();this._prepConstructor()},_prepBehavior:function(b){this._addHostAttributes(b.hostAttributes)},_marshalBehavior:function(b){},_initFeatures:function(){this._marshalHostAttributes();this._setupDebouncers();this._marshalBehaviors()}});Polymer.Base._addFeature({_prepTemplate:function(){this._template=this._template||Polymer.DomModule.import(this.is,"template");if(this._template&&this._template.hasAttribute("is")){this._warn(this._logf("_prepTemplate","top-level Polymer template "+"must not be a type-extension, found",this._template,"Move inside simple <template>."))}if(this._template&&!this._template.content&&HTMLTemplateElement.bootstrap){HTMLTemplateElement.decorate(this._template);HTMLTemplateElement.bootstrap(this._template.content)}},_stampTemplate:function(){if(this._template){this.root=this.instanceTemplate(this._template)}},instanceTemplate:function(template){var dom=document.importNode(template._content||template.content,true);return dom}});(function(){var baseAttachedCallback=Polymer.Base.attachedCallback;Polymer.Base._addFeature({_hostStack:[],ready:function(){},_pushHost:function(host){this.dataHost=host=host||Polymer.Base._hostStack[Polymer.Base._hostStack.length-1];if(host&&host._clients){host._clients.push(this)}this._beginHost()},_beginHost:function(){Polymer.Base._hostStack.push(this);if(!this._clients){this._clients=[]}},_popHost:function(){Polymer.Base._hostStack.pop()},_tryReady:function(){if(this._canReady()){this._ready()}},_canReady:function(){return!this.dataHost||this.dataHost._clientsReadied},_ready:function(){this._beforeClientsReady();this._setupRoot();this._readyClients();this._afterClientsReady();this._readySelf()},_readyClients:function(){this._beginDistribute();var c$=this._clients;for(var i=0,l=c$.length,c;i<l&&(c=c$[i]);i++){c._ready()}this._finishDistribute();this._clientsReadied=true;this._clients=null},_readySelf:function(){this._doBehavior("ready");this._readied=true;if(this._attachedPending){this._attachedPending=false;this.attachedCallback()}},_beforeClientsReady:function(){},_afterClientsReady:function(){},_beforeAttached:function(){},attachedCallback:function(){if(this._readied){this._beforeAttached();baseAttachedCallback.call(this)}else{this._attachedPending=true}}})})();Polymer.ArraySplice=function(){function newSplice(index,removed,addedCount){return{index:index,removed:removed,addedCount:addedCount}}var EDIT_LEAVE=0;var EDIT_UPDATE=1;var EDIT_ADD=2;var EDIT_DELETE=3;function ArraySplice(){}ArraySplice.prototype={calcEditDistances:function(current,currentStart,currentEnd,old,oldStart,oldEnd){var rowCount=oldEnd-oldStart+1;var columnCount=currentEnd-currentStart+1;var distances=new Array(rowCount);for(var i=0;i<rowCount;i++){distances[i]=new Array(columnCount);distances[i][0]=i}for(var j=0;j<columnCount;j++)distances[0][j]=j;for(var i=1;i<rowCount;i++){for(var j=1;j<columnCount;j++){if(this.equals(current[currentStart+j-1],old[oldStart+i-1]))distances[i][j]=distances[i-1][j-1];else{var north=distances[i-1][j]+1;var west=distances[i][j-1]+1;distances[i][j]=north<west?north:west}}}return distances},spliceOperationsFromEditDistances:function(distances){var i=distances.length-1;var j=distances[0].length-1;var current=distances[i][j];var edits=[];while(i>0||j>0){if(i==0){edits.push(EDIT_ADD);j--;continue}if(j==0){edits.push(EDIT_DELETE);i--;continue}var northWest=distances[i-1][j-1];var west=distances[i-1][j];var north=distances[i][j-1];var min;if(west<north)min=west<northWest?west:northWest;else min=north<northWest?north:northWest;if(min==northWest){if(northWest==current){edits.push(EDIT_LEAVE)}else{edits.push(EDIT_UPDATE);current=northWest}i--;j--}else if(min==west){edits.push(EDIT_DELETE);i--;current=west}else{edits.push(EDIT_ADD);j--;current=north}}edits.reverse();return edits},calcSplices:function(current,currentStart,currentEnd,old,oldStart,oldEnd){var prefixCount=0;var suffixCount=0;var minLength=Math.min(currentEnd-currentStart,oldEnd-oldStart);if(currentStart==0&&oldStart==0)prefixCount=this.sharedPrefix(current,old,minLength);if(currentEnd==current.length&&oldEnd==old.length)suffixCount=this.sharedSuffix(current,old,minLength-prefixCount);currentStart+=prefixCount;oldStart+=prefixCount;currentEnd-=suffixCount;oldEnd-=suffixCount;if(currentEnd-currentStart==0&&oldEnd-oldStart==0)return[];if(currentStart==currentEnd){var splice=newSplice(currentStart,[],0);while(oldStart<oldEnd)splice.removed.push(old[oldStart++]);return[splice]}else if(oldStart==oldEnd)return[newSplice(currentStart,[],currentEnd-currentStart)];var ops=this.spliceOperationsFromEditDistances(this.calcEditDistances(current,currentStart,currentEnd,old,oldStart,oldEnd));var splice=undefined;var splices=[];var index=currentStart;var oldIndex=oldStart;for(var i=0;i<ops.length;i++){switch(ops[i]){case EDIT_LEAVE:if(splice){splices.push(splice);splice=undefined}index++;oldIndex++;break;case EDIT_UPDATE:if(!splice)splice=newSplice(index,[],0);splice.addedCount++;index++;splice.removed.push(old[oldIndex]);oldIndex++;break;case EDIT_ADD:if(!splice)splice=newSplice(index,[],0);splice.addedCount++;index++;break;case EDIT_DELETE:if(!splice)splice=newSplice(index,[],0);splice.removed.push(old[oldIndex]);oldIndex++;break}}if(splice){splices.push(splice)}return splices},sharedPrefix:function(current,old,searchLength){for(var i=0;i<searchLength;i++)if(!this.equals(current[i],old[i]))return i;return searchLength},sharedSuffix:function(current,old,searchLength){var index1=current.length;var index2=old.length;var count=0;while(count<searchLength&&this.equals(current[--index1],old[--index2]))count++;return count},calculateSplices:function(current,previous){return this.calcSplices(current,0,current.length,previous,0,previous.length)},equals:function(currentValue,previousValue){return currentValue===previousValue}};return new ArraySplice}();Polymer.EventApi=function(){var Settings=Polymer.Settings;var EventApi=function(event){this.event=event};if(Settings.useShadow){EventApi.prototype={get rootTarget(){return this.event.path[0]},get localTarget(){return this.event.target},get path(){return this.event.path}}}else{EventApi.prototype={get rootTarget(){return this.event.target},get localTarget(){var current=this.event.currentTarget;var currentRoot=current&&Polymer.dom(current).getOwnerRoot();var p$=this.path;for(var i=0;i<p$.length;i++){if(Polymer.dom(p$[i]).getOwnerRoot()===currentRoot){return p$[i]}}},get path(){if(!this.event._path){var path=[];var o=this.rootTarget;while(o){path.push(o);o=Polymer.dom(o).parentNode||o.host}path.push(window);this.event._path=path}return this.event._path}}}var factory=function(event){if(!event.__eventApi){event.__eventApi=new EventApi(event)}return event.__eventApi};return{factory:factory}}();Polymer.domInnerHTML=function(){var escapeAttrRegExp=/[&\u00A0"]/g;var escapeDataRegExp=/[&\u00A0<>]/g;function escapeReplace(c){switch(c){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case" ":return"&nbsp;"}}function escapeAttr(s){return s.replace(escapeAttrRegExp,escapeReplace)}function escapeData(s){return s.replace(escapeDataRegExp,escapeReplace)}function makeSet(arr){var set={};for(var i=0;i<arr.length;i++){set[arr[i]]=true}return set}var voidElements=makeSet(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);var plaintextParents=makeSet(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function getOuterHTML(node,parentNode,composed){switch(node.nodeType){case Node.ELEMENT_NODE:var tagName=node.localName;var s="<"+tagName;var attrs=node.attributes;for(var i=0,attr;attr=attrs[i];i++){s+=" "+attr.name+'="'+escapeAttr(attr.value)+'"'}s+=">";if(voidElements[tagName]){return s}return s+getInnerHTML(node,composed)+"</"+tagName+">";case Node.TEXT_NODE:var data=node.data;if(parentNode&&plaintextParents[parentNode.localName]){return data}return escapeData(data);case Node.COMMENT_NODE:return"\x3c!--"+node.data+"--\x3e";default:console.error(node);throw new Error("not implemented")}}function getInnerHTML(node,composed){if(node instanceof HTMLTemplateElement)node=node.content;var s="";var c$=Polymer.dom(node).childNodes;c$=composed?node._composedChildren:c$;for(var i=0,l=c$.length,child;i<l&&(child=c$[i]);i++){s+=getOuterHTML(child,node,composed)}return s}return{getInnerHTML:getInnerHTML}}();Polymer.DomApi=function(){"use strict";var Settings=Polymer.Settings;var getInnerHTML=Polymer.domInnerHTML.getInnerHTML;var nativeInsertBefore=Element.prototype.insertBefore;var nativeRemoveChild=Element.prototype.removeChild;var nativeAppendChild=Element.prototype.appendChild;var nativeCloneNode=Element.prototype.cloneNode;var nativeImportNode=Document.prototype.importNode;var DomApi=function(node){this.node=node;if(this.patch){this.patch()}};if(window.wrap&&Settings.useShadow&&!Settings.useNativeShadow){DomApi=function(node){this.node=wrap(node);if(this.patch){this.patch()}}}DomApi.prototype={flush:function(){Polymer.dom.flush()},_lazyDistribute:function(host){if(host.shadyRoot&&host.shadyRoot._distributionClean){host.shadyRoot._distributionClean=false;Polymer.dom.addDebouncer(host.debounce("_distribute",host._distributeContent))}},appendChild:function(node){return this._addNode(node)},insertBefore:function(node,ref_node){return this._addNode(node,ref_node)},_addNode:function(node,ref_node){this._removeNodeFromHost(node,true);var addedInsertionPoint
;var root=this.getOwnerRoot();if(root){addedInsertionPoint=this._maybeAddInsertionPoint(node,this.node)}if(this._nodeHasLogicalChildren(this.node)){if(ref_node){var children=this.childNodes;var index=children.indexOf(ref_node);if(index<0){throw Error("The ref_node to be inserted before is not a child "+"of this node")}}this._addLogicalInfo(node,this.node,index)}this._addNodeToHost(node);if(!this._maybeDistribute(node,this.node)&&!this._tryRemoveUndistributedNode(node)){if(ref_node){ref_node=ref_node.localName===CONTENT?this._firstComposedNode(ref_node):ref_node}var container=this.node._isShadyRoot?this.node.host:this.node;addToComposedParent(container,node,ref_node);if(ref_node){nativeInsertBefore.call(container,node,ref_node)}else{nativeAppendChild.call(container,node)}}if(addedInsertionPoint){this._updateInsertionPoints(root.host)}return node},removeChild:function(node){if(factory(node).parentNode!==this.node){console.warn("The node to be removed is not a child of this node",node)}this._removeNodeFromHost(node);if(!this._maybeDistribute(node,this.node)){var container=this.node._isShadyRoot?this.node.host:this.node;if(container===node.parentNode){removeFromComposedParent(container,node);nativeRemoveChild.call(container,node)}}return node},replaceChild:function(node,ref_node){this.insertBefore(node,ref_node);this.removeChild(ref_node);return node},_hasCachedOwnerRoot:function(node){return Boolean(node._ownerShadyRoot!==undefined)},getOwnerRoot:function(){return this._ownerShadyRootForNode(this.node)},_ownerShadyRootForNode:function(node){if(!node){return}if(node._ownerShadyRoot===undefined){var root;if(node._isShadyRoot){root=node}else{var parent=Polymer.dom(node).parentNode;if(parent){root=parent._isShadyRoot?parent:this._ownerShadyRootForNode(parent)}else{root=null}}node._ownerShadyRoot=root}return node._ownerShadyRoot},_maybeDistribute:function(node,parent){var fragContent=node.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&!node.__noContent&&Polymer.dom(node).querySelector(CONTENT);var wrappedContent=fragContent&&Polymer.dom(fragContent).parentNode.nodeType!==Node.DOCUMENT_FRAGMENT_NODE;var hasContent=fragContent||node.localName===CONTENT;if(hasContent){var root=this._ownerShadyRootForNode(parent);if(root){var host=root.host;this._lazyDistribute(host)}}var parentNeedsDist=this._parentNeedsDistribution(parent);if(parentNeedsDist){this._lazyDistribute(parent)}return parentNeedsDist||hasContent&&!wrappedContent},_maybeAddInsertionPoint:function(node,parent){var added;if(node.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&!node.__noContent){var c$=factory(node).querySelectorAll(CONTENT);for(var i=0,n,np,na;i<c$.length&&(n=c$[i]);i++){np=factory(n).parentNode;if(np===node){np=parent}na=this._maybeAddInsertionPoint(n,np);added=added||na}}else if(node.localName===CONTENT){saveLightChildrenIfNeeded(parent);saveLightChildrenIfNeeded(node);added=true}return added},_tryRemoveUndistributedNode:function(node){if(this.node.shadyRoot){var parent=getComposedParent(node);if(parent){nativeRemoveChild.call(parent,node)}return true}},_updateInsertionPoints:function(host){var i$=host.shadyRoot._insertionPoints=factory(host.shadyRoot).querySelectorAll(CONTENT);for(var i=0,c;i<i$.length;i++){c=i$[i];saveLightChildrenIfNeeded(c);saveLightChildrenIfNeeded(factory(c).parentNode)}},_nodeHasLogicalChildren:function(node){return Boolean(node._lightChildren!==undefined)},_parentNeedsDistribution:function(parent){return parent&&parent.shadyRoot&&hasInsertionPoint(parent.shadyRoot)},_removeNodeFromHost:function(node,ensureComposedRemoval){var hostNeedsDist;var root;var parent=node._lightParent;if(parent){factory(node)._distributeParent();root=this._ownerShadyRootForNode(node);if(root){root.host._elementRemove(node);hostNeedsDist=this._removeDistributedChildren(root,node)}this._removeLogicalInfo(node,node._lightParent)}this._removeOwnerShadyRoot(node);if(root&&hostNeedsDist){this._updateInsertionPoints(root.host);this._lazyDistribute(root.host)}else if(ensureComposedRemoval){removeFromComposedParent(getComposedParent(node),node)}},_removeDistributedChildren:function(root,container){var hostNeedsDist;var ip$=root._insertionPoints;for(var i=0;i<ip$.length;i++){var content=ip$[i];if(this._contains(container,content)){var dc$=factory(content).getDistributedNodes();for(var j=0;j<dc$.length;j++){hostNeedsDist=true;var node=dc$[j];var parent=node.parentNode;if(parent){removeFromComposedParent(parent,node);nativeRemoveChild.call(parent,node)}}}}return hostNeedsDist},_contains:function(container,node){while(node){if(node==container){return true}node=factory(node).parentNode}},_addNodeToHost:function(node){var root=this.getOwnerRoot();if(root){root.host._elementAdd(node)}},_addLogicalInfo:function(node,container,index){var children=factory(container).childNodes;index=index===undefined?children.length:index;if(node.nodeType===Node.DOCUMENT_FRAGMENT_NODE){var c$=Array.prototype.slice.call(node.childNodes);for(var i=0,n;i<c$.length&&(n=c$[i]);i++){children.splice(index++,0,n);n._lightParent=container}}else{children.splice(index,0,node);node._lightParent=container}},_removeLogicalInfo:function(node,container){var children=factory(container).childNodes;var index=children.indexOf(node);if(index<0||container!==node._lightParent){throw Error("The node to be removed is not a child of this node")}children.splice(index,1);node._lightParent=null},_removeOwnerShadyRoot:function(node){if(this._hasCachedOwnerRoot(node)){var c$=factory(node).childNodes;for(var i=0,l=c$.length,n;i<l&&(n=c$[i]);i++){this._removeOwnerShadyRoot(n)}}node._ownerShadyRoot=undefined},_firstComposedNode:function(content){var n$=factory(content).getDistributedNodes();for(var i=0,l=n$.length,n,p$;i<l&&(n=n$[i]);i++){p$=factory(n).getDestinationInsertionPoints();if(p$[p$.length-1]===content){return n}}},querySelector:function(selector){return this.querySelectorAll(selector)[0]},querySelectorAll:function(selector){return this._query(function(n){return matchesSelector.call(n,selector)},this.node)},_query:function(matcher,node){node=node||this.node;var list=[];this._queryElements(factory(node).childNodes,matcher,list);return list},_queryElements:function(elements,matcher,list){for(var i=0,l=elements.length,c;i<l&&(c=elements[i]);i++){if(c.nodeType===Node.ELEMENT_NODE){this._queryElement(c,matcher,list)}}},_queryElement:function(node,matcher,list){if(matcher(node)){list.push(node)}this._queryElements(factory(node).childNodes,matcher,list)},getDestinationInsertionPoints:function(){return this.node._destinationInsertionPoints||[]},getDistributedNodes:function(){return this.node._distributedNodes||[]},queryDistributedElements:function(selector){var c$=this.childNodes;var list=[];this._distributedFilter(selector,c$,list);for(var i=0,l=c$.length,c;i<l&&(c=c$[i]);i++){if(c.localName===CONTENT){this._distributedFilter(selector,factory(c).getDistributedNodes(),list)}}return list},_distributedFilter:function(selector,list,results){results=results||[];for(var i=0,l=list.length,d;i<l&&(d=list[i]);i++){if(d.nodeType===Node.ELEMENT_NODE&&d.localName!==CONTENT&&matchesSelector.call(d,selector)){results.push(d)}}return results},_clear:function(){while(this.childNodes.length){this.removeChild(this.childNodes[0])}},setAttribute:function(name,value){this.node.setAttribute(name,value);this._distributeParent()},removeAttribute:function(name){this.node.removeAttribute(name);this._distributeParent()},_distributeParent:function(){if(this._parentNeedsDistribution(this.parentNode)){this._lazyDistribute(this.parentNode)}},cloneNode:function(deep){var n=nativeCloneNode.call(this.node,false);if(deep){var c$=this.childNodes;var d=factory(n);for(var i=0,nc;i<c$.length;i++){nc=factory(c$[i]).cloneNode(true);d.appendChild(nc)}}return n},importNode:function(externalNode,deep){var doc=this.node instanceof Document?this.node:this.node.ownerDocument;var n=nativeImportNode.call(doc,externalNode,false);if(deep){var c$=factory(externalNode).childNodes;var d=factory(n);for(var i=0,nc;i<c$.length;i++){nc=factory(doc).importNode(c$[i],true);d.appendChild(nc)}}return n}};Object.defineProperty(DomApi.prototype,"classList",{get:function(){if(!this._classList){this._classList=new DomApi.ClassList(this)}return this._classList},configurable:true});DomApi.ClassList=function(host){this.domApi=host;this.node=host.node};DomApi.ClassList.prototype={add:function(){this.node.classList.add.apply(this.node.classList,arguments);this.domApi._distributeParent()},remove:function(){this.node.classList.remove.apply(this.node.classList,arguments);this.domApi._distributeParent()},toggle:function(){this.node.classList.toggle.apply(this.node.classList,arguments);this.domApi._distributeParent()},contains:function(){return this.node.classList.contains.apply(this.node.classList,arguments)}};if(!Settings.useShadow){Object.defineProperties(DomApi.prototype,{childNodes:{get:function(){var c$=getLightChildren(this.node);return Array.isArray(c$)?c$:Array.prototype.slice.call(c$)},configurable:true},children:{get:function(){return Array.prototype.filter.call(this.childNodes,function(n){return n.nodeType===Node.ELEMENT_NODE})},configurable:true},parentNode:{get:function(){return this.node._lightParent||getComposedParent(this.node)},configurable:true},firstChild:{get:function(){return this.childNodes[0]},configurable:true},lastChild:{get:function(){var c$=this.childNodes;return c$[c$.length-1]},configurable:true},nextSibling:{get:function(){var c$=this.parentNode&&factory(this.parentNode).childNodes;if(c$){return c$[Array.prototype.indexOf.call(c$,this.node)+1]}},configurable:true},previousSibling:{get:function(){var c$=this.parentNode&&factory(this.parentNode).childNodes;if(c$){return c$[Array.prototype.indexOf.call(c$,this.node)-1]}},configurable:true},firstElementChild:{get:function(){return this.children[0]},configurable:true},lastElementChild:{get:function(){var c$=this.children;return c$[c$.length-1]},configurable:true},nextElementSibling:{get:function(){var c$=this.parentNode&&factory(this.parentNode).children;if(c$){return c$[Array.prototype.indexOf.call(c$,this.node)+1]}},configurable:true},previousElementSibling:{get:function(){var c$=this.parentNode&&factory(this.parentNode).children;if(c$){return c$[Array.prototype.indexOf.call(c$,this.node)-1]}},configurable:true},textContent:{get:function(){var nt=this.node.nodeType;if(nt===Node.TEXT_NODE||nt===Node.COMMENT_NODE){return this.node.textContent}else{var tc=[];for(var i=0,cn=this.childNodes,c;c=cn[i];i++){if(c.nodeType!==Node.COMMENT_NODE){tc.push(c.textContent)}}return tc.join("")}},set:function(text){var nt=this.node.nodeType;if(nt===Node.TEXT_NODE||nt===Node.COMMENT_NODE){this.node.textContent=text}else{this._clear();if(text){this.appendChild(document.createTextNode(text))}}},configurable:true},innerHTML:{get:function(){var nt=this.node.nodeType;if(nt===Node.TEXT_NODE||nt===Node.COMMENT_NODE){return null}else{return getInnerHTML(this.node)}},set:function(text){var nt=this.node.nodeType;if(nt!==Node.TEXT_NODE||nt!==Node.COMMENT_NODE){this._clear();var d=document.createElement("div");d.innerHTML=text;var c$=Array.prototype.slice.call(d.childNodes);for(var i=0;i<c$.length;i++){this.appendChild(c$[i])}}},configurable:true}});DomApi.prototype._getComposedInnerHTML=function(){return getInnerHTML(this.node,true)}}else{var forwardMethods=["cloneNode","appendChild","insertBefore","removeChild","replaceChild"];forwardMethods.forEach(function(name){DomApi.prototype[name]=function(){return this.node[name].apply(this.node,arguments)}});DomApi.prototype.querySelectorAll=function(selector){return Array.prototype.slice.call(this.node.querySelectorAll(selector))};DomApi.prototype.getOwnerRoot=function(){var n=this.node;while(n){if(n.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&n.host){return n}n=n.parentNode}};DomApi.prototype.importNode=function(externalNode,deep){var doc=this.node instanceof Document?this.node:this.node.ownerDocument;return doc.importNode(externalNode,deep)};DomApi.prototype.getDestinationInsertionPoints=function(){var n$=this.node.getDestinationInsertionPoints&&this.node.getDestinationInsertionPoints();return n$?Array.prototype.slice.call(n$):[]};DomApi.prototype.getDistributedNodes=function(){var n$=this.node.getDistributedNodes&&this.node.getDistributedNodes();return n$?Array.prototype.slice.call(n$):[]};DomApi.prototype._distributeParent=function(){};Object.defineProperties(DomApi.prototype,{childNodes:{get:function(){return Array.prototype.slice.call(this.node.childNodes)},configurable:true},children:{get:function(){return Array.prototype.slice.call(this.node.children)},configurable:true},textContent:{get:function(){return this.node.textContent},set:function(value){return this.node.textContent=value},configurable:true},innerHTML:{get:function(){return this.node.innerHTML},set:function(value){return this.node.innerHTML=value},configurable:true}});var forwardProperties=["parentNode","firstChild","lastChild","nextSibling","previousSibling","firstElementChild","lastElementChild","nextElementSibling","previousElementSibling"];forwardProperties.forEach(function(name){Object.defineProperty(DomApi.prototype,name,{get:function(){return this.node[name]},configurable:true})})}var CONTENT="content";var factory=function(node,patch){node=node||document;if(!node.__domApi){node.__domApi=new DomApi(node,patch)}return node.__domApi};Polymer.dom=function(obj,patch){if(obj instanceof Event){return Polymer.EventApi.factory(obj)}else{return factory(obj,patch)}};Polymer.Base.extend(Polymer.dom,{_flushGuard:0,_FLUSH_MAX:100,_needsTakeRecords:!Polymer.Settings.useNativeCustomElements,_debouncers:[],_finishDebouncer:null,flush:function(){for(var i=0;i<this._debouncers.length;i++){this._debouncers[i].complete()}if(this._finishDebouncer){this._finishDebouncer.complete()}this._flushPolyfills();if(this._debouncers.length&&this._flushGuard<this._FLUSH_MAX){this._flushGuard++;this.flush()}else{if(this._flushGuard>=this._FLUSH_MAX){console.warn("Polymer.dom.flush aborted. Flush may not be complete.")}this._flushGuard=0}},_flushPolyfills:function(){if(this._needsTakeRecords){CustomElements.takeRecords()}},addDebouncer:function(debouncer){this._debouncers.push(debouncer);this._finishDebouncer=Polymer.Debounce(this._finishDebouncer,this._finishFlush)},_finishFlush:function(){Polymer.dom._debouncers=[]}});function getLightChildren(node){var children=node._lightChildren;return children?children:node.childNodes}function getComposedChildren(node){if(!node._composedChildren){node._composedChildren=Array.prototype.slice.call(node.childNodes)}return node._composedChildren}function addToComposedParent(parent,node,ref_node){var children=getComposedChildren(parent);var i=ref_node?children.indexOf(ref_node):-1;if(node.nodeType===Node.DOCUMENT_FRAGMENT_NODE){var fragChildren=getComposedChildren(node);for(var j=0;j<fragChildren.length;j++){addNodeToComposedChildren(fragChildren[j],parent,children,i+j)}node._composedChildren=null}else{addNodeToComposedChildren(node,parent,children,i)}}function getComposedParent(node){return node.__patched?node._composedParent:node.parentNode}function addNodeToComposedChildren(node,parent,children,i){node._composedParent=parent;children.splice(i>=0?i:children.length,0,node)}function removeFromComposedParent(parent,node){node._composedParent=null;if(parent){var children=getComposedChildren(parent);var i=children.indexOf(node);if(i>=0){children.splice(i,1)}}}function saveLightChildrenIfNeeded(node){if(!node._lightChildren){var c$=Array.prototype.slice.call(node.childNodes);for(var i=0,l=c$.length,child;i<l&&(child=c$[i]);i++){child._lightParent=child._lightParent||node}node._lightChildren=c$}}function hasInsertionPoint(root){return Boolean(root&&root._insertionPoints.length)}var p=Element.prototype;var matchesSelector=p.matches||p.matchesSelector||p.mozMatchesSelector||p.msMatchesSelector||p.oMatchesSelector||p.webkitMatchesSelector;return{getLightChildren:getLightChildren,getComposedParent:getComposedParent,getComposedChildren:getComposedChildren,removeFromComposedParent:removeFromComposedParent,saveLightChildrenIfNeeded:saveLightChildrenIfNeeded,matchesSelector:matchesSelector,hasInsertionPoint:hasInsertionPoint,ctor:DomApi,factory:factory}}();(function(){Polymer.Base._addFeature({_prepShady:function(){this._useContent=this._useContent||Boolean(this._template)},_poolContent:function(){if(this._useContent){saveLightChildrenIfNeeded(this)}},_setupRoot:function(){if(this._useContent){this._createLocalRoot();if(!this.dataHost){upgradeLightChildren(this._lightChildren)}}},_createLocalRoot:function(){this.shadyRoot=this.root;this.shadyRoot._distributionClean=false;this.shadyRoot._isShadyRoot=true;this.shadyRoot._dirtyRoots=[];var i$=this.shadyRoot._insertionPoints=!this._notes||this._notes._hasContent?this.shadyRoot.querySelectorAll("content"):[];saveLightChildrenIfNeeded(this.shadyRoot);for(var i=0,c;i<i$.length;i++){c=i$[i];saveLightChildrenIfNeeded(c);saveLightChildrenIfNeeded(c.parentNode)}this.shadyRoot.host=this},get domHost(){var root=Polymer.dom(this).getOwnerRoot();return root&&root.host},distributeContent:function(updateInsertionPoints){if(this.shadyRoot){var dom=Polymer.dom(this);if(updateInsertionPoints){dom._updateInsertionPoints(this)}var host=getTopDistributingHost(this);dom._lazyDistribute(host)}},_distributeContent:function(){if(this._useContent&&!this.shadyRoot._distributionClean){this._beginDistribute();this._distributeDirtyRoots();this._finishDistribute()}},_beginDistribute:function(){if(this._useContent&&hasInsertionPoint(this.shadyRoot)){this._resetDistribution();this._distributePool(this.shadyRoot,this._collectPool())}},_distributeDirtyRoots:function(){var c$=this.shadyRoot._dirtyRoots;for(var i=0,l=c$.length,c;i<l&&(c=c$[i]);i++){c._distributeContent()}this.shadyRoot._dirtyRoots=[]},_finishDistribute:function(){if(this._useContent){this.shadyRoot._distributionClean=true;if(hasInsertionPoint(this.shadyRoot)){this._composeTree()}else{if(!this.shadyRoot._hasDistributed){this.textContent="";this._composedChildren=null;this.appendChild(this.shadyRoot)}else{var children=this._composeNode(this);this._updateChildNodes(this,children)}}this.shadyRoot._hasDistributed=true}},elementMatches:function(selector,node){node=node||this;return matchesSelector.call(node,selector)},_resetDistribution:function(){var children=getLightChildren(this);for(var i=0;i<children.length;i++){var child=children[i];if(child._destinationInsertionPoints){child._destinationInsertionPoints=undefined}if(isInsertionPoint(child)){clearDistributedDestinationInsertionPoints(child)}}var root=this.shadyRoot;var p$=root._insertionPoints;for(var j=0;j<p$.length;j++){p$[j]._distributedNodes=[]}},_collectPool:function(){var pool=[];var children=getLightChildren(this);for(var i=0;i<children.length;i++){var child=children[i];if(isInsertionPoint(child)){pool.push.apply(pool,child._distributedNodes)}else{pool.push(child)}}return pool},_distributePool:function(node,pool){var p$=node._insertionPoints;for(var i=0,l=p$.length,p;i<l&&(p=p$[i]);i++){this._distributeInsertionPoint(p,pool);maybeRedistributeParent(p,this)}},_distributeInsertionPoint:function(content,pool){var anyDistributed=false;for(var i=0,l=pool.length,node;i<l;i++){node=pool[i];if(!node){continue}if(this._matchesContentSelect(node,content)){distributeNodeInto(node,content);pool[i]=undefined;anyDistributed=true}}if(!anyDistributed){var children=getLightChildren(content);for(var j=0;j<children.length;j++){distributeNodeInto(children[j],content)}}},_composeTree:function(){this._updateChildNodes(this,this._composeNode(this));var p$=this.shadyRoot._insertionPoints;for(var i=0,l=p$.length,p,parent;i<l&&(p=p$[i]);i++){parent=p._lightParent||p.parentNode;if(!parent._useContent&&parent!==this&&parent!==this.shadyRoot){this._updateChildNodes(parent,this._composeNode(parent))}}},_composeNode:function(node){var children=[];var c$=getLightChildren(node.shadyRoot||node);for(var i=0;i<c$.length;i++){var child=c$[i];if(isInsertionPoint(child)){var distributedNodes=child._distributedNodes;for(var j=0;j<distributedNodes.length;j++){var distributedNode=distributedNodes[j];if(isFinalDestination(child,distributedNode)){children.push(distributedNode)}}}else{children.push(child)}}return children},_updateChildNodes:function(container,children){var composed=getComposedChildren(container);var splices=Polymer.ArraySplice.calculateSplices(children,composed);for(var i=0,d=0,s;i<splices.length&&(s=splices[i]);i++){for(var j=0,n;j<s.removed.length&&(n=s.removed[j]);j++){if(getComposedParent(n)===container){remove(n)}composed.splice(s.index+d,1)}d-=s.addedCount}for(var i=0,s,next;i<splices.length&&(s=splices[i]);i++){next=composed[s.index];for(var j=s.index,n;j<s.index+s.addedCount;j++){n=children[j];insertBefore(container,n,next);composed.splice(j,0,n)}}ensureComposedParent(container,children)},_matchesContentSelect:function(node,contentElement){var select=contentElement.getAttribute("select");if(!select){return true}select=select.trim();if(!select){return true}if(!(node instanceof Element)){return false}var validSelectors=/^(:not\()?[*.#[a-zA-Z_|]/;if(!validSelectors.test(select)){return false}return this.elementMatches(select,node)},_elementAdd:function(){},_elementRemove:function(){}});var saveLightChildrenIfNeeded=Polymer.DomApi.saveLightChildrenIfNeeded;var getLightChildren=Polymer.DomApi.getLightChildren;var matchesSelector=Polymer.DomApi.matchesSelector;var hasInsertionPoint=Polymer.DomApi.hasInsertionPoint;var getComposedChildren=Polymer.DomApi.getComposedChildren;var getComposedParent=Polymer.DomApi.getComposedParent;var removeFromComposedParent=Polymer.DomApi.removeFromComposedParent;function distributeNodeInto(child,insertionPoint){insertionPoint._distributedNodes.push(child);var points=child._destinationInsertionPoints;if(!points){child._destinationInsertionPoints=[insertionPoint]}else{points.push(insertionPoint)}}function clearDistributedDestinationInsertionPoints(content){var e$=content._distributedNodes;if(e$){for(var i=0;i<e$.length;i++){var d=e$[i]._destinationInsertionPoints;if(d){d.splice(d.indexOf(content)+1,d.length)}}}}function maybeRedistributeParent(content,host){var parent=content._lightParent;if(parent&&parent.shadyRoot&&hasInsertionPoint(parent.shadyRoot)&&parent.shadyRoot._distributionClean){parent.shadyRoot._distributionClean=false;host.shadyRoot._dirtyRoots.push(parent)}}function isFinalDestination(insertionPoint,node){var points=node._destinationInsertionPoints;return points&&points[points.length-1]===insertionPoint}function isInsertionPoint(node){return node.localName=="content"}var nativeInsertBefore=Element.prototype.insertBefore;var nativeRemoveChild=Element.prototype.removeChild;function insertBefore(parentNode,newChild,refChild){var newChildParent=getComposedParent(newChild);if(newChildParent!==parentNode){removeFromComposedParent(newChildParent,newChild)}remove(newChild);nativeInsertBefore.call(parentNode,newChild,refChild||null);newChild._composedParent=parentNode}function remove(node){var parentNode=getComposedParent(node);if(parentNode){node._composedParent=null;nativeRemoveChild.call(parentNode,node)}}function ensureComposedParent(parent,children){for(var i=0,n;i<children.length;i++){children[i]._composedParent=parent}}function getTopDistributingHost(host){while(host&&hostNeedsRedistribution(host)){host=host.domHost}return host}function hostNeedsRedistribution(host){var c$=Polymer.dom(host).children;for(var i=0,c;i<c$.length;i++){c=c$[i];if(c.localName==="content"){return host.domHost}}}var needsUpgrade=window.CustomElements&&!CustomElements.useNative;function upgradeLightChildren(children){if(needsUpgrade&&children){for(var i=0;i<children.length;i++){CustomElements.upgrade(children[i])}}}})();if(Polymer.Settings.useShadow){Polymer.Base._addFeature({_poolContent:function(){},_beginDistribute:function(){},distributeContent:function(){},_distributeContent:function(){},_finishDistribute:function(){},_createLocalRoot:function(){this.createShadowRoot();this.shadowRoot.appendChild(this.root);this.root=this.shadowRoot}})}Polymer.DomModule=document.createElement("dom-module");Polymer.Base._addFeature({_registerFeatures:function(){this._prepIs();this._prepAttributes();this._prepBehaviors();this._prepConstructor();this._prepTemplate();this._prepShady()},_prepBehavior:function(b){this._addHostAttributes(b.hostAttributes)},_initFeatures:function(){this._poolContent();this._pushHost();this._stampTemplate();this._popHost();this._marshalHostAttributes();this._setupDebouncers();this._marshalBehaviors();this._tryReady()},_marshalBehavior:function(b){}});Polymer.nar=[];Polymer.Annotations={parseAnnotations:function(template){var list=[];var content=template._content||template.content;this._parseNodeAnnotations(content,list);return list},_parseNodeAnnotations:function(node,list){return node.nodeType===Node.TEXT_NODE?this._parseTextNodeAnnotation(node,list):this._parseElementAnnotations(node,list)},_testEscape:function(value){var escape=value.slice(0,2);if(escape==="{{"||escape==="[["){return escape}},_parseTextNodeAnnotation:function(node,list){var v=node.textContent;var escape=this._testEscape(v);if(escape){node.textContent=" ";var annote={bindings:[{kind:"text",mode:escape[0],value:v.slice(2,-2).trim()}]};list.push(annote);return annote}},_parseElementAnnotations:function(element,list){var annote={bindings:[],events:[]};if(element.localName==="content"){list._hasContent=true}this._parseChildNodesAnnotations(element,annote,list);if(element.attributes){this._parseNodeAttributeAnnotations(element,annote,list);if(this.prepElement){this.prepElement(element)}}if(annote.bindings.length||annote.events.length||annote.id){list.push(annote)}return annote},_parseChildNodesAnnotations:function(root,annote,list,callback){if(root.firstChild){for(var i=0,node=root.firstChild;node;node=node.nextSibling,i++){if(node.localName==="template"&&!node.hasAttribute("preserve-content")){this._parseTemplate(node,i,list,annote)}if(node.nodeType===Node.TEXT_NODE){var n=node.nextSibling;while(n&&n.nodeType===Node.TEXT_NODE){node.textContent+=n.textContent;root.removeChild(n);n=n.nextSibling}}var childAnnotation=this._parseNodeAnnotations(node,list,callback);if(childAnnotation){childAnnotation.parent=annote;childAnnotation.index=i}}}},_parseTemplate:function(node,index,list,parent){var content=document.createDocumentFragment();content._notes=this.parseAnnotations(node);content.appendChild(node.content);list.push({bindings:Polymer.nar,events:Polymer.nar,templateContent:content,parent:parent,index:index})},_parseNodeAttributeAnnotations:function(node,annotation){for(var i=node.attributes.length-1,a;a=node.attributes[i];i--){var n=a.name,v=a.value;if(n==="id"&&!this._testEscape(v)){annotation.id=v}else if(n.slice(0,3)==="on-"){node.removeAttribute(n);annotation.events.push({name:n.slice(3),value:v})}else{var b=this._parseNodeAttributeAnnotation(node,n,v);if(b){annotation.bindings.push(b)}}}},_parseNodeAttributeAnnotation:function(node,n,v){var escape=this._testEscape(v);if(escape){var customEvent;var name=n;var mode=escape[0];v=v.slice(2,-2).trim();var not=false;if(v[0]=="!"){v=v.substring(1);not=true}var kind="property";if(n[n.length-1]=="$"){name=n.slice(0,-1);kind="attribute"}var notifyEvent,colon;if(mode=="{"&&(colon=v.indexOf("::"))>0){notifyEvent=v.substring(colon+2);v=v.substring(0,colon);customEvent=true}if(node.localName=="input"&&n=="value"){node.setAttribute(n,"")}node.removeAttribute(n);if(kind==="property"){name=Polymer.CaseMap.dashToCamelCase(name)}return{kind:kind,mode:mode,name:name,value:v,negate:not,event:notifyEvent,customEvent:customEvent}}},_localSubTree:function(node,host){return node===host?node.childNodes:node._lightChildren||node.childNodes},findAnnotatedNode:function(root,annote){var parent=annote.parent&&Polymer.Annotations.findAnnotatedNode(root,annote.parent);return!parent?root:Polymer.Annotations._localSubTree(parent,root)[annote.index]}};(function(){function resolveCss(cssText,ownerDocument){return cssText.replace(CSS_URL_RX,function(m,pre,url,post){return pre+"'"+resolve(url.replace(/["']/g,""),ownerDocument)+"'"+post})}function resolveAttrs(element,ownerDocument){for(var name in URL_ATTRS){var a$=URL_ATTRS[name];for(var i=0,l=a$.length,a,at,v;i<l&&(a=a$[i]);i++){if(name==="*"||element.localName===name){at=element.attributes[a];v=at&&at.value;if(v&&v.search(BINDING_RX)<0){at.value=a==="style"?resolveCss(v,ownerDocument):resolve(v,ownerDocument)}}}}}function resolve(url,ownerDocument){if(url&&url[0]==="#"){return url}var resolver=getUrlResolver(ownerDocument);resolver.href=url;return resolver.href||url}var tempDoc;var tempDocBase;function resolveUrl(url,baseUri){if(!tempDoc){tempDoc=document.implementation.createHTMLDocument("temp");tempDocBase=tempDoc.createElement("base");tempDoc.head.appendChild(tempDocBase)}tempDocBase.href=baseUri;return resolve(url,tempDoc)}function getUrlResolver(ownerDocument){return ownerDocument.__urlResolver||(ownerDocument.__urlResolver=ownerDocument.createElement("a"))}var CSS_URL_RX=/(url\()([^)]*)(\))/g;var URL_ATTRS={"*":["href","src","style","url"],form:["action"]};var BINDING_RX=/\{\{|\[\[/;Polymer.ResolveUrl={resolveCss:resolveCss,resolveAttrs:resolveAttrs,resolveUrl:resolveUrl}})();Polymer.Base._addFeature({_prepAnnotations:function(){if(!this._template){this._notes=[]}else{Polymer.Annotations.prepElement=this._prepElement.bind(this);if(this._template._content&&this._template._content._notes){this._notes=this._template._content._notes}else{this._notes=Polymer.Annotations.parseAnnotations(this._template)}this._processAnnotations(this._notes);Polymer.Annotations.prepElement=null}},_processAnnotations:function(notes){for(var i=0;i<notes.length;i++){var note=notes[i];for(var j=0;j<note.bindings.length;j++){var b=note.bindings[j];b.signature=this._parseMethod(b.value);if(!b.signature){b.model=this._modelForPath(b.value)}}if(note.templateContent){this._processAnnotations(note.templateContent._notes);var pp=note.templateContent._parentProps=this._discoverTemplateParentProps(note.templateContent._notes);var bindings=[];for(var prop in pp){bindings.push({index:note.index,kind:"property",mode:"{",name:"_parent_"+prop,model:prop,value:prop})}note.bindings=note.bindings.concat(bindings)}}},_discoverTemplateParentProps:function(notes){var pp={};notes.forEach(function(n){n.bindings.forEach(function(b){if(b.signature){var args=b.signature.args;for(var k=0;k<args.length;k++){pp[args[k].model]=true}}else{pp[b.model]=true}});if(n.templateContent){var tpp=n.templateContent._parentProps;Polymer.Base.mixin(pp,tpp)}});return pp},_prepElement:function(element){Polymer.ResolveUrl.resolveAttrs(element,this._template.ownerDocument)},_findAnnotatedNode:Polymer.Annotations.findAnnotatedNode,_marshalAnnotationReferences:function(){if(this._template){this._marshalIdNodes();this._marshalAnnotatedNodes();this._marshalAnnotatedListeners()}},_configureAnnotationReferences:function(){this._configureTemplateContent()},_configureTemplateContent:function(){this._notes.forEach(function(note,i){if(note.templateContent){this._nodes[i]._content=note.templateContent}},this)},_marshalIdNodes:function(){this.$={};this._notes.forEach(function(a){if(a.id){this.$[a.id]=this._findAnnotatedNode(this.root,a)}},this)},_marshalAnnotatedNodes:function(){if(this._nodes){this._nodes=this._nodes.map(function(a){return this._findAnnotatedNode(this.root,a)},this)}},_marshalAnnotatedListeners:function(){this._notes.forEach(function(a){if(a.events&&a.events.length){var node=this._findAnnotatedNode(this.root,a);a.events.forEach(function(e){this.listen(node,e.name,e.value)},this)}},this)}});Polymer.Base._addFeature({listeners:{},_listenListeners:function(listeners){var node,name,key;for(key in listeners){if(key.indexOf(".")<0){node=this;name=key}else{name=key.split(".");node=this.$[name[0]];name=name[1]}this.listen(node,name,listeners[key])}},listen:function(node,eventName,methodName){
var handler=this._recallEventHandler(this,eventName,node,methodName);if(!handler){handler=this._createEventHandler(node,eventName,methodName)}if(handler._listening){return}this._listen(node,eventName,handler);handler._listening=true},_boundListenerKey:function(eventName,methodName){return eventName+":"+methodName},_recordEventHandler:function(host,eventName,target,methodName,handler){var hbl=host.__boundListeners;if(!hbl){hbl=host.__boundListeners=new WeakMap}var bl=hbl.get(target);if(!bl){bl={};hbl.set(target,bl)}var key=this._boundListenerKey(eventName,methodName);bl[key]=handler},_recallEventHandler:function(host,eventName,target,methodName){var hbl=host.__boundListeners;if(!hbl){return}var bl=hbl.get(target);if(!bl){return}var key=this._boundListenerKey(eventName,methodName);return bl[key]},_createEventHandler:function(node,eventName,methodName){var host=this;var handler=function(e){if(host[methodName]){host[methodName](e,e.detail)}else{host._warn(host._logf("_createEventHandler","listener method `"+methodName+"` not defined"))}};handler._listening=false;this._recordEventHandler(host,eventName,node,methodName,handler);return handler},unlisten:function(node,eventName,methodName){var handler=this._recallEventHandler(this,eventName,node,methodName);if(handler){this._unlisten(node,eventName,handler);handler._listening=false}},_listen:function(node,eventName,handler){node.addEventListener(eventName,handler)},_unlisten:function(node,eventName,handler){node.removeEventListener(eventName,handler)}});(function(){"use strict";var HAS_NATIVE_TA=typeof document.head.style.touchAction==="string";var GESTURE_KEY="__polymerGestures";var HANDLED_OBJ="__polymerGesturesHandled";var TOUCH_ACTION="__polymerGesturesTouchAction";var TAP_DISTANCE=25;var TRACK_DISTANCE=5;var TRACK_LENGTH=2;var MOUSE_TIMEOUT=2500;var MOUSE_EVENTS=["mousedown","mousemove","mouseup","click"];var MOUSE_WHICH_TO_BUTTONS=[0,1,4,2];var MOUSE_HAS_BUTTONS=function(){try{return new MouseEvent("test",{buttons:1}).buttons===1}catch(e){return false}}();var IS_TOUCH_ONLY=navigator.userAgent.match(/iP(?:[oa]d|hone)|Android/);var mouseCanceller=function(mouseEvent){mouseEvent[HANDLED_OBJ]={skip:true};if(mouseEvent.type==="click"){var path=Polymer.dom(mouseEvent).path;for(var i=0;i<path.length;i++){if(path[i]===POINTERSTATE.mouse.target){return}}mouseEvent.preventDefault();mouseEvent.stopPropagation()}};function setupTeardownMouseCanceller(setup){for(var i=0,en;i<MOUSE_EVENTS.length;i++){en=MOUSE_EVENTS[i];if(setup){document.addEventListener(en,mouseCanceller,true)}else{document.removeEventListener(en,mouseCanceller,true)}}}function ignoreMouse(){if(IS_TOUCH_ONLY){return}if(!POINTERSTATE.mouse.mouseIgnoreJob){setupTeardownMouseCanceller(true)}var unset=function(){setupTeardownMouseCanceller();POINTERSTATE.mouse.target=null;POINTERSTATE.mouse.mouseIgnoreJob=null};POINTERSTATE.mouse.mouseIgnoreJob=Polymer.Debounce(POINTERSTATE.mouse.mouseIgnoreJob,unset,MOUSE_TIMEOUT)}function hasLeftMouseButton(ev){var type=ev.type;if(MOUSE_EVENTS.indexOf(type)===-1){return false}if(type==="mousemove"){var buttons=ev.buttons===undefined?1:ev.buttons;if(ev instanceof window.MouseEvent&&!MOUSE_HAS_BUTTONS){buttons=MOUSE_WHICH_TO_BUTTONS[ev.which]||0}return Boolean(buttons&1)}else{var button=ev.button===undefined?0:ev.button;return button===0}}function isSyntheticClick(ev){if(ev.type==="click"){if(ev.detail===0){return true}var t=Gestures.findOriginalTarget(ev);var bcr=t.getBoundingClientRect();var x=ev.pageX,y=ev.pageY;return!(x>=bcr.left&&x<=bcr.right&&(y>=bcr.top&&y<=bcr.bottom))}return false}var POINTERSTATE={mouse:{target:null,mouseIgnoreJob:null},touch:{x:0,y:0,id:-1,scrollDecided:false}};function firstTouchAction(ev){var path=Polymer.dom(ev).path;var ta="auto";for(var i=0,n;i<path.length;i++){n=path[i];if(n[TOUCH_ACTION]){ta=n[TOUCH_ACTION];break}}return ta}function trackDocument(stateObj,movefn,upfn){stateObj.movefn=movefn;stateObj.upfn=upfn;document.addEventListener("mousemove",movefn);document.addEventListener("mouseup",upfn)}function untrackDocument(stateObj){document.removeEventListener("mousemove",stateObj.movefn);document.removeEventListener("mouseup",stateObj.upfn)}var Gestures={gestures:{},recognizers:[],deepTargetFind:function(x,y){var node=document.elementFromPoint(x,y);var next=node;while(next&&next.shadowRoot){next=next.shadowRoot.elementFromPoint(x,y);if(next){node=next}}return node},findOriginalTarget:function(ev){if(ev.path){return ev.path[0]}return ev.target},handleNative:function(ev){var handled;var type=ev.type;var node=ev.currentTarget;var gobj=node[GESTURE_KEY];var gs=gobj[type];if(!gs){return}if(!ev[HANDLED_OBJ]){ev[HANDLED_OBJ]={};if(type.slice(0,5)==="touch"){var t=ev.changedTouches[0];if(type==="touchstart"){if(ev.touches.length===1){POINTERSTATE.touch.id=t.identifier}}if(POINTERSTATE.touch.id!==t.identifier){return}if(!HAS_NATIVE_TA){if(type==="touchstart"||type==="touchmove"){Gestures.handleTouchAction(ev)}}if(type==="touchend"){POINTERSTATE.mouse.target=Polymer.dom(ev).rootTarget;ignoreMouse(true)}}}handled=ev[HANDLED_OBJ];if(handled.skip){return}var recognizers=Gestures.recognizers;for(var i=0,r;i<recognizers.length;i++){r=recognizers[i];if(gs[r.name]&&!handled[r.name]){if(r.flow&&r.flow.start.indexOf(ev.type)>-1){if(r.reset){r.reset()}}}}for(var i=0,r;i<recognizers.length;i++){r=recognizers[i];if(gs[r.name]&&!handled[r.name]){handled[r.name]=true;r[type](ev)}}},handleTouchAction:function(ev){var t=ev.changedTouches[0];var type=ev.type;if(type==="touchstart"){POINTERSTATE.touch.x=t.clientX;POINTERSTATE.touch.y=t.clientY;POINTERSTATE.touch.scrollDecided=false}else if(type==="touchmove"){if(POINTERSTATE.touch.scrollDecided){return}POINTERSTATE.touch.scrollDecided=true;var ta=firstTouchAction(ev);var prevent=false;var dx=Math.abs(POINTERSTATE.touch.x-t.clientX);var dy=Math.abs(POINTERSTATE.touch.y-t.clientY);if(!ev.cancelable){}else if(ta==="none"){prevent=true}else if(ta==="pan-x"){prevent=dy>dx}else if(ta==="pan-y"){prevent=dx>dy}if(prevent){ev.preventDefault()}else{Gestures.prevent("track")}}},add:function(node,evType,handler){var recognizer=this.gestures[evType];var deps=recognizer.deps;var name=recognizer.name;var gobj=node[GESTURE_KEY];if(!gobj){node[GESTURE_KEY]=gobj={}}for(var i=0,dep,gd;i<deps.length;i++){dep=deps[i];if(IS_TOUCH_ONLY&&MOUSE_EVENTS.indexOf(dep)>-1){continue}gd=gobj[dep];if(!gd){gobj[dep]=gd={_count:0}}if(gd._count===0){node.addEventListener(dep,this.handleNative)}gd[name]=(gd[name]||0)+1;gd._count=(gd._count||0)+1}node.addEventListener(evType,handler);if(recognizer.touchAction){this.setTouchAction(node,recognizer.touchAction)}},remove:function(node,evType,handler){var recognizer=this.gestures[evType];var deps=recognizer.deps;var name=recognizer.name;var gobj=node[GESTURE_KEY];if(gobj){for(var i=0,dep,gd;i<deps.length;i++){dep=deps[i];gd=gobj[dep];if(gd&&gd[name]){gd[name]=(gd[name]||1)-1;gd._count=(gd._count||1)-1;if(gd._count===0){node.removeEventListener(dep,this.handleNative)}}}}node.removeEventListener(evType,handler)},register:function(recog){this.recognizers.push(recog);for(var i=0;i<recog.emits.length;i++){this.gestures[recog.emits[i]]=recog}},findRecognizerByEvent:function(evName){for(var i=0,r;i<this.recognizers.length;i++){r=this.recognizers[i];for(var j=0,n;j<r.emits.length;j++){n=r.emits[j];if(n===evName){return r}}}return null},setTouchAction:function(node,value){if(HAS_NATIVE_TA){node.style.touchAction=value}node[TOUCH_ACTION]=value},fire:function(target,type,detail){var ev=Polymer.Base.fire(type,detail,{node:target,bubbles:true,cancelable:true});if(ev.defaultPrevented){var se=detail.sourceEvent;if(se&&se.preventDefault){se.preventDefault()}}},prevent:function(evName){var recognizer=this.findRecognizerByEvent(evName);if(recognizer.info){recognizer.info.prevent=true}}};Gestures.register({name:"downup",deps:["mousedown","touchstart","touchend"],flow:{start:["mousedown","touchstart"],end:["mouseup","touchend"]},emits:["down","up"],info:{movefn:function(){},upfn:function(){}},reset:function(){untrackDocument(this.info)},mousedown:function(e){if(!hasLeftMouseButton(e)){return}var t=Gestures.findOriginalTarget(e);var self=this;var movefn=function movefn(e){if(!hasLeftMouseButton(e)){self.fire("up",t,e);untrackDocument(self.info)}};var upfn=function upfn(e){if(hasLeftMouseButton(e)){self.fire("up",t,e)}untrackDocument(self.info)};trackDocument(this.info,movefn,upfn);this.fire("down",t,e)},touchstart:function(e){this.fire("down",Gestures.findOriginalTarget(e),e.changedTouches[0])},touchend:function(e){this.fire("up",Gestures.findOriginalTarget(e),e.changedTouches[0])},fire:function(type,target,event){var self=this;Gestures.fire(target,type,{x:event.clientX,y:event.clientY,sourceEvent:event,prevent:Gestures.prevent.bind(Gestures)})}});Gestures.register({name:"track",touchAction:"none",deps:["mousedown","touchstart","touchmove","touchend"],flow:{start:["mousedown","touchstart"],end:["mouseup","touchend"]},emits:["track"],info:{x:0,y:0,state:"start",started:false,moves:[],addMove:function(move){if(this.moves.length>TRACK_LENGTH){this.moves.shift()}this.moves.push(move)},movefn:function(){},upfn:function(){},prevent:false},reset:function(){this.info.state="start";this.info.started=false;this.info.moves=[];this.info.x=0;this.info.y=0;this.info.prevent=false;untrackDocument(this.info)},hasMovedEnough:function(x,y){if(this.info.prevent){return false}if(this.info.started){return true}var dx=Math.abs(this.info.x-x);var dy=Math.abs(this.info.y-y);return dx>=TRACK_DISTANCE||dy>=TRACK_DISTANCE},mousedown:function(e){if(!hasLeftMouseButton(e)){return}var t=Gestures.findOriginalTarget(e);var self=this;var movefn=function movefn(e){var x=e.clientX,y=e.clientY;if(self.hasMovedEnough(x,y)){self.info.state=self.info.started?e.type==="mouseup"?"end":"track":"start";self.info.addMove({x:x,y:y});if(!hasLeftMouseButton(e)){self.info.state="end";untrackDocument(self.info)}self.fire(t,e);self.info.started=true}};var upfn=function upfn(e){if(self.info.started){Gestures.prevent("tap");movefn(e)}untrackDocument(self.info)};trackDocument(this.info,movefn,upfn);this.info.x=e.clientX;this.info.y=e.clientY},touchstart:function(e){var ct=e.changedTouches[0];this.info.x=ct.clientX;this.info.y=ct.clientY},touchmove:function(e){var t=Gestures.findOriginalTarget(e);var ct=e.changedTouches[0];var x=ct.clientX,y=ct.clientY;if(this.hasMovedEnough(x,y)){this.info.addMove({x:x,y:y});this.fire(t,ct);this.info.state="track";this.info.started=true}},touchend:function(e){var t=Gestures.findOriginalTarget(e);var ct=e.changedTouches[0];if(this.info.started){Gestures.prevent("tap");this.info.state="end";this.info.addMove({x:ct.clientX,y:ct.clientY});this.fire(t,ct)}},fire:function(target,touch){var secondlast=this.info.moves[this.info.moves.length-2];var lastmove=this.info.moves[this.info.moves.length-1];var dx=lastmove.x-this.info.x;var dy=lastmove.y-this.info.y;var ddx,ddy=0;if(secondlast){ddx=lastmove.x-secondlast.x;ddy=lastmove.y-secondlast.y}return Gestures.fire(target,"track",{state:this.info.state,x:touch.clientX,y:touch.clientY,dx:dx,dy:dy,ddx:ddx,ddy:ddy,sourceEvent:touch,hover:function(){return Gestures.deepTargetFind(touch.clientX,touch.clientY)}})}});Gestures.register({name:"tap",deps:["mousedown","click","touchstart","touchend"],flow:{start:["mousedown","touchstart"],end:["click","touchend"]},emits:["tap"],info:{x:NaN,y:NaN,prevent:false},reset:function(){this.info.x=NaN;this.info.y=NaN;this.info.prevent=false},save:function(e){this.info.x=e.clientX;this.info.y=e.clientY},mousedown:function(e){if(hasLeftMouseButton(e)){this.save(e)}},click:function(e){if(hasLeftMouseButton(e)){this.forward(e)}},touchstart:function(e){this.save(e.changedTouches[0])},touchend:function(e){this.forward(e.changedTouches[0])},forward:function(e){var dx=Math.abs(e.clientX-this.info.x);var dy=Math.abs(e.clientY-this.info.y);var t=Gestures.findOriginalTarget(e);if(isNaN(dx)||isNaN(dy)||dx<=TAP_DISTANCE&&dy<=TAP_DISTANCE||isSyntheticClick(e)){if(!this.info.prevent){Gestures.fire(t,"tap",{x:e.clientX,y:e.clientY,sourceEvent:e})}}}});var DIRECTION_MAP={x:"pan-x",y:"pan-y",none:"none",all:"auto"};Polymer.Base._addFeature({_listen:function(node,eventName,handler){if(Gestures.gestures[eventName]){Gestures.add(node,eventName,handler)}else{node.addEventListener(eventName,handler)}},_unlisten:function(node,eventName,handler){if(Gestures.gestures[eventName]){Gestures.remove(node,eventName,handler)}else{node.removeEventListener(eventName,handler)}},setScrollDirection:function(direction,node){node=node||this;Gestures.setTouchAction(node,DIRECTION_MAP[direction]||"auto")}});Polymer.Gestures=Gestures})();Polymer.Async={_currVal:0,_lastVal:0,_callbacks:[],_twiddleContent:0,_twiddle:document.createTextNode(""),run:function(callback,waitTime){if(waitTime>0){return~setTimeout(callback,waitTime)}else{this._twiddle.textContent=this._twiddleContent++;this._callbacks.push(callback);return this._currVal++}},cancel:function(handle){if(handle<0){clearTimeout(~handle)}else{var idx=handle-this._lastVal;if(idx>=0){if(!this._callbacks[idx]){throw"invalid async handle: "+handle}this._callbacks[idx]=null}}},_atEndOfMicrotask:function(){var len=this._callbacks.length;for(var i=0;i<len;i++){var cb=this._callbacks[i];if(cb){try{cb()}catch(e){i++;this._callbacks.splice(0,i);this._lastVal+=i;this._twiddle.textContent=this._twiddleContent++;throw e}}}this._callbacks.splice(0,len);this._lastVal+=len}};new(window.MutationObserver||JsMutationObserver)(Polymer.Async._atEndOfMicrotask.bind(Polymer.Async)).observe(Polymer.Async._twiddle,{characterData:true});Polymer.Debounce=function(){var Async=Polymer.Async;var Debouncer=function(context){this.context=context;this.boundComplete=this.complete.bind(this)};Debouncer.prototype={go:function(callback,wait){var h;this.finish=function(){Async.cancel(h)};h=Async.run(this.boundComplete,wait);this.callback=callback},stop:function(){if(this.finish){this.finish();this.finish=null}},complete:function(){if(this.finish){this.stop();this.callback.call(this.context)}}};function debounce(debouncer,callback,wait){if(debouncer){debouncer.stop()}else{debouncer=new Debouncer(this)}debouncer.go(callback,wait);return debouncer}return debounce}();Polymer.Base._addFeature({$$:function(slctr){return Polymer.dom(this.root).querySelector(slctr)},toggleClass:function(name,bool,node){node=node||this;if(arguments.length==1){bool=!node.classList.contains(name)}if(bool){Polymer.dom(node).classList.add(name)}else{Polymer.dom(node).classList.remove(name)}},toggleAttribute:function(name,bool,node){node=node||this;if(arguments.length==1){bool=!node.hasAttribute(name)}if(bool){Polymer.dom(node).setAttribute(name,"")}else{Polymer.dom(node).removeAttribute(name)}},classFollows:function(name,toElement,fromElement){if(fromElement){Polymer.dom(fromElement).classList.remove(name)}if(toElement){Polymer.dom(toElement).classList.add(name)}},attributeFollows:function(name,toElement,fromElement){if(fromElement){Polymer.dom(fromElement).removeAttribute(name)}if(toElement){Polymer.dom(toElement).setAttribute(name,"")}},getContentChildNodes:function(slctr){var content=Polymer.dom(this.root).querySelector(slctr||"content");return content?Polymer.dom(content).getDistributedNodes():[]},getContentChildren:function(slctr){return this.getContentChildNodes(slctr).filter(function(n){return n.nodeType===Node.ELEMENT_NODE})},fire:function(type,detail,options){options=options||Polymer.nob;var node=options.node||this;var detail=detail===null||detail===undefined?Polymer.nob:detail;var bubbles=options.bubbles===undefined?true:options.bubbles;var cancelable=Boolean(options.cancelable);var event=new CustomEvent(type,{bubbles:Boolean(bubbles),cancelable:cancelable,detail:detail});node.dispatchEvent(event);return event},async:function(callback,waitTime){return Polymer.Async.run(callback.bind(this),waitTime)},cancelAsync:function(handle){Polymer.Async.cancel(handle)},arrayDelete:function(path,item){var index;if(Array.isArray(path)){index=path.indexOf(item);if(index>=0){return path.splice(index,1)}}else{var arr=this.get(path);index=arr.indexOf(item);if(index>=0){return this.splice(path,index,1)}}},transform:function(transform,node){node=node||this;node.style.webkitTransform=transform;node.style.transform=transform},translate3d:function(x,y,z,node){node=node||this;this.transform("translate3d("+x+","+y+","+z+")",node)},importHref:function(href,onload,onerror){var l=document.createElement("link");l.rel="import";l.href=href;if(onload){l.onload=onload.bind(this)}if(onerror){l.onerror=onerror.bind(this)}document.head.appendChild(l);return l},create:function(tag,props){var elt=document.createElement(tag);if(props){for(var n in props){elt[n]=props[n]}}return elt},isLightDescendant:function(node){return this.contains(node)&&Polymer.dom(this).getOwnerRoot()===Polymer.dom(node).getOwnerRoot()},isLocalDescendant:function(node){return this.root===Polymer.dom(node).getOwnerRoot()}});Polymer.Bind={prepareModel:function(model){model._propertyEffects={};model._bindListeners=[];Polymer.Base.mixin(model,this._modelApi)},_modelApi:{_notifyChange:function(property){var eventName=Polymer.CaseMap.camelToDashCase(property)+"-changed";Polymer.Base.fire(eventName,{value:this[property]},{bubbles:false,node:this})},_propertySetter:function(property,value,effects,fromAbove){var old=this.__data__[property];if(old!==value&&(old===old||value===value)){this.__data__[property]=value;if(typeof value=="object"){this._clearPath(property)}if(this._propertyChanged){this._propertyChanged(property,value,old)}if(effects){this._effectEffects(property,value,effects,old,fromAbove)}}return old},__setProperty:function(property,value,quiet,node){node=node||this;var effects=node._propertyEffects&&node._propertyEffects[property];if(effects){node._propertySetter(property,value,effects,quiet)}else{node[property]=value}},_effectEffects:function(property,value,effects,old,fromAbove){effects.forEach(function(fx){var fn=Polymer.Bind["_"+fx.kind+"Effect"];if(fn){fn.call(this,property,value,fx.effect,old,fromAbove)}},this)},_clearPath:function(path){for(var prop in this.__data__){if(prop.indexOf(path+".")===0){this.__data__[prop]=undefined}}}},ensurePropertyEffects:function(model,property){var fx=model._propertyEffects[property];if(!fx){fx=model._propertyEffects[property]=[]}return fx},addPropertyEffect:function(model,property,kind,effect){var fx=this.ensurePropertyEffects(model,property);fx.push({kind:kind,effect:effect})},createBindings:function(model){var fx$=model._propertyEffects;if(fx$){for(var n in fx$){var fx=fx$[n];fx.sort(this._sortPropertyEffects);this._createAccessors(model,n,fx)}}},_sortPropertyEffects:function(){var EFFECT_ORDER={compute:0,annotation:1,computedAnnotation:2,reflect:3,notify:4,observer:5,complexObserver:6,function:7};return function(a,b){return EFFECT_ORDER[a.kind]-EFFECT_ORDER[b.kind]}}(),_createAccessors:function(model,property,effects){var defun={get:function(){return this.__data__[property]}};var setter=function(value){this._propertySetter(property,value,effects)};var info=model.getPropertyInfo&&model.getPropertyInfo(property);if(info&&info.readOnly){if(!info.computed){model["_set"+this.upper(property)]=setter}}else{defun.set=setter}Object.defineProperty(model,property,defun)},upper:function(name){return name[0].toUpperCase()+name.substring(1)},_addAnnotatedListener:function(model,index,property,path,event){var fn=this._notedListenerFactory(property,path,this._isStructured(path),this._isEventBogus);var eventName=event||Polymer.CaseMap.camelToDashCase(property)+"-changed";model._bindListeners.push({index:index,property:property,path:path,changedFn:fn,event:eventName})},_isStructured:function(path){return path.indexOf(".")>0},_isEventBogus:function(e,target){return e.path&&e.path[0]!==target},_notedListenerFactory:function(property,path,isStructured,bogusTest){return function(e,target){if(!bogusTest(e,target)){if(e.detail&&e.detail.path){this.notifyPath(this._fixPath(path,property,e.detail.path),e.detail.value)}else{var value=target[property];if(!isStructured){this[path]=target[property]}else{if(this.__data__[path]!=value){this.set(path,value)}}}}}},prepareInstance:function(inst){inst.__data__=Object.create(null)},setupBindListeners:function(inst){inst._bindListeners.forEach(function(info){var node=inst._nodes[info.index];node.addEventListener(info.event,inst._notifyListener.bind(inst,info.changedFn))})}};Polymer.Base.extend(Polymer.Bind,{_shouldAddListener:function(effect){return effect.name&&effect.mode==="{"&&!effect.negate&&effect.kind!="attribute"},_annotationEffect:function(source,value,effect){if(source!=effect.value){value=this.get(effect.value);this.__data__[effect.value]=value}var calc=effect.negate?!value:value;if(!effect.customEvent||this._nodes[effect.index][effect.name]!==calc){return this._applyEffectValue(calc,effect)}},_reflectEffect:function(source){this.reflectPropertyToAttribute(source)},_notifyEffect:function(source,value,effect,old,fromAbove){if(!fromAbove){this._notifyChange(source)}},_functionEffect:function(source,value,fn,old,fromAbove){fn.call(this,source,value,old,fromAbove)},_observerEffect:function(source,value,effect,old){var fn=this[effect.method];if(fn){fn.call(this,value,old)}else{this._warn(this._logf("_observerEffect","observer method `"+effect.method+"` not defined"))}},_complexObserverEffect:function(source,value,effect){var fn=this[effect.method];if(fn){var args=Polymer.Bind._marshalArgs(this.__data__,effect,source,value);if(args){fn.apply(this,args)}}else{this._warn(this._logf("_complexObserverEffect","observer method `"+effect.method+"` not defined"))}},_computeEffect:function(source,value,effect){var args=Polymer.Bind._marshalArgs(this.__data__,effect,source,value);if(args){var fn=this[effect.method];if(fn){this.__setProperty(effect.property,fn.apply(this,args))}else{this._warn(this._logf("_computeEffect","compute method `"+effect.method+"` not defined"))}}},_annotatedComputationEffect:function(source,value,effect){var computedHost=this._rootDataHost||this;var fn=computedHost[effect.method];if(fn){var args=Polymer.Bind._marshalArgs(this.__data__,effect,source,value);if(args){var computedvalue=fn.apply(computedHost,args);if(effect.negate){computedvalue=!computedvalue}this._applyEffectValue(computedvalue,effect)}}else{computedHost._warn(computedHost._logf("_annotatedComputationEffect","compute method `"+effect.method+"` not defined"))}},_marshalArgs:function(model,effect,path,value){var values=[];var args=effect.args;for(var i=0,l=args.length;i<l;i++){var arg=args[i];var name=arg.name;var v;if(arg.literal){v=arg.value}else if(arg.structured){v=Polymer.Base.get(name,model)}else{v=model[name]}if(args.length>1&&v===undefined){return}if(arg.wildcard){var baseChanged=name.indexOf(path+".")===0;var matches=effect.trigger.name.indexOf(name)===0&&!baseChanged;values[i]={path:matches?path:name,value:matches?value:v,base:v}}else{values[i]=v}}return values}});Polymer.Base._addFeature({_addPropertyEffect:function(property,kind,effect){Polymer.Bind.addPropertyEffect(this,property,kind,effect)},_prepEffects:function(){Polymer.Bind.prepareModel(this);this._addAnnotationEffects(this._notes)},_prepBindings:function(){Polymer.Bind.createBindings(this)},_addPropertyEffects:function(properties){if(properties){for(var p in properties){var prop=properties[p];if(prop.observer){this._addObserverEffect(p,prop.observer)}if(prop.computed){prop.readOnly=true;this._addComputedEffect(p,prop.computed)}if(prop.notify){this._addPropertyEffect(p,"notify")}if(prop.reflectToAttribute){this._addPropertyEffect(p,"reflect")}if(prop.readOnly){Polymer.Bind.ensurePropertyEffects(this,p)}}}},_addComputedEffect:function(name,expression){var sig=this._parseMethod(expression);sig.args.forEach(function(arg){this._addPropertyEffect(arg.model,"compute",{method:sig.method,args:sig.args,trigger:arg,property:name})},this)},_addObserverEffect:function(property,observer){this._addPropertyEffect(property,"observer",{method:observer,property:property})},_addComplexObserverEffects:function(observers){if(observers){observers.forEach(function(observer){this._addComplexObserverEffect(observer)},this)}},_addComplexObserverEffect:function(observer){var sig=this._parseMethod(observer);sig.args.forEach(function(arg){this._addPropertyEffect(arg.model,"complexObserver",{method:sig.method,args:sig.args,trigger:arg})},this)},_addAnnotationEffects:function(notes){this._nodes=[];notes.forEach(function(note){var index=this._nodes.push(note)-1;note.bindings.forEach(function(binding){this._addAnnotationEffect(binding,index)},this)},this)},_addAnnotationEffect:function(note,index){if(Polymer.Bind._shouldAddListener(note)){Polymer.Bind._addAnnotatedListener(this,index,note.name,note.value,note.event)}if(note.signature){this._addAnnotatedComputationEffect(note,index)}else{note.index=index;this._addPropertyEffect(note.model,"annotation",note)}},_addAnnotatedComputationEffect:function(note,index){var sig=note.signature;if(sig.static){this.__addAnnotatedComputationEffect("__static__",index,note,sig,null)}else{sig.args.forEach(function(arg){if(!arg.literal){this.__addAnnotatedComputationEffect(arg.model,index,note,sig,arg)}},this)}},__addAnnotatedComputationEffect:function(property,index,note,sig,trigger){this._addPropertyEffect(property,"annotatedComputation",{index:index,kind:note.kind,property:note.name,negate:note.negate,method:sig.method,args:sig.args,trigger:trigger})},_parseMethod:function(expression){var m=expression.match(/([^\s]+)\((.*)\)/);if(m){var sig={method:m[1],static:true};if(m[2].trim()){var args=m[2].replace(/\\,/g,"&comma;").split(",");return this._parseArgs(args,sig)}else{sig.args=Polymer.nar;return sig}}},_parseArgs:function(argList,sig){sig.args=argList.map(function(rawArg){var arg=this._parseArg(rawArg);if(!arg.literal){sig.static=false}return arg},this);return sig},_parseArg:function(rawArg){var arg=rawArg.trim().replace(/&comma;/g,",").replace(/\\(.)/g,"$1");var a={name:arg,model:this._modelForPath(arg)};var fc=arg[0];if(fc==="-"){fc=arg[1]}if(fc>="0"&&fc<="9"){fc="#"}switch(fc){case"'":case'"':a.value=arg.slice(1,-1);a.literal=true;break;case"#":a.value=Number(arg);a.literal=true;break}if(!a.literal){a.structured=arg.indexOf(".")>0;if(a.structured){a.wildcard=arg.slice(-2)==".*";if(a.wildcard){a.name=arg.slice(0,-2)}}}return a},_marshalInstanceEffects:function(){Polymer.Bind.prepareInstance(this);Polymer.Bind.setupBindListeners(this)},_applyEffectValue:function(value,info){var node=this._nodes[info.index];var property=info.property||info.name||"textContent";if(info.kind=="attribute"){this.serializeValueToAttribute(value,property,node)}else{if(property==="className"){value=this._scopeElementClass(node,value)}if(property==="textContent"||node.localName=="input"&&property=="value"){value=value==undefined?"":value}return node[property]=value}},_executeStaticEffects:function(){if(this._propertyEffects.__static__){this._effectEffects("__static__",null,this._propertyEffects.__static__)}}});Polymer.Base._addFeature({_setupConfigure:function(initialConfig){this._config={};for(var i in initialConfig){if(initialConfig[i]!==undefined){this._config[i]=initialConfig[i]}}this._handlers=[]},_marshalAttributes:function(){this._takeAttributesToModel(this._config)},_attributeChangedImpl:function(name){var model=this._clientsReadied?this:this._config;this._setAttributeToProperty(model,name)},_configValue:function(name,value){this._config[name]=value},_beforeClientsReady:function(){this._configure()},_configure:function(){this._configureAnnotationReferences();this._aboveConfig=this.mixin({},this._config);var config={};this.behaviors.forEach(function(b){this._configureProperties(b.properties,config)},this);this._configureProperties(this.properties,config);this._mixinConfigure(config,this._aboveConfig);this._config=config;this._distributeConfig(this._config)},_configureProperties:function(properties,config){for(var i in properties){var c=properties[i];if(c.value!==undefined){var value=c.value;if(typeof value=="function"){value=value.call(this,this._config)}config[i]=value}}},_mixinConfigure:function(a,b){for(var prop in b){if(!this.getPropertyInfo(prop).readOnly){a[prop]=b[prop]}}},_distributeConfig:function(config){var fx$=this._propertyEffects;if(fx$){for(var p in config){var fx=fx$[p];if(fx){for(var i=0,l=fx.length,x;i<l&&(x=fx[i]);i++){if(x.kind==="annotation"){var node=this._nodes[x.effect.index];if(node._configValue){var value=p===x.effect.value?config[p]:this.get(x.effect.value,config);node._configValue(x.effect.name,value)}}}}}}},_afterClientsReady:function(){this._executeStaticEffects();this._applyConfig(this._config,this._aboveConfig);this._flushHandlers()},_applyConfig:function(config,aboveConfig){for(var n in config){if(this[n]===undefined){this.__setProperty(n,config[n],n in aboveConfig)}}},_notifyListener:function(fn,e){if(!this._clientsReadied){this._queueHandler([fn,e,e.target])}else{return fn.call(this,e,e.target)}},_queueHandler:function(args){this._handlers.push(args)},_flushHandlers:function(){var h$=this._handlers;for(var i=0,l=h$.length,h;i<l&&(h=h$[i]);i++){h[0].call(this,h[1],h[2])}this._handlers=[]}});(function(){"use strict";Polymer.Base._addFeature({notifyPath:function(path,value,fromAbove){var old=this._propertySetter(path,value);if(old!==value&&(old===old||value===value)){this._pathEffector(path,value);if(!fromAbove){this._notifyPath(path,value)}return true}},_getPathParts:function(path){if(Array.isArray(path)){var parts=[];for(var i=0;i<path.length;i++){var args=path[i].toString().split(".");for(var j=0;j<args.length;j++){parts.push(args[j])}}return parts}else{return path.toString().split(".")}},set:function(path,value,root){var prop=root||this;var parts=this._getPathParts(path);var array;var last=parts[parts.length-1];if(parts.length>1){for(var i=0;i<parts.length-1;i++){var part=parts[i];prop=prop[part];if(array&&parseInt(part)==part){parts[i]=Polymer.Collection.get(array).getKey(prop)}if(!prop){return}array=Array.isArray(prop)?prop:null}if(array&&parseInt(last)==last){var coll=Polymer.Collection.get(array);var old=prop[last];var key=coll.getKey(old);parts[i]=key;coll.setItem(key,value)}prop[last]=value;if(!root){this.notifyPath(parts.join("."),value)}}else{prop[path]=value}},get:function(path,root){var prop=root||this;var parts=this._getPathParts(path);var last=parts.pop();while(parts.length){prop=prop[parts.shift()];if(!prop){return}}return prop[last]},_pathEffector:function(path,value){var model=this._modelForPath(path);var fx$=this._propertyEffects[model];if(fx$){fx$.forEach(function(fx){var fxFn=this["_"+fx.kind+"PathEffect"];if(fxFn){fxFn.call(this,path,value,fx.effect)}},this)}if(this._boundPaths){this._notifyBoundPaths(path,value)}},_annotationPathEffect:function(path,value,effect){if(effect.value===path||effect.value.indexOf(path+".")===0){Polymer.Bind._annotationEffect.call(this,path,value,effect)}else if(path.indexOf(effect.value+".")===0&&!effect.negate){var node=this._nodes[effect.index];if(node&&node.notifyPath){var p=this._fixPath(effect.name,effect.value,path);node.notifyPath(p,value,true)}}},_complexObserverPathEffect:function(path,value,effect){if(this._pathMatchesEffect(path,effect)){Polymer.Bind._complexObserverEffect.call(this,path,value,effect)}},_computePathEffect:function(path,value,effect){if(this._pathMatchesEffect(path,effect)){Polymer.Bind._computeEffect.call(this,path,value,effect)}},_annotatedComputationPathEffect:function(path,value,effect){if(this._pathMatchesEffect(path,effect)){Polymer.Bind._annotatedComputationEffect.call(this,path,value,effect)}},_pathMatchesEffect:function(path,effect){var effectArg=effect.trigger.name;return effectArg==path||effectArg.indexOf(path+".")===0||effect.trigger.wildcard&&path.indexOf(effectArg)===0},linkPaths:function(to,from){this._boundPaths=this._boundPaths||{};if(from){this._boundPaths[to]=from}else{this.unlinkPaths(to)}},unlinkPaths:function(path){if(this._boundPaths){
delete this._boundPaths[path]}},_notifyBoundPaths:function(path,value){for(var a in this._boundPaths){var b=this._boundPaths[a];if(path.indexOf(a+".")==0){this.notifyPath(this._fixPath(b,a,path),value)}else if(path.indexOf(b+".")==0){this.notifyPath(this._fixPath(a,b,path),value)}}},_fixPath:function(property,root,path){return property+path.slice(root.length)},_notifyPath:function(path,value){var rootName=this._modelForPath(path);var dashCaseName=Polymer.CaseMap.camelToDashCase(rootName);var eventName=dashCaseName+this._EVENT_CHANGED;this.fire(eventName,{path:path,value:value},{bubbles:false})},_modelForPath:function(path){var dot=path.indexOf(".");return dot<0?path:path.slice(0,dot)},_EVENT_CHANGED:"-changed",_notifySplice:function(array,path,index,added,removed){var splices=[{index:index,addedCount:added,removed:removed,object:array,type:"splice"}];var change={keySplices:Polymer.Collection.applySplices(array,splices),indexSplices:splices};this.set(path+".splices",change);if(added!=removed.length){this.notifyPath(path+".length",array.length)}change.keySplices=null;change.indexSplices=null},push:function(path){var array=this.get(path);var args=Array.prototype.slice.call(arguments,1);var len=array.length;var ret=array.push.apply(array,args);if(args.length){this._notifySplice(array,path,len,args.length,[])}return ret},pop:function(path){var array=this.get(path);var hadLength=Boolean(array.length);var args=Array.prototype.slice.call(arguments,1);var ret=array.pop.apply(array,args);if(hadLength){this._notifySplice(array,path,array.length,0,[ret])}return ret},splice:function(path,start,deleteCount){var array=this.get(path);if(start<0){start=array.length-Math.floor(-start)}else{start=Math.floor(start)}if(!start){start=0}var args=Array.prototype.slice.call(arguments,1);var ret=array.splice.apply(array,args);var addedCount=Math.max(args.length-2,0);if(addedCount||ret.length){this._notifySplice(array,path,start,addedCount,ret)}return ret},shift:function(path){var array=this.get(path);var hadLength=Boolean(array.length);var args=Array.prototype.slice.call(arguments,1);var ret=array.shift.apply(array,args);if(hadLength){this._notifySplice(array,path,0,0,[ret])}return ret},unshift:function(path){var array=this.get(path);var args=Array.prototype.slice.call(arguments,1);var ret=array.unshift.apply(array,args);if(args.length){this._notifySplice(array,path,0,args.length,[])}return ret},prepareModelNotifyPath:function(model){this.mixin(model,{fire:Polymer.Base.fire,notifyPath:Polymer.Base.notifyPath,_EVENT_CHANGED:Polymer.Base._EVENT_CHANGED,_notifyPath:Polymer.Base._notifyPath,_pathEffector:Polymer.Base._pathEffector,_annotationPathEffect:Polymer.Base._annotationPathEffect,_complexObserverPathEffect:Polymer.Base._complexObserverPathEffect,_annotatedComputationPathEffect:Polymer.Base._annotatedComputationPathEffect,_computePathEffect:Polymer.Base._computePathEffect,_modelForPath:Polymer.Base._modelForPath,_pathMatchesEffect:Polymer.Base._pathMatchesEffect,_notifyBoundPaths:Polymer.Base._notifyBoundPaths})}})})();Polymer.Base._addFeature({resolveUrl:function(url){var module=Polymer.DomModule.import(this.is);var root="";if(module){var assetPath=module.getAttribute("assetpath")||"";root=Polymer.ResolveUrl.resolveUrl(assetPath,module.ownerDocument.baseURI)}return Polymer.ResolveUrl.resolveUrl(url,root)}});Polymer.CssParse=function(){var api={parse:function(text){text=this._clean(text);return this._parseCss(this._lex(text),text)},_clean:function(cssText){return cssText.replace(this._rx.comments,"").replace(this._rx.port,"")},_lex:function(text){var root={start:0,end:text.length};var n=root;for(var i=0,s=0,l=text.length;i<l;i++){switch(text[i]){case this.OPEN_BRACE:if(!n.rules){n.rules=[]}var p=n;var previous=p.rules[p.rules.length-1];n={start:i+1,parent:p,previous:previous};p.rules.push(n);break;case this.CLOSE_BRACE:n.end=i+1;n=n.parent||root;break}}return root},_parseCss:function(node,text){var t=text.substring(node.start,node.end-1);node.parsedCssText=node.cssText=t.trim();if(node.parent){var ss=node.previous?node.previous.end:node.parent.start;t=text.substring(ss,node.start-1);t=t.substring(t.lastIndexOf(";")+1);var s=node.parsedSelector=node.selector=t.trim();node.atRule=s.indexOf(this.AT_START)===0;if(node.atRule){if(s.indexOf(this.MEDIA_START)===0){node.type=this.types.MEDIA_RULE}else if(s.match(this._rx.keyframesRule)){node.type=this.types.KEYFRAMES_RULE}}else{if(s.indexOf(this.VAR_START)===0){node.type=this.types.MIXIN_RULE}else{node.type=this.types.STYLE_RULE}}}var r$=node.rules;if(r$){for(var i=0,l=r$.length,r;i<l&&(r=r$[i]);i++){this._parseCss(r,text)}}return node},stringify:function(node,preserveProperties,text){text=text||"";var cssText="";if(node.cssText||node.rules){var r$=node.rules;if(r$&&(preserveProperties||!this._hasMixinRules(r$))){for(var i=0,l=r$.length,r;i<l&&(r=r$[i]);i++){cssText=this.stringify(r,preserveProperties,cssText)}}else{cssText=preserveProperties?node.cssText:this.removeCustomProps(node.cssText);cssText=cssText.trim();if(cssText){cssText="  "+cssText+"\n"}}}if(cssText){if(node.selector){text+=node.selector+" "+this.OPEN_BRACE+"\n"}text+=cssText;if(node.selector){text+=this.CLOSE_BRACE+"\n\n"}}return text},_hasMixinRules:function(rules){return rules[0].selector.indexOf(this.VAR_START)>=0},removeCustomProps:function(cssText){cssText=this.removeCustomPropAssignment(cssText);return this.removeCustomPropApply(cssText)},removeCustomPropAssignment:function(cssText){return cssText.replace(this._rx.customProp,"").replace(this._rx.mixinProp,"")},removeCustomPropApply:function(cssText){return cssText.replace(this._rx.mixinApply,"").replace(this._rx.varApply,"")},types:{STYLE_RULE:1,KEYFRAMES_RULE:7,MEDIA_RULE:4,MIXIN_RULE:1e3},OPEN_BRACE:"{",CLOSE_BRACE:"}",_rx:{comments:/\/\*[^*]*\*+([^\/*][^*]*\*+)*\//gim,port:/@import[^;]*;/gim,customProp:/(?:^|[\s;])--[^;{]*?:[^{};]*?(?:[;\n]|$)/gim,mixinProp:/(?:^|[\s;])--[^;{]*?:[^{;]*?{[^}]*?}(?:[;\n]|$)?/gim,mixinApply:/@apply[\s]*\([^)]*?\)[\s]*(?:[;\n]|$)?/gim,varApply:/[^;:]*?:[^;]*var[^;]*(?:[;\n]|$)?/gim,keyframesRule:/^@[^\s]*keyframes/},VAR_START:"--",MEDIA_START:"@media",AT_START:"@"};return api}();Polymer.StyleUtil=function(){return{MODULE_STYLES_SELECTOR:"style, link[rel=import][type~=css], template",INCLUDE_ATTR:"include",toCssText:function(rules,callback,preserveProperties){if(typeof rules==="string"){rules=this.parser.parse(rules)}if(callback){this.forEachStyleRule(rules,callback)}return this.parser.stringify(rules,preserveProperties)},forRulesInStyles:function(styles,callback){if(styles){for(var i=0,l=styles.length,s;i<l&&(s=styles[i]);i++){this.forEachStyleRule(this.rulesForStyle(s),callback)}}},rulesForStyle:function(style){if(!style.__cssRules&&style.textContent){style.__cssRules=this.parser.parse(style.textContent)}return style.__cssRules},clearStyleRules:function(style){style.__cssRules=null},forEachStyleRule:function(node,callback){if(!node){return}var s=node.parsedSelector;var skipRules=false;if(node.type===this.ruleTypes.STYLE_RULE){callback(node)}else if(node.type===this.ruleTypes.KEYFRAMES_RULE||node.type===this.ruleTypes.MIXIN_RULE){skipRules=true}var r$=node.rules;if(r$&&!skipRules){for(var i=0,l=r$.length,r;i<l&&(r=r$[i]);i++){this.forEachStyleRule(r,callback)}}},applyCss:function(cssText,moniker,target,afterNode){var style=document.createElement("style");if(moniker){style.setAttribute("scope",moniker)}style.textContent=cssText;target=target||document.head;if(!afterNode){var n$=target.querySelectorAll("style[scope]");afterNode=n$[n$.length-1]}target.insertBefore(style,afterNode&&afterNode.nextSibling||target.firstChild);return style},cssFromModules:function(moduleIds,warnIfNotFound){var modules=moduleIds.trim().split(" ");var cssText="";for(var i=0;i<modules.length;i++){cssText+=this.cssFromModule(modules[i],warnIfNotFound)}return cssText},cssFromModule:function(moduleId,warnIfNotFound){var m=Polymer.DomModule.import(moduleId);if(m&&!m._cssText){m._cssText=this._cssFromElement(m)}if(!m&&warnIfNotFound){console.warn("Could not find style data in module named",moduleId)}return m&&m._cssText||""},_cssFromElement:function(element){var cssText="";var content=element.content||element;var e$=Array.prototype.slice.call(content.querySelectorAll(this.MODULE_STYLES_SELECTOR));for(var i=0,e;i<e$.length;i++){e=e$[i];if(e.localName==="template"){cssText+=this._cssFromElement(e)}else{if(e.localName==="style"){var include=e.getAttribute(this.INCLUDE_ATTR);if(include){cssText+=this.cssFromModules(include,true)}e=e.__appliedElement||e;e.parentNode.removeChild(e);cssText+=this.resolveCss(e.textContent,element.ownerDocument)}else if(e.import&&e.import.body){cssText+=this.resolveCss(e.import.body.textContent,e.import)}}}return cssText},resolveCss:Polymer.ResolveUrl.resolveCss,parser:Polymer.CssParse,ruleTypes:Polymer.CssParse.types}}();Polymer.StyleTransformer=function(){var nativeShadow=Polymer.Settings.useNativeShadow;var styleUtil=Polymer.StyleUtil;var api={dom:function(node,scope,useAttr,shouldRemoveScope){this._transformDom(node,scope||"",useAttr,shouldRemoveScope)},_transformDom:function(node,selector,useAttr,shouldRemoveScope){if(node.setAttribute){this.element(node,selector,useAttr,shouldRemoveScope)}var c$=Polymer.dom(node).childNodes;for(var i=0;i<c$.length;i++){this._transformDom(c$[i],selector,useAttr,shouldRemoveScope)}},element:function(element,scope,useAttr,shouldRemoveScope){if(useAttr){if(shouldRemoveScope){element.removeAttribute(SCOPE_NAME)}else{element.setAttribute(SCOPE_NAME,scope)}}else{if(scope){if(element.classList){if(shouldRemoveScope){element.classList.remove(SCOPE_NAME);element.classList.remove(scope)}else{element.classList.add(SCOPE_NAME);element.classList.add(scope)}}else if(element.getAttribute){var c=element.getAttribute(CLASS);if(shouldRemoveScope){if(c){element.setAttribute(CLASS,c.replace(SCOPE_NAME,"").replace(scope,""))}}else{element.setAttribute(CLASS,c+(c?" ":"")+SCOPE_NAME+" "+scope)}}}}},elementStyles:function(element,callback){var styles=element._styles;var cssText="";for(var i=0,l=styles.length,s,text;i<l&&(s=styles[i]);i++){var rules=styleUtil.rulesForStyle(s);cssText+=nativeShadow?styleUtil.toCssText(rules,callback):this.css(rules,element.is,element.extends,callback,element._scopeCssViaAttr)+"\n\n"}return cssText.trim()},css:function(rules,scope,ext,callback,useAttr){var hostScope=this._calcHostScope(scope,ext);scope=this._calcElementScope(scope,useAttr);var self=this;return styleUtil.toCssText(rules,function(rule){if(!rule.isScoped){self.rule(rule,scope,hostScope);rule.isScoped=true}if(callback){callback(rule,scope,hostScope)}})},_calcElementScope:function(scope,useAttr){if(scope){return useAttr?CSS_ATTR_PREFIX+scope+CSS_ATTR_SUFFIX:CSS_CLASS_PREFIX+scope}else{return""}},_calcHostScope:function(scope,ext){return ext?"[is="+scope+"]":scope},rule:function(rule,scope,hostScope){this._transformRule(rule,this._transformComplexSelector,scope,hostScope)},_transformRule:function(rule,transformer,scope,hostScope){var p$=rule.selector.split(COMPLEX_SELECTOR_SEP);for(var i=0,l=p$.length,p;i<l&&(p=p$[i]);i++){p$[i]=transformer.call(this,p,scope,hostScope)}rule.selector=rule.transformedSelector=p$.join(COMPLEX_SELECTOR_SEP)},_transformComplexSelector:function(selector,scope,hostScope){var stop=false;var hostContext=false;var self=this;selector=selector.replace(SIMPLE_SELECTOR_SEP,function(m,c,s){if(!stop){var info=self._transformCompoundSelector(s,c,scope,hostScope);stop=stop||info.stop;hostContext=hostContext||info.hostContext;c=info.combinator;s=info.value}else{s=s.replace(SCOPE_JUMP," ")}return c+s});if(hostContext){selector=selector.replace(HOST_CONTEXT_PAREN,function(m,pre,paren,post){return pre+paren+" "+hostScope+post+COMPLEX_SELECTOR_SEP+" "+pre+hostScope+paren+post})}return selector},_transformCompoundSelector:function(selector,combinator,scope,hostScope){var jumpIndex=selector.search(SCOPE_JUMP);var hostContext=false;if(selector.indexOf(HOST_CONTEXT)>=0){hostContext=true}else if(selector.indexOf(HOST)>=0){selector=selector.replace(HOST_PAREN,function(m,host,paren){return hostScope+paren});selector=selector.replace(HOST,hostScope)}else if(jumpIndex!==0){selector=scope?this._transformSimpleSelector(selector,scope):selector}if(selector.indexOf(CONTENT)>=0){combinator=""}var stop;if(jumpIndex>=0){selector=selector.replace(SCOPE_JUMP," ");stop=true}return{value:selector,combinator:combinator,stop:stop,hostContext:hostContext}},_transformSimpleSelector:function(selector,scope){var p$=selector.split(PSEUDO_PREFIX);p$[0]+=scope;return p$.join(PSEUDO_PREFIX)},documentRule:function(rule){rule.selector=rule.parsedSelector;this.normalizeRootSelector(rule);if(!nativeShadow){this._transformRule(rule,this._transformDocumentSelector)}},normalizeRootSelector:function(rule){if(rule.selector===ROOT){rule.selector="body"}},_transformDocumentSelector:function(selector){return selector.match(SCOPE_JUMP)?this._transformComplexSelector(selector,SCOPE_DOC_SELECTOR):this._transformSimpleSelector(selector.trim(),SCOPE_DOC_SELECTOR)},SCOPE_NAME:"style-scope"};var SCOPE_NAME=api.SCOPE_NAME;var SCOPE_DOC_SELECTOR=":not(["+SCOPE_NAME+"])"+":not(."+SCOPE_NAME+")";var COMPLEX_SELECTOR_SEP=",";var SIMPLE_SELECTOR_SEP=/(^|[\s>+~]+)([^\s>+~]+)/g;var HOST=":host";var ROOT=":root";var HOST_PAREN=/(\:host)(?:\(((?:\([^)(]*\)|[^)(]*)+?)\))/g;var HOST_CONTEXT=":host-context";var HOST_CONTEXT_PAREN=/(.*)(?:\:host-context)(?:\(((?:\([^)(]*\)|[^)(]*)+?)\))(.*)/;var CONTENT="::content";var SCOPE_JUMP=/\:\:content|\:\:shadow|\/deep\//;var CSS_CLASS_PREFIX=".";var CSS_ATTR_PREFIX="["+SCOPE_NAME+"~=";var CSS_ATTR_SUFFIX="]";var PSEUDO_PREFIX=":";var CLASS="class";return api}();Polymer.StyleExtends=function(){var styleUtil=Polymer.StyleUtil;return{hasExtends:function(cssText){return Boolean(cssText.match(this.rx.EXTEND))},transform:function(style){var rules=styleUtil.rulesForStyle(style);var self=this;styleUtil.forEachStyleRule(rules,function(rule){var map=self._mapRule(rule);if(rule.parent){var m;while(m=self.rx.EXTEND.exec(rule.cssText)){var extend=m[1];var extendor=self._findExtendor(extend,rule);if(extendor){self._extendRule(rule,extendor)}}}rule.cssText=rule.cssText.replace(self.rx.EXTEND,"")});return styleUtil.toCssText(rules,function(rule){if(rule.selector.match(self.rx.STRIP)){rule.cssText=""}},true)},_mapRule:function(rule){if(rule.parent){var map=rule.parent.map||(rule.parent.map={});var parts=rule.selector.split(",");for(var i=0,p;i<parts.length;i++){p=parts[i];map[p.trim()]=rule}return map}},_findExtendor:function(extend,rule){return rule.parent&&rule.parent.map&&rule.parent.map[extend]||this._findExtendor(extend,rule.parent)},_extendRule:function(target,source){if(target.parent!==source.parent){this._cloneAndAddRuleToParent(source,target.parent)}target.extends=target.extends||(target.extends=[]);target.extends.push(source);source.selector=source.selector.replace(this.rx.STRIP,"");source.selector=(source.selector&&source.selector+",\n")+target.selector;if(source.extends){source.extends.forEach(function(e){this._extendRule(target,e)},this)}},_cloneAndAddRuleToParent:function(rule,parent){rule=Object.create(rule);rule.parent=parent;if(rule.extends){rule.extends=rule.extends.slice()}parent.rules.push(rule)},rx:{EXTEND:/@extends\(([^)]*)\)\s*?;/gim,STRIP:/%[^,]*$/}}}();(function(){var prepElement=Polymer.Base._prepElement;var nativeShadow=Polymer.Settings.useNativeShadow;var styleUtil=Polymer.StyleUtil;var styleTransformer=Polymer.StyleTransformer;var styleExtends=Polymer.StyleExtends;Polymer.Base._addFeature({_prepElement:function(element){if(this._encapsulateStyle){styleTransformer.element(element,this.is,this._scopeCssViaAttr)}prepElement.call(this,element)},_prepStyles:function(){if(this._encapsulateStyle===undefined){this._encapsulateStyle=!nativeShadow&&Boolean(this._template)}this._styles=this._collectStyles();var cssText=styleTransformer.elementStyles(this);if(cssText&&this._template){var style=styleUtil.applyCss(cssText,this.is,nativeShadow?this._template.content:null);if(!nativeShadow){this._scopeStyle=style}}},_collectStyles:function(){var styles=[];var cssText="",m$=this.styleModules;if(m$){for(var i=0,l=m$.length,m;i<l&&(m=m$[i]);i++){cssText+=styleUtil.cssFromModule(m)}}cssText+=styleUtil.cssFromModule(this.is);if(cssText){var style=document.createElement("style");style.textContent=cssText;if(styleExtends.hasExtends(style.textContent)){cssText=styleExtends.transform(style)}styles.push(style)}return styles},_elementAdd:function(node){if(this._encapsulateStyle){if(node.__styleScoped){node.__styleScoped=false}else{styleTransformer.dom(node,this.is,this._scopeCssViaAttr)}}},_elementRemove:function(node){if(this._encapsulateStyle){styleTransformer.dom(node,this.is,this._scopeCssViaAttr,true)}},scopeSubtree:function(container,shouldObserve){if(nativeShadow){return}var self=this;var scopify=function(node){if(node.nodeType===Node.ELEMENT_NODE){node.className=self._scopeElementClass(node,node.className);var n$=node.querySelectorAll("*");Array.prototype.forEach.call(n$,function(n){n.className=self._scopeElementClass(n,n.className)})}};scopify(container);if(shouldObserve){var mo=new MutationObserver(function(mxns){mxns.forEach(function(m){if(m.addedNodes){for(var i=0;i<m.addedNodes.length;i++){scopify(m.addedNodes[i])}}})});mo.observe(container,{childList:true,subtree:true});return mo}}})})();Polymer.StyleProperties=function(){"use strict";var nativeShadow=Polymer.Settings.useNativeShadow;var matchesSelector=Polymer.DomApi.matchesSelector;var styleUtil=Polymer.StyleUtil;var styleTransformer=Polymer.StyleTransformer;return{decorateStyles:function(styles){var self=this,props={};styleUtil.forRulesInStyles(styles,function(rule){self.decorateRule(rule);self.collectPropertiesInCssText(rule.propertyInfo.cssText,props)});var names=[];for(var i in props){names.push(i)}return names},decorateRule:function(rule){if(rule.propertyInfo){return rule.propertyInfo}var info={},properties={};var hasProperties=this.collectProperties(rule,properties);if(hasProperties){info.properties=properties;rule.rules=null}info.cssText=this.collectCssText(rule);rule.propertyInfo=info;return info},collectProperties:function(rule,properties){var info=rule.propertyInfo;if(info){if(info.properties){Polymer.Base.mixin(properties,info.properties);return true}}else{var m,rx=this.rx.VAR_ASSIGN;var cssText=rule.parsedCssText;var any;while(m=rx.exec(cssText)){properties[m[1]]=(m[2]||m[3]).trim();any=true}return any}},collectCssText:function(rule){var customCssText="";var cssText=rule.parsedCssText;cssText=cssText.replace(this.rx.BRACKETED,"").replace(this.rx.VAR_ASSIGN,"");var parts=cssText.split(";");for(var i=0,p;i<parts.length;i++){p=parts[i];if(p.match(this.rx.MIXIN_MATCH)||p.match(this.rx.VAR_MATCH)){customCssText+=p+";\n"}}return customCssText},collectPropertiesInCssText:function(cssText,props){var m;while(m=this.rx.VAR_CAPTURE.exec(cssText)){props[m[1]]=true;var def=m[2];if(def&&def.match(this.rx.IS_VAR)){props[def]=true}}},reify:function(props){var names=Object.getOwnPropertyNames(props);for(var i=0,n;i<names.length;i++){n=names[i];props[n]=this.valueForProperty(props[n],props)}},valueForProperty:function(property,props){if(property){if(property.indexOf(";")>=0){property=this.valueForProperties(property,props)}else{var self=this;var fn=function(all,prefix,value,fallback){var propertyValue=self.valueForProperty(props[value],props)||(props[fallback]?self.valueForProperty(props[fallback],props):fallback);return prefix+(propertyValue||"")};property=property.replace(this.rx.VAR_MATCH,fn)}}return property&&property.trim()||""},valueForProperties:function(property,props){var parts=property.split(";");for(var i=0,p,m;i<parts.length;i++){if(p=parts[i]){m=p.match(this.rx.MIXIN_MATCH);if(m){p=this.valueForProperty(props[m[1]],props)}else{var pp=p.split(":");if(pp[1]){pp[1]=pp[1].trim();pp[1]=this.valueForProperty(pp[1],props)||pp[1]}p=pp.join(":")}parts[i]=p&&p.lastIndexOf(";")===p.length-1?p.slice(0,-1):p||""}}return parts.join(";")},applyProperties:function(rule,props){var output="";if(!rule.propertyInfo){this.decorateRule(rule)}if(rule.propertyInfo.cssText){output=this.valueForProperties(rule.propertyInfo.cssText,props)}rule.cssText=output},propertyDataFromStyles:function(styles,element){var props={},self=this;var o=[],i=0;styleUtil.forRulesInStyles(styles,function(rule){if(!rule.propertyInfo){self.decorateRule(rule)}if(element&&rule.propertyInfo.properties&&matchesSelector.call(element,rule.transformedSelector||rule.parsedSelector)){self.collectProperties(rule,props);addToBitMask(i,o)}i++});return{properties:props,key:o}},scopePropertiesFromStyles:function(styles){if(!styles._scopeStyleProperties){styles._scopeStyleProperties=this.selectedPropertiesFromStyles(styles,this.SCOPE_SELECTORS)}return styles._scopeStyleProperties},hostPropertiesFromStyles:function(styles){if(!styles._hostStyleProperties){styles._hostStyleProperties=this.selectedPropertiesFromStyles(styles,this.HOST_SELECTORS)}return styles._hostStyleProperties},selectedPropertiesFromStyles:function(styles,selectors){var props={},self=this;styleUtil.forRulesInStyles(styles,function(rule){if(!rule.propertyInfo){self.decorateRule(rule)}for(var i=0;i<selectors.length;i++){if(rule.parsedSelector===selectors[i]){self.collectProperties(rule,props);return}}});return props},transformStyles:function(element,properties,scopeSelector){var self=this;var hostSelector=styleTransformer._calcHostScope(element.is,element.extends);var rxHostSelector=element.extends?"\\"+hostSelector.slice(0,-1)+"\\]":hostSelector;var hostRx=new RegExp(this.rx.HOST_PREFIX+rxHostSelector+this.rx.HOST_SUFFIX);return styleTransformer.elementStyles(element,function(rule){self.applyProperties(rule,properties);if(rule.cssText&&!nativeShadow){self._scopeSelector(rule,hostRx,hostSelector,element._scopeCssViaAttr,scopeSelector)}})},_scopeSelector:function(rule,hostRx,hostSelector,viaAttr,scopeId){rule.transformedSelector=rule.transformedSelector||rule.selector;var selector=rule.transformedSelector;var scope=viaAttr?"["+styleTransformer.SCOPE_NAME+"~="+scopeId+"]":"."+scopeId;var parts=selector.split(",");for(var i=0,l=parts.length,p;i<l&&(p=parts[i]);i++){parts[i]=p.match(hostRx)?p.replace(hostSelector,hostSelector+scope):scope+" "+p}rule.selector=parts.join(",")},applyElementScopeSelector:function(element,selector,old,viaAttr){var c=viaAttr?element.getAttribute(styleTransformer.SCOPE_NAME):element.className;var v=old?c.replace(old,selector):(c?c+" ":"")+this.XSCOPE_NAME+" "+selector;if(c!==v){if(viaAttr){element.setAttribute(styleTransformer.SCOPE_NAME,v)}else{element.className=v}}},applyElementStyle:function(element,properties,selector,style){var cssText=style?style.textContent||"":this.transformStyles(element,properties,selector);var s=element._customStyle;if(s&&!nativeShadow&&s!==style){s._useCount--;if(s._useCount<=0&&s.parentNode){s.parentNode.removeChild(s)}}if(nativeShadow||(!style||!style.parentNode)){if(nativeShadow&&element._customStyle){element._customStyle.textContent=cssText;style=element._customStyle}else if(cssText){style=styleUtil.applyCss(cssText,selector,nativeShadow?element.root:null,element._scopeStyle)}}if(style){style._useCount=style._useCount||0;if(element._customStyle!=style){style._useCount++}element._customStyle=style}return style},mixinCustomStyle:function(props,customStyle){var v;for(var i in customStyle){v=customStyle[i];if(v||v===0){props[i]=v}}},rx:{VAR_ASSIGN:/(?:^|[;\n]\s*)(--[\w-]*?):\s*(?:([^;{]*)|{([^}]*)})(?:(?=[;\n])|$)/gi,MIXIN_MATCH:/(?:^|\W+)@apply[\s]*\(([^)]*)\)/i,VAR_MATCH:/(^|\W+)var\([\s]*([^,)]*)[\s]*,?[\s]*((?:[^,)]*)|(?:[^;]*\([^;)]*\)))[\s]*?\)/gi,VAR_CAPTURE:/\([\s]*(--[^,\s)]*)(?:,[\s]*(--[^,\s)]*))?(?:\)|,)/gi,IS_VAR:/^--/,BRACKETED:/\{[^}]*\}/g,HOST_PREFIX:"(?:^|[^.#[:])",HOST_SUFFIX:"($|[.:[\\s>+~])"},HOST_SELECTORS:[":host"],SCOPE_SELECTORS:[":root"],XSCOPE_NAME:"x-scope"};function addToBitMask(n,bits){var o=parseInt(n/32);var v=1<<n%32;bits[o]=(bits[o]||0)|v}}();(function(){Polymer.StyleCache=function(){this.cache={}};Polymer.StyleCache.prototype={MAX:100,store:function(is,data,keyValues,keyStyles){data.keyValues=keyValues;data.styles=keyStyles;var s$=this.cache[is]=this.cache[is]||[];s$.push(data);if(s$.length>this.MAX){s$.shift()}},retrieve:function(is,keyValues,keyStyles){var cache=this.cache[is];if(cache){for(var i=cache.length-1,data;i>=0;i--){data=cache[i];if(keyStyles===data.styles&&this._objectsEqual(keyValues,data.keyValues)){return data}}}},clear:function(){this.cache={}},_objectsEqual:function(target,source){var t,s;for(var i in target){t=target[i],s=source[i];if(!(typeof t==="object"&&t?this._objectsStrictlyEqual(t,s):t===s)){return false}}if(Array.isArray(target)){return target.length===source.length}return true},_objectsStrictlyEqual:function(target,source){return this._objectsEqual(target,source)&&this._objectsEqual(source,target)}}})();Polymer.StyleDefaults=function(){var styleProperties=Polymer.StyleProperties;var styleUtil=Polymer.StyleUtil;var StyleCache=Polymer.StyleCache;var api={_styles:[],_properties:null,customStyle:{},_styleCache:new StyleCache,addStyle:function(style){this._styles.push(style);this._properties=null},get _styleProperties(){if(!this._properties){styleProperties.decorateStyles(this._styles);this._styles._scopeStyleProperties=null;this._properties=styleProperties.scopePropertiesFromStyles(this._styles);styleProperties.mixinCustomStyle(this._properties,this.customStyle);styleProperties.reify(this._properties)}return this._properties},_needsStyleProperties:function(){},_computeStyleProperties:function(){return this._styleProperties},updateStyles:function(properties){this._properties=null;if(properties){Polymer.Base.mixin(this.customStyle,properties)}this._styleCache.clear();for(var i=0,s;i<this._styles.length;i++){s=this._styles[i];s=s.__importElement||s;s._apply()}}};return api}();(function(){"use strict";var serializeValueToAttribute=Polymer.Base.serializeValueToAttribute;var propertyUtils=Polymer.StyleProperties;var styleTransformer=Polymer.StyleTransformer;var styleUtil=Polymer.StyleUtil;var styleDefaults=Polymer.StyleDefaults;var nativeShadow=Polymer.Settings.useNativeShadow;Polymer.Base._addFeature({_prepStyleProperties:function(){this._ownStylePropertyNames=this._styles?propertyUtils.decorateStyles(this._styles):[]},customStyle:{},_setupStyleProperties:function(){this.customStyle={}},_needsStyleProperties:function(){return Boolean(this._ownStylePropertyNames&&this._ownStylePropertyNames.length)},_beforeAttached:function(){if(!this._scopeSelector&&this._needsStyleProperties()){this._updateStyleProperties()}},_findStyleHost:function(){var e=this,root;while(root=Polymer.dom(e).getOwnerRoot()){if(Polymer.isInstance(root.host)){return root.host}e=root.host}return styleDefaults},_updateStyleProperties:function(){var info,scope=this._findStyleHost();if(!scope._styleCache){scope._styleCache=new Polymer.StyleCache}var scopeData=propertyUtils.propertyDataFromStyles(scope._styles,this);scopeData.key.customStyle=this.customStyle;info=scope._styleCache.retrieve(this.is,scopeData.key,this._styles);var scopeCached=Boolean(info);if(scopeCached){this._styleProperties=info._styleProperties}else{this._computeStyleProperties(scopeData.properties)}this._computeOwnStyleProperties();if(!scopeCached){info=styleCache.retrieve(this.is,this._ownStyleProperties,this._styles)}var globalCached=Boolean(info)&&!scopeCached;var style=this._applyStyleProperties(info);if(!scopeCached){style=style&&nativeShadow?style.cloneNode(true):style;info={style:style,_scopeSelector:this._scopeSelector,_styleProperties:this._styleProperties};scopeData.key.customStyle={};this.mixin(scopeData.key.customStyle,this.customStyle);scope._styleCache.store(this.is,info,scopeData.key,this._styles);if(!globalCached){styleCache.store(this.is,Object.create(info),this._ownStyleProperties,this._styles)}}},_computeStyleProperties:function(scopeProps){var scope=this._findStyleHost();if(!scope._styleProperties){scope._computeStyleProperties()}var props=Object.create(scope._styleProperties);this.mixin(props,propertyUtils.hostPropertiesFromStyles(this._styles));scopeProps=scopeProps||propertyUtils.propertyDataFromStyles(scope._styles,this).properties;this.mixin(props,scopeProps);this.mixin(props,propertyUtils.scopePropertiesFromStyles(this._styles));propertyUtils.mixinCustomStyle(props,this.customStyle);propertyUtils.reify(props);this._styleProperties=props},_computeOwnStyleProperties:function(){var props={};for(var i=0,n;i<this._ownStylePropertyNames.length;i++){n=this._ownStylePropertyNames[i];props[n]=this._styleProperties[n]}this._ownStyleProperties=props},_scopeCount:0,_applyStyleProperties:function(info){var oldScopeSelector=this._scopeSelector;this._scopeSelector=info?info._scopeSelector:this.is+"-"+this.__proto__._scopeCount++;var style=propertyUtils.applyElementStyle(this,this._styleProperties,this._scopeSelector,info&&info.style);if(!nativeShadow){propertyUtils.applyElementScopeSelector(this,this._scopeSelector,oldScopeSelector,this._scopeCssViaAttr)}return style},serializeValueToAttribute:function(value,attribute,node){node=node||this;if(attribute==="class"&&!nativeShadow){var host=node===this?this.domHost||this.dataHost:this;if(host){value=host._scopeElementClass(node,value)}}node=Polymer.dom(node);serializeValueToAttribute.call(this,value,attribute,node)},_scopeElementClass:function(element,selector){if(!nativeShadow&&!this._scopeCssViaAttr){selector+=(selector?" ":"")+SCOPE_NAME+" "+this.is+(element._scopeSelector?" "+XSCOPE_NAME+" "+element._scopeSelector:"")}return selector},updateStyles:function(properties){if(this.isAttached){if(properties){this.mixin(this.customStyle,properties)}if(this._needsStyleProperties()){this._updateStyleProperties()}else{this._styleProperties=null}if(this._styleCache){this._styleCache.clear()}this._updateRootStyles()}},_updateRootStyles:function(root){root=root||this.root;var c$=Polymer.dom(root)._query(function(e){return e.shadyRoot||e.shadowRoot});for(var i=0,l=c$.length,c;i<l&&(c=c$[i]);i++){if(c.updateStyles){c.updateStyles()}}}});Polymer.updateStyles=function(properties){styleDefaults.updateStyles(properties);Polymer.Base._updateRootStyles(document)};var styleCache=new Polymer.StyleCache;Polymer.customStyleCache=styleCache;var SCOPE_NAME=styleTransformer.SCOPE_NAME;var XSCOPE_NAME=propertyUtils.XSCOPE_NAME})();Polymer.Base._addFeature({_registerFeatures:function(){this._prepIs();this._prepAttributes();this._prepConstructor();this._prepTemplate();this._prepStyles();this._prepStyleProperties();this._prepAnnotations();this._prepEffects();this._prepBehaviors();this._prepBindings();this._prepShady()},_prepBehavior:function(b){this._addPropertyEffects(b.properties);this._addComplexObserverEffects(b.observers);this._addHostAttributes(b.hostAttributes)},_initFeatures:function(){this._poolContent();this._setupConfigure();this._setupStyleProperties();this._pushHost();this._stampTemplate();this._popHost();this._marshalAnnotationReferences();this._setupDebouncers();this._marshalInstanceEffects();this._marshalHostAttributes();this._marshalBehaviors();this._marshalAttributes();this._tryReady()},_marshalBehavior:function(b){this._listenListeners(b.listeners)}});(function(){var nativeShadow=Polymer.Settings.useNativeShadow;var propertyUtils=Polymer.StyleProperties;var styleUtil=Polymer.StyleUtil;var cssParse=Polymer.CssParse;var styleDefaults=Polymer.StyleDefaults;var styleTransformer=Polymer.StyleTransformer;Polymer({is:"custom-style",extends:"style",properties:{include:String},ready:function(){this._tryApply()},attached:function(){this._tryApply()},_tryApply:function(){if(!this._appliesToDocument){if(this.parentNode&&this.parentNode.localName!=="dom-module"){this._appliesToDocument=true;var e=this.__appliedElement||this;styleDefaults.addStyle(e);if(e.textContent||this.include){this._apply()}else{var observer=new MutationObserver(function(){observer.disconnect();this._apply()
}.bind(this));observer.observe(e,{childList:true})}}}},_apply:function(){var e=this.__appliedElement||this;if(this.include){e.textContent=styleUtil.cssFromModules(this.include,true)+e.textContent}if(e.textContent){styleUtil.forEachStyleRule(styleUtil.rulesForStyle(e),function(rule){styleTransformer.documentRule(rule)});this._applyCustomProperties(e)}},_applyCustomProperties:function(element){this._computeStyleProperties();var props=this._styleProperties;var rules=styleUtil.rulesForStyle(element);element.textContent=styleUtil.toCssText(rules,function(rule){var css=rule.cssText=rule.parsedCssText;if(rule.propertyInfo&&rule.propertyInfo.cssText){css=cssParse.removeCustomPropAssignment(css);rule.cssText=propertyUtils.valueForProperties(css,props)}})}})})();Polymer.Templatizer={properties:{__hideTemplateChildren__:{observer:"_showHideChildren"}},_instanceProps:Polymer.nob,_parentPropPrefix:"_parent_",templatize:function(template){this._templatized=template;if(!template._content){template._content=template.content}if(template._content._ctor){this.ctor=template._content._ctor;this._prepParentProperties(this.ctor.prototype,template);return}var archetype=Object.create(Polymer.Base);this._customPrepAnnotations(archetype,template);this._prepParentProperties(archetype,template);archetype._prepEffects();this._customPrepEffects(archetype);archetype._prepBehaviors();archetype._prepBindings();archetype._notifyPath=this._notifyPathImpl;archetype._scopeElementClass=this._scopeElementClassImpl;archetype.listen=this._listenImpl;archetype._showHideChildren=this._showHideChildrenImpl;var _constructor=this._constructorImpl;var ctor=function TemplateInstance(model,host){_constructor.call(this,model,host)};ctor.prototype=archetype;archetype.constructor=ctor;template._content._ctor=ctor;this.ctor=ctor},_getRootDataHost:function(){return this.dataHost&&this.dataHost._rootDataHost||this.dataHost},_showHideChildrenImpl:function(hide){var c=this._children;for(var i=0;i<c.length;i++){var n=c[i];if(Boolean(hide)!=Boolean(n.__hideTemplateChildren__)){if(n.nodeType===Node.TEXT_NODE){if(hide){n.__polymerTextContent__=n.textContent;n.textContent=""}else{n.textContent=n.__polymerTextContent__}}else if(n.style){if(hide){n.__polymerDisplay__=n.style.display;n.style.display="none"}else{n.style.display=n.__polymerDisplay__}}}n.__hideTemplateChildren__=hide}},_debounceTemplate:function(fn){Polymer.dom.addDebouncer(this.debounce("_debounceTemplate",fn))},_flushTemplates:function(debouncerExpired){Polymer.dom.flush()},_customPrepEffects:function(archetype){var parentProps=archetype._parentProps;for(var prop in parentProps){archetype._addPropertyEffect(prop,"function",this._createHostPropEffector(prop))}for(var prop in this._instanceProps){archetype._addPropertyEffect(prop,"function",this._createInstancePropEffector(prop))}},_customPrepAnnotations:function(archetype,template){archetype._template=template;var c=template._content;if(!c._notes){var rootDataHost=archetype._rootDataHost;if(rootDataHost){Polymer.Annotations.prepElement=rootDataHost._prepElement.bind(rootDataHost)}c._notes=Polymer.Annotations.parseAnnotations(template);Polymer.Annotations.prepElement=null;this._processAnnotations(c._notes)}archetype._notes=c._notes;archetype._parentProps=c._parentProps},_prepParentProperties:function(archetype,template){var parentProps=this._parentProps=archetype._parentProps;if(this._forwardParentProp&&parentProps){var proto=archetype._parentPropProto;var prop;if(!proto){for(prop in this._instanceProps){delete parentProps[prop]}proto=archetype._parentPropProto=Object.create(null);if(template!=this){Polymer.Bind.prepareModel(proto);Polymer.Base.prepareModelNotifyPath(proto)}for(prop in parentProps){var parentProp=this._parentPropPrefix+prop;var effects=[{kind:"function",effect:this._createForwardPropEffector(prop)},{kind:"notify"}];Polymer.Bind._createAccessors(proto,parentProp,effects)}}if(template!=this){Polymer.Bind.prepareInstance(template);template._forwardParentProp=this._forwardParentProp.bind(this)}this._extendTemplate(template,proto);template._pathEffector=this._pathEffectorImpl.bind(this)}},_createForwardPropEffector:function(prop){return function(source,value){this._forwardParentProp(prop,value)}},_createHostPropEffector:function(prop){var prefix=this._parentPropPrefix;return function(source,value){this.dataHost._templatized[prefix+prop]=value}},_createInstancePropEffector:function(prop){return function(source,value,old,fromAbove){if(!fromAbove){this.dataHost._forwardInstanceProp(this,prop,value)}}},_extendTemplate:function(template,proto){Object.getOwnPropertyNames(proto).forEach(function(n){var val=template[n];var pd=Object.getOwnPropertyDescriptor(proto,n);Object.defineProperty(template,n,pd);if(val!==undefined){template._propertySetter(n,val)}})},_showHideChildren:function(hidden){},_forwardInstancePath:function(inst,path,value){},_forwardInstanceProp:function(inst,prop,value){},_notifyPathImpl:function(path,value){var dataHost=this.dataHost;var dot=path.indexOf(".");var root=dot<0?path:path.slice(0,dot);dataHost._forwardInstancePath.call(dataHost,this,path,value);if(root in dataHost._parentProps){dataHost._templatized.notifyPath(dataHost._parentPropPrefix+path,value)}},_pathEffectorImpl:function(path,value,fromAbove){if(this._forwardParentPath){if(path.indexOf(this._parentPropPrefix)===0){var subPath=path.substring(this._parentPropPrefix.length);this._forwardParentPath(subPath,value)}}Polymer.Base._pathEffector.call(this._templatized,path,value,fromAbove)},_constructorImpl:function(model,host){this._rootDataHost=host._getRootDataHost();this._setupConfigure(model);this._pushHost(host);this.root=this.instanceTemplate(this._template);this.root.__noContent=!this._notes._hasContent;this.root.__styleScoped=true;this._popHost();this._marshalAnnotatedNodes();this._marshalInstanceEffects();this._marshalAnnotatedListeners();var children=[];for(var n=this.root.firstChild;n;n=n.nextSibling){children.push(n);n._templateInstance=this}this._children=children;if(host.__hideTemplateChildren__){this._showHideChildren(true)}this._tryReady()},_listenImpl:function(node,eventName,methodName){var model=this;var host=this._rootDataHost;var handler=host._createEventHandler(node,eventName,methodName);var decorated=function(e){e.model=model;handler(e)};host._listen(node,eventName,decorated)},_scopeElementClassImpl:function(node,value){var host=this._rootDataHost;if(host){return host._scopeElementClass(node,value)}},stamp:function(model){model=model||{};if(this._parentProps){var templatized=this._templatized;for(var prop in this._parentProps){model[prop]=templatized[this._parentPropPrefix+prop]}}return new this.ctor(model,this)},modelForElement:function(el){var model;while(el){if(model=el._templateInstance){if(model.dataHost!=this){el=model.dataHost}else{return model}}else{el=el.parentNode}}}};Polymer({is:"dom-template",extends:"template",behaviors:[Polymer.Templatizer],ready:function(){this.templatize(this)}});Polymer._collections=new WeakMap;Polymer.Collection=function(userArray){Polymer._collections.set(userArray,this);this.userArray=userArray;this.store=userArray.slice();this.initMap()};Polymer.Collection.prototype={constructor:Polymer.Collection,initMap:function(){var omap=this.omap=new WeakMap;var pmap=this.pmap={};var s=this.store;for(var i=0;i<s.length;i++){var item=s[i];if(item&&typeof item=="object"){omap.set(item,i)}else{pmap[item]=i}}},add:function(item){var key=this.store.push(item)-1;if(item&&typeof item=="object"){this.omap.set(item,key)}else{this.pmap[item]=key}return key},removeKey:function(key){this._removeFromMap(this.store[key]);delete this.store[key]},_removeFromMap:function(item){if(item&&typeof item=="object"){this.omap.delete(item)}else{delete this.pmap[item]}},remove:function(item){var key=this.getKey(item);this.removeKey(key);return key},getKey:function(item){if(item&&typeof item=="object"){return this.omap.get(item)}else{return this.pmap[item]}},getKeys:function(){return Object.keys(this.store)},setItem:function(key,item){var old=this.store[key];if(old){this._removeFromMap(old)}if(item&&typeof item=="object"){this.omap.set(item,key)}else{this.pmap[item]=key}this.store[key]=item},getItem:function(key){return this.store[key]},getItems:function(){var items=[],store=this.store;for(var key in store){items.push(store[key])}return items},_applySplices:function(splices){var keyMap={},key,i;splices.forEach(function(s){s.addedKeys=[];for(i=0;i<s.removed.length;i++){key=this.getKey(s.removed[i]);keyMap[key]=keyMap[key]?null:-1}for(i=0;i<s.addedCount;i++){var item=this.userArray[s.index+i];key=this.getKey(item);key=key===undefined?this.add(item):key;keyMap[key]=keyMap[key]?null:1;s.addedKeys.push(key)}},this);var removed=[];var added=[];for(var key in keyMap){if(keyMap[key]<0){this.removeKey(key);removed.push(key)}if(keyMap[key]>0){added.push(key)}}return[{removed:removed,added:added}]}};Polymer.Collection.get=function(userArray){return Polymer._collections.get(userArray)||new Polymer.Collection(userArray)};Polymer.Collection.applySplices=function(userArray,splices){var coll=Polymer._collections.get(userArray);return coll?coll._applySplices(splices):null};Polymer({is:"dom-repeat",extends:"template",properties:{items:{type:Array},as:{type:String,value:"item"},indexAs:{type:String,value:"index"},sort:{type:Function,observer:"_sortChanged"},filter:{type:Function,observer:"_filterChanged"},observe:{type:String,observer:"_observeChanged"},delay:Number},behaviors:[Polymer.Templatizer],observers:["_itemsChanged(items.*)"],created:function(){this._instances=[]},detached:function(){for(var i=0;i<this._instances.length;i++){this._detachRow(i)}},attached:function(){var parentNode=Polymer.dom(this).parentNode;for(var i=0;i<this._instances.length;i++){Polymer.dom(parentNode).insertBefore(this._instances[i].root,this)}},ready:function(){this._instanceProps={__key__:true};this._instanceProps[this.as]=true;this._instanceProps[this.indexAs]=true;if(!this.ctor){this.templatize(this)}},_sortChanged:function(){var dataHost=this._getRootDataHost();var sort=this.sort;this._sortFn=sort&&(typeof sort=="function"?sort:function(){return dataHost[sort].apply(dataHost,arguments)});this._needFullRefresh=true;if(this.items){this._debounceTemplate(this._render)}},_filterChanged:function(){var dataHost=this._getRootDataHost();var filter=this.filter;this._filterFn=filter&&(typeof filter=="function"?filter:function(){return dataHost[filter].apply(dataHost,arguments)});this._needFullRefresh=true;if(this.items){this._debounceTemplate(this._render)}},_observeChanged:function(){this._observePaths=this.observe&&this.observe.replace(".*",".").split(" ")},_itemsChanged:function(change){if(change.path=="items"){if(Array.isArray(this.items)){this.collection=Polymer.Collection.get(this.items)}else if(!this.items){this.collection=null}else{this._error(this._logf("dom-repeat","expected array for `items`,"+" found",this.items))}this._keySplices=[];this._indexSplices=[];this._needFullRefresh=true;this._debounceTemplate(this._render)}else if(change.path=="items.splices"){this._keySplices=this._keySplices.concat(change.value.keySplices);this._indexSplices=this._indexSplices.concat(change.value.indexSplices);this._debounceTemplate(this._render)}else{var subpath=change.path.slice(6);this._forwardItemPath(subpath,change.value);this._checkObservedPaths(subpath)}},_checkObservedPaths:function(path){if(this._observePaths){path=path.substring(path.indexOf(".")+1);var paths=this._observePaths;for(var i=0;i<paths.length;i++){if(path.indexOf(paths[i])===0){this._needFullRefresh=true;if(this.delay){this.debounce("render",this._render,this.delay)}else{this._debounceTemplate(this._render)}return}}}},render:function(){this._needFullRefresh=true;this._debounceTemplate(this._render);this._flushTemplates()},_render:function(){var c=this.collection;if(this._needFullRefresh){this._applyFullRefresh();this._needFullRefresh=false}else{if(this._sortFn){this._applySplicesUserSort(this._keySplices)}else{if(this._filterFn){this._applyFullRefresh()}else{this._applySplicesArrayOrder(this._indexSplices)}}}this._keySplices=[];this._indexSplices=[];var keyToIdx=this._keyToInstIdx={};for(var i=0;i<this._instances.length;i++){var inst=this._instances[i];keyToIdx[inst.__key__]=i;inst.__setProperty(this.indexAs,i,true)}this.fire("dom-change")},_applyFullRefresh:function(){var c=this.collection;var keys;if(this._sortFn){keys=c?c.getKeys():[]}else{keys=[];var items=this.items;if(items){for(var i=0;i<items.length;i++){keys.push(c.getKey(items[i]))}}}if(this._filterFn){keys=keys.filter(function(a){return this._filterFn(c.getItem(a))},this)}if(this._sortFn){keys.sort(function(a,b){return this._sortFn(c.getItem(a),c.getItem(b))}.bind(this))}for(var i=0;i<keys.length;i++){var key=keys[i];var inst=this._instances[i];if(inst){inst.__setProperty("__key__",key,true);inst.__setProperty(this.as,c.getItem(key),true)}else{this._instances.push(this._insertRow(i,key))}}for(;i<this._instances.length;i++){this._detachRow(i)}this._instances.splice(keys.length,this._instances.length-keys.length)},_keySort:function(a,b){return this.collection.getKey(a)-this.collection.getKey(b)},_numericSort:function(a,b){return a-b},_applySplicesUserSort:function(splices){var c=this.collection;var instances=this._instances;var keyMap={};var pool=[];var sortFn=this._sortFn||this._keySort.bind(this);splices.forEach(function(s){for(var i=0;i<s.removed.length;i++){var key=s.removed[i];keyMap[key]=keyMap[key]?null:-1}for(var i=0;i<s.added.length;i++){var key=s.added[i];keyMap[key]=keyMap[key]?null:1}},this);var removedIdxs=[];var addedKeys=[];for(var key in keyMap){if(keyMap[key]===-1){removedIdxs.push(this._keyToInstIdx[key])}if(keyMap[key]===1){addedKeys.push(key)}}if(removedIdxs.length){removedIdxs.sort(this._numericSort);for(var i=removedIdxs.length-1;i>=0;i--){var idx=removedIdxs[i];if(idx!==undefined){pool.push(this._detachRow(idx));instances.splice(idx,1)}}}if(addedKeys.length){if(this._filterFn){addedKeys=addedKeys.filter(function(a){return this._filterFn(c.getItem(a))},this)}addedKeys.sort(function(a,b){return this._sortFn(c.getItem(a),c.getItem(b))}.bind(this));var start=0;for(var i=0;i<addedKeys.length;i++){start=this._insertRowUserSort(start,addedKeys[i],pool)}}},_insertRowUserSort:function(start,key,pool){var c=this.collection;var item=c.getItem(key);var end=this._instances.length-1;var idx=-1;var sortFn=this._sortFn||this._keySort.bind(this);while(start<=end){var mid=start+end>>1;var midKey=this._instances[mid].__key__;var cmp=sortFn(c.getItem(midKey),item);if(cmp<0){start=mid+1}else if(cmp>0){end=mid-1}else{idx=mid;break}}if(idx<0){idx=end+1}this._instances.splice(idx,0,this._insertRow(idx,key,pool));return idx},_applySplicesArrayOrder:function(splices){var pool=[];var c=this.collection;splices.forEach(function(s){for(var i=0;i<s.removed.length;i++){var inst=this._detachRow(s.index+i);if(!inst.isPlaceholder){pool.push(inst)}}this._instances.splice(s.index,s.removed.length);for(var i=0;i<s.addedKeys.length;i++){var inst={isPlaceholder:true,key:s.addedKeys[i]};this._instances.splice(s.index+i,0,inst)}},this);for(var i=this._instances.length-1;i>=0;i--){var inst=this._instances[i];if(inst.isPlaceholder){this._instances[i]=this._insertRow(i,inst.key,pool,true)}}},_detachRow:function(idx){var inst=this._instances[idx];if(!inst.isPlaceholder){var parentNode=Polymer.dom(this).parentNode;for(var i=0;i<inst._children.length;i++){var el=inst._children[i];Polymer.dom(inst.root).appendChild(el)}}return inst},_insertRow:function(idx,key,pool,replace){var inst;if(inst=pool&&pool.pop()){inst.__setProperty(this.as,this.collection.getItem(key),true);inst.__setProperty("__key__",key,true)}else{inst=this._generateRow(idx,key)}var beforeRow=this._instances[replace?idx+1:idx];var beforeNode=beforeRow?beforeRow._children[0]:this;var parentNode=Polymer.dom(this).parentNode;Polymer.dom(parentNode).insertBefore(inst.root,beforeNode);return inst},_generateRow:function(idx,key){var model={__key__:key};model[this.as]=this.collection.getItem(key);model[this.indexAs]=idx;var inst=this.stamp(model);return inst},_showHideChildren:function(hidden){for(var i=0;i<this._instances.length;i++){this._instances[i]._showHideChildren(hidden)}},_forwardInstanceProp:function(inst,prop,value){if(prop==this.as){var idx;if(this._sortFn||this._filterFn){idx=this.items.indexOf(this.collection.getItem(inst.__key__))}else{idx=inst[this.indexAs]}this.set("items."+idx,value)}},_forwardInstancePath:function(inst,path,value){if(path.indexOf(this.as+".")===0){this.notifyPath("items."+inst.__key__+"."+path.slice(this.as.length+1),value)}},_forwardParentProp:function(prop,value){this._instances.forEach(function(inst){inst.__setProperty(prop,value,true)},this)},_forwardParentPath:function(path,value){this._instances.forEach(function(inst){inst.notifyPath(path,value,true)},this)},_forwardItemPath:function(path,value){if(this._keyToInstIdx){var dot=path.indexOf(".");var key=path.substring(0,dot<0?path.length:dot);var idx=this._keyToInstIdx[key];var inst=this._instances[idx];if(inst){if(dot>=0){path=this.as+"."+path.substring(dot+1);inst.notifyPath(path,value,true)}else{inst.__setProperty(this.as,value,true)}}}},itemForElement:function(el){var instance=this.modelForElement(el);return instance&&instance[this.as]},keyForElement:function(el){var instance=this.modelForElement(el);return instance&&instance.__key__},indexForElement:function(el){var instance=this.modelForElement(el);return instance&&instance[this.indexAs]}});Polymer({is:"array-selector",properties:{items:{type:Array,observer:"clearSelection"},multi:{type:Boolean,value:false,observer:"clearSelection"},selected:{type:Object,notify:true},selectedItem:{type:Object,notify:true},toggle:{type:Boolean,value:false}},clearSelection:function(){if(Array.isArray(this.selected)){for(var i=0;i<this.selected.length;i++){this.unlinkPaths("selected."+i)}}else{this.unlinkPaths("selected")}if(this.multi){if(!this.selected||this.selected.length){this.selected=[];this._selectedColl=Polymer.Collection.get(this.selected)}}else{this.selected=null;this._selectedColl=null}this.selectedItem=null},isSelected:function(item){if(this.multi){return this._selectedColl.getKey(item)!==undefined}else{return this.selected==item}},deselect:function(item){if(this.multi){if(this.isSelected(item)){var skey=this._selectedColl.getKey(item);this.arrayDelete("selected",item);this.unlinkPaths("selected."+skey)}}else{this.selected=null;this.selectedItem=null;this.unlinkPaths("selected");this.unlinkPaths("selectedItem")}},select:function(item){var icol=Polymer.Collection.get(this.items);var key=icol.getKey(item);if(this.multi){if(this.isSelected(item)){if(this.toggle){this.deselect(item)}}else{this.push("selected",item);var skey=this._selectedColl.getKey(item);this.linkPaths("selected."+skey,"items."+key)}}else{if(this.toggle&&item==this.selected){this.deselect()}else{this.selected=item;this.selectedItem=item;this.linkPaths("selected","items."+key);this.linkPaths("selectedItem","items."+key)}}}});Polymer({is:"dom-if",extends:"template",properties:{if:{type:Boolean,value:false,observer:"_queueRender"},restamp:{type:Boolean,value:false,observer:"_queueRender"}},behaviors:[Polymer.Templatizer],_queueRender:function(){this._debounceTemplate(this._render)},detached:function(){this._teardownInstance()},attached:function(){if(this.if&&this.ctor){this.async(this._ensureInstance)}},render:function(){this._flushTemplates()},_render:function(){if(this.if){if(!this.ctor){this.templatize(this)}this._ensureInstance();this._showHideChildren()}else if(this.restamp){this._teardownInstance()}if(!this.restamp&&this._instance){this._showHideChildren()}if(this.if!=this._lastIf){this.fire("dom-change");this._lastIf=this.if}},_ensureInstance:function(){if(!this._instance){this._instance=this.stamp();var root=this._instance.root;var parent=Polymer.dom(Polymer.dom(this).parentNode);parent.insertBefore(root,this)}},_teardownInstance:function(){if(this._instance){var c=this._instance._children;if(c){var parent=Polymer.dom(Polymer.dom(c[0]).parentNode);c.forEach(function(n){parent.removeChild(n)})}this._instance=null}},_showHideChildren:function(){var hidden=this.__hideTemplateChildren__||!this.if;if(this._instance){this._instance._showHideChildren(hidden)}},_forwardParentProp:function(prop,value){if(this._instance){this._instance[prop]=value}},_forwardParentPath:function(path,value){if(this._instance){this._instance.notifyPath(path,value,true)}}});Polymer({is:"dom-bind",extends:"template",created:function(){Polymer.RenderStatus.whenReady(this._markImportsReady.bind(this))},_ensureReady:function(){if(!this._readied){this._readySelf()}},_markImportsReady:function(){this._importsReady=true;this._ensureReady()},_registerFeatures:function(){this._prepConstructor()},_insertChildren:function(){var parentDom=Polymer.dom(Polymer.dom(this).parentNode);parentDom.insertBefore(this.root,this)},_removeChildren:function(){if(this._children){for(var i=0;i<this._children.length;i++){this.root.appendChild(this._children[i])}}},_initFeatures:function(){},_scopeElementClass:function(element,selector){if(this.dataHost){return this.dataHost._scopeElementClass(element,selector)}else{return selector}},_prepConfigure:function(){var config={};for(var prop in this._propertyEffects){config[prop]=this[prop]}this._setupConfigure=this._setupConfigure.bind(this,config)},attached:function(){if(this._importsReady){this.render()}},detached:function(){this._removeChildren()},render:function(){this._ensureReady();if(!this._children){this._template=this;this._prepAnnotations();this._prepEffects();this._prepBehaviors();this._prepConfigure();this._prepBindings();Polymer.Base._initFeatures.call(this);this._children=Array.prototype.slice.call(this.root.childNodes)}this._insertChildren();this.fire("dom-change")}});CODON_CONFIG={"":{text:"",color:"transparent"},R:{text:"Arg",color:"#BBBFE0"},H:{text:"His",color:"#BBBFE0"},K:{text:"Lys",color:"#BBBFE0"},D:{text:"Asp",color:"#F8B7D3"},E:{text:"Glu",color:"#F8B7D3"},F:{text:"Phe",color:"#FFE75F"},L:{text:"Leu",color:"#FFE75F"},I:{text:"Ile",color:"#FFE75F"},M:{text:"Met",color:"#FFE75F"},V:{text:"Val",color:"#FFE75F"},P:{text:"Pro",color:"#FFE75F"},A:{text:"Ala",color:"#FFE75F"},W:{text:"Trp",color:"#FFE75F"},G:{text:"Gly",color:"#FFE75F"},T:{text:"Thr",color:"#B3DEC0"},S:{text:"Ser",color:"#B3DEC0"},Y:{text:"Tyr",color:"#B3DEC0"},Q:{text:"Gln",color:"#B3DEC0"},N:{text:"Asn",color:"#B3DEC0"},C:{text:"Cys",color:"#B3DEC0"},X:{text:" X ",color:"#f0f0f0"},"*":{text:" * ",color:"#DDDDDD"}};GENE_BIOTYPE_COLORS={"3prime_overlapping_ncrna":"Orange",ambiguous_orf:"SlateBlue",antisense:"SteelBlue",disrupted_domain:"YellowGreen",IG_C_gene:"#FF7F50",IG_D_gene:"#FF7F50",IG_J_gene:"#FF7F50",IG_V_gene:"#FF7F50",lincRNA:"#8b668b",miRNA:"#8b668b",misc_RNA:"#8b668b",Mt_rRNA:"#8b668b",Mt_tRNA:"#8b668b",ncrna_host:"Fuchsia",nonsense_mediated_decay:"seagreen",non_coding:"orangered",non_stop_decay:"aqua",polymorphic_pseudogene:"#666666",processed_pseudogene:"#666666",processed_transcript:"#0000ff",protein_coding:"#a00000",pseudogene:"#666666",retained_intron:"goldenrod",retrotransposed:"lightsalmon",rRNA:"indianred",sense_intronic:"#20B2AA",sense_overlapping:"#20B2AA",snoRNA:"#8b668b",snRNA:"#8b668b",transcribed_processed_pseudogene:"#666666",transcribed_unprocessed_pseudogene:"#666666",unitary_pseudogene:"#666666",unprocessed_pseudogene:"#666666","":"orangered",other:"#000000"};SNP_BIOTYPE_COLORS={"2KB_upstream_variant":"#a2b5cd","5KB_upstream_variant":"#a2b5cd","500B_downstream_variant":"#a2b5cd","5KB_downstream_variant":"#a2b5cd","3_prime_UTR_variant":"#7ac5cd","5_prime_UTR_variant":"#7ac5cd",coding_sequence_variant:"#458b00",complex_change_in_transcript:"#00fa9a",frameshift_variant:"#ff69b4",incomplete_terminal_codon_variant:"#ff00ff",inframe_codon_gain:"#ffd700",inframe_codon_loss:"#ffd700",initiator_codon_change:"#ffd700",non_synonymous_codon:"#ffd700",intergenic_variant:"#636363",intron_variant:"#02599c",mature_miRNA_variant:"#458b00",nc_transcript_variant:"#32cd32",splice_acceptor_variant:"#ff7f50",splice_donor_variant:"#ff7f50",splice_region_variant:"#ff7f50",stop_gained:"#ff0000",stop_lost:"#ff0000",stop_retained_variant:"#76ee00",synonymous_codon:"#76ee00",other:"#000000"};SEQUENCE_COLORS={A:"#009900",C:"#0000FF",G:"#857A00",T:"#aa0000",N:"#555555"};SAM_FLAGS=[["read paired",1],["read mapped in proper pair",2],["read unmapped",4],["mate unmapped",8],["read reverse strand",16],["mate reverse strand",32],["first in pair",64],["second in pair",128],["not primary alignment",256],["read fails platform/vendor quality checks",512],["read is PCR or optical duplicate",1024]];FEATURE_TYPES={formatTitle:function(str){var s=str;if(str){str.replace(/_/gi," ");s=s.charAt(0).toUpperCase()+s.slice(1)}return s},getTipCommons:function(f){var strand=f.strand!=null?f.strand:"NA";return'start-end:&nbsp;<span style="font-weight: bold">'+f.start+"-"+f.end+"</span><br>"+'strand:&nbsp;<span style="font-weight: bold">'+strand+"</span><br>"+'length:&nbsp;<span style="font-weight: bold; color:#005fdb">'+(f.end-f.start+1).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+"</span><br>"},getTipTitleCommons:function(f){var tokens=[];if(f.featureType)tokens.push(f.featureType);if(f.id)tokens.push(f.id);if(f.name)tokens.push(f.name);return tokens.join(" - ")},getLabelCommons:function(f){var tokens=[];if(f.id)tokens.push(f.id);if(f.name)tokens.push(f.name);return tokens.join(" - ")},_getSimpleKeys:function(f){var s="";for(key in f){if(key=="start"||key=="end"||key=="id"||key=="name"||key=="length"){continue}if(_.isNumber(f[key])||_.isString(f[key])){s+=key+':&nbsp;<span style="font-weight: bold">'+f[key]+"</span><br>"}}return s},sequence:{color:SEQUENCE_COLORS},undefined:{label:function(f){var str="";str+=f.chromosome+":"+f.start+"-"+f.end;return str},tooltipTitle:function(f){return FEATURE_TYPES.getTipTitleCommons(f)},tooltipText:function(f){return FEATURE_TYPES.getTipCommons(f)+FEATURE_TYPES._getSimpleKeys(f)},color:"#aaa",infoWidgetId:"id",height:10,histogramColor:"lightgray"},gene:{label:function(f){var name=f.name!=null?f.name:f.id;var str="";str+=f.strand<0||f.strand=="-"?"<":"";str+=" "+name+" ";str+=f.strand>0||f.strand=="+"?">":"";if(f.biotype!=null&&f.biotype!=""){str+=" ["+f.biotype+"]"}return str},tooltipTitle:function(f){var name=f.name!=null?f.name:f.id;return FEATURE_TYPES.formatTitle("Gene")+' - <span class="ok">'+name+"</span>"},tooltipText:function(f){var color=GENE_BIOTYPE_COLORS[f.biotype];return'id:&nbsp;<span class="ssel">'+f.id+"</span><br>"+'biotype:&nbsp;<span class="emph" style="color:'+color+';">'+f.biotype+"</span><br>"+FEATURE_TYPES.getTipCommons(f)+'source:&nbsp;<span class="ssel">'+f.source+"</span><br><br>"+'description:&nbsp;<span class="emph">'+f.description+"</span><br>"},color:function(f){return GENE_BIOTYPE_COLORS[f.biotype]},infoWidgetId:"id",height:4,histogramColor:"lightblue"},transcript:{label:function(f){var name=f.name!=null?f.name:f.id;var str="";str+=f.strand<0?"<":"";str+=" "+name+" ";str+=f.strand>0?">":"";if(f.biotype!=null&&f.biotype!=""){str+=" ["+f.biotype+"]"}return str},tooltipTitle:function(f){var name=f.name!=null?f.name:f.id;return FEATURE_TYPES.formatTitle("Transcript")+' - <span class="ok">'+name+"</span>"},tooltipText:function(f){var color=GENE_BIOTYPE_COLORS[f.biotype];return'id:&nbsp;<span class="ssel">'+f.id+"</span><br>"+'biotype:&nbsp;<span class="emph" style="color:'+color+';">'+f.biotype+"</span><br>"+'description:&nbsp;<span class="emph">'+f.description+"</span><br>"+FEATURE_TYPES.getTipCommons(f)},color:function(f){return GENE_BIOTYPE_COLORS[f.biotype]},infoWidgetId:"id",height:1,histogramColor:"lightblue"},exon:{label:function(f){var name=f.name!=null?f.name:f.id;return name},tooltipTitle:function(f){var name=f.name!=null?f.name:f.id;if(name==null){name=""}return FEATURE_TYPES.formatTitle("Exon")+' - <span class="ok">'+name+"</span>"},tooltipText:function(e,t){return FEATURE_TYPES.getTipCommons(e)+FEATURE_TYPES._getSimpleKeys(e)},color:function(f){return"black"},infoWidgetId:"id",height:7,histogramColor:"lightblue"},snp:{label:function(f){return"name"in f?f.name:f.id},tooltipTitle:function(f){var name=f.name!=null?f.name:f.id;return"SNP"+' - <span class="ok">'+name+"</span>"},tooltipText:function(f){return'alleles:&nbsp;<span class="ssel">'+f.alleleString+"</span><br>"+FEATURE_TYPES.getTipCommons(f)+'conseq. type :&nbsp;<span class="ssel">'+f.displayConsequenceType+"</span><br>"},color:function(f){return SNP_BIOTYPE_COLORS[f.displayConsequenceType]},infoWidgetId:"id",height:8,histogramColor:"orange"},vcf:{label:function(f){return f.id;try{var fields=f.sampleData.split("\t")}catch(e){console.log(e);debugger}if(fields.length>10||fields.length==9)return f.id+" "+f.ref+"/"+f.alt+"";else{var gt=fields[9].split(":")[0];if(gt.indexOf(".")!=-1||gt.indexOf("-")!=-1)return gt;var label="";var alt=f.alt.split(",");if(gt.charAt(0)=="0")label=f.ref;else{var pos=gt.charAt(0)-1;label=alt[pos]}label+=gt.charAt(1);if(gt.charAt(2)=="0")label+=f.ref;else{var pos=gt.charAt(2)-1;label+=alt[pos]}return label}},tooltipTitle:function(f){return'VCF variant - <span class="ok">'+f.id+"</span>"},tooltipText:function(f){return'alleles (ref/alt):&nbsp;<span class="emph">'+f.reference+"/"+f.alternate+"</span><br>"+'quality:&nbsp;<span class="emph">'+f.quality+"</span><br>"+'filter:&nbsp;<span class="emph">'+f.filter+"</span><br>"+FEATURE_TYPES.getTipCommons(f)},color:function(f){return"black"},infoWidgetId:"id",height:8,histogramColor:"gray"},gff2:{label:function(f){var str="";str+=f.label;return str},tooltipTitle:function(f){return f.featureType.toUpperCase()+' - <span class="ok">'+f.label+"</span>"},tooltipText:function(f){return'score:&nbsp;<span class="emph">'+f.score+"</span><br>"+'frame:&nbsp;<span class="emph">'+f.frame+"</span><br>"+FEATURE_TYPES.getTipCommons(f)},getColor:function(f){return"black"},height:8,histogramColor:"gray"},gff3:{label:function(f){var str="";str+=f.label;return str},tooltipTitle:function(f){return f.featureType.toUpperCase()+' - <span class="ok">'+f.label+"</span>"},tooltipText:function(f){return'score:&nbsp;<span class="emph">'+f.score+"</span><br>"+'frame:&nbsp;<span class="emph">'+f.frame+"</span><br>"+FEATURE_TYPES.getTipCommons(f)},color:function(f){return"black"},height:8,histogramColor:"gray",infoWidgetId:"id",handlers:{"feature:mouseover":function(e){console.log(e)},"feature:click":function(e){console.log(e)}}},gtf:{label:function(f){var str="";str+=f.label;return str},tooltipTitle:function(f){return f.featureType.toUpperCase()+' - <span class="ok">'+f.label+"</span>"},tooltipText:function(f){return'score:&nbsp;<span class="emph">'+f.score+"</span><br>"+'frame:&nbsp;<span class="emph">'+f.frame+"</span><br>"+FEATURE_TYPES.getTipCommons(f)},color:function(f){return"black"},height:8,histogramColor:"gray",infoWidgetId:"id",handlers:{"feature:mouseover":function(e){console.log(e)},"feature:click":function(e){console.log(e)}}},bed:{label:function(f){var str="";str+=f.label;return str},tooltipTitle:function(f){return FEATURE_TYPES.formatTitle(f.featureType)},tooltipText:function(f){return FEATURE_TYPES.getTipCommons(f)},color:function(f){var rgbColor=new Array;rgbColor=f.itemRgb.split(",");var hex=function(x){var hexDigits=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return isNaN(x)?"00":hexDigits[(x-x%16)/16]+hexDigits[x%16]};var hexColor=hex(rgbColor[0])+hex(rgbColor[1])+hex(rgbColor[2]);return"#"+hexColor},height:8,histogramColor:"orange",infoWidgetId:"id",handlers:{"feature:mouseover":function(e){console.log(e)},"feature:click":function(e){console.log(e)}}},alignment:{explainFlags:function(flags){var summary='<div style="background:#FFEF93;font-weight:bold;margin:0 15px 0 0;">flags : <span class="ssel">'+flags+"</span></div>";for(var i=0;i<SAM_FLAGS.length;i++){if(SAM_FLAGS[i][1]&flags){summary+=SAM_FLAGS[i][0]+"<br>"}}return summary},label:function(f){
return"Alignment  "+f.chromosome+":"+f.start+"-"+f.end},tooltipTitle:function(f){return"Alignment"+' - <span class="ok">'+f.name+"</span>"},tooltipText:function(f){f.strand=FEATURE_TYPES.alignment.strand(f);var cigar="";for(var i=0;i<f.differences.length;i++){var d=f.differences[i];cigar+=d.length+d.op}var one='cigar:&nbsp;<span class="ssel">'+cigar+"</span><br>"+'insert size:&nbsp;<span class="ssel">'+f.inferredInsertSize+"</span><br>"+FEATURE_TYPES.getTipCommons(f)+"<br>"+this.explainFlags(f.flags);var three='<div style="background:#FFEF93;font-weight:bold;">attributes</div>';delete f.attributes["BQ"];for(var key in f.attributes){three+=key+":"+f.attributes[key]+"<br>"}var style="background:#FFEF93;font-weight:bold;";return'<div style="float:left">'+one+"</div>"+'<div style="float:right">'+three+"</div>"},color:function(f,chr){if(f.mateReferenceName!=chr){return"lightgreen"}return(parseInt(f.flags)&16)==0?"DarkGray":"LightGray"},strokeColor:function(f){if(this.mateUnmappedFlag(f)){return"tomato"}return(parseInt(f.flags)&16)==0?"LightGray":"DarkGray"},strand:function(f){return(parseInt(f.flags)&16)==0?"Forward":"Reverse"},readPairedFlag:function(f){return(parseInt(f.flags)&1)==0?false:true},firstOfPairFlag:function(f){return(parseInt(f.flags)&64)==0?false:true},mateUnmappedFlag:function(f){return(parseInt(f.flags)&8)==0?false:true},infoWidgetId:"id",height:13,histogramColor:"grey"},variantMulti:{label:function(f){return f.id;debugger;try{var fields=f.sampleData.split("\t")}catch(e){console.log(e);debugger}if(fields.length>10||fields.length==9)return f.id+" "+f.ref+"/"+f.alt+"";else{var gt=fields[9].split(":")[0];if(gt.indexOf(".")!=-1||gt.indexOf("-")!=-1)return gt;var label="";var alt=f.alt.split(",");if(gt.charAt(0)=="0")label=f.ref;else{var pos=gt.charAt(0)-1;label=alt[pos]}label+=gt.charAt(1);if(gt.charAt(2)=="0")label+=f.ref;else{var pos=gt.charAt(2)-1;label+=alt[pos]}return label}},tooltipTitle:function(f){return'VCF variant - <span class="ok">'+f.id+"</span>"},tooltipText:function(f){return'alleles (ref/alt):&nbsp;<span class="emph">'+f.reference+"/"+f.alternate+"</span><br>"+'type:&nbsp;<span class="emph">'+f.type+"</span><br>"+FEATURE_TYPES.getTipCommons(f)},color:"#8BC34A",infoWidgetId:"id",height:10,histogramColor:"gray"},variant:{label:function(f){return FEATURE_TYPES.getLabelCommons(f)},tooltipTitle:function(f){return FEATURE_TYPES.getTipTitleCommons(f)},tooltipText:function(f){return FEATURE_TYPES.getTipCommons(f)+FEATURE_TYPES._getSimpleKeys(f)},color:"#8BC34A",infoWidgetId:"id",height:10,histogramColor:"#58f3f0"},TF_binding_site:{label:function(f){return FEATURE_TYPES.getLabelCommons(f)},tooltipTitle:function(f){return FEATURE_TYPES.getTipTitleCommons(f)},tooltipText:function(f){return FEATURE_TYPES.getTipCommons(f)+FEATURE_TYPES._getSimpleKeys(f)},color:"#58f3f0",infoWidgetId:"id",height:10,histogramColor:"#58f3f0"},mirna_target:{label:function(f){return FEATURE_TYPES.getLabelCommons(f)},tooltipTitle:function(f){return FEATURE_TYPES.getTipTitleCommons(f)},tooltipText:function(f){return FEATURE_TYPES.getTipCommons(f)+FEATURE_TYPES._getSimpleKeys(f)},color:"#8af688",infoWidgetId:"id",height:10,histogramColor:"#8af688"},Histone:{label:function(f){return FEATURE_TYPES.getLabelCommons(f)},tooltipTitle:function(f){return FEATURE_TYPES.getTipTitleCommons(f)},tooltipText:function(f){return FEATURE_TYPES.getTipCommons(f)+FEATURE_TYPES._getSimpleKeys(f)},color:"#7a91c7",infoWidgetId:"id",height:10,histogramColor:"#7a91c7"},Polymerase:{label:function(f){return FEATURE_TYPES.getLabelCommons(f)},tooltipTitle:function(f){return FEATURE_TYPES.getTipTitleCommons(f)},tooltipText:function(f){return FEATURE_TYPES.getTipCommons(f)+FEATURE_TYPES._getSimpleKeys(f)},color:"#44c2d4",infoWidgetId:"id",height:10,histogramColor:"#44c2d4"},"Open Chromatin":{label:function(f){return FEATURE_TYPES.getLabelCommons(f)},tooltipTitle:function(f){return FEATURE_TYPES.getTipTitleCommons(f)},tooltipText:function(f){return FEATURE_TYPES.getTipCommons(f)+FEATURE_TYPES._getSimpleKeys(f)},color:"#ba56b8",infoWidgetId:"id",height:10,histogramColor:"#ba56b8"},Clinvar:{label:function(f){return FEATURE_TYPES.getLabelCommons(f)},tooltipTitle:function(f){return"Clinvar"+" - "+f.clinvarSet.title},tooltipText:function(f){return FEATURE_TYPES.getTipCommons(f)+FEATURE_TYPES._getSimpleKeys(f)},color:"#d7ff9a",infoWidgetId:"id",height:10,histogramColor:"#d7ff9a"},Cosmic:{label:function(f){return FEATURE_TYPES.getLabelCommons(f)},tooltipTitle:function(f){return"Cosmic"},tooltipText:function(f){return FEATURE_TYPES.getTipCommons(f)+FEATURE_TYPES._getSimpleKeys(f)},color:"#009aff",infoWidgetId:"id",height:10,histogramColor:"#009aff"},GWAS:{label:function(f){return FEATURE_TYPES.getLabelCommons(f)},tooltipTitle:function(f){return"GWAS"},tooltipText:function(f){return FEATURE_TYPES.getTipCommons(f)+FEATURE_TYPES._getSimpleKeys(f)},color:"#ff6500",infoWidgetId:"id",height:10,histogramColor:"#ff6500"}};var SVG={create:function(elementName,attributes){var el=document.createElementNS("http://www.w3.org/2000/svg",elementName);for(var key in attributes){el.setAttribute(key,attributes[key])}return el},addChild:function(parent,elementName,attributes,index){var el=document.createElementNS("http://www.w3.org/2000/svg",elementName);for(var key in attributes){el.setAttribute(key,attributes[key])}return this._insert(parent,el,index)},addChildImage:function(parent,attributes,index){var el=document.createElementNS("http://www.w3.org/2000/svg","image");for(var key in attributes){if(key=="xlink:href"){el.setAttributeNS("http://www.w3.org/1999/xlink","href",attributes[key])}else{el.setAttribute(key,attributes[key])}}return this._insert(parent,el,index)},_insert:function(parent,el,index){if(null==index){parent.appendChild(el)}else{var targetIndex=index+1;if(0==index){targetIndex=0}var targetEl=parent.childNodes[targetIndex];if(targetEl){parent.insertBefore(el,targetEl)}else{parent.appendChild(el)}}return el},init:function(parent,attributes){return this.addChild(parent,"svg",attributes)},_polarToCartesian:function(centerX,centerY,radius,angleInDegrees){var angleInRadians=(angleInDegrees-90)*Math.PI/180;return{x:centerX+radius*Math.cos(angleInRadians),y:centerY+radius*Math.sin(angleInRadians)}},describeArc:function(x,y,radius,startAngle,endAngle){var start=this._polarToCartesian(x,y,radius,endAngle);var end=this._polarToCartesian(x,y,radius,startAngle);var arcSweep=endAngle-startAngle<=180?"0":"1";var d=["M",start.x,start.y,"A",radius,radius,0,arcSweep,0,end.x,end.y].join(" ");return d}};function Region(args){this.chromosome=null;this.start=null;this.end=null;if(_.isObject(args)){this.load(args)}else if(_.isString(args)){this.parse(args)}}Region.prototype={load:function(obj){if(_.isString(obj)){return this.parse(obj)}this.chromosome=this._checkChromosomeAlias(obj)||this.chromosome;if(typeof obj.position!=="undefined"){obj.start=parseInt(obj.position);obj.end=obj.start}_.isUndefined(obj.start)?this.start=parseInt(this.start):this.start=parseInt(obj.start);_.isUndefined(obj.end)?this.end=parseInt(this.end):this.end=parseInt(obj.end)},parse:function(str){if(_.isObject(str)){this.load(obj)}var pattern=/^([a-zA-Z0-9_])+\:([0-9])+\-([0-9])+$/;var pattern2=/^([a-zA-Z0-9_])+\:([0-9])+$/;if(pattern.test(str)||pattern2.test(str)){var splitDots=str.split(":");if(splitDots.length==2){var splitDash=splitDots[1].split("-");this.chromosome=splitDots[0];this.start=parseInt(splitDash[0]);if(splitDash.length==2){this.end=parseInt(splitDash[1])}else{this.end=this.start}}return true}else{return false}},multiParse:function(str){if(_.isObject(str)){this.load(obj)}var pattern=/^([a-zA-Z0-9_])+\:([0-9])+\-([0-9])+(,([a-zA-Z0-9_])+\:([0-9])+\-([0-9])+)*$/;var pattern2=/^\[([a-zA-Z0-9_])+\:([0-9])+\-([0-9])+(,([a-zA-Z0-9_])+\:([0-9])+\-([0-9])+)*\]$/;var withoutBrackets=str;if(pattern2.test(str)){withoutBrackets=str.slice(1,str.length-1)}var regions=[];if(pattern.test(withoutBrackets)){var splitRegions=withoutBrackets.split(",");for(var i=0;i<splitRegions.length;i++){regions.push(new Region(splitRegions[i]))}}return regions},center:function(){return this.start+Math.floor(this.length()/2)},length:function(){return this.end-this.start+1},equals:function(r){if(this.chromosome===r.chromosome&&this.start===r.start&&this.end===r.end){return true}return false},toString:function(formated){var str;if(formated==true){str=this.chromosome+":"+Utils.formatNumber(this.start)+"-"+Utils.formatNumber(this.end)}else{str=this.chromosome+":"+this.start+"-"+this.end}return str},_checkChromosomeAlias:function(obj){for(var i=0;i<Region.chromosomeAlias.length;i++){var alias=Region.chromosomeAlias[i];if(alias in obj){return obj[alias]}}}};Region.chromosomeAlias=["chromosome","sequenceName"];function FeatureBinarySearchTree(){this._root=null}FeatureBinarySearchTree.prototype={constructor:FeatureBinarySearchTree,add:function(v){var node={value:v,left:null,right:null},current;if(this._root===null){this._root=node;return true}current=this._root;while(true){if(node.value.end<current.value.start){if(current.left===null){current.left=node;return true}current=current.left}else if(node.value.start>current.value.end){if(current.right===null){current.right=node;return true}current=current.right}else{return false}}},contains:function(v){var node={value:v,left:null,right:null},found=false,current=this._root;while(!found&&current){if(node.value.end<current.value.start){current=current.left}else if(node.value.start>current.value.end){current=current.right}else{found=true}}return found}};var CellBaseManager={host:typeof CELLBASE_HOST==="undefined"?"http://bioinfo.hpc.cam.ac.uk/cellbase":CELLBASE_HOST,version:"v3",get:function(args){var success=args.success;var error=args.error;var async=args.async==false?false:true;var ignoreKeys=["success","error","async"];var urlConfig={};for(var prop in args){if(hasOwnProperty.call(args,prop)&&args[prop]!=null&&ignoreKeys.indexOf(prop)==-1){urlConfig[prop]=args[prop]}}var url=CellBaseManager.url(urlConfig);if(typeof url==="undefined"){return}console.log(url);var d;var request=new XMLHttpRequest;request.onload=function(){var contentType=this.getResponseHeader("Content-Type");if(contentType==="application/json"){var parsedResponse=JSON.parse(this.response);if(typeof success==="function")success(parsedResponse);d=parsedResponse}else{console.log("Cellbase returned a non json object or list, please check the url.");console.log(url);console.log(this.response)}};request.onerror=function(){console.log("CellBaseManager: Ajax call returned "+this.statusText);if(typeof error==="function")error(this)};request.open("GET",url,async);request.send();return d},url:function(args){if(args==null){args={}}if(args.params==null){args.params={}}var version=this.version;if(args.version!=null){version=args.version}var host=this.host;if(args.host!=null){host=args.host}delete args.host;delete args.version;var config={host:host,version:version};for(var prop in args){if(hasOwnProperty.call(args,prop)&&args[prop]!=null){config[prop]=args[prop]}}var query="";if(config.query!=null){query="/"+config.query.toString()}if(config.species&&config.species.id!=null){if(config.species.assembly!=null){config.params["assembly"]=config.species.assembly.name}if(config.subCategory==="chromosome"){delete config.params["assembly"]}config.species=Utils.getSpeciesCode(config.species.scientificName)}var url;if(config.category==="meta"){url=config.host+"/webservices/rest/"+config.version+"/"+config.category+"/"+config.subCategory}else{url=config.host+"/webservices/rest/"+config.version+"/"+config.species+"/"+config.category+"/"+config.subCategory+query+"/"+config.resource}url=Utils.addQueryParamtersToUrl(config.params,url);return url}};var EnsemblManager={host:"http://beta.rest.ensembl.org",get:function(args){var success=args.success;var error=args.error;var async=_.isUndefined(args.async)||_.isNull(args.async)?true:args.async;var urlConfig=_.omit(args,["success","error","async"]);var url=EnsemblManager.url(urlConfig);if(typeof url==="undefined"){return}console.log(url);var d;$.ajax({type:"GET",url:url,dataType:"json",async:async,success:function(data,textStatus,jqXHR){if($.isPlainObject(data)||$.isArray(data)){if(_.isFunction(success))success(data);d=data}else{console.log("Cellbase returned a non json object or list, please check the url.");console.log(url);console.log(data)}},error:function(jqXHR,textStatus,errorThrown){console.log("CellBaseManager: Ajax call returned : "+errorThrown+"\t"+textStatus+"\t"+jqXHR.statusText+" END");if(_.isFunction(error))error(jqXHR,textStatus,errorThrown)}});return d},url:function(args){if(!$.isPlainObject(args))args={};if(!$.isPlainObject(args.params))args.params={};var host=EnsemblManager.host;if(typeof args.host!=="undefined"){host=args.host}if(typeof host==="undefined"){console.log("CELLBASE_HOST is not configured");return}delete args.host;var config={host:host};var params={"content-type":"application/json"};_.extend(config,args);_.extend(config.params,params);if($.isPlainObject(config.species)){config.species=Utils.getSpeciesCode(config.species.text)}var url=config.host+"/"+config.category+"/"+config.subCategory+"/"+config.species+"/"+config.query;url=Utils.addQueryParamtersToUrl(config.params,url);return url}};var OpencgaManager={host:typeof OPENCGA_HOST==="undefined"?"http://cafetal:8080/opencga/rest":OPENCGA_HOST,version:typeof OPENCGA_VERSION==="undefined"?"v1":OPENCGA_VERSION,users:{login:function(args){return OpencgaManager._doRequest(args,"users","login")},logout:function(args){return OpencgaManager._doRequest(args,"users","logout")},read:function(args){return OpencgaManager._doRequest(args,"users","info")},update:function(args){return OpencgaManager._doRequest(args,"users","update")},updateEmail:function(args){return OpencgaManager._doRequest(args,"users","change-email")},updatePassword:function(args){return OpencgaManager._doRequest(args,"users","change-password")},resetPassword:function(args){return OpencgaManager._doRequest(args,"users","reset-password")},create:function(args){return OpencgaManager._doRequest(args,"users","create")},delete:function(args){return OpencgaManager._doRequest(args,"users","delete")}},projects:{list:function(args){return OpencgaManager._doRequest(args,"projects","all-projects")},read:function(args){return OpencgaManager._doRequest(args,"projects","info")},update:function(args){return OpencgaManager._doRequest(args,"projects","update")},create:function(args){return OpencgaManager._doRequest(args,"projects","create")},delete:function(args){return OpencgaManager._doRequest(args,"projects","delete")},studies:function(args){return OpencgaManager._doRequest(args,"projects","studies")}},studies:{list:function(args){return OpencgaManager._doRequest(args,"studies","all-studies")},read:function(args){return OpencgaManager._doRequest(args,"studies","info")},update:function(args){return OpencgaManager._doRequest(args,"studies","update")},create:function(args){return OpencgaManager._doRequest(args,"studies","create")},delete:function(args){return OpencgaManager._doRequest(args,"studies","delete")},analysis:function(args){return OpencgaManager._doRequest(args,"studies","analysis")},jobs:function(args){return OpencgaManager._doRequest(args,"studies","jobs")}},files:{list:function(args){return OpencgaManager._doRequest(args,"files","list")},fetch:function(args){return OpencgaManager._doRequest(args,"files","fetch")},alignments:function(args){return OpencgaManager._doRequest(args,"files","alignments")},variants:function(args){return OpencgaManager._doRequest(args,"files","variants")},read:function(args){return OpencgaManager._doRequest(args,"files","info")},info:function(args){return OpencgaManager._doRequest(args,"files","info")},delete:function(args){return OpencgaManager._doRequest(args,"files","delete")},index:function(args){return OpencgaManager._doRequest(args,"files","index")},search:function(args){return OpencgaManager._doRequest(args,"files","search")},filesByFolder:function(args){return OpencgaManager._doRequest(args,"files","files")},content:function(args){return OpencgaManager._doRequest(args,"files","content")},contentGrep:function(args){return OpencgaManager._doRequest(args,"files","content-grep")},createFolder:function(args){return OpencgaManager._doRequest(args,"files","create-folder")},setHeader:function(args){return OpencgaManager._doRequest(args,"files","set-header")},contentExample:function(args){return OpencgaManager._doRequest(args,"files","content-example")},downloadExample:function(args){return OpencgaManager._doRequest(args,"files","download-example")},update:function(args){return OpencgaManager._doRequest(args,"files","update")},download:function(args){return OpencgaManager._doRequest(args,"files","download")},upload:function(args){return OpencgaManager._doRequest(args,"files","upload")},upload2:function(args){var query={sid:Cookies("bioinfo_sid"),studyId:args.studyId};if(window.OPENCGA_OLD_URL_FORMAT!=null&&OPENCGA_OLD_URL_FORMAT===true){var splitIndex=args.relativeFilePath.lastIndexOf("/")+1;query.name=args.relativeFilePath.substring(splitIndex);query.directory=args.relativeFilePath.substring(0,splitIndex)}else{query.path=args.relativeFilePath}OpencgaManager.files.search({query:query,request:{success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){if(response.response[0].result.length==0){var url=OpencgaManager._url({query:{sid:args.sid},request:{}},"files","upload");args.url=url;OpencgaManager._uploadFile(args)}else{args.error("File already exists")}}else{args.error(response.response[0].errorMsg)}},error:function(){args.error("Server error, try again later.")}}})}},jobs:{create:function(args){return OpencgaManager._doRequest(args,"jobs","create")},delete:function(args){return OpencgaManager._doRequest(args,"jobs","delete")}},samples:{search:function(args){return OpencgaManager._doRequest(args,"samples","search")}},util:{proxy:function(args){return OpencgaManager._doRequest(args,"util","proxy")}},_url:function(args,api,action){var host=OpencgaManager.host;if(typeof args.request.host!=="undefined"&&args.request.host!=null){host=args.request.host}var version=OpencgaManager.version;if(typeof args.request.version!=="undefined"&&args.request.version!=null){version=args.request.version}var id="";if(typeof args.id!=="undefined"&&args.id!=null){id="/"+args.id}var url=host+"/webservices/rest/"+version+"/"+api+id+"/"+action;if(window.OPENCGA_OLD_URL_FORMAT!=null&&OPENCGA_OLD_URL_FORMAT===true){if(action=="jobs"){action="job"}if(api=="jobs"){api="job"}url=host+"/rest/"+api+id+"/"+action}url=Utils.addQueryParamtersToUrl(args.query,url);return url},_doRequest:function(args,api,action){var url=OpencgaManager._url(args,api,action);if(args.request.url===true){return url}else{var method="GET";if(typeof args.request.method!=="undefined"&&args.request.method!=null){method=args.request.method}var async=true;if(typeof args.request.async!=="undefined"&&args.request.async!=null){async=args.request.async}console.log(url);var request=new XMLHttpRequest;request.onload=function(){var contentType=this.getResponseHeader("Content-Type");if(contentType==="application/json"){args.request.success(JSON.parse(this.response),this)}else{args.request.success(this.response,this)}};request.onerror=function(){args.request.error(this)};request.open(method,url,async);request.send();return url}},_uploadFile:function(args){var url=args.url;var inputFile=args.inputFile;var fileName=args.fileName;var userId=args.userId;var studyId=args.studyId;var relativeFilePath=args.relativeFilePath;var fileFormat=args.fileFormat;var bioFormat=args.bioFormat;var description=args.description;var callbackProgress=args.callbackProgress;var resume=true;var resumeInfo={};var chunkMap={};var chunkId=0;var blob=inputFile;var BYTES_PER_CHUNK=2*1024*1024;var SIZE=blob.size;var NUM_CHUNKS=Math.max(Math.ceil(SIZE/BYTES_PER_CHUNK),1);var start;var end;var getResumeInfo=function(formData){var xhr=new XMLHttpRequest;xhr.open("POST",url,false);xhr.send(formData);var response=JSON.parse(xhr.responseText);return response.response[0]};var checkChunk=function(id,size,resumeInfo){if(typeof resumeInfo[id]==="undefined"){return false}else if(resumeInfo[id].size!=size){return false}return true};var processChunk=function(c){var chunkBlob=blob.slice(c.start,c.end);if(checkChunk(c.id,chunkBlob.size,resumeInfo)==false){var formData=new FormData;formData.append("chunk_content",chunkBlob);formData.append("chunk_id",c.id);formData.append("chunk_size",chunkBlob.size);formData.append("filename",fileName);formData.append("userId",userId);formData.append("studyId",studyId);formData.append("relativeFilePath",relativeFilePath);if(c.last){formData.append("last_chunk",true);formData.append("total_size",SIZE);formData.append("fileFormat",fileFormat);formData.append("bioFormat",bioFormat);formData.append("description",description)}uploadChunk(formData,c,function(chunkResponse){callbackProgress(c,NUM_CHUNKS,chunkResponse);if(!c.last){processChunk(chunkMap[c.id+1])}else{}})}else{callbackProgress(c,NUM_CHUNKS);if(!c.last){processChunk(chunkMap[c.id+1])}else{}}};var uploadChunk=function(formData,chunk,callback){var xhr=new XMLHttpRequest;xhr.open("POST",url,true);xhr.onload=function(e){chunk.done=true;console.log("chunk done");callback(JSON.parse(xhr.responseText))};xhr.send(formData)};if(resume){var resumeFormData=new FormData;resumeFormData.append("resume_upload",resume);resumeFormData.append("filename",fileName);resumeFormData.append("userId",userId);resumeFormData.append("studyId",studyId);resumeFormData.append("relativeFilePath",relativeFilePath);resumeInfo=getResumeInfo(resumeFormData)}start=0;end=BYTES_PER_CHUNK;while(start<SIZE){var last=false;if(chunkId==NUM_CHUNKS-1){last=true}chunkMap[chunkId]={id:chunkId,start:start,end:end,done:false,last:last};start=end;end=start+BYTES_PER_CHUNK;chunkId++}processChunk(chunkMap[0])},resourceTypes:{USERS:"users",PROJECTS:"projects",STUDIES:"studies",FILES:"files",ANALYSES:"analyses",JOBS:"jobs"},actions:{LOGIN:"login",LOGOUT:"logout",CREATE:"create",UPLOAD:"upload",INFO:"info",LIST:"list",FETCH:"fetch",UPDATE:"update",DELETE:"delete"},httpMethods:{},login:function(userId,queryParams,args){this._call(this.resourceTypes.USERS,userId,this.actions.LOGIN,queryParams,args)},logout:function(userId,queryParams,args){this._call(this.resourceTypes.USERS,"",this.actions.LOGOUT,queryParams,args)},create:function(resourceType,queryParams,args){this._call(resourceType,"",this.actions.CREATE,queryParam,args)},upload:function(resourceType,queryParams,args){this._call(resourceType,"",this.actions.UPLOAD,queryParams,args)},get:function(resourceType,resourceId,action,queryParams,args){_.extend(queryParams,{sid:"RNk4P0ttFGHyqLA3YGS8",view_as_pairs:"false",include_coverage:"true",process_differences:"false"});this._call(resourceType,resourceId,action,queryParams,args)},list:function(resourceType,queryParams,args){this._call(resourceType,"",this.actions.LIST,queryParams,args)},update:function(resourceType,resourceId,queryParams,args){this._call(resourceType,resourceId,this.actions.UPDATE,queryParams,args)},delete:function(resourceType,resourceId,queryParams,args){this._call(resourceType,resourceId,this.actions.DELETE,queryParams,args)},_call:function(resourceType,resourceId,action,queryParams,args){var url=this._url(resourceType,resourceId,action,queryParams,args);if(typeof url==="undefined"||url==null){return}console.log(url);var async=_.isUndefined(args.async)||_.isNull(args.async)?true:args.async;var success=args.success;var error=args.error;var d;$.ajax({type:OpencgaManager.httpMethods[resourceType],url:url,dataType:"json",async:async,success:function(data,textStatus,jqXHR){if($.isPlainObject(data)||$.isArray(data)){if(_.isFunction(success)){success(data)}d=data}else{console.log("Cellbase returned a non json object or list, please check the url.");console.log(url);console.log(data)}},error:function(jqXHR,textStatus,errorThrown){console.log("CellBaseManager: Ajax call returned : "+errorThrown+"\t"+textStatus+"\t"+jqXHR.statusText+" END");if(_.isFunction(error)){error(jqXHR,textStatus,errorThrown)}}});return url},_url2:function(resourceType,resourceId,action,queryParams,args){if(resourceId==undefined||resourceId==null){resourceId=""}else{resourceId=resourceId+"/"}var host=this.host;if(typeof args.host!=="undefined"&&args.host!=null){host=args.host}var opencga=this.opencga;if(typeof args.opencga!=="undefined"&&args.opencga!=null){opencga=args.opencga}var url=host+opencga+resourceType+"/"+resourceId+action;url=Utils.addQueryParamtersToUrl(queryParams,url);return url}};OpencgaManager.httpMethods[OpencgaManager.actions.LOGIN]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.LOGOUT]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.CREATE]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.UPLOAD]="POST";OpencgaManager.httpMethods[OpencgaManager.actions.INFO]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.LIST]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.FETCH]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.UPDATE]="GET";OpencgaManager.httpMethods[OpencgaManager.actions.DELETE]="GET";function FileFeatureCache(args){this.args=args;this.id=Math.round(Math.random()*1e7);this.chunkSize=5e4;this.gzip=true;this.maxSize=10*1024*1024;this.size=0;if(args!=null){if(args.chunkSize!=null){this.chunkSize=args.chunkSize}if(args.gzip!=null){this.gzip=args.gzip}}this.cache={};this.chunksDisplayed={};this.maxFeaturesInterval=0;this.gzip=false}FileFeatureCache.prototype._getChunk=function(position){return Math.floor(position/this.chunkSize)};FileFeatureCache.prototype.getChunkRegion=function(region){start=this._getChunk(region.start)*this.chunkSize;end=this._getChunk(region.end)*this.chunkSize+this.chunkSize-1;return{start:start,end:end}};FileFeatureCache.prototype.getFirstFeature=function(){var feature;if(this.gzip){feature=JSON.parse(RawDeflate.inflate(this.cache[Object.keys(this.cache)[0]].data[0]))}else{feature=this.cache[Object.keys(this.cache)[0]].data[0]}return feature};FileFeatureCache.prototype.getFeatureChunk=function(key){if(this.cache[key]!=null){return this.cache[key]}return null};FileFeatureCache.prototype.getFeatureChunkByDataType=function(key,dataType){if(this.cache[key]!=null){if(this.cache[key][dataType]!=null){return this.cache[key][dataType]}}return null};FileFeatureCache.prototype.getFeatureChunksByRegion=function(region){var firstRegionChunk,lastRegionChunk,chunks=[],key;firstRegionChunk=this._getChunk(region.start);lastRegionChunk=this._getChunk(region.end);for(var i=firstRegionChunk;i<=lastRegionChunk;i++){key=region.chromosome+":"+i;if(this.cache[key]!=null){chunks.push(this.cache[key])}}return chunks};FileFeatureCache.prototype.putFeaturesByRegion=function(featureDataList,region,featureType,dataType){var key,firstRegionChunk,lastRegionChunk,firstChunk,lastChunk,feature,gzipFeature;firstRegionChunk=this._getChunk(region.start);lastRegionChunk=this._getChunk(region.end);for(var i=firstRegionChunk;i<=lastRegionChunk;i++){key=region.chromosome+":"+i;if(this.cache[key]==null){this.cache[key]={};this.cache[key].key=key}if(this.cache[key][dataType]==null){this.cache[key][dataType]=[]}}if(featureDataList.constructor!=Array){featureDataList=[featureDataList]}for(var index=0,len=featureDataList.length;index<len;index++){feature=featureDataList[index];feature.featureType=featureType;firstChunk=this._getChunk(feature.start);lastChunk=this._getChunk(feature.end);if(this.gzip){gzipFeature=RawDeflate.deflate(JSON.stringify(feature))}else{gzipFeature=feature}for(var i=firstChunk;i<=lastChunk;i++){if(i>=firstRegionChunk&&i<=lastRegionChunk){key=region.chromosome+":"+i;this.cache[key][dataType].push(gzipFeature)}}}};FileFeatureCache.prototype.putFeatures=function(featureDataList,dataType){var feature,key,firstChunk,lastChunk;if(featureDataList.constructor!=Array){featureDataList=[featureDataList]}for(var index=0,len=featureDataList.length;index<len;index++){feature=featureDataList[index];firstChunk=this._getChunk(feature.start);lastChunk=this._getChunk(feature.end);for(var i=firstChunk;i<=lastChunk;i++){key=feature.chromosome+":"+i;if(this.cache[key]==null){this.cache[key]=[];this.cache[key].key=key}if(this.cache[key][dataType]==null){this.cache[key][dataType]=[]}if(this.gzip){this.cache[key][dataType].push(RawDeflate.deflate(JSON.stringify(feature)))}else{this.cache[key][dataType].push(feature)}}}};FileFeatureCache.prototype.putChunk=function(key,item){this.cache[key]=item};FileFeatureCache.prototype.getChunk=function(key){return this.cache[key]};FileFeatureCache.prototype.putCustom=function(f){f(this)};FileFeatureCache.prototype.getCustom=function(f){f(this)};FileFeatureCache.prototype.remove=function(region){var firstChunk=this._getChunk(region.start);var lastChunk=this._getChunk(region.end);for(var i=firstChunk;i<=lastChunk;i++){var key=region.chromosome+":"+i;this.cache[key]=null}};FileFeatureCache.prototype.clear=function(){this.size=0;this.cache={}};function FeatureChunkCache(args){_.extend(this,Backbone.Events);this.id=Utils.genId("FeatureChunkCache");this.defaultChunkSize=5e4;this.defaultCategory="defaultCategory";this.limit;_.extend(this,args);if(this.storeType=="MemoryStore"){this.store=new MemoryStore({})}else{this.store=new IndexedDBStore({cacheId:this.cacheId})}this.verbose=false}FeatureChunkCache.prototype={get:function(region,categories,dataType,chunkSize,callback){var _this=this;var temporalChunkSize=chunkSize?chunkSize:this.defaultChunkSize;var firstChunkId=this.getChunkId(region.start,temporalChunkSize);var lastChunkId=this.getChunkId(region.end,temporalChunkSize);var keys=[];var chunksAndRegions={cachedChunks:{},uncachedRegions:{}};for(var chunkId=firstChunkId;chunkId<=lastChunkId;chunkId++){keys.push(this.getChunkKey(region.chromosome,chunkId,dataType,temporalChunkSize))}if(!_.isArray(categories)){categories=[categories]}var callbackCount=0;for(var cat=0;cat<categories.length;cat++){callbackCount++;chunksAndRegions.cachedChunks[categories[cat]]=[];chunksAndRegions.uncachedRegions[categories[cat]]=[];this.getChunks(categories[cat],keys,function(iterCat){return function(chunks){for(var i=0;i<chunks.length;i++){var chunkRegionEnd=parseInt((firstChunkId+i)*temporalChunkSize+temporalChunkSize-1);var chunkRegionStart=parseInt((firstChunkId+i)*temporalChunkSize);var chunkRegion=new Region({chromosome:region.chromosome,start:chunkRegionStart,end:chunkRegionEnd});if(_.isUndefined(chunks[i])){chunksAndRegions.uncachedRegions[categories[iterCat]].push(chunkRegion)}else{chunksAndRegions.cachedChunks[categories[iterCat]].push(chunks[i])}}if(this.verbose){console.log(chunksAndRegions)}callbackCount--;if(callbackCount==0&&callback){callback(chunksAndRegions.cachedChunks,chunksAndRegions.uncachedRegions)}}}(cat))}},getChunk:function(category,chunkKey,callback){if(!callback){console.log("bad FeatureChunkCache usage: undefined callback")}if(!category){category=this.defaultCategory}this.store.get(category,chunkKey,callback)},getChunks:function(category,chunkKeysArray,callback){if(!callback){console.log("bad FeatureChunkCache usage: undefined callback")}if(!category){category=this.defaultCategory}this.store.getAll(category,chunkKeysArray,callback)},joinRegions:function(regions){if(regions.length<=1){return regions}var joinedRegions=[];var regionStart=regions[0].start;var regionEnd=region[0].end;var regionChromosome=regions[0].chromosome;for(var i=1;i<regions.length;i++){if(regions[i].chromosome==regionChromosome&&regions[i].start-1<=regionEnd){if(regions[i].end>regionEnd){regionEnd=regions[i].end}}else{joinedRegions.push(new Region({chromosome:regionChromosome,start:regionStart,end:regionEnd}));regionChromosome=regions[i].chromosome;regionStart=regions[i].start;regionEnd=regions[i].end}}joinedRegions.push(new Region({chromosome:regionChromosome,start:regionStart,end:regionEnd}));return joinedRegions},
putByRegions:function(regionArray,valueArray,category,dataType,chunkSize){var temporalChunkSize=chunkSize?chunkSize:this.defaultChunkSize;var chunkKeyArray=[];for(var i=0;i<regionArray.length;i++){var chunkId=this.getChunkId(regionArray[i].start,temporalChunkSize);var chunkKey=this.getChunkKey(regionArray[i].chromosome,chunkId,dataType,chunkSize);chunkKeyArray.push(chunkKey)}return this.putChunks(chunkKeyArray,valueArray,category,false)},putChunks:function(chunkKeyArray,valueArray,category,encoded){var valueStoredArray=[];for(var i=0;i<valueArray.length;i++){valueStoredArray.push(this.createEntryValue(chunkKeyArray[i],valueArray[i],encoded))}if(!category){category=this.defaultCategory}this.store.putAll(category,chunkKeyArray,valueStoredArray);return valueStoredArray},createEntryValue:function(chunkKey,value,encoded){var valueStored;if(encoded){valueStored={value:value,chunkKey:chunkKey,enc:encoded}}else{valueStored={value:value,chunkKey:chunkKey}}return valueStored},getChunkKey:function(chromosome,chunkId,dataType,chunkSize){var keySuffix=dataType?"_"+dataType:"";keySuffix+="_"+chunkSize;return chromosome+":"+chunkId+keySuffix},getChunkId:function(position,chunkSize){return Math.floor(position/chunkSize)},getDefaultChunkSize:function(){return this.defaultChunkSize}};function MemoryStore(args){_.extend(this,Backbone.Events);_.extend(this,args);this.init()}MemoryStore.prototype={put:function(category,key,value){if(typeof this.stores[category]==="undefined"){this.init(category)}var item={key:key,value:value};this.stores[category][key]=item;if(this.tails[category]){this.tails[category].newer=item;item.older=this.tails[category]}else{this.heads[category]=item}this.tails[category]=item;this.sizes[category]++},putAll:function(category,keyArray,valueArray){for(var i=0;i<keyArray.length;i++){this.put(category,keyArray[i],valueArray[i])}},shift:function(category){if(typeof this.stores[category]==="undefined"){this.init(category)}var item=this.heads[category];if(item){if(this.heads[category].newer){this.heads[category]=this.heads[category].newer;this.heads[category].older=undefined}else{this.heads[category]=undefined}item.newer=item.older=undefined;delete this.stores[category][item.key]}},get:function(category,key,callback){if(typeof this.stores[category]==="undefined"){this.init(category)}var item=this.stores[category][key];if(item===undefined){if(callback){callback()}return}if(item===this.tails[category]){if(callback){callback(item.value)}return item.value}if(item.newer){if(item===this.heads[category]){this.heads[category]=item.newer}item.newer.older=item.older}if(item.older){item.older.newer=item.newer}item.newer=undefined;item.older=this.tails[category];if(this.tails[category])this.tails[category].newer=item;this.tails[category]=item;if(callback){callback(item.value)}return item.value},getAll:function(category,keyArray,callback){var valueArray=[];for(var i=0;i<keyArray.length;i++){valueArray[i]=this.get(category,keyArray[i])}callback(valueArray)},foreach:function(category,keyArray,callback){for(var i=0;i<keyArray.length;i++){callback(this.get(category,keyArray[i]),keyArray[i])}},init:function(category){if(category!=undefined){this.sizes[category]=0;this.stores[category]={};this.heads[category]=undefined;this.tails[category]=undefined}else{this.sizes={};this.stores={};this.heads={};this.tails={}}},clear:function(){this.stores=null;this.init()}};var iDBInstances=[];var iDBVersion=1;function IndexedDBStore(args){var _this=this;this.debug=false;this.profile=false;_.extend(this,Backbone.Events);this.lru=[];this.cacheId="DataBase";this.opening=false;this.timeout=30;_.extend(this,args);window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;this.version=iDBVersion;if(!this.cacheId){console.log("IndexedDBStore: not supplied cacheId to constructor. Using default DataBase...")}iDBInstances.push(this)}IndexedDBStore.prototype={_getConnection:function(objectStoreName,callback,version){var _this=this;if(_this.debug){console.log(_this.cacheId+" opening? "+_this.opening);if(objectStoreName==undefined){console.log("WARNING: requested to create objectStore 'undefined'");debugger}}if(_this.opening==true){if(_this.debug){console.log("Database "+_this.cacheId+" is already opening. To avoid block: waiting...")}setTimeout(_this._getConnection.bind(_this),_this.timeout*(1+Math.random()*.25),objectStoreName,callback,version)}else{try{if(_this.debug){console.log("trying opening Database:"+_this.cacheId)}var dbOpenRequest;_this.opening=true;if(_this.debug){console.log("lock:"+_this.cacheId+", "+objectStoreName+" opening = "+_this.opening+" version: "+version)}if(!_.isUndefined(version)){dbOpenRequest=window.indexedDB.open(_this.cacheId,version)}else{dbOpenRequest=window.indexedDB.open(_this.cacheId)}dbOpenRequest.onsuccess=function(event){_this.opening=false;if(_this.debug){console.log("unlock:"+_this.cacheId+", "+objectStoreName+" opening = "+_this.opening)}var dbConnection=event.target.result;dbConnection.onversionchange=function(e){if(_this.debug){console.log("Version change triggered, so closing database connection "+_this.cacheId+", "+objectStoreName+" (old version, new version, db, event)",e.oldVersion,e.newVersion,dbConnection,e)}if(dbConnection){dbConnection.close();dbConnection.closed=true;dbConnection=undefined}};if(objectStoreName!=""&&!dbConnection.objectStoreNames.contains(objectStoreName)){iDBVersion=Math.max(iDBVersion,dbConnection.version)+1;dbConnection.close();dbConnection.closed=true;dbConnection=undefined;_this.version=iDBVersion;if(_this.debug){console.log("needed ObjectStore "+objectStoreName+" in "+_this.cacheId+" creating version "+iDBVersion)}_this._getConnection(objectStoreName,callback,_this.version)}else{if(_this.debug){console.log("connection obtained for "+_this.cacheId+" and "+objectStoreName,dbConnection)}callback(dbConnection)}};dbOpenRequest.onupgradeneeded=function(e){if(_this.debug){console.log("Database upgrade needed in "+_this.cacheId+", "+objectStoreName)}dbConnection=e.target.result;if(!dbConnection.objectStoreNames.contains(objectStoreName)){if(_this.debug){console.log("creating "+objectStoreName+" in Database "+_this.cacheId)}var objectStore=dbConnection.createObjectStore(objectStoreName)}};dbOpenRequest.onerror=function(e){console.log("DB Open Request Error in "+_this.cacheId+", "+objectStoreName);console.log(e)};dbOpenRequest.onblocked=function(e){console.log("DB Open Request Blocked in "+_this.cacheId+", "+objectStoreName,e);_this._getConnection(objectStoreName,callback)}}catch(e){console.log("catch error:");console.error(e)}}},clear:function(objectStoreName){var _this=this;_this._getConnection(objectStoreName,function(dbConnection){var transaction=dbConnection.transaction([objectStoreName],"readwrite");transaction.oncomplete=function(event){console.log("IndexedDB "+_this.cacheId+", "+objectStoreName+" clear success!")};var objectStore=transaction.objectStore(objectStoreName);var req=objectStore.clear();req.onerror=function(evt){console.log("IndexedDB Error trying to clear the object store "+objectStoreName+" in "+_this.cacheId)}})},count:function(objectStoreName,callback){var _this=this;_this._getConnection(objectStoreName,function(dbConnection){var transaction=dbConnection.transaction([objectStoreName],"readwrite");var objectStore=transaction.objectStore(objectStoreName);var req=objectStore.count();req.onerror=function(evt){console.log("IndexedDB Error trying to count the object store "+objectStoreName+" in "+_this.cacheId)};req.onsuccess=function(event){callback(event.target.result)}})},getObjectStoreNames:function(callback){var _this=this;_this._getConnection("",function(dbConnection){callback(dbConnection.objectStoreNames)})},close:function(){var _this=this;_this._getConnection(objectStoreName,function(dbConnection){dbConnection.close();console.log("Database "+_this.cacheId+" closed");dbConnection.closed=true;dbConnection=undefined})},destroyDB:function(){var _this=this;try{var dbDeleteRequest=window.indexedDB.deleteDatabase(_this.cacheId);dbDeleteRequest.onsuccess=function(e){console.log("Database "+_this.cacheId+" successfully deleted")};dbDeleteRequest.onupgradeneeded=function(e){var db=dbOpenRequest.result;console.log("Deleting Database upgrade needed")};dbDeleteRequest.onerror=function(e){console.log("Error deleting DB"+_this.cacheId);console.log(e)};dbDeleteRequest.onblocked=function(e){console.log("Deleting DB Blocked. Try closing the database "+_this.cacheId+" and then deleting it")}}catch(e){console.log(e)}},destroyDBs:function(){for(var i=0;i<iDBInstances.length;i++){iDBInstances[i].close();iDBInstances[i].destroyDB()}},get:function(objectStoreName,key,callback){var timeId;var _this=this;if(_this.debug){timeId="IndexedDBStore.get "+objectStoreName+key;console.time(timeId)}var result=null;_this._getConnection(objectStoreName,function(dbConnection){var transaction=dbConnection.transaction([objectStoreName],"readonly");transaction.oncomplete=function(event){if(_this.debug){console.timeEnd(timeId)}dbConnection.close();callback(result)};transaction.onerror=function(event){console.log("There was an error in the transaction get ("+key+")");console.log(event)};var objectStore=transaction.objectStore(objectStoreName);var request=objectStore.get(key);request.onsuccess=function(event){result=event.target.result}})},getAll:function(objectStoreName,keyArray,callback){var _this=this;var timeId;if(_this.profile||_this.debug){timeId="IndexedDBStore.getAll "+objectStoreName+", with "+keyArray.length+" keys.";console.time(timeId)}if(!(keyArray instanceof Array)||!callback){console.error("Bad use of IndexedDBStore: getAll must receive an ObjectStoreName, an Array of keys and a callback function.");return}var results=new Array(keyArray.length);_this._getConnection(objectStoreName,function(dbConnection){var transaction=dbConnection.transaction([objectStoreName],"readonly");transaction.oncomplete=function(event){if(_this.profile||_this.debug){console.timeEnd(timeId)}dbConnection.close();callback(results)};transaction.onerror=function(event){console.log("There was an error in the transaction get ("+keyArray+")");console.log(event)};var objectStore=transaction.objectStore(objectStoreName);for(var i=0;i<keyArray.length;i++){var request=objectStore.get(keyArray[i]);request.onsuccess=function(iteration){return function(event){results[iteration]=event.target.result}}(i)}})},foreach:function(objectStoreName,keyArray,callback,whenCompletedCallback){if(!(keyArray instanceof Array)||!callback){console.error("Bad use of IndexedDBStore: foreach must receive an ObjectStoreName, an Array of keys and a callback function.");return}var _this=this;var timeId;if(_this.profile||_this.debug){timeId="IndexedDBStore.getAll "+objectStoreName+", with "+keyArray.length+" keys.";console.time(timeId)}_this._getConnection(objectStoreName,function(dbConnection){var transaction=dbConnection.transaction([objectStoreName],"readonly");transaction.oncomplete=function(event){dbConnection.close();if(_this.profile||_this.debug){console.timeEnd(timeId)}if(whenCompletedCallback){whenCompletedCallback()}};transaction.onerror=function(event){console.log("There was an error in the transaction foreach ("+keyArray+")");console.log(event)};var objectStore=transaction.objectStore(objectStoreName);for(var i=0;i<keyArray.length;i++){var request=objectStore.get(keyArray[i]);request.onsuccess=function(iteration){return function(event){callback(event.target.result,keyArray[iteration],iteration)}}(i)}})},add:function(objectStoreName,key,value){var _this=this;_this._getConnection(objectStoreName,function(dbConnection){var transaction=dbConnection.transaction([objectStoreName],"readwrite");transaction.onerror=function(event){console.log("There was an error in the transaction add ("+key+", "+value+")");console.log(event)};var objectStore=transaction.objectStore(objectStoreName);var request=objectStore.add(value,key)})},put:function(objectStoreName,key,value){var _this=this;var timeId;if(_this.debug){timeId="IndexedDBStore.put "+objectStoreName+key;console.time(timeId)}_this._getConnection(objectStoreName,function(dbConnection){var transaction=dbConnection.transaction([objectStoreName],"readwrite");transaction.oncomplete=function(event){if(_this.debug){console.timeEnd(timeId)}dbConnection.close();dbConnection.close=true};transaction.onerror=function(event){console.log("There was an error in the transaction put("+key+", ",value,")");console.log(event)};var objectStore=transaction.objectStore(objectStoreName);var request=objectStore.put(value,key)})},putAll:function(objectStoreName,keyArray,valueArray){var _this=this;var timeId;if(_this.profile||_this.debug){timeId="IndexedDBStore.putAll "+objectStoreName+", with "+keyArray.length;console.time(timeId)}if(!(keyArray instanceof Array)||!(valueArray instanceof Array)||keyArray.length!=valueArray.length){console.error("Bad use of IndexedDBStore: putAll must receive two Arrays of the same length.");return}_this._getConnection(objectStoreName,function(dbConnection){var transaction=dbConnection.transaction([objectStoreName],"readwrite");transaction.oncomplete=function(event){if(_this.profile||_this.debug){console.timeEnd(timeId)}dbConnection.close();dbConnection.close=true};transaction.onerror=function(event){console.log("There was an error in the transaction put("+key+", ",value,")");console.log(event)};var objectStore=transaction.objectStore(objectStoreName);for(var i=0;i<keyArray.length;i++){objectStore.put(valueArray[i],keyArray[i])}})},delete:function(objectStoreName,key){var _this=this;_this._getConnection(objectStoreName,function(dbConnection){var transaction=dbConnection.transaction([objectStoreName],"readwrite");transaction.onerror=function(event){console.log("There was an error in the transaction delete ("+key+")");console.log(event)};var objectStore=transaction.objectStore(objectStoreName);var request=objectStore.delete(key)})}};IndexedDBTest=function(){var idb=new IndexedDBStore({cacheId:"test"});idb.put("os-a","key-a","value-a");idb.put("os-b","key-b","value-b")};IndexedDBTest();BamCache.prototype.putHistogramFeaturesByRegion=FileFeatureCache.prototype.putFeaturesByRegion;function BamCache(args){this.args=args;this.id=Math.round(Math.random()*1e7);this.chunkSize=5e4;this.gzip=true;this.maxSize=10*1024*1024;this.size=0;if(args!=null){if(args.chunkSize!=null){this.chunkSize=args.chunkSize}if(args.gzip!=null){this.gzip=args.gzip}}this.cache={};this.maxFeaturesInterval=0;this.gzip=false}BamCache.prototype._getChunk=function(position){return Math.floor(position/this.chunkSize)};BamCache.prototype.getFeatureChunk=function(key){if(this.cache[key]!=null){return this.cache[key]}return null};BamCache.prototype.getFeatureChunksByRegion=function(region){var firstRegionChunk,lastRegionChunk,chunks=[],key;firstRegionChunk=this._getChunk(region.start);lastRegionChunk=this._getChunk(region.end);for(var i=firstRegionChunk;i<=lastRegionChunk;i++){key=region.chromosome+":"+i;if(this.cache[key]!=null){chunks.push(this.cache[key])}}return chunks};BamCache.prototype.putFeaturesByRegion=function(resultObj,region,featureType,dataType){var key,firstChunk,lastChunk,firstRegionChunk,lastRegionChunk,read,gzipRead;var reads=resultObj.reads;var coverage=resultObj.coverage;firstRegionChunk=this._getChunk(region.start);lastRegionChunk=this._getChunk(region.end);var chunkIndex=0;console.time("BamCache.prototype.putFeaturesByRegion1");for(var i=firstRegionChunk,c=0;i<=lastRegionChunk;i++,c++){key=region.chromosome+":"+i;if(this.cache[key]==null||this.cache[key][dataType]==null){this.cache[key]={};this.cache[key][dataType]=[];this.cache[key].key=key;this.cache[key].start=parseInt(region.start)+c*this.chunkSize;this.cache[key].end=parseInt(region.start)+(c+1)*this.chunkSize-1}if(dataType==="data"){var chunkCoverageAll=coverage.all.slice(chunkIndex,chunkIndex+this.chunkSize);var chunkCoverageA=coverage.a.slice(chunkIndex,chunkIndex+this.chunkSize);var chunkCoverageC=coverage.c.slice(chunkIndex,chunkIndex+this.chunkSize);var chunkCoverageG=coverage.g.slice(chunkIndex,chunkIndex+this.chunkSize);var chunkCoverageT=coverage.t.slice(chunkIndex,chunkIndex+this.chunkSize);var chunkCoverage={all:chunkCoverageAll,a:chunkCoverageA,c:chunkCoverageC,g:chunkCoverageG,t:chunkCoverageT}}if(this.gzip){this.cache[key]["coverage"]=RawDeflate.deflate(JSON.stringify(chunkCoverage))}else{this.cache[key]["coverage"]=chunkCoverage}chunkIndex+=this.chunkSize}console.timeEnd("BamCache.prototype.putFeaturesByRegion1");console.time("BamCache.prototype.putFeaturesByRegion");var ssss=0;if(dataType==="data"){for(var index=0,len=reads.length;index<len;index++){read=reads[index];read.featureType="bam";firstChunk=this._getChunk(read.start);lastChunk=this._getChunk(read.end==0?read.end=-1:read.end);if(this.gzip){gzipRead=RawDeflate.deflate(JSON.stringify(read))}else{gzipRead=read}for(var i=firstChunk,c=0;i<=lastChunk;i++,c++){if(i>=firstRegionChunk&&i<=lastRegionChunk){key=read.chromosome+":"+i;this.cache[key][dataType].push(gzipRead)}}}}console.timeEnd("BamCache.prototype.putFeaturesByRegion");console.log("BamCache.prototype.putFeaturesByRegion"+ssss)};BamCache.prototype.clear=function(){this.size=0;this.cache={};console.log("bamCache cleared")};function CellBaseAdapter(args){_.extend(this,Backbone.Events);_.extend(this,args);this.on(this.handlers);this.configureCache();this.debug=false}CellBaseAdapter.prototype={setSpecies:function(species){this.species=species;this.configureCache()},setHost:function(host){this.configureCache();this.host=host},configureCache:function(){var host=this.host||CellBaseManager.host;var speciesString=this.species.id+this.species.assembly.name.replace(/[\/_().\ -]/g,"");var cacheId=host+speciesString;if(!this.cacheConfig){this.cacheConfig={chunkSize:3e3}}this.cacheConfig.cacheId=cacheId;this.cache=new FeatureChunkCache(this.cacheConfig)},getData:function(args){var _this=this;var params={};_.extend(params,this.params);_.extend(params,args.params);var region=args.region;if(region.start>3e8||region.end<1){return}region.start=region.start<1?1:region.start;region.end=region.end>3e8?3e8:region.end;var categories=[this.category+this.subCategory+this.resource+Utils.queryString(params)];var dataType=args.dataType;if(_.isUndefined(dataType)){console.log("dataType must be provided!!!")}var chunkSize=params.interval?params.interval:this.cacheConfig.chunkSize;if(this.debug){console.log(chunkSize)}this.cache.get(region,categories,dataType,chunkSize,function(cachedChunks,uncachedRegions){var category=categories[0];var categoriesName="";for(var j=0;j<categories.length;j++){categoriesName+=","+categories[j]}categoriesName=categoriesName.slice(1);var chunks=cachedChunks[category];var queriesList=_this._groupQueries(uncachedRegions[category]);if(queriesList.length>0){args.webServiceCallCount=0;for(var i=0;i<queriesList.length;i++){args.webServiceCallCount++;var queryRegion=queriesList[i];CellBaseManager.get({host:_this.host,version:_this.version,species:_this.species,category:_this.category,subCategory:_this.subCategory,query:queryRegion.toString(),resource:_this.resource,params:params,success:function(response){var responseChunks=_this._cellbaseSuccess(response,categories,dataType,chunkSize);args.webServiceCallCount--;chunks=chunks.concat(responseChunks);if(args.webServiceCallCount===0){chunks.sort(function(a,b){return a.chunkKey.localeCompare(b.chunkKey)});args.done({items:chunks,dataType:dataType,chunkSize:chunkSize,sender:_this})}},error:function(){console.log("Server error");args.done()}})}}else{args.done({items:chunks,dataType:dataType,chunkSize:chunkSize,sender:_this})}})},_cellbaseSuccess:function(data,categories,dataType,chunkSize){var timeId=Utils.randomString(4)+this.resource+" save";console.time(timeId);var regions=[];var chunks=[];for(var i=0;i<data.response.length;i++){var queryResult=data.response[i];if(dataType=="histogram"){for(var j=0;j<queryResult.result.length;j++){var interval=queryResult.result[j];var region=new Region(interval);regions.push(region);chunks.push(interval)}}else{regions.push(new Region(queryResult.id));chunks.push(queryResult.result)}}var items=this.cache.putByRegions(regions,chunks,categories,dataType,chunkSize);console.timeEnd(timeId);return items},_groupQueries:function(uncachedRegions){var groupSize=50;var queriesLists=[];while(uncachedRegions.length>0){queriesLists.push(uncachedRegions.splice(0,groupSize).toString())}return queriesLists}};function OpencgaAdapter(args){_.extend(this,Backbone.Events);_.extend(this,args);this.on(this.handlers);this.configureCache();this.debug=false}OpencgaAdapter.prototype={setSpecies:function(species){this.species=species},configureCache:function(){var host=this.host||OpencgaManager.host;if(!this.cacheConfig){this.cacheConfig={chunkSize:3e3}}this.cacheConfig.cacheId="opencga"+this.resource.id;this.cache=new FeatureChunkCache(this.cacheConfig)},getData:function(args){var _this=this;var params={};_.extend(params,this.params);_.extend(params,args.params);var region=args.region;if(region.start>3e8||region.end<1){return}region.start=region.start<1?1:region.start;region.end=region.end>3e8?3e8:region.end;var categories=this.resource.id.toString().split(",");var dataType=args.dataType;if(_.isUndefined(dataType)){console.log("dataType must be provided!!!")}var chunkSize=params.interval?params.interval:this.cacheConfig.chunkSize;if(this.debug){console.log(chunkSize)}this.cache.get(region,categories,dataType,chunkSize,function(cachedChunks,uncachedRegions){var category=categories[0];var categoriesName="";for(var j=0;j<categories.length;j++){categoriesName+=","+categories[j]}categoriesName=categoriesName.slice(1);var chunks=cachedChunks[category];var queriesList=_this._groupQueries(uncachedRegions[category]);if(queriesList.length>0){args.webServiceCallCount=0;for(var i=0;i<queriesList.length;i++){args.webServiceCallCount++;var queryRegion=queriesList[i];params["region"]=queryRegion.toString();params["interval"]=chunkSize;params["histogram"]=dataType=="histogram";params["process_differences"]=false;OpencgaManager.files["fetch"]({id:categoriesName,query:params,request:{success:function(response){var responseChunks=_this._opencgaSuccess(response,categories,dataType,chunkSize,args);args.webServiceCallCount--;chunks=chunks.concat(responseChunks);if(args.webServiceCallCount===0){args.done({items:chunks,dataType:dataType,chunkSize:chunkSize,sender:_this})}},error:function(){console.log("Server error");args.done()}}})}}else{args.done({items:chunks,dataType:dataType,chunkSize:chunkSize,sender:_this})}})},_opencgaSuccess:function(data,categories,dataType,chunkSize){var timeId=this.cacheConfig.cacheId+" save "+data.response.length+" samples";console.time(timeId);if(categories.length!=data.response.length){console.log("ERROR: requested "+categories.length+"samples, but response has "+data.response.length);console.log(data)}if(data.response[0]&&data.response[0].result[0]){var inferredChunkSize=data.response[0].result[0].end-data.response[0].result[0].start+1;if(inferredChunkSize!=chunkSize){console.log("code smell: chunkSize requested: "+chunkSize+", but obtained: "+inferredChunkSize)}}var responseItems=[];for(var i=0;i<data.response.length;i++){var queryResult=data.response[i];var items=this._adaptChunks(queryResult,categories[i],dataType,chunkSize);responseItems=responseItems.concat(items)}console.timeEnd(timeId);return responseItems},_groupQueries:function(uncachedRegions){var groupSize=50;var queriesLists=[];while(uncachedRegions.length>0){queriesLists.push(uncachedRegions.splice(0,groupSize).toString())}return queriesLists},_decryptChunks:function(chunks,password){var decryptedChunks=[];for(var i=0;i<chunks.length;i++){if(chunks[i].enc==true){decryptedChunks.push(CryptoJS.AES.decrypt(chunks[i],password))}else{decryptedChunks.push(chunks[i])}}return decryptedChunks},_adaptChunks:function(queryResult,category,dataType,chunkSize){var chunks;var regions;var items=[];if(queryResult.resultType=="org.opencb.biodata.models.variant.Variant"){chunks=[];regions=[];var keyToPair={};for(var i=0;i<queryResult.result.length;i++){var variation=queryResult.result[i];var chunkId=this.cache.getChunkId(variation.start,chunkSize);var key=this.cache.getChunkKey(variation.chromosome,chunkId,dataType,chunkSize);if(keyToPair[key]==undefined){keyToPair[key]=chunks.length;regions.push(new Region({chromosome:variation.chromosome,start:chunkId*chunkSize,end:(chunkId+1)*chunkSize-1}));chunks.push([])}chunks[keyToPair[key]].push(variation)}items=this.cache.putByRegions(regions,chunks,category,dataType,chunkSize)}else{regions=[];for(var j=0;j<queryResult.result.length;j++){regions.push(new Region(queryResult.result[j]))}chunks=queryResult.result;items=this.cache.putByRegions(regions,chunks,category,dataType,chunkSize)}return items}};function EnsemblAdapter(args){_.extend(this,Backbone.Events);_.extend(this,args);this.on(this.handlers);this.cache=new FeatureChunkCache(this.cacheConfig)}EnsemblAdapter.prototype={getData:function(args){var _this=this;args.webServiceCallCount=0;var params={};_.extend(params,this.params);_.extend(params,args.params);var region=args.region;if(region.start>3e8||region.end<1){return}region.start=region.start<1?1:region.start;region.end=region.end>3e8?3e8:region.end;var dataType=args.dataType;if(_.isUndefined(dataType)){console.log("dataType must be provided!!!")}var categories=[dataType];var chunkSize=args.params.interval?args.params.interval:this.cacheConfig.chunkSize;if(this.debug){console.log(chunkSize)}this.cache.get(region,categories,dataType,chunkSize,function(cachedChunks,uncachedRegions){if(uncachedRegions.length>0){var queryRegionStrings=uncachedRegions;for(var i=0;i<queryRegionStrings.length;i++){args.webServiceCallCount++;_this._get(queryRegionStrings[i],params,categories,chunkSize,args)}}if(cachedChunks.length>0){if(args.webServiceCallCount===0){args.done()}_this.trigger("data:ready",{items:cachedChunks[categories[0]],dataType:dataType,chunkSize:chunkSize,sender:_this})}})},_get:function(query,params,categories,chunkSize,args){var _this=this;EnsemblManager.get({host:_this.host,species:_this.species,category:_this.category,subCategory:_this.subCategory,query:query,params:params,success:function(data){var transformedData=_this._transformResponse(data,query);_this._success(transformedData,categories,undefined,chunkSize,args)}})},_success:function(data,categories,dataType,chunkSize,args){args.webServiceCallCount--;var timeId=Utils.randomString(4)+this.resource+" save";console.time(timeId);var regions=[];var chunks=[];for(var i=0;i<data.response.length;i++){var queryResult=data.response[i];regions.push(new Region(queryResult.id));chunks.push(queryResult.result)}var items=this.cache.putByRegions(regions,chunks,categories,dataType,chunkSize);console.timeEnd(timeId);if(args.webServiceCallCount===0){args.done()}if(items.length>0){this.trigger("data:ready",{items:items,dataType:dataType,chunkSize:chunkSize,sender:_this})}},_transformResponse:function(data,query){for(var i=0;i<data.length;i++){var f=data[i];f.id=f.ID;delete f.ID;f.name=f.external_name;delete f.external_name;f.chromosome=f.seq_region_name;delete f.seq_region_name}var r={response:[]};var result={id:query,result:data};r.response.push(result);return r}};function FeatureTemplateAdapter(args){_.extend(this,Backbone.Events);this.templateVariables={};this.multiRegions=true;this.histogramMultiRegions=true;_.extend(this,args);this.configureCache();this.debug=false}FeatureTemplateAdapter.prototype={setSpecies:function(species){this.species=species;this.configureCache()},setHost:function(host){this.configureCache();this.host=host},configureCache:function(){var speciesString="";if(this.species!=null){var speciesString=this.species.id+this.species.assembly.name.replace(/[\/_().\ -]/g,"")}var cacheId=this.uriTemplate+speciesString;if(!this.cacheConfig){this.cacheConfig={chunkSize:3e3}}this.cacheConfig.cacheId=cacheId;this.cache=new FeatureChunkCache(this.cacheConfig)},getData:function(args){var _this=this;var params={};_.extend(params,this.params);_.extend(params,args.params);var region=args.region;var regionLimit=3e8;if(this.species!=null&&this.species.chromosomes[region.chromosome]!=null){regionLimit=this.species.chromosomes[args.region.chromosome].end}if(region.start>regionLimit||region.end<1){return}region.start=region.start<1?1:region.start;region.end=region.end>regionLimit?regionLimit:region.end;var categories=["cat_"+Utils.queryString(this.templateVariables)+Utils.queryString(params)];var dataType=args.dataType;if(_.isUndefined(dataType)){console.log("dataType must be provided!!!")}var chunkSize=params.interval?params.interval:this.cacheConfig.chunkSize;if(this.debug){console.log(chunkSize)}this.cache.get(region,categories,dataType,chunkSize,function(cachedChunks,uncachedRegions){var category=categories[0];var categoriesName="";for(var j=0;j<categories.length;j++){categoriesName+=","+categories[j]}categoriesName=categoriesName.slice(1);var chunks=cachedChunks[category];var queriesList;if(dataType!=="histogram"){if(_this.multiRegions===false){queriesList=_this._singleQueries(uncachedRegions[category])}else{queriesList=_this._groupQueries(uncachedRegions[category])}}else{if(_this.histogramMultiRegions===false){queriesList=_this._singleQueries(uncachedRegions[category])}else{queriesList=_this._groupQueries(uncachedRegions[category])}}if(queriesList.length>0){args.webServiceCallCount=0;for(var i=0;i<queriesList.length;i++){args.webServiceCallCount++;var queryRegion=queriesList[i];var request=new XMLHttpRequest;request._queryRegion=queryRegion;request._originalRegion=region;request.onload=function(){args.webServiceCallCount--;if(request.status!==400){var response;try{response=JSON.parse(this.response)}catch(e){console.log("Warning: Response is not JSON");response=this.response}var responseChunks=_this._success(response,categories,dataType,this._queryRegion,this._originalRegion,chunkSize);chunks=chunks.concat(responseChunks)}else{console.log("request.status: "+request.status)}if(args.webServiceCallCount===0){chunks.sort(function(a,b){return a.chunkKey.localeCompare(b.chunkKey)});args.done({items:chunks,dataType:dataType,chunkSize:chunkSize,sender:_this})}};request.onerror=function(){console.log("Server error");args.done()};var uriTemplate=new URITemplate(_this.uriTemplate);_this.templateVariables["region"]=queryRegion.toString();_this.templateVariables["species"]=_this._getSpeciesQueryString(_this.species);var url=uriTemplate.expand(_this.templateVariables);url=Utils.addQueryParamtersToUrl(params,url);request.open("GET",url,true);console.log(url);request.send()}}else{args.done({items:chunks,dataType:dataType,chunkSize:chunkSize,sender:_this})}})},_success:function(response,categories,dataType,queryRegion,originalRegion,chunkSize){var regions=[];var chunks=[];if(dataType!=="histogram"){if(typeof this.parse==="function"){chunks=this.parse(response,dataType)}else{chunks=response}regions=this._getRegionsFromQueryRegions(queryRegion)}else{if(typeof this.parseHistogram==="function"){chunks=this.parseHistogram(response)}else{chunks=response}regions=this._getRegionsFromHistogramChunks(chunks,originalRegion.chromosome)}var items=this.cache.putByRegions(regions,chunks,categories,dataType,chunkSize);return items},_groupQueries:function(uncachedRegions){var groupSize=50;var queriesLists=[];while(uncachedRegions.length>0){queriesLists.push(uncachedRegions.splice(0,groupSize).toString())}return queriesLists},_singleQueries:function(uncachedRegions){var queriesLists=[];for(var i=0;i<uncachedRegions.length;i++){var region=uncachedRegions[i];queriesLists.push(region.toString())}return queriesLists},_getSpeciesQueryString:function(species){if(species==null){return""}if(this.speciesParse!=null){return this.speciesParse(species)}else{return Utils.getSpeciesCode(species.scientificName)}},_getRegionsFromQueryRegions:function(queryRegion){var regions=[];var regionSplit=queryRegion.split(",")
;for(var i=0;i<regionSplit.length;i++){var regionStr=regionSplit[i];regions.push(new Region(regionStr))}return regions},_getRegionsFromHistogramChunks:function(intervals,chromosome){var regions=[];for(var i=0;i<intervals.length;i++){var interval=intervals[i];var region=new Region(interval);region.chromosome=chromosome;regions.push(region)}return regions}};function BamAdapter(args){_.extend(this,Backbone.Events);if(typeof args!="undefined"){this.host=args.host||this.host;this.category=args.category||this.category;this.resource=args.resource||this.resource;this.params=args.params||this.params;this.filters=args.filters||this.filters;this.options=args.options||this.options;this.species=args.species||this.species;var argsFeatureCache=args.featureCache||{}}if(args!=null){if(args.featureConfig!=null){if(args.featureConfig.filters!=null){this.filtersConfig=args.featureConfig.filters}if(args.featureConfig.options!=null){this.optionsConfig=args.featureConfig.options;for(var i=0;i<this.optionsConfig.length;i++){if(this.optionsConfig[i].checked==true){this.options[this.optionsConfig[i].name]=true;this.params[this.optionsConfig[i].name]=true}}}}}this.featureCache=new BamCache(argsFeatureCache)}BamAdapter.prototype={host:null,gzip:true,params:{}};BamAdapter.prototype.clearData=function(){this.featureCache.clear()};BamAdapter.prototype.setFilters=function(filters){this.clearData();this.filters=filters;for(filter in filters){var value=filters[filter].toString();delete this.params[filter];if(value!=""){this.params[filter]=value}}};BamAdapter.prototype.setOption=function(opt,value){if(opt.fetch){this.clearData()}this.options[opt.name]=value;for(option in this.options){if(this.options[opt.name]!=null){this.params[opt.name]=this.options[opt.name]}else{delete this.params[opt.name]}}};BamAdapter.prototype.getData=function(args){var _this=this;this.params["histogram"]=args.histogram;this.params["histogramLogarithm"]=args.histogramLogarithm;this.params["histogramMax"]=args.histogramMax;this.params["interval"]=args.interval;this.params["transcript"]=args.transcript;this.params["chromosome"]=args.chromosome;this.params["resource"]=this.resource.id;this.params["category"]=this.category;this.params["species"]=Utils.getSpeciesCode(this.species.text);if(args.start<1){args.start=1}if(args.end>3e8){args.end=3e8}var dataType="data";if(args.histogram){dataType="histogram"+args.interval}this.params["dataType"]=dataType;var firstChunk=this.featureCache._getChunk(args.start);var lastChunk=this.featureCache._getChunk(args.end);var chunks=[];var itemList=[];for(var i=firstChunk;i<=lastChunk;i++){var key=args.chromosome+":"+i;if(this.featureCache.cache[key]==null||this.featureCache.cache[key][dataType]==null){chunks.push(i)}else{var item=this.featureCache.getFeatureChunk(key);itemList.push(item)}}var regionSuccess=function(data){var splitDots=data.query.split(":");var splitDash=splitDots[1].split("-");var query={chromosome:splitDots[0],start:splitDash[0],end:splitDash[1]};var dataType="data";if(data.params.histogram){dataType="histogram"+data.params.interval;_this.featureCache.putHistogramFeaturesByRegion(data.result,query,data.resource,dataType)}else{_this.featureCache.putFeaturesByRegion(data.result,query,data.resource,dataType)}var items=_this.featureCache.getFeatureChunksByRegion(query,dataType);itemList=itemList.concat(items);if(itemList.length>0){_this.trigger("data:ready",{items:itemList,params:_this.params,cached:false,sender:_this})}};var querys=[];var updateStart=true;var updateEnd=true;if(chunks.length>0){for(var i=0;i<chunks.length;i++){if(updateStart){var chunkStart=parseInt(chunks[i]*this.featureCache.chunkSize);updateStart=false}if(updateEnd){var chunkEnd=parseInt(chunks[i]*this.featureCache.chunkSize+this.featureCache.chunkSize-1);updateEnd=false}if(chunks[i+1]!=null){if(chunks[i]+1==chunks[i+1]){updateEnd=true}else{var query=args.chromosome+":"+chunkStart+"-"+chunkEnd;querys.push(query);updateStart=true;updateEnd=true}}else{var query=args.chromosome+":"+chunkStart+"-"+chunkEnd;querys.push(query);updateStart=true;updateEnd=true}}for(var i=0,li=querys.length;i<li;i++){console.time("dqs");var cookie=$.cookie("bioinfo_sid");cookie=cookie!=""&&cookie!=null?cookie:"dummycookie";OpencgaManager.region({accountId:this.resource.account,sessionId:cookie,bucketId:this.resource.bucketId,objectId:this.resource.oid,region:querys[i],queryParams:this.params,success:regionSuccess})}}else{if(itemList.length>0){_this.trigger("data:ready",{items:itemList,params:this.params,cached:false,sender:this})}}};function DasAdapter(args){var _this=this;_.extend(this,Backbone.Events);this.id=Utils.genId("DasAdapter");this.gzip=true;this.proxy=CELLBASE_HOST+"/latest/utils/proxy?url=";this.url;this.species;this.featureCache;this.params={};_.extend(this,args);this.on(this.handlers);this.featureCache=new FeatureCache(this.featureCache)}DasAdapter.prototype.getData=function(args){var _this=this;this.params["histogram"]=args.histogram;this.params["interval"]=args.interval;this.params["transcript"]=args.transcript;if(args.start<1){args.start=1}if(args.end>3e8){args.end=3e8}var dataType="data";if(args.histogram){dataType="histogram"+args.interval}this.params["dataType"]=dataType;var firstChunk=this.featureCache._getChunk(args.start);var lastChunk=this.featureCache._getChunk(args.end);var chunks=[];var itemList=[];for(var i=firstChunk;i<=lastChunk;i++){var key=args.chromosome+":"+i;if(this.featureCache.cache[key]==null||this.featureCache.cache[key][dataType]==null){chunks.push(i)}else{var item=this.featureCache.getFeatureChunk(key);itemList.push(item)}}if(itemList.length>0){this.trigger("data:ready",{items:itemList,params:this.params,cached:true})}var updateStart=true;var updateEnd=true;if(chunks.length>0){for(var i=0;i<chunks.length;i++){var query=null;if(updateStart){var chunkStart=parseInt(chunks[i]*this.featureCache.chunkSize);updateStart=false}if(updateEnd){var chunkEnd=parseInt(chunks[i]*this.featureCache.chunkSize+this.featureCache.chunkSize-1);updateEnd=false}if(chunks[i+1]!=null){if(chunks[i]+1==chunks[i+1]){updateEnd=true}else{query=args.chromosome+":"+chunkStart+","+chunkEnd;updateStart=true;updateEnd=true}}else{query=args.chromosome+":"+chunkStart+","+chunkEnd;updateStart=true;updateEnd=true}if(query){var fullURL=this.proxy+this.url+"?segment="+query;console.log("fullURL: "+fullURL);$.ajax({url:fullURL,type:"GET",dataType:"xml",error:function(){alert("error");_this.trigger("error","It is not allowed by Access-Control-Allow-Origin ")},success:function(data){_this.xml=(new XMLSerializer).serializeToString(data);var xmlStringified=(new XMLSerializer).serializeToString(data);var data=xml2json.parser(xmlStringified);if(data.dasgff!=null){var result=new Array;if(typeof data.dasgff.gff.segment!="undefined"){if(typeof data.dasgff.gff.segment.feature!="undefined"){result=data.dasgff.gff.segment.feature}else if(typeof data.dasgff.gff.segment[0]!="undefined"){if(data.dasgff.gff.segment[0].feature!=null){for(var i=0;i<data.dasgff.gff.segment.length;i++){for(var j=0;j<data.dasgff.gff.segment[i].feature.length;j++){data.dasgff.gff.segment[i].feature[j]["chromosome"]=args.chromosome;result.push(data.dasgff.gff.segment[i].feature[j])}}}else{result.push([])}}}var region={chromosome:args.chromosome,start:chunkStart,end:chunkEnd};var resource="das";_this.featureCache.putFeaturesByRegion(result,region,resource,dataType);console.log(_this.featureCache.cache);var items=_this.featureCache.getFeatureChunksByRegion(region);if(items!=null){_this.trigger("data:ready",{items:items,params:_this.params,cached:false})}}}})}}}};DasAdapter.prototype.checkUrl=function(){var _this=this;var fullURL=this.proxy+this.url+"?segment=1:1,1";console.log("Checking URL: "+fullURL);$.ajax({url:fullURL,type:"GET",dataType:"xml",error:function(){alert("error");_this.trigger("error","It is not allowed by Access-Control-Allow-Origin ")},success:function(data){_this.xml=(new XMLSerializer).serializeToString(data);_this.trigger("url:check",{data:_this.xml})}})};function FeatureDataAdapter(dataSource,args){var _this=this;_.extend(this,Backbone.Events);this.dataSource=dataSource;this.gzip=true;this.params={};if(args!=null){if(args.gzip!=null){this.gzip=args.gzip}if(args.species!=null){this.species=args.species}if(args.params!=null){this.params=args.params}}this.featureCache=new FileFeatureCache({chunkSize:1e4,gzip:this.gzip});this.chromosomesLoaded={}}FeatureDataAdapter.prototype.getData=function(args){console.log("TODO comprobar histograma");console.log(args.region);this.params["dataType"]="data";this.params["chromosome"]=args.region.chromosome;if(this.chromosomesLoaded[args.region.chromosome]!=true){this._fetchData(args.region);this.chromosomesLoaded[args.region.chromosome]=true}var itemList=this.featureCache.getFeatureChunksByRegion(args.region);if(itemList!=null){this.trigger("data:ready",{items:itemList,params:this.params,chunkSize:this.featureCache.chunkSize,cached:true,sender:this})}args.done()};FeatureDataAdapter.prototype._fetchData=function(region){var _this=this;if(this.dataSource!=null){if(this.async){this.dataSource.on("success",function(data){_this.parse(data,region);_this.trigger("file:load",{sender:_this});var itemList=_this.featureCache.getFeatureChunksByRegion(region);if(itemList!=null){_this.trigger("data:ready",{items:itemList,params:_this.params,chunkSize:_this.featureCache.chunkSize,cached:true,sender:_this})}});this.dataSource.fetch(this.async)}else{var data=this.dataSource.fetch(this.async);this.parse(data,region)}}};FeatureDataAdapter.prototype.addFeatures=function(features){this.featureCache.putFeatures(features,"data")};VCFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;VCFDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData;function VCFDataAdapter(dataSource,args){FeatureDataAdapter.prototype.constructor.call(this,dataSource,args);var _this=this;this.async=true;this.featuresCount=0;this.featuresByChromosome={};this.header="";this.samples=[];if(args!=null){if(args.async!=null){this.async=args.async}}}VCFDataAdapter.prototype.parse=function(data,region){var _this=this;var dataType="value";var lines=data.split("\n");for(var i=0;i<lines.length;i++){var line=lines[i].replace(/^\s+|\s+$/g,"");if(line!=null&&line.length>0){var fields=line.split("\t");if(line.substr(0,1)==="#"){if(line.substr(1,1)==="#"){this.header+=line.replace(/</gi,"&#60;").replace(/>/gi,"&#62;")+"<br>"}else{this.samples=fields.slice(9)}}else{var chrom=fields[0].replace(/chr/gi,"");if(chrom==region.chromosome){var samples=[];if(fields[9]){samples=fields.slice(9)}var feature={chromosome:chrom,position:parseInt(fields[1]),start:parseInt(fields[1]),end:parseInt(fields[1]),id:fields[2],reference:fields[3],alternate:fields[4],quality:fields[5],filter:fields[6],info:fields[7].replace(/;/gi,"<br>"),format:fields[8],sampleData:line,samples:samples,featureType:"vcf"};this.featureCache.putFeatures(feature,dataType);if(this.featuresByChromosome[chrom]==null){this.featuresByChromosome[chrom]=0}this.featuresByChromosome[chrom]++;this.featuresCount++}}}}};GFF2DataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;GFF2DataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData;function GFF2DataAdapter(dataSource,args){FeatureDataAdapter.prototype.constructor.call(this,dataSource,args);var _this=this;this.async=true;this.featuresCount=0;this.featuresByChromosome={};if(args!=null){if(args.async!=null){this.async=args.async}}}GFF2DataAdapter.prototype.parse=function(data,region){var _this=this;var dataType="value";var lines=data.split("\n");for(var i=0;i<lines.length;i++){var line=lines[i].replace(/^\s+|\s+$/g,"");if(line!=null&&line.length>0){var fields=line.split("\t");var chromosome=fields[0].replace("chr","");if(chromosome==region.chromosome){var feature={chromosome:chromosome,label:fields[2],start:parseInt(fields[3]),end:parseInt(fields[4]),score:fields[5],strand:fields[6],frame:fields[7],group:fields[8],featureType:"gff2"};this.featureCache.putFeatures(feature,dataType);if(this.featuresByChromosome[chromosome]==null){this.featuresByChromosome[chromosome]=0}this.featuresByChromosome[chromosome]++;this.featuresCount++}}}};GFF3DataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;GFF3DataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData;function GFF3DataAdapter(dataSource,args){FeatureDataAdapter.prototype.constructor.call(this,dataSource,args);var _this=this;this.async=true;this.featuresCount=0;this.featuresByChromosome={};if(args!=null){if(args.async!=null){this.async=args.async}}}GFF3DataAdapter.prototype.parse=function(data,region){var _this=this;var getAttr=function(column){var obj={};if(typeof column!=="undefined"){var arr=column.replace(/ /g,"").split(";");for(var i=0,li=arr.length;i<li;i++){var item=arr[i].split("=");obj[item[0]]=item[1]}}return obj};var dataType="value";var lines=data.split("\n");for(var i=0;i<lines.length;i++){var line=lines[i].replace(/^\s+|\s+$/g,"");if(line!=null&&line.length>0){var fields=line.split("\t");var chromosome=fields[0].replace("chr","");if(chromosome==region.chromosome){var feature={chromosome:chromosome,label:fields[2],start:parseInt(fields[3]),end:parseInt(fields[4]),score:fields[5],strand:fields[6],frame:fields[7],attributes:getAttr(fields[8]),featureType:"gff3"};this.featureCache.putFeatures(feature,dataType);if(this.featuresByChromosome[chromosome]==null){this.featuresByChromosome[chromosome]=0}this.featuresByChromosome[chromosome]++;this.featuresCount++}}}};BEDDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;BEDDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData;function BEDDataAdapter(dataSource,args){FeatureDataAdapter.prototype.constructor.call(this,dataSource,args);var _this=this;this.async=true;this.parseFunction;if(args!=null){if(args.parseFunction!=null){this.parseFunction=args.parseFunction}}this.featuresCount=0;this.featuresByChromosome={};if(args!=null){if(args.async!=null){this.async=args.async}}}BEDDataAdapter.prototype.parse=function(data,region){if(this.parseFunction){this.parseFunction(data,region)}else{this._defaultParse(data,region)}};BEDDataAdapter.prototype._defaultParse=function(data,region){var _this=this;var dataType="value";var lines=data.split("\n");for(var i=0;i<lines.length;i++){var line=lines[i].replace(/^\s+|\s+$/g,"");if(line!=null&&line.length>0){var fields=line.split("\t");var chromosome=fields[0].replace("chr","");if(chromosome==region.chromosome){var feature={label:fields[3],chromosome:chromosome,start:parseFloat(fields[1]),end:parseFloat(fields[2]),score:fields[4],strand:fields[5],thickStart:fields[6],thickEnd:fields[7],itemRgb:fields[8],blockCount:fields[9],blockSizes:fields[10],blockStarts:fields[11],featureType:"bed"};this.featureCache.putFeatures(feature,dataType);if(this.featuresByChromosome[chromosome]==null){this.featuresByChromosome[chromosome]=0}this.featuresByChromosome[chromosome]++;this.featuresCount++}}}};function DataSource(){}DataSource.prototype.fetch=function(){};StringDataSource.prototype.fetch=DataSource.prototype.fetch;function StringDataSource(str){DataSource.prototype.constructor.call(this);_.extend(this,Backbone.Events);this.str=str}StringDataSource.prototype.fetch=function(async){if(async){this.trigger("success",this.str)}else{return this.str}};FileDataSource.prototype.fetch=DataSource.prototype.fetch;function FileDataSource(args){DataSource.prototype.constructor.call(this);_.extend(this,Backbone.Events);this.file;this.maxSize=500*1024*1024;this.type="text";_.extend(this,args)}FileDataSource.prototype.error=function(){alert("File is too big. Max file size is "+this.maxSize+" bytes")};FileDataSource.prototype.fetch=function(async){var _this=this;if(this.file.size<=this.maxSize){if(async){var reader=new FileReader;reader.onload=function(evt){_this.trigger("success",evt.target.result)};return this.readAs(this.type,reader)}else{var reader=new FileReaderSync;return this.readAs(this.type,reader)}}else{_this.error();_this.trigger("error",{sender:this})}};FileDataSource.prototype.readAs=function(type,reader){switch(type){case"binary":return reader.readAsBinaryString(this.file);break;case"text":default:return reader.readAsText(this.file,"UTF-8")}};function NavigationBar(args){_.extend(this,Backbone.Events);var _this=this;this.id=Utils.genId("NavigationBar");this.target;this.autoRender=true;this.cellBaseHost="http://bioinfo.hpc.cam.ac.uk/cellbase";this.cellBaseVersion="v3";this.species="Homo sapiens";this.increment=3;this.componentsConfig={menuButton:false,leftSideButton:false,restoreDefaultRegionButton:true,regionHistoryButton:true,speciesButton:true,chromosomesButton:true,karyotypeButtonLabel:true,chromosomeButtonLabel:true,regionButtonLabel:true,zoomControl:true,windowSizeControl:true,positionControl:true,moveControl:true,autoheightButton:true,compactButton:true,searchControl:true};this.zoom=100;this.quickSearchDisplayKey="name";_.extend(this.componentsConfig,args.componentsConfig);delete args.componentsConfig;_.extend(this,args);this.region=new Region(this.region);this.currentChromosomeList=[];this.on(this.handlers);this.els={};this.zoomChanging=false;this.regionChanging=false;this.rendered=false;if(this.autoRender){this.render()}}NavigationBar.prototype={render:function(){var _this=this;var HTML=""+'<div title="Restore previous region" style="margin-right: 5px;" id="leftSideButton" class="ocb-ctrl"><i class="fa fa-navicon"></i></div>'+'<div id="restoreDefaultRegionButton" class="ocb-ctrl"><i class="fa fa-repeat"></i></div>'+'<div title="Region history" class="ocb-dropdown" style="margin-left: 5px">'+'   <div tabindex="-1" id="regionHistoryButton" class="ocb-ctrl"><i class="fa fa-history"></i> <i class="fa fa-caret-down"></i></div>'+'   <ul id="regionHistoryMenu"></ul>'+"</div>"+'<div title="Species menu" class="ocb-dropdown" style="margin-left: 5px">'+'   <div tabindex="-1" id="speciesButton" class="ocb-ctrl"><span id="speciesText"></span> <i class="fa fa-caret-down"></i></div>'+'   <ul id="speciesMenu"></ul>'+"</div>"+'<div title="Chromosomes menu" class="ocb-dropdown" style="margin-left: 5px">'+'   <div tabindex="-1" id="chromosomesButton" class="ocb-ctrl"><span id="chromosomesText"></span> <i class="fa fa-caret-down"></i></div>'+'   <ul id="chromosomesMenu" style="height: 200px; overflow-y: auto;"></ul>'+"</div>"+'<div style="margin-left: 5px; float: left; " >'+'   <label title="Toggle karyotype panel" class="ocb-ctrl" id="karyotypeButtonLabel"><input id="karyotypeButton" type="checkbox"><span style="border-right: none"><span class="ocb-icon ocb-icon-karyotype"></span></span></label>'+'   <label title="Toggle chromosome panel" class="ocb-ctrl" id="chromosomeButtonLabel"><input id="chromosomeButton" type="checkbox"><span style="border-right: none"><span class="ocb-icon ocb-icon-chromosome"></span></span></label>'+'   <label title="Toggle overview panel" class="ocb-ctrl" id="regionButtonLabel"><input id="regionButton" type="checkbox"><span><span class="ocb-icon ocb-icon-region"></span></span></label>'+"</div>"+'<div id="zoomControl" style="float:left;">'+'<div title="Minimum window size" id="zoomMinButton" class="ocb-ctrl" style="margin-left: 5px;border-right: none;">Min</div>'+'<div title="Decrease window size" id="zoomOutButton" class="ocb-ctrl"><span class="fa fa-minus"></span></div>'+'<div id="progressBarCont" class="ocb-zoom-bar">'+'   <div id="progressBar" class="back"></div>'+'   <div id="progressBar" class="rect" style="width: '+this.zoom+'%"></div>'+'   <div id="progressBarBall" class="ball" style="left: '+this.zoom+'%"></div>'+"</div>"+'<div title="Increase window size" id="zoomInButton" class="ocb-ctrl" style="border-right: none;"><span class="fa fa-plus"></span></div>'+'<div title="Maximum window size" id="zoomMaxButton" class="ocb-ctrl">Max</div>'+"</div>"+'<div title="Window size (Nucleotides)" id="windowSizeControl" style="float:left;margin-left: 5px;">'+'<input id="windowSizeField" class="ocb-ctrl"  type="text" style="width: 70px;">'+"</div>"+'<div title="Position" id="positionControl" style="float:left;margin-left: 5px">'+'<input id="regionField" class="ocb-ctrl" placeholder="1:10000-20000" type="text" style="width: 170px;">'+'<div id="goButton" class="ocb-ctrl" style="border-left: none;">Go!</div>'+"</div>"+'<div id="moveControl" style="float:left;font-size:18px;">'+'<div id="moveFurtherLeftButton" class="ocb-ctrl" style="border-right: none;margin-left: 5px;"><i class="fa fa-angle-double-left"></i></div>'+'<div id="moveLeftButton" class="ocb-ctrl" style="border-right: none;"><i class="fa fa-angle-left"></i></div>'+'<div id="moveRightButton" class="ocb-ctrl" style="border-right: none;"><i class="fa fa-angle-right"></i></div>'+'<div id="moveFurtherRightButton" class="ocb-ctrl"><i class="fa fa-angle-double-right"></i></div>'+"</div>"+'<label class="ocb-ctrl"><input type="checkbox" id="autoheightButton"><span style="margin-left: 5px;font-size:18px;"><i class="fa fa-compress"></i></span></label>'+'<div id="searchControl" style="float:left;">'+'<input id="searchField" class="ocb-ctrl"  list="searchDataList"  placeholder="gene" type="text" style="width: 90px;margin-left: 5px;">'+'       <datalist id="searchDataList">'+"       </datalist>"+'<div id="quickSearchButton" class="ocb-ctrl" style="border-left: none;"><i class="fa fa-search"></i></div>'+"</div>"+'<div style="float:right;margin-right:10px;" id="menuButton" class="ocb-ctrl"><i class="fa fa-navicon"></i> Configure</div>'+"";this.div=document.createElement("div");this.div.setAttribute("class","ocb-gv-navigation-bar unselectable");this.div.innerHTML=HTML;var els=this.div.querySelectorAll("[id]");for(var i=0;i<els.length;i++){var elid=els[i].getAttribute("id");if(elid){this.els[elid]=els[i]}}for(var key in this.componentsConfig){if(!this.componentsConfig[key]){this.els[key].classList.add("hidden")}}this.els.karyotypeButton.checked=this.karyotypePanelConfig.hidden?false:true;this.els.chromosomeButton.checked=this.chromosomePanelConfig.hidden?false:true;this.els.regionButton.checked=this.regionPanelConfig.hidden?false:true;this.els.menuButton.addEventListener("click",function(e){_this.trigger("menuButton:click",{clickEvent:e,sender:{}})});this.els.leftSideButton.addEventListener("click",function(e){_this.trigger("leftSideButton:click",{clickEvent:e,sender:{}})});this.els.restoreDefaultRegionButton.addEventListener("click",function(e){_this.trigger("restoreDefaultRegion:click",{clickEvent:e,sender:{}})});this._addRegionHistoryMenuItem(this.region);this._setChromosomeMenu();this._setSpeciesMenu();this.els.chromosomesText.textContent=this.region.chromosome;this.els.speciesText.textContent=this.species.scientificName;this.els.karyotypeButton.addEventListener("click",function(){_this.trigger("karyotype-button:change",{selected:this.checked,sender:_this})});this.els.chromosomeButton.addEventListener("click",function(){_this.trigger("chromosome-button:change",{selected:this.checked,sender:_this})});this.els.regionButton.addEventListener("click",function(){_this.trigger("region-button:change",{selected:this.checked,sender:_this})});this.els.zoomOutButton.addEventListener("click",function(){_this._handleZoomOutButton()});this.els.zoomInButton.addEventListener("click",function(){_this._handleZoomInButton()});this.els.zoomMaxButton.addEventListener("click",function(){_this._handleZoomSlider(100)});this.els.zoomMinButton.addEventListener("click",function(){_this._handleZoomSlider(0)});var zoomBarMove=function(e){var progressBarCont=_this.els.progressBarCont;var br=progressBarCont.getBoundingClientRect();var offsetX=e.clientX-br.left;var zoom=100/parseInt(getComputedStyle(progressBarCont).width)*offsetX;if(zoom>0&&zoom<100){_this.els.progressBarBall.style.left=zoom+"%"}};this.els.progressBarCont.addEventListener("click",function(e){var br=this.getBoundingClientRect();var offsetX=e.clientX-br.left;var zoom=100/parseInt(getComputedStyle(this).width)*offsetX;_this._handleZoomSlider(zoom);this.removeEventListener("mousemove",zoomBarMove)});this.els.progressBarBall.addEventListener("mousedown",function(e){_this.els.progressBarCont.addEventListener("mousemove",zoomBarMove)});this.els.progressBarBall.addEventListener("mouseleave",function(e){_this.els.progressBarCont.removeEventListener("mousemove",zoomBarMove);_this.els.progressBarBall.style.left=_this.zoom+"%"});this.els.regionField.value=this.region.toString();this.els.regionField.addEventListener("keyup",function(event){if(_this._checkRegion(this.value)&&event.which===13){_this._triggerRegionChange({region:new Region(this.value),sender:this})}});this.els.goButton.addEventListener("click",function(){var value=_this.els.regionField.value;if(_this._checkRegion(value)){_this._triggerRegionChange({region:new Region(value),sender:this})}});this.els.moveFurtherLeftButton.addEventListener("click",function(){_this._handleMoveRegion(10)});this.els.moveFurtherRightButton.addEventListener("click",function(){_this._handleMoveRegion(-10)});this.els.moveLeftButton.addEventListener("click",function(){_this._handleMoveRegion(1)});this.els.moveRightButton.addEventListener("click",function(){_this._handleMoveRegion(-1)});this.els.autoheightButton.addEventListener("click",function(){_this.trigger("autoHeight-button:change",{selected:this.checked,sender:_this})});var lastQuery="";this.els.searchField.addEventListener("keyup",function(event){this.classList.remove("error");var query=this.value;if(query.length>2&&lastQuery!==query&&event.which!==13){_this._setQuickSearchMenu(query);lastQuery=query}if(event.which===13){var item=_this.quickSearchDataset[query];if(item){_this.trigger("quickSearch:select",{item:item,sender:_this})}else{this.classList.add("error")}}});this.els.quickSearchButton.addEventListener("click",function(){_this.els.searchField.classList.remove("error");var query=_this.els.searchField.value;var item=_this.quickSearchDataset[query];if(item){_this.trigger("quickSearch:go",{item:item,sender:_this})}else{_this.els.searchField.classList.add("error")}});this.els.windowSizeField.value=this.region.length();this.els.windowSizeField.addEventListener("keyup",function(event){var value=this.value;var pattern=/^([0-9])+$/;if(pattern.test(value)){this.classList.remove("error");if(event.which===13){var regionSize=parseInt(value);var haflRegionSize=Math.floor(regionSize/2);var region=new Region({chromosome:_this.region.chromosome,start:_this.region.center()-haflRegionSize,end:_this.region.center()+haflRegionSize});_this._triggerRegionChange({region:region,sender:_this})}}else{this.classList.add("error")}});this.rendered=true},draw:function(){this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target);if(!this.targetDiv){console.log("target not found");return}this.targetDiv.appendChild(this.div)},_addRegionHistoryMenuItem:function(region){var _this=this;var menuEntry=document.createElement("li");menuEntry.textContent=region.toString();this.els.regionHistoryMenu.appendChild(menuEntry);menuEntry.addEventListener("click",function(){_this._triggerRegionChange({region:new Region(this.textContent),sender:_this})})},_setQuickSearchMenu:function(query){if(typeof this.quickSearchResultFn==="function"){while(this.els.searchDataList.firstChild){this.els.searchDataList.removeChild(this.els.searchDataList.firstChild)}this.quickSearchDataset={};var items=this.quickSearchResultFn(query);for(var i=0;i<items.length;i++){var item=items[i];var value=item[this.quickSearchDisplayKey];this.quickSearchDataset[value]=item;var menuEntry=document.createElement("option");menuEntry.setAttribute("value",value);this.els.searchDataList.appendChild(menuEntry)}}else{console.log("the quickSearchResultFn function is not valid")}},_setChromosomeMenu:function(){var _this=this;while(this.els.chromosomesMenu.firstChild){this.els.chromosomesMenu.removeChild(this.els.chromosomesMenu.firstChild)}var list=[];for(var chr in this.species.chromosomes){list.push(chr);var menuEntry=document.createElement("li");menuEntry.textContent=chr;this.els.chromosomesMenu.appendChild(menuEntry);menuEntry.addEventListener("click",function(){var region=new Region({chromosome:this.textContent,start:_this.region.start,end:_this.region.end});_this._triggerRegionChange({region:region,sender:_this})})}this.currentChromosomeList=list},_setSpeciesMenu:function(){var _this=this;var createSpeciesEntry=function(species,ul){var menuEntry=document.createElement("li");menuEntry.textContent=species.scientificName+" ("+species.assembly.name+")";ul.appendChild(menuEntry);menuEntry.addEventListener("click",function(){_this.trigger("species:change",{species:species,sender:_this})})};var createTaxonomy=function(taxonomy){var menuEntry=document.createElement("li");menuEntry.setAttribute("data-sub",true);menuEntry.textContent=taxonomy;_this.els.speciesMenu.appendChild(menuEntry);var ul=document.createElement("ul");menuEntry.appendChild(ul);return ul};for(var taxonomy in this.availableSpecies){var taxUl=createTaxonomy(taxonomy);for(var i=0;i<this.availableSpecies[taxonomy].length;i++){var species=this.availableSpecies[taxonomy][i];createSpeciesEntry(species,taxUl)}}},_checkRegion:function(value){var reg=new Region(value);if(!reg.parse(value)||reg.start<0||reg.end<0||_.indexOf(this.currentChromosomeList,reg.chromosome)==-1){this.els.regionField.classList.add("error");return false}else{this.els.regionField.classList.remove("error");return true}},_handleZoomOutButton:function(){this._handleZoomSlider(Math.max(0,this.zoom-5))},_handleZoomSlider:function(value){var _this=this;if(!_this.zoomChanging){_this.zoomChanging=true;_this.zoom=5*Math.round(value/5);_this.trigger("zoom:change",{zoom:_this.zoom,sender:_this});setTimeout(function(){_this.zoomChanging=false},700)}},_handleZoomInButton:function(){this._handleZoomSlider(Math.min(100,this.zoom+5))},_handleMoveRegion:function(positions){var pixelBase=(this.width-this.svgCanvasWidthOffset)/this.region.length();var disp=Math.round(positions*10/pixelBase);this.region.start-=disp;this.region.end-=disp;this.els.regionField.value=this.region.toString();this.trigger("region:move",{region:this.region,disp:disp,sender:this})},setVisible:function(obj){for(key in obj){var el=this.els[key];if(obj[key]){el.classList.remove("hidden")}else{el.classList.add("hidden")}}},setRegion:function(region,zoom){this.region.load(region);if(zoom){this.zoom=5*Math.round(zoom/5)}this.updateRegionControls();this._addRegionHistoryMenuItem(region)},moveRegion:function(region){this.region.load(region);this.els.chromosomesText.textContent=this.region.chromosome;this.els.regionField.value=this.region.toString()},setSpecies:function(species){this.species=species;this.els.speciesText.textContent=this.species.scientificName;this._setChromosomeMenu()},setWidth:function(width){this.width=width},_triggerRegionChange:function(event){var _this=this;if(!this.regionChanging){this.regionChanging=true;this.trigger("region:change",event);setTimeout(function(){_this.regionChanging=false},700)}else{this.updateRegionControls()}},updateRegionControls:function(){this.els.chromosomesText.textContent=this.region.chromosome;this.els.regionField.value=this.region.toString();this.els.windowSizeField.value=this.region.length();this.els.regionField.classList.remove("error");this.els.progressBar.style.width=this.zoom+"%";this.els.progressBarBall.style.left=this.zoom+"%"},setCellBaseHost:function(host){this.cellBaseHost=host}};function ChromosomePanel(args){_.extend(this,Backbone.Events);this.id=Utils.genId("ChromosomePanel");this.target;this.autoRender=true;this.cellBaseHost="http://bioinfo.hpc.cam.ac.uk/cellbase";this.cellBaseVersion="v3";this.pixelBase;this.species="hsapiens";this.width=600;this.height=75;this.collapsed=false;this.collapsible=false;this.hidden=false;_.extend(this,args);this.region=new Region(this.region);this.lastChromosome="";this.data;this.on(this.handlers);this.regionChanging=false;this.rendered=false;if(this.autoRender){this.render()}}
ChromosomePanel.prototype={show:function(){$(this.div).css({display:"block"});this.hidden=false},hide:function(){$(this.div).css({display:"none"});this.hidden=true},setVisible:function(bool){if(bool){this.show()}else{this.hide()}},showContent:function(){$(this.svg).css({display:"inline"});this.collapsed=false;$(this.collapseDiv).removeClass("active");$(this.collapseDiv).children().first().removeClass("fa-plus");$(this.collapseDiv).children().first().addClass("fa-minus")},hideContent:function(){$(this.svg).css({display:"none"});this.collapsed=true;$(this.collapseDiv).addClass("active");$(this.collapseDiv).children().first().removeClass("fa-minus");$(this.collapseDiv).children().first().addClass("fa-plus")},setTitle:function(title){if("titleDiv"in this){$(this.titleTextDiv).html(title)}},setWidth:function(width){this.width=width;this.svg.setAttribute("width",width);if(typeof this.data!=="undefined"){this.clean();this._drawSvg(this.data)}},render:function(){var _this=this;this.div=$('<div id="chromosome-panel"></div>')[0];if("title"in this&&this.title!==""){var titleDiv=$('<div id="tl-title" class="ocb-gv-panel-title unselectable"></div>')[0];$(this.div).append(titleDiv);if(this.collapsible==true){this.collapseDiv=$('<div class="ocb-gv-panel-collapse-control"><span class="fa fa-minus"></span></div>');$(titleDiv).dblclick(function(){if(_this.collapsed){_this.showContent()}else{_this.hideContent()}});$(this.collapseDiv).click(function(){if(_this.collapsed){_this.showContent()}else{_this.hideContent()}});$(titleDiv).append(this.collapseDiv)}this.titleTextDiv=$('<div class="ocb-gv-panel-text">'+this.title+"</div>");$(titleDiv).append(this.titleTextDiv)}this.svg=SVG.init(this.div,{width:this.width,height:this.height});$(this.div).addClass("unselectable");this.colors={gneg:"#eeeeee",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue",clementina:"#ffc967"};this.setVisible(!this.hidden);this.rendered=true},setSpecies:function(species){this.species=species},clean:function(){$(this.svg).empty()},draw:function(){var _this=this;this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target);if(!this.targetDiv){console.log("target not found");return}this.targetDiv.appendChild(this.div);this.clean();CellBaseManager.get({host:this.cellBaseHost,version:this.cellBaseVersion,species:this.species,category:"genomic",subCategory:"chromosome",query:this.region.chromosome,resource:"info",async:false,success:function(data){_this.data=data.response[0].result[0].chromosomes[0];_this.data.cytobands.sort(function(a,b){return a.start-b.start});_this._drawSvg(_this.data)}});this.lastChromosome=this.region.chromosome;if(this.collapsed){_this.hideContent()}},_drawSvg:function(chromosome){var _this=this;var offset=20;var group=SVG.addChild(_this.svg,"g",{cursor:"pointer"});this.chromosomeLength=chromosome.size;this.pixelBase=(this.width-40)/this.chromosomeLength;var backrect=SVG.addChild(group,"rect",{x:offset,y:4,width:this.width-40+1,height:22,fill:"#555555"});var cytobandsByStain={};var textDrawingOffset=offset;for(var i=0;i<chromosome.cytobands.length;i++){var cytoband=chromosome.cytobands[i];cytoband.pixelStart=cytoband.start*this.pixelBase;cytoband.pixelEnd=cytoband.end*this.pixelBase;cytoband.pixelSize=cytoband.pixelEnd-cytoband.pixelStart;if(typeof cytobandsByStain[cytoband.stain]=="undefined"){cytobandsByStain[cytoband.stain]=[]}cytobandsByStain[cytoband.stain].push(cytoband);var middleX=textDrawingOffset+cytoband.pixelSize/2;var textY=28;var text=SVG.addChild(group,"text",{x:middleX,y:textY,"font-size":10,transform:"rotate(90, "+middleX+", "+textY+")",fill:"black"});text.textContent=cytoband.name;textDrawingOffset+=cytoband.pixelSize}for(var cytobandStain in cytobandsByStain){var cytobands_d="";if(cytobandStain!="acen"){for(var j=0;j<cytobandsByStain[cytobandStain].length;j++){var cytoband=cytobandsByStain[cytobandStain][j];cytobands_d+="M"+(cytoband.pixelStart+offset+1)+",15"+" L"+(cytoband.pixelEnd+offset)+",15 "}var path=SVG.addChild(group,"path",{d:cytobands_d,stroke:this.colors[cytobandStain],"stroke-width":20,fill:"none"})}}if(typeof cytobandsByStain["acen"]!=="undefined"){var firstStain=cytobandsByStain["acen"][0];var lastStain=cytobandsByStain["acen"][1];var backrect=SVG.addChild(group,"rect",{x:firstStain.pixelStart+offset+1,y:4,width:lastStain.pixelEnd+offset-(firstStain.pixelStart+offset+1),height:22,fill:"white"});var firstStainXStart=firstStain.pixelStart+offset+1;var firstStainXEnd=firstStain.pixelEnd+offset;var lastStainXStart=lastStain.pixelStart+offset+1;var lastStainXEnd=lastStain.pixelEnd+offset;var path=SVG.addChild(group,"path",{d:"M"+firstStainXStart+",4"+" L"+(firstStainXEnd-5)+",4 "+" L"+firstStainXEnd+",15 "+" L "+(firstStainXEnd-5)+",26 "+" L "+firstStainXStart+",26 z",fill:this.colors["acen"]});var path=SVG.addChild(group,"path",{d:"M"+lastStainXStart+",15"+" L"+(lastStainXStart+5)+",4 "+" L"+lastStainXEnd+",4 "+" L "+lastStainXEnd+",26 "+" L "+(lastStainXStart+5)+",26 z",fill:this.colors["acen"]})}var status="";var centerPosition=_this.region.center();var pointerPosition=centerPosition*_this.pixelBase+offset;$(this.svg).on("mousedown",function(event){status="setRegion"});this.selBox=SVG.addChild(this.svg,"rect",{x:0,y:2,"stroke-width":"2",stroke:"deepskyblue",opacity:"0.5",fill:"honeydew"});var positionBoxWidth=_this.region.length()*_this.pixelBase;var positionGroup=SVG.addChild(group,"g");this.positionBox=SVG.addChild(positionGroup,"rect",{x:pointerPosition-positionBoxWidth/2,y:2,width:positionBoxWidth,height:_this.height-3,stroke:"orangered","stroke-width":2,opacity:.5,fill:"navajowhite",cursor:"move"});$(this.positionBox).on("mousedown",function(event){status="movePositionBox"});this.resizeLeft=SVG.addChild(positionGroup,"rect",{x:pointerPosition-positionBoxWidth/2,y:2,width:7,height:_this.height-3,opacity:.5,fill:"orangered",visibility:"hidden"});$(this.resizeLeft).on("mousedown",function(event){status="resizePositionBoxLeft"});this.resizeRight=SVG.addChild(positionGroup,"rect",{x:positionBoxWidth-5,y:2,width:7,height:_this.height-3,opacity:.5,fill:"orangered",visibility:"hidden"});$(this.resizeRight).on("mousedown",function(event){status="resizePositionBoxRight"});$(this.positionBox).off("mouseenter");$(this.positionBox).off("mouseleave");$(positionGroup).mouseenter(function(event){_this._recalculateResizeControls();_this._showResizeControls()});$(positionGroup).mouseleave(function(event){_this._hideResizeControls()});$(this.svg).off("contextmenu");$(this.svg).off("mousedown");$(this.svg).off("mouseup");$(this.svg).off("mousemove");$(this.svg).off("mouseleave");$(this.svg).contextmenu(function(e){e.preventDefault()});var downY,downX,moveX,moveY,lastX,increment;$(this.svg).mousedown(function(event){downX=event.clientX-$(this).parent().offset().left;_this.selBox.setAttribute("x",downX);lastX=_this.positionBox.getAttribute("x");if(status==""){status="setRegion"}_this._hideResizeControls();$(this).mousemove(function(event){moveX=event.clientX-$(this).parent().offset().left;_this._hideResizeControls();switch(status){case"resizePositionBoxLeft":var inc=moveX-downX;var newWidth=parseInt(_this.positionBox.getAttribute("width"))-inc;if(newWidth>0){_this.positionBox.setAttribute("x",parseInt(_this.positionBox.getAttribute("x"))+inc);_this.positionBox.setAttribute("width",newWidth)}downX=moveX;break;case"resizePositionBoxRight":var inc=moveX-downX;SVG;var newWidth=parseInt(_this.positionBox.getAttribute("width"))+inc;if(newWidth>0){_this.positionBox.setAttribute("width",newWidth)}downX=moveX;break;case"movePositionBox":var inc=moveX-downX;_this.positionBox.setAttribute("x",parseInt(_this.positionBox.getAttribute("x"))+inc);downX=moveX;break;case"setRegion":case"selectingRegion":status="selectingRegion";if(moveX<downX){_this.selBox.setAttribute("x",moveX)}_this.selBox.setAttribute("width",Math.abs(moveX-downX));_this.selBox.setAttribute("height",_this.height-3);break}})});$(this.svg).mouseup(function(event){$(this).off("mousemove");if(downX!=null){switch(status){case"resizePositionBoxLeft":case"resizePositionBoxRight":case"movePositionBox":if(moveX!=null){var w=parseInt(_this.positionBox.getAttribute("width"));var x=parseInt(_this.positionBox.getAttribute("x"));var pixS=x;var pixE=x+w;var bioS=(pixS-offset)/_this.pixelBase;var bioE=(pixE-offset)/_this.pixelBase;_this._triggerRegionChange({region:new Region({chromosome:_this.region.chromosome,start:bioS,end:bioE}),sender:_this})}break;case"setRegion":if(downX>offset&&downX<_this.width-offset){var w=_this.positionBox.getAttribute("width");var pixS=downX-w/2;var pixE=downX+w/2;var bioS=(pixS-offset)/_this.pixelBase;var bioE=(pixE-offset)/_this.pixelBase;_this._triggerRegionChange({region:new Region({chromosome:_this.region.chromosome,start:bioS,end:bioE}),sender:_this})}break;case"selectingRegion":var bioS=(downX-offset)/_this.pixelBase;var bioE=(moveX-offset)/_this.pixelBase;var start=Math.min(bioS,bioE);var end=Math.max(bioS,bioE);_this.selBox.setAttribute("width",0);_this.selBox.setAttribute("height",0);_this._triggerRegionChange({region:new Region({chromosome:_this.region.chromosome,start:start,end:end}),sender:_this});break}status=""}downX=null;moveX=null;lastX=_this.positionBox.getAttribute("x")});$(this.svg).mouseleave(function(event){$(this).off("mousemove");if(lastX!=null){_this.positionBox.setAttribute("x",lastX)}_this.selBox.setAttribute("width",0);_this.selBox.setAttribute("height",0);downX=null;moveX=null;lastX=null;overPositionBox=false;movingPositionBox=false;selectingRegion=false})},_triggerRegionChange:function(event){var _this=this;if(!this.regionChanging){this.regionChanging=true;this._limitRegionToChromosome(event.region);this.trigger("region:change",event);setTimeout(function(){_this.regionChanging=false},700)}else{this.updateRegionControls()}},_recalculatePositionBox:function(region){var genomicLength=region.length();var pixelWidth=genomicLength*this.pixelBase;var x=region.start*this.pixelBase+20;this.positionBox.setAttribute("x",x);this.positionBox.setAttribute("width",pixelWidth)},_recalculateSelectionBox:function(region){var genomicLength=region.length();var pixelWidth=genomicLength*this.pixelBase;var x=region.start*this.pixelBase+20;this.selBox.setAttribute("x",x);this.selBox.setAttribute("width",pixelWidth)},_recalculateResizeControls:function(){var postionBoxX=parseInt(this.positionBox.getAttribute("x"));var postionBoxWidth=parseInt(this.positionBox.getAttribute("width"));this.resizeLeft.setAttribute("x",postionBoxX-5);this.resizeRight.setAttribute("x",postionBoxX+postionBoxWidth);$(this.resizeLeft).css({cursor:"ew-resize"});$(this.resizeRight).css({cursor:"ew-resize"})},_hideResizeControls:function(){this.resizeLeft.setAttribute("visibility","hidden");this.resizeRight.setAttribute("visibility","hidden")},_showResizeControls:function(){this.resizeLeft.setAttribute("visibility","visible");this.resizeRight.setAttribute("visibility","visible")},_limitRegionToChromosome:function(region){region.start=region.start<1?1:region.start;region.end=region.end>this.chromosomeLength?this.chromosomeLength:region.end},updateRegionControls:function(){this.selBox.setAttribute("width",0);this.selBox.setAttribute("height",0);this._recalculatePositionBox(this.region);this._recalculateResizeControls()},setRegion:function(region){console.log("region modified chromosome");this.region.load(region);var needDraw=false;if(this.lastChromosome!=this.region.chromosome){needDraw=true}if(needDraw){this.draw()}this.updateRegionControls()},setCellBaseHost:function(host){this.cellBaseHost=host}};function KaryotypePanel(args){_.extend(this,Backbone.Events);this.target;this.autoRender=true;this.id=Utils.genId("KaryotypePanel");this.cellBaseHost="http://bioinfo.hpc.cam.ac.uk/cellbase";this.cellBaseVersion="v3";this.pixelBase;this.species;this.width=600;this.height=75;this.collapsed=false;this.collapsible=true;this.hidden=false;_.extend(this,args);this.region=new Region(this.region);this.lastSpecies=this.species;this.chromosomeList;this.data2;this.on(this.handlers);this.regionChanging=false;this.rendered=false;if(this.autoRender){this.render()}}KaryotypePanel.prototype={show:function(){$(this.div).css({display:"block"});this.hidden=false},hide:function(){$(this.div).css({display:"none"});this.hidden=true},setVisible:function(bool){if(bool){this.show()}else{this.hide()}},showContent:function(){$(this.svg).css({display:"inline"});this.collapsed=false;$(this.collapseDiv).removeClass("active");$(this.collapseDiv).children().first().removeClass("fa-plus");$(this.collapseDiv).children().first().addClass("fa-minus")},hideContent:function(){$(this.svg).css({display:"none"});this.collapsed=true;$(this.collapseDiv).addClass("active");$(this.collapseDiv).children().first().removeClass("fa-minus");$(this.collapseDiv).children().first().addClass("fa-plus")},setTitle:function(title){if("titleDiv"in this){$(this.titleTextDiv).html(title)}},setWidth:function(width){this.width=width;this.svg.setAttribute("width",width);if(typeof this.chromosomeList!=="undefined"){this.clean();this._drawSvg(this.chromosomeList,this.data2)}},render:function(){var _this=this;this.div=$('<div id="karyotype-panel"></div>')[0];if("title"in this&&this.title!==""){var titleDiv=$('<div id="tl-title" class="ocb-gv-panel-title unselectable"></div>')[0];$(this.div).append(titleDiv);if(this.collapsible==true){this.collapseDiv=$('<div class="ocb-gv-panel-collapse-control"><span class="fa fa-minus"></span></div>');$(titleDiv).dblclick(function(){if(_this.collapsed){_this.showContent()}else{_this.hideContent()}});$(this.collapseDiv).click(function(){if(_this.collapsed){_this.showContent()}else{_this.hideContent()}});$(titleDiv).append(this.collapseDiv)}this.titleTextDiv=$('<div class="ocb-gv-panel-text">'+this.title+"</div>");$(titleDiv).append(this.titleTextDiv)}this.svg=SVG.init(this.div,{width:this.width,height:this.height});this.markGroup=SVG.addChild(this.svg,"g",{cursor:"pointer"});$(this.div).addClass("unselectable");this.colors={gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue"};this.setVisible(!this.hidden);this.rendered=true},setSpecies:function(species){this.lastSpecies=this.species;this.species=species},clean:function(){$(this.svg).empty()},draw:function(){var _this=this;this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target);if(!this.targetDiv){console.log("target not found");return}this.targetDiv.appendChild(this.div);this.clean();var sortfunction=function(a,b){var IsNumber=true;for(var i=0;i<a.name.length&&IsNumber==true;i++){if(isNaN(a.name[i])){IsNumber=false}}if(!IsNumber)return 1;return a.name-b.name};CellBaseManager.get({host:this.cellBaseHost,version:this.cellBaseVersion,species:this.species,category:"genomic",subCategory:"chromosome",resource:"all",async:false,success:function(data){_this.chromosomeList=data.response[0].result[0].chromosomes;_this.chromosomeList.sort(sortfunction);_this._drawSvg(_this.chromosomeList)}});if(this.collapsed){_this.hideContent()}},_drawSvg:function(chromosomeList){var _this=this;var x=20;var xOffset=_this.width/chromosomeList.length;var yMargin=2;var biggerChr=0;for(var i=0,len=chromosomeList.length;i<len;i++){var size=chromosomeList[i].size;if(size>biggerChr){biggerChr=size}}_this.pixelBase=(_this.height-10)/biggerChr;_this.chrOffsetY={};_this.chrOffsetX={};for(var i=0,len=chromosomeList.length;i<len;i++){var chromosome=chromosomeList[i];var chrSize=chromosome.size*_this.pixelBase;var y=yMargin+biggerChr*_this.pixelBase-chrSize;_this.chrOffsetY[chromosome.name]=y;var firstCentromere=true;var group=SVG.addChild(_this.svg,"g",{cursor:"pointer",chr:chromosome.name});$(group).click(function(event){var chrClicked=this.getAttribute("chr");var offsetY=event.pageY-$(_this.svg).offset().top;var clickPosition=parseInt((offsetY-_this.chrOffsetY[chrClicked])/_this.pixelBase);var region=new Region({chromosome:chrClicked,start:clickPosition,end:clickPosition});_this._triggerRegionChange({region:region,sender:_this})});for(var j=0,lenJ=chromosome.cytobands.length;j<lenJ;j++){var cytoband=chromosome.cytobands[j];var height=_this.pixelBase*(cytoband.end-cytoband.start);var width=13;var color=_this.colors[cytoband.stain];if(color==null)color="purple";if(cytoband.stain=="acen"){var points="";var middleX=x+width/2;var middleY=y+height/2;var endX=x+width;var endY=y+height;if(firstCentromere){points=x+","+y+" "+endX+","+y+" "+endX+","+middleY+" "+middleX+","+endY+" "+x+","+middleY;firstCentromere=false}else{points=x+","+endY+" "+x+","+middleY+" "+middleX+","+y+" "+endX+","+middleY+" "+endX+","+endY}SVG.addChild(group,"polyline",{points:points,stroke:"black",opacity:.8,fill:color})}else{SVG.addChild(group,"rect",{x:x,y:y,width:width,height:height,stroke:"grey",opacity:.8,fill:color})}y+=height}var text=SVG.addChild(_this.svg,"text",{x:x+1,y:_this.height,"font-size":9,fill:"black"});text.textContent=chromosome.name;_this.chrOffsetX[chromosome.name]=x;x+=xOffset}this.positionBox=SVG.addChild(this.svg,"line",{x1:0,y1:0,x2:0,y2:0,stroke:"orangered","stroke-width":2,opacity:.5});this._recalculatePositionBox(this.region);this.rendered=true;this.trigger("after:render",{sender:this})},_triggerRegionChange:function(event){var _this=this;if(!this.regionChanging){this.regionChanging=true;this.trigger("region:change",event);setTimeout(function(){_this.regionChanging=false},700)}else{this.updateRegionControls()}},_recalculatePositionBox:function(region){var centerPosition=region.center();var pointerPosition=centerPosition*this.pixelBase+this.chrOffsetY[region.chromosome];this.positionBox.setAttribute("x1",this.chrOffsetX[region.chromosome]-10);this.positionBox.setAttribute("x2",this.chrOffsetX[region.chromosome]+23);this.positionBox.setAttribute("y1",pointerPosition);this.positionBox.setAttribute("y2",pointerPosition)},updateRegionControls:function(){this._recalculatePositionBox(this.region)},setRegion:function(region){this.region.load(region);var needDraw=false;if(this.lastSpecies!=this.species){needDraw=true;this.lastSpecies=this.species}if(needDraw){this.draw()}this.updateRegionControls()},addMark:function(item){var _this=this;var mark=function(){if(_this.region.chromosome!=null&&_this.region.start!=null){if(_this.chrOffsetX[_this.region.chromosome]!=null){var x1=_this.chrOffsetX[_this.region.chromosome]-10;var x2=_this.chrOffsetX[_this.region.chromosome];var y1=_this.region.start*_this.pixelBase+_this.chrOffsetY[_this.region.chromosome]-4;var y2=_this.region.start*_this.pixelBase+_this.chrOffsetY[_this.region.chromosome];var y3=_this.region.start*_this.pixelBase+_this.chrOffsetY[_this.region.chromosome]+4;var points=x1+","+y1+" "+x2+","+y2+" "+x1+","+y3+" "+x1+","+y1;SVG.addChild(_this.markGroup,"polyline",{points:points,stroke:"black",opacity:.8,fill:"#33FF33"})}}};if(this.rendered){mark()}else{_this.on("after:render",function(e){mark()})}},unmark:function(){$(this.markGroup).empty()},setCellBaseHost:function(host){this.cellBaseHost=host}};function StatusBar(args){_.extend(this,Backbone.Events);var _this=this;this.id=Utils.genId("StatusBar");this.target;this.autoRender=true;_.extend(this,args);this.region=new Region(this.region);this.rendered=false;if(this.autoRender){this.render()}}StatusBar.prototype={render:function(){this.div=$('<div id="'+this.id+'" class="ocb-gv-status-bar"></div>')[0];this.rightDiv=$('<div class="ocb-gv-status-right" id="'+this.id+'position"</div>')[0];this.leftDiv=$('<div class="ocb-gv-status-left" id="'+this.id+'position"></div>')[0];$(this.div).append(this.leftDiv);$(this.div).append(this.rightDiv);this.mousePositionEl=$('<span id="'+this.id+'position"></span>')[0];this.mousePositionBase=document.createElement("span");this.mousePositionBase.style.marginRight="5px";this.mousePositionRegion=document.createElement("span");this.mousePositionEl.appendChild(this.mousePositionBase);this.mousePositionEl.appendChild(this.mousePositionRegion);this.versionEl=$('<span id="'+this.id+'version">'+this.version+"</span>")[0];$(this.rightDiv).append(this.mousePositionEl);$(this.leftDiv).append(this.versionEl);this.rendered=true},draw:function(){var _this=this;this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target);if(!this.targetDiv){console.log("target not found");return}this.targetDiv.appendChild(this.div)},setRegion:function(event){this.region.load(event.region);$(this.mousePositionEl).html(Utils.formatNumber(event.region.center()))},setMousePosition:function(event){this.mousePositionBase.style.color=SEQUENCE_COLORS[event.base];this.mousePositionBase.textContent=event.base;this.mousePositionRegion.textContent=this.region.chromosome+":"+Utils.formatNumber(event.mousePos)}};function TrackListPanel(args){var _this=this;_.extend(this,Backbone.Events);this.cellBaseHost="http://bioinfo.hpc.cam.ac.uk/cellbase";this.cellBaseVersion="v3";this.target;this.autoRender=true;this.id=Utils.genId("TrackListPanel");this.collapsed=false;this.collapsible=false;this.hidden=false;this.tracks=[];this.tracksIndex={};this.parentLayout;this.mousePosition;this.windowSize;this.zoomMultiplier=1;this.showRegionOverviewBox=false;this.height=0;_.extend(this,args);this.region=new Region(this.region);this.width-=18;this.status;this.visualRegion=new Region(this.region);this._setPixelBase();this.on(this.handlers);this.regionChanging=false;this.rendered=false;if(this.autoRender){this.render()}}TrackListPanel.prototype={show:function(){$(this.div).css({display:"block"});this.hidden=false},hide:function(){$(this.div).css({display:"none"});this.hidden=true},setVisible:function(bool){if(bool){this.show()}else{this.hide()}},setTitle:function(title){if("titleDiv"in this){$(this.titleDiv).html(title)}},showContent:function(){$(this.tlHeaderDiv).css({display:"block"});$(this.panelDiv).css({display:"block"});this.collapsed=false;$(this.collapseDiv).removeClass("active");$(this.collapseDiv).children().first().removeClass("fa-plus");$(this.collapseDiv).children().first().addClass("fa-minus")},hideContent:function(){$(this.tlHeaderDiv).css({display:"none"});$(this.panelDiv).css({display:"none"});this.collapsed=true;$(this.collapseDiv).addClass("active");$(this.collapseDiv).children().first().removeClass("fa-minus");$(this.collapseDiv).children().first().addClass("fa-plus")},render:function(){var _this=this;this.div=document.createElement("div");this.div.classList.add("ocb-gv-tracklist");this.windowSizeDiv=document.createElement("div");this.windowSizeDiv.classList.add("ocb-gv-tracklist-windowsize");if("title"in this&&this.title!==""){var titleDiv=document.createElement("div");titleDiv.classList.add("ocb-gv-panel-title","unselectable");titleDiv.appendChild(this.windowSizeDiv);if(this.collapsible==true){this.collapseDiv=document.createElement("div");this.collapseDiv.classList.add("ocb-gv-panel-collapse-control");var collapseSpan=document.createElement("span");collapseSpan.classList.add("fa","fa-minus");this.collapseDiv.appendChild(collapseSpan);$(titleDiv).dblclick(function(){if(_this.collapsed){_this.showContent()}else{_this.hideContent()}});$(this.collapseDiv).click(function(){if(_this.collapsed){_this.showContent()}else{_this.hideContent()}});titleDiv.appendChild(this.collapseDiv)}var titleTextDiv=document.createElement("div");titleTextDiv.classList.add("ocb-gv-panel-text");titleTextDiv.textContent=this.title;titleDiv.appendChild(titleTextDiv);this.div.appendChild(titleDiv)}var tlHeaderDiv=$('<div id="tl-header" class="unselectable"></div>')[0];var panelDiv=$('<div id="tl-panel"></div>')[0];$(panelDiv).css({position:"relative",width:"100%"});this.tlTracksDiv=$('<div id="tl-tracks"></div>')[0];$(this.tlTracksDiv).css({position:"relative","z-index":3});$(this.div).append(tlHeaderDiv);$(this.div).append(panelDiv);$(panelDiv).append(this.tlTracksDiv);this.positionDiv=document.createElement("div");this.positionDiv.classList.add("ocb-gv-tracklist-position");this.positionLeftDiv=document.createElement("div");this.positionLeftDiv.classList.add("ocb-gv-tracklist-position-left");this.positionNucleotidDiv=document.createElement("div");this.positionNucleotidDiv.classList.add("ocb-gv-tracklist-position-mid-nt");this.positionMidPosDiv=document.createElement("div");this.positionMidPosDiv.classList.add("ocb-gv-tracklist-position-mid-pos");this.positionMidDiv=document.createElement("div");this.positionMidDiv.classList.add("ocb-gv-tracklist-position-mid");this.positionRightDiv=document.createElement("div");this.positionRightDiv.classList.add("ocb-gv-tracklist-position-right");this.positionDiv.appendChild(this.positionLeftDiv);this.positionDiv.appendChild(this.positionNucleotidDiv);this.positionMidDiv.appendChild(this.positionNucleotidDiv);this.positionMidDiv.appendChild(this.positionMidPosDiv);this.positionDiv.appendChild(this.positionMidDiv);this.positionDiv.appendChild(this.positionRightDiv);tlHeaderDiv.appendChild(this.positionDiv);var mid=this.width/2;this._setTextPosition();this.centerLine=$('<div id="'+this.id+'centerLine"></div>')[0];$(panelDiv).append(this.centerLine);$(this.centerLine).css({"z-index":2,position:"absolute",left:mid-1,top:0,width:Math.floor(this.pixelBase),height:"calc(100% - 8px)",opacity:.5,border:"1px solid orangered","background-color":"orange"});this.mouseLine=$('<div id="'+this.id+'mouseLine"></div>')[0];$(panelDiv).append(this.mouseLine);$(this.mouseLine).css({"z-index":1,position:"absolute",left:-20.5,top:0,width:Math.floor(this.pixelBase),height:"calc(100% - 8px)",border:"1px solid gray",opacity:.7,visibility:"hidden","background-color":"gainsboro"});var selBox=$('<div id="'+this.id+'selBox"></div>')[0];$(panelDiv).append(selBox);$(selBox).css({"z-index":0,position:"absolute",left:0,top:0,height:"100%",border:"2px solid deepskyblue",opacity:.5,visibility:"hidden","background-color":"honeydew"});if(this.showRegionOverviewBox){var regionOverviewBoxLeft=$('<div id="'+this.id+'regionOverviewBoxLeft"></div>')[0];var regionOverviewBoxRight=$('<div id="'+this.id+'regionOverviewBoxRight"></div>')[0];$(panelDiv).append(regionOverviewBoxLeft);$(panelDiv).append(regionOverviewBoxRight);var regionOverviewBoxWidth=this.region.length()*this.pixelBase;var regionOverviewDarkBoxWidth=(this.width-regionOverviewBoxWidth)/2;$(regionOverviewBoxLeft).css({"z-index":0,position:"absolute",left:1,top:0,width:regionOverviewDarkBoxWidth,height:"calc(100% - 8px)",opacity:.5,"background-color":"lightgray"});$(regionOverviewBoxRight).css({"z-index":0,position:"absolute",left:regionOverviewDarkBoxWidth+regionOverviewBoxWidth,top:0,width:regionOverviewDarkBoxWidth,height:"calc(100% - 8px)",opacity:.5,"background-color":"lightgray"});this.regionOverviewBoxLeft=regionOverviewBoxLeft;this.regionOverviewBoxRight=regionOverviewBoxRight}$(this.div).mousemove(function(event){var centerPosition=_this.region.center();var mid=_this.width/2;var mouseLineOffset=_this.pixelBase/2;var offsetX=event.clientX-_this.tlTracksDiv.getBoundingClientRect().left;var cX=offsetX-mouseLineOffset;var rcX=cX/_this.pixelBase|0;var pos=rcX*_this.pixelBase+mid%_this.pixelBase-1;$(_this.mouseLine).css({left:pos});var posOffset=mid/_this.pixelBase|0;_this.mousePosition=centerPosition+rcX-posOffset;_this.trigger("mousePosition:change",{mousePos:_this.mousePosition,chromosome:_this.region.chromosome,base:_this.getMousePosition(_this.mousePosition)})});$(this.tlTracksDiv).dblclick(function(event){if(!_this.regionChanging){_this.regionChanging=true;var halfLength=_this.region.length()/2;var mouseRegion=new Region({chromosome:_this.region.chromosome,start:_this.mousePosition-halfLength,end:_this.mousePosition+halfLength});_this.trigger("region:change",{region:mouseRegion,sender:_this});setTimeout(function(){_this.regionChanging=false},700)}});var downX,moveX;$(this.tlTracksDiv).mousedown(function(event){$("html").addClass("unselectable");$(_this.mouseLine).css({visibility:"hidden"});var mouseState=event.which;if(event.ctrlKey){mouseState="ctrlKey"+event.which}switch(mouseState){case 1:$(this).css({cursor:"move"});downX=event.clientX;var lastX=0;$(this).mousemove(function(event){var newX=(downX-event.clientX)/_this.pixelBase|0;if(newX!=lastX){var disp=lastX-newX;var centerPosition=_this.region.center();var p=centerPosition-disp;if(p>0){_this.region.start-=disp;_this.region.end-=disp;_this._setTextPosition();_this.trigger("region:move",{region:_this.region,disp:disp,sender:_this});_this.trigger("trackRegion:move",{region:_this.region,disp:disp,sender:_this});lastX=newX}}});break;case 2:case"ctrlKey1":$(selBox).css({visibility:"visible"});$(selBox).css({width:0});downX=event.pageX-$(_this.tlTracksDiv).offset().left;$(selBox).css({left:downX});$(this).mousemove(function(event){moveX=event.pageX-$(_this.tlTracksDiv).offset().left;if(moveX<downX){$(selBox).css({left:moveX})}$(selBox).css({width:Math.abs(moveX-downX)})});break;case 3:break;default:}});$(this.tlTracksDiv).mouseup(function(event){$("html").removeClass("unselectable");$(this).css({cursor:"default"});$(_this.mouseLine).css({visibility:"visible"});$(this).off("mousemove");var mouseState=event.which;if(event.ctrlKey){mouseState="ctrlKey"+event.which}switch(mouseState){case 1:break;case 2:case"ctrlKey1":$(selBox).css({visibility:"hidden"});$(this).off("mousemove");if(downX!=null&&moveX!=null){var ss=downX/_this.pixelBase;var ee=moveX/_this.pixelBase;ss+=_this.visualRegion.start;ee+=_this.visualRegion.start;_this.region.start=parseInt(Math.min(ss,ee));_this.region.end=parseInt(Math.max(ss,ee));_this.trigger("region:change",{region:_this.region,sender:_this});moveX=null}else if(downX!=null&&moveX==null){var mouseRegion=new Region({chromosome:_this.region.chromosome,start:_this.mousePosition,end:_this.mousePosition});_this.trigger("region:change",{region:mouseRegion,sender:_this})}break;case 3:break;default:}});$(this.tlTracksDiv).mouseleave(function(event){$(this).css({cursor:"default"});$(_this.mouseLine).css({visibility:"hidden"});$(this).off("mousemove");$("body").off("keydown.genomeViewer");$(selBox).css({visibility:"hidden"});downX=null;moveX=null});$(this.tlTracksDiv).mouseenter(function(e){$(_this.mouseLine).css({visibility:"visible"});$("body").off("keydown.genomeViewer");enableKeys()});var enableKeys=function(){$("body").bind("keydown.genomeViewer",function(e){var disp=0;switch(e.keyCode){case 37:if(e.ctrlKey){disp=Math.round(100/_this.pixelBase)}else{disp=Math.round(10/_this.pixelBase)}break;case 39:if(e.ctrlKey){disp=Math.round(-100/_this.pixelBase)}else{disp=Math.round(-10/_this.pixelBase)}break}if(disp!=0){_this.region.start-=disp;_this.region.end-=disp;_this._setTextPosition();_this.trigger("region:move",{region:_this.region,disp:disp,sender:_this});_this.trigger("trackRegion:move",{region:_this.region,disp:disp,sender:_this})}})};this.tlHeaderDiv=tlHeaderDiv;this.panelDiv=panelDiv;this.setVisible(!this.hidden);this.rendered=true},setHeight:function(height){},setWidth:function(width){console.log("trackListPanel setWidth ------\x3e "+width);this.width=width-18},highlight:function(event){this.trigger("trackFeature:highlight",event)},moveRegion:function(event){this.region.load(event.region);this.visualRegion.load(event.region);this._setTextPosition();this.trigger("trackRegion:move",event)},setSpecies:function(species){this.species=species;for(var i=0;i<this.tracks.length;i++){var track=this.tracks[i];track.setSpecies(this.species)}},setRegion:function(region){console.log("trackListPanel setRegion region ------\x3e "+region);console.log("trackListPanel setRegion width ------\x3e "+this.width);var _this=this;var mid=this.width/2;this.region.load(region);this.visualRegion.load(region);this._setPixelBase();$(this.centerLine).css({left:mid-1,width:this.pixelBase});$(this.mouseLine).css({width:this.pixelBase});this._setTextPosition();if(this.showRegionOverviewBox){
var regionOverviewBoxWidth=this.region.length()*this.pixelBase;var regionOverviewDarkBoxWidth=(this.width-regionOverviewBoxWidth)/2;$(this.regionOverviewBoxLeft).css({width:regionOverviewDarkBoxWidth});$(this.regionOverviewBoxRight).css({left:regionOverviewDarkBoxWidth+regionOverviewBoxWidth,width:regionOverviewDarkBoxWidth})}this.trigger("window:size",{windowSize:this.windowSize});this.trigger("trackRegion:change",{region:this.visualRegion,sender:this});this.positionNucleotidDiv.textContent="";this.status="rendering"},draw:function(){var _this=this;this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target);if(!this.targetDiv){console.log("target not found");return}this.targetDiv.appendChild(this.div);this.trigger("track:draw",{sender:this})},_checkAllTrackStatus:function(status){for(var i=0;i<this.tracks.length;i++){var track=this.tracks[i];if(track.status!=status)return false}return true},checkTracksReady:function(){return this._checkAllTrackStatus("ready")},addTrack:function(track){if(_.isArray(track)){for(var i in track){this._addTrack(track[i])}}else{this._addTrack(track)}},_addTrack:function(track){if(!this.rendered){console.info(this.id+" is not rendered yet");return}var _this=this;if(track==null){return false}if(this.containsTrack(track)){return false}var length=this.tracks.push(track);var insertPosition=length-1;this.tracksIndex[track.id]=insertPosition;if(typeof track.dataAdapter.host==="undefined"){track.dataAdapter.host=this.cellBaseHost}if(typeof track.dataAdapter.version==="undefined"){track.dataAdapter.version=this.cellBaseVersion}track.set("pixelBase",this.pixelBase);track.set("region",this.visualRegion);track.set("width",this.width);track.setSpecies(this.species);track.set("trackListPanel",this);if(!track.rendered){track.render(this.tlTracksDiv)}track.draw();track.set("track:draw",function(event){track.draw()});track.set("trackRegion:change",function(event){console.log("trackListPanel trackRegion:change region ------\x3e "+event.region);console.log("trackListPanel trackRegion:change width ------\x3e "+_this.width);track.setWidth(_this.width);track.set("pixelBase",_this.pixelBase);track.set("region",event.region);track.draw()});track.set("trackRegion:move",function(event){track.set("region",event.region);track.set("pixelBase",_this.pixelBase);track.move(event.disp)});track.set("trackFeature:highlight",function(event){var attrName=event.attrName||"feature_id";if("attrValue"in event){event.attrValue=$.isArray(event.attrValue)?event.attrValue:[event.attrValue];for(var key in event.attrValue){var queryStr=attrName+"~="+event.attrValue[key];var group=$(track.svgdiv).find("g["+queryStr+"]");$(group).each(function(){var animation=$(this).find("animate");if(animation.length==0){animation=SVG.addChild(this,"animate",{attributeName:"opacity",attributeType:"XML",begin:"indefinite",from:"0.0",to:"1",begin:"0s",dur:"0.5s",repeatCount:"5"})}else{animation=animation[0]}var y=$(group).find("rect").attr("y");$(track.svgdiv).scrollTop(y);animation.beginElement()})}}});track.on("track:close",function(event){_this.removeTrack(event.sender)});track.on("track:up",function(event){_this._reallocateAbove(event.sender)});track.on("track:down",function(event){_this._reallocateUnder(event.sender)});this.on("track:draw",track.get("track:draw"));this.on("trackRegion:change",track.get("trackRegion:change"));this.on("trackRegion:move",track.get("trackRegion:move"));this.on("trackFeature:highlight",track.get("trackFeature:highlight"))},toggleAutoHeight:function(bool){for(var i=0;i<this.tracks.length;i++){var track=this.tracks[i];track.toggleAutoHeight(bool)}},updateHeight:function(){for(var i=0;i<this.tracks.length;i++){var track=this.tracks[i];track.updateHeight(true)}},containsTrack:function(track){if(typeof this.tracksIndex[track.id]!=="undefined"){return true}else{return false}},getTrackIndex:function(track){return this.tracksIndex[track.id]},_updateTracksIndex:function(){for(var i=0;i<this.tracks.length;i++){var track=this.tracks[i];this.tracksIndex[track.id]=i}},refreshTracksDom:function(){for(var i=0;i<this.tracks.length;i++){var track=this.tracks[i];$(track.div).detach();$(this.tlTracksDiv).append(track.div)}this.trigger("tracks:refresh",{sender:this})},removeTrack:function(track){if(!this.containsTrack(track)){return false}this.hideTrack(track);track.remove();var index=this.getTrackIndex(track);this.tracks.splice(index,1)[0];delete this.tracksIndex[track.id];this._updateTracksIndex();track.off("track:close");track.off("track:up");track.off("track:down");this.off("track:draw",track.get("track:draw"));this.off("trackRegion:change",track.get("trackRegion:change"));this.off("trackRegion:move",track.get("trackRegion:move"));this.off("trackFeature:highlight",track.get("trackFeature:highlight"));this.refreshTracksDom();return track},restoreTrack:function(track,index){if(this.containsTrack(track)){return false}this.addTrack(track);if(typeof index!=="undefined"){this.setTrackIndex(track,index)}track.show();this.refreshTracksDom()},_reallocateAbove:function(track){if(!this.containsTrack(track)){return false}var i=this.getTrackIndex(track);console.log(i+" wants to move up");if(i>0){var aboveTrack=this.tracks[i-1];var underTrack=this.tracks[i];this.tracks[i]=aboveTrack;this.tracks[i-1]=underTrack;this.tracksIndex[aboveTrack.id]=i;this.tracksIndex[underTrack.id]=i-1;this.refreshTracksDom()}else{console.log("is at top")}},_reallocateUnder:function(track){if(!this.containsTrack(track)){return false}var i=this.getTrackIndex(track);console.log(i+" wants to move down");if(i+1<this.tracks.length){var aboveTrack=this.tracks[i];var underTrack=this.tracks[i+1];this.tracks[i]=underTrack;this.tracks[i+1]=aboveTrack;this.tracksIndex[underTrack.id]=i;this.tracksIndex[aboveTrack.id]=i+1;this.refreshTracksDom()}else{console.log("is at bottom")}},setTrackIndex:function(track,newIndex){if(!this.containsTrack(track)){return false}var oldIndex=this.getTrackIndex(track);this.tracks.splice(oldIndex,1)[0];this.tracks.splice(newIndex,0,track);this._updateTracksIndex();this.refreshTracksDom()},swapTracks:function(t1,t2){if(!this.containsTrack(t1)){return false}if(!this.containsTrack(t2)){return false}var oldIndex1=this.getTrackIndex(t1);var oldIndex2=this.getTrackIndex(t2);this.tracks[oldIndex1]=t2;this.tracks[oldIndex2]=t1;this.tracksIndex[t1.id]=oldIndex2;this.tracksIndex[t2.id]=oldIndex1;this.refreshTracksDom()},scrollToTrack:function(track){if(!this.containsTrack(track)){return false}var y=$(track.div).position().top;$(this.tlTracksDiv).scrollTop(y)},hideTrack:function(track){if(!this.containsTrack(track)){return false}track.hide();this.refreshTracksDom()},showTrack:function(track){if(!this.containsTrack(track)){return false}track.show();this.refreshTracksDom()},_setPixelBase:function(){this.pixelBase=this.width/this.region.length();this.pixelBase=this.pixelBase/this.zoomMultiplier;this.halfVirtualBase=this.width*3/2/this.pixelBase},_setTextPosition:function(){var centerPosition=this.region.center();var baseLength=parseInt(this.width/this.pixelBase);var aux=Math.ceil(baseLength/2-1);this.visualRegion.start=Math.floor(centerPosition-aux);this.visualRegion.end=Math.floor(centerPosition+aux);this.positionMidPosDiv.textContent=Utils.formatNumber(centerPosition);this.positionLeftDiv.textContent=Utils.formatNumber(this.visualRegion.start);this.positionRightDiv.textContent=Utils.formatNumber(this.visualRegion.end);this.windowSize="Window size: "+Utils.formatNumber(this.visualRegion.length())+" nts";this.windowSizeDiv.innerHTML=this.windowSize},getTrackById:function(trackId){if(typeof this.tracksIndex[trackId]!=="undefined"){var i=this.tracksIndex[trackId];return this.tracks[i]}},getSequenceTrack:function(){for(var i=0;i<this.tracks.length;i++){var track=this.tracks[i];if(track.renderer instanceof SequenceRenderer){return track}}return},getMousePosition:function(position){var base="";if(position>0){base=this.getSequenceNucleotid(position)}return base},getSequenceNucleotid:function(position){var seqTrack=this.getSequenceTrack();if(seqTrack){var el=seqTrack.svgCanvasFeatures.querySelector('text[data-pos="'+position+'"]');if(el){return el.textContent}}return""},setNucleotidPosition:function(position){var base=this.getSequenceNucleotid(position);this.positionNucleotidDiv.style.color=SEQUENCE_COLORS[base];this.positionNucleotidDiv.textContent=base},setCellBaseHost:function(host){this.cellBaseHost=host;for(var i=0;i<this.tracks.length;i++){var track=this.tracks[i];if(track.dataAdapter instanceof CellBaseAdapter){track.dataAdapter.setHost(this.cellBaseHost)}}}};function Track(args){this.id=Utils.genId("track");this.dataAdapter;this.renderer;this.resizable=true;this.autoHeight=false;this.targetId;this.title;this.minHistogramRegionSize=3e8;this.maxLabelRegionSize=3e8;this.width=200;this.height=100;this.visibleRegionSize;this.visible=true;this.contentVisible=true;this.closable=false;this.fontClass="ocb-font-roboto ocb-font-size-14";this.externalLink="";_.extend(this,args);this.pixelBase;this.svgCanvasWidth=5e5;this.pixelPosition=this.svgCanvasWidth/2;this.svgCanvasOffset;this.status;this.histogram;this.histogramLogarithm;this.histogramMax;this.interval;this.svgCanvasLeftLimit;this.svgCanvasRightLimit;this.invalidZoomText;this.renderedArea={};this.chunksDisplayed={};if("handlers"in this){for(eventName in this.handlers){this.on(eventName,this.handlers[eventName])}}this.rendered=false;if(this.autoRender){this.render()}}Track.prototype={get:function(attr){return this[attr]},set:function(attr,value){this[attr]=value},hide:function(){this.visible=false;this.div.classList.add("hidden")},show:function(){this.visible=true;this.div.classList.remove("hidden");this.updateHeight()},toggle:function(){if(this.visible){this.hide()}else{this.show()}},remove:function(){$(this.div).remove()},hideContent:function(){this.contentVisible=false;this.contentDiv.classList.add("hidden");this.resizeDiv.classList.add("hidden");this.iToggleEl.classList.remove("fa-minus");this.iToggleEl.classList.add("fa-plus")},showContent:function(){this.contentVisible=true;this.contentDiv.classList.remove("hidden");this.resizeDiv.classList.remove("hidden");this.iToggleEl.classList.remove("fa-plus");this.iToggleEl.classList.add("fa-minus");this.updateHeight()},toggleContent:function(){if(this.contentVisible){this.hideContent()}else{this.showContent()}},close:function(){this.trigger("track:close",{sender:this})},up:function(){this.trigger("track:up",{sender:this})},down:function(){this.trigger("track:down",{sender:this})},setSpecies:function(species){this.species=species;this.dataAdapter.setSpecies(this.species)},setWidth:function(width){this._setWidth(width)},_setWidth:function(width){this.width=width},updateHeight:function(){this._updateHeight()},_updateHeight:function(){$(this.contentDiv).css({height:this.height+10})},enableAutoHeight:function(){console.log("enable autoHeigth");this.autoHeight=true;this.updateHeight()},disableAutoHeight:function(){console.log("disable autoHeigth");this.autoHeight=false;this.updateHeight()},toggleAutoHeight:function(bool){if(bool==true){this.enableAutoHeight();return}else if(bool==false){this.disableAutoHeight();return}if(this.autoHeight==true){this.disableAutoHeight();return}else if(this.autoHeight==false){this.enableAutoHeight();return}},setTitle:function(title){$(this.titleText).html(title)},setLoading:function(bool){if(bool){this.status="rendering";$(this.loadingEl).html('&nbsp; &nbsp;<i class="fa fa-spinner fa-spin"></i> Loading...</span>')}else{this.status="ready";$(this.loadingEl).html("")}},updateHistogramParams:function(){if(this.region.length()>this.minHistogramRegionSize){this.histogram=true;this.histogramLogarithm=true;this.histogramMax=500;this.interval=Math.ceil(10/this.pixelBase);$(this.histogramEl).html('&nbsp;<i class="fa fa-signal"></i>')}else{this.histogram=undefined;this.histogramLogarithm=undefined;this.histogramMax=undefined;this.interval=undefined;$(this.histogramEl).html("")}},clean:function(){this._clean()},_clean:function(){this.chunksDisplayed={};this.renderedArea={}},initializeDom:function(targetId){this._initializeDom(targetId)},_initializeDom:function(targetId){var _this=this;var div=$('<div id="'+this.id+'-div"></div>')[0];div.classList.add("ocb-gv-track");var titleBarHtml="";titleBarHtml+='   <div class="ocb-gv-track-title">';titleBarHtml+='   <div class="ocb-gv-track-title-el">';titleBarHtml+='       <span class="ocb-gv-track-title-text">'+this.title+"</span>";titleBarHtml+='       <span class="ocb-gv-track-title-histogram"></span>';titleBarHtml+='       <span class="ocb-gv-track-title-toggle"><i class="fa fa-minus"></i></span>';titleBarHtml+='       <span class="ocb-gv-track-title-down"><i class="fa fa-chevron-down"></i></span>';titleBarHtml+='       <span class="ocb-gv-track-title-up"><i class="fa fa-chevron-up"></i></span>';if(this.closable==true){titleBarHtml+='       <span class="ocb-gv-track-title-close"><i class="fa fa-times"></i></span>'}if(this.externalLink!==""){titleBarHtml+='       <span class="ocb-gv-track-title-external-link"><i class="fa fa-external-link"></i></span>'}titleBarHtml+='       <span class="ocb-gv-track-title-loading"></span>';titleBarHtml+="   </div>";titleBarHtml+="   </div>";var titleBardiv=$(titleBarHtml)[0];if(typeof this.title==="undefined"){$(titleBardiv).addClass("hidden")}var titlediv=titleBardiv.querySelector(".ocb-gv-track-title");this.titleEl=titleBardiv.querySelector(".ocb-gv-track-title-el");this.titleText=titleBardiv.querySelector(".ocb-gv-track-title-text");this.histogramEl=titleBardiv.querySelector(".ocb-gv-track-title-histogram");this.toggleEl=titleBardiv.querySelector(".ocb-gv-track-title-toggle");this.iToggleEl=this.toggleEl.querySelector("i");this.loadingEl=titleBardiv.querySelector(".ocb-gv-track-title-loading");this.closeEl=titleBardiv.querySelector(".ocb-gv-track-title-close");this.upEl=titleBardiv.querySelector(".ocb-gv-track-title-up");this.downEl=titleBardiv.querySelector(".ocb-gv-track-title-down");this.externalLinkEl=titleBardiv.querySelector(".ocb-gv-track-title-external-link");var contentDiv=$('<div id="'+this.id+'-svgdiv"></div>')[0];$(contentDiv).css({position:"relative","box-sizing":"boder-box","z-index":3,height:this.height,"overflow-y":this.resizable?"auto":"hidden","overflow-x":"hidden"});var resizediv=$('<div id="'+this.id+'-resizediv" class="ocb-track-resize"></div>')[0];$(targetId).addClass("unselectable");$(targetId).append(div);$(div).append(titleBardiv);$(div).append(contentDiv);$(div).append(resizediv);$(titleBardiv).css({padding:"4px"}).on("dblclick",function(e){e.stopPropagation()});$(this.toggleEl).click(function(e){_this.toggleContent()});$(this.closeEl).click(function(e){_this.close()});$(this.upEl).click(function(e){_this.up()});$(this.downEl).click(function(e){_this.down()});$(this.externalLinkEl).click(function(e){window.open(_this.externalLink)});if(this.resizable){$(resizediv).mousedown(function(event){$("html").addClass("unselectable");event.stopPropagation();var downY=event.clientY;$("html").bind("mousemove.genomeViewer",function(event){var despY=event.clientY-downY;var actualHeight=$(contentDiv).outerHeight();var newHeight=actualHeight+despY;if(newHeight>0){_this.height=newHeight;$(contentDiv).css({height:_this.height})}downY=event.clientY})});$("html").bind("mouseup.genomeViewer",function(event){$("html").removeClass("unselectable");$("html").off("mousemove.genomeViewer")});$(contentDiv).closest(".trackListPanels").mouseup(function(event){_this.updateHeight()})}this.div=div;this.contentDiv=contentDiv;this.titlediv=titlediv;this.resizeDiv=resizediv;this.rendered=true;this.status="ready"},_drawHistogramLegend:function(){var histogramHeight=this.histogramRenderer.histogramHeight;var multiplier=this.histogramRenderer.multiplier;this.histogramGroup=SVG.addChild(this.svgGroup,"g",{class:"histogramGroup",visibility:"hidden"});var text=SVG.addChild(this.histogramGroup,"text",{x:21,y:histogramHeight+4,"font-size":12,opacity:"0.9",fill:"orangered",class:this.fontClass});text.textContent="0-";var text=SVG.addChild(this.histogramGroup,"text",{x:14,y:histogramHeight+4-Math.log(10)*multiplier,"font-size":12,opacity:"0.9",fill:"orangered",class:this.fontClass});text.textContent="10-";var text=SVG.addChild(this.histogramGroup,"text",{x:7,y:histogramHeight+4-Math.log(100)*multiplier,"font-size":12,opacity:"0.9",fill:"orangered",class:this.fontClass});text.textContent="100-";var text=SVG.addChild(this.histogramGroup,"text",{x:0,y:histogramHeight+4-Math.log(1e3)*multiplier,"font-size":12,opacity:"0.9",fill:"orangered",class:this.fontClass});text.textContent="1000-"},draw:function(){},getFeaturesToRenderByChunk:function(response,filters){var getChunkId=function(position){return Math.floor(position/response.chunkSize)};var getChunkKey=function(chromosome,chunkId){return chromosome+":"+chunkId+"_"+response.dataType+"_"+response.chunkSize};var chunks=response.items;var features=[];var feature,displayed,featureFirstChunk,featureLastChunk,features=[];for(var i=0,leni=chunks.length;i<leni;i++){if(this.chunksDisplayed[chunks[i].chunkKey]!=true){for(var j=0,lenj=chunks[i].value.length;j<lenj;j++){feature=chunks[i].value[j];displayed=false;featureFirstChunk=getChunkId(feature.start);featureLastChunk=getChunkId(feature.end);for(var chunkId=featureFirstChunk;chunkId<=featureLastChunk;chunkId++){var chunkKey=getChunkKey(feature.chromosome,chunkId);if(this.chunksDisplayed[chunkKey]==true){displayed=true;break}}if(!displayed){features.push(feature)}}this.chunksDisplayed[chunks[i].chunkKey]=true}}return features}};FeatureTrack.prototype=new Track({});function FeatureTrack(args){Track.call(this,args);_.extend(this,Backbone.Events);this.defaultRenderer=this.renderer;this.histogramRenderer=new HistogramRenderer(args);this.featureType="Feature";_.extend(this,args);this.resource=this.dataAdapter.resource;this.species=this.dataAdapter.species;this.dataType="features"}FeatureTrack.prototype.clean=function(){this._clean();while(this.svgCanvasFeatures.firstChild){this.svgCanvasFeatures.removeChild(this.svgCanvasFeatures.firstChild)}};FeatureTrack.prototype.updateHeight=function(){if(this.histogram){this.contentDiv.style.height=this.histogramRenderer.histogramHeight+5+"px";this.main.setAttribute("height",this.histogramRenderer.histogramHeight);return}var renderedHeight=this.svgCanvasFeatures.getBoundingClientRect().height;this.main.setAttribute("height",renderedHeight);if(this.resizable){if(this.autoHeight==false){this.contentDiv.style.height=this.height+10+"px"}else if(this.autoHeight==true){var x=this.pixelPosition;var width=this.width;var lastContains=0;for(var i in this.renderedArea){if(this.renderedArea[i].contains({start:x,end:x+width})){lastContains=i}}var visibleHeight=parseInt(lastContains)+30;this.contentDiv.style.height=visibleHeight+10+"px";this.main.setAttribute("height",visibleHeight)}}};FeatureTrack.prototype.setWidth=function(width){this._setWidth(width);this.main.setAttribute("width",this.width)};FeatureTrack.prototype.initializeDom=function(targetId){this._initializeDom(targetId);this.main=SVG.addChild(this.contentDiv,"svg",{class:"trackSvg",x:0,y:0,width:this.width});this.svgCanvasFeatures=SVG.addChild(this.main,"svg",{class:"features",x:-this.pixelPosition,width:this.svgCanvasWidth});this.updateHeight()};FeatureTrack.prototype.render=function(targetId){this.initializeDom(targetId);this.svgCanvasOffset=this.width*3/2/this.pixelBase;this.svgCanvasLeftLimit=this.region.start-this.svgCanvasOffset*2;this.svgCanvasRightLimit=this.region.start+this.svgCanvasOffset*2};FeatureTrack.prototype.getDataHandler=function(event){var features;if(event.dataType=="histogram"){this.renderer=this.histogramRenderer;features=event.items}else{this.renderer=this.defaultRenderer;features=this.getFeaturesToRenderByChunk(event)}this.renderer.render(features,{cacheItems:event.items,svgCanvasFeatures:this.svgCanvasFeatures,featureTypes:this.featureTypes,renderedArea:this.renderedArea,pixelBase:this.pixelBase,position:this.region.center(),regionSize:this.region.length(),maxLabelRegionSize:this.maxLabelRegionSize,width:this.width,pixelPosition:this.pixelPosition,resource:this.resource,species:this.species,featureType:this.featureType});this.updateHeight()};FeatureTrack.prototype.draw=function(){var _this=this;this.svgCanvasOffset=this.width*3/2/this.pixelBase;this.svgCanvasLeftLimit=this.region.start-this.svgCanvasOffset*2;this.svgCanvasRightLimit=this.region.start+this.svgCanvasOffset*2;this.updateHistogramParams();this.clean();this.dataType="features";if(this.histogram){this.dataType="histogram"}if(typeof this.visibleRegionSize==="undefined"||this.region.length()<this.visibleRegionSize){this.setLoading(true);this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:this.region.chromosome,start:this.region.start-this.svgCanvasOffset*2,end:this.region.end+this.svgCanvasOffset*2}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(event){_this.getDataHandler(event);_this.setLoading(false)}})}else{}this.updateHeight()};FeatureTrack.prototype.move=function(disp){var _this=this;this.dataType="features";if(this.histogram){this.dataType="histogram"}_this.region.center();var pixelDisplacement=disp*_this.pixelBase;this.pixelPosition-=pixelDisplacement;var move=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+pixelDisplacement;this.svgCanvasFeatures.setAttribute("x",move);var virtualStart=parseInt(this.region.start-this.svgCanvasOffset);var virtualEnd=parseInt(this.region.end+this.svgCanvasOffset);if(typeof this.visibleRegionSize==="undefined"||this.region.length()<this.visibleRegionSize){if(disp>0&&virtualStart<this.svgCanvasLeftLimit){this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:_this.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(event){_this.getDataHandler(event)}});this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)}if(disp<0&&virtualEnd>this.svgCanvasRightLimit){this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:_this.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(event){_this.getDataHandler(event)}});this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}}if(this.autoHeight==true){this.updateHeight()}};GeneTrack.prototype=new Track({});function GeneTrack(args){Track.call(this,args);_.extend(this,Backbone.Events);this.minTranscriptRegionSize;this.defaultRenderer=this.renderer;this.histogramRenderer=new HistogramRenderer(args);_.extend(this,args);this.exclude}GeneTrack.prototype.clean=function(){while(this.svgCanvasFeatures.firstChild){this.svgCanvasFeatures.removeChild(this.svgCanvasFeatures.firstChild)}this._clean()};GeneTrack.prototype.updateHeight=function(){if(this.histogram){this.contentDiv.style.height=this.histogramRenderer.histogramHeight+5+"px";this.main.setAttribute("height",this.histogramRenderer.histogramHeight);return}var renderedHeight=this.svgCanvasFeatures.getBoundingClientRect().height;this.main.setAttribute("height",renderedHeight);if(this.resizable){if(this.autoHeight==false){this.contentDiv.style.height=this.height+10+"px"}else if(this.autoHeight==true){var x=this.pixelPosition;var width=this.width;var lastContains=0;for(var i in this.renderedArea){if(this.renderedArea[i].contains({start:x,end:x+width})){lastContains=i}}var visibleHeight=parseInt(lastContains)+30;this.contentDiv.style.height=visibleHeight+10+"px";this.main.setAttribute("height",visibleHeight)}}};GeneTrack.prototype.setWidth=function(width){this._setWidth(width);this.main.setAttribute("width",this.width)};GeneTrack.prototype.initializeDom=function(targetId){this._initializeDom(targetId);this.main=SVG.addChild(this.contentDiv,"svg",{class:"trackSvg",x:0,y:0,width:this.width});this.svgCanvasFeatures=SVG.addChild(this.main,"svg",{class:"features",x:-this.pixelPosition,width:this.svgCanvasWidth});this.updateHeight()};GeneTrack.prototype.render=function(targetId){this.initializeDom(targetId);this.svgCanvasOffset=this.width*3/2/this.pixelBase;this.svgCanvasLeftLimit=this.region.start-this.svgCanvasOffset*2;this.svgCanvasRightLimit=this.region.start+this.svgCanvasOffset*2};GeneTrack.prototype.getDataHandler=function(event){var features;if(event.dataType=="histogram"){this.renderer=this.histogramRenderer;features=event.items}else{this.renderer=this.defaultRenderer;features=this.getFeaturesToRenderByChunk(event)}this.renderer.render(features,{cacheItems:event.items,svgCanvasFeatures:this.svgCanvasFeatures,renderedArea:this.renderedArea,pixelBase:this.pixelBase,position:this.region.center(),regionSize:this.region.length(),maxLabelRegionSize:this.maxLabelRegionSize,width:this.width,pixelPosition:this.pixelPosition});this.updateHeight()};GeneTrack.prototype.updateTranscriptParams=function(){if(this.region.length()<this.minTranscriptRegionSize){this.exclude=this.dataAdapter.params.exclude}else{this.exclude="transcripts,chunkIds"}};GeneTrack.prototype.draw=function(){var _this=this;this.svgCanvasOffset=this.width*3/2/this.pixelBase;this.svgCanvasLeftLimit=this.region.start-this.svgCanvasOffset*2;this.svgCanvasRightLimit=this.region.start+this.svgCanvasOffset*2;this.updateTranscriptParams();this.updateHistogramParams();this.clean();var dataType="features";if(this.histogram){dataType="histogram"}if(typeof this.visibleRegionSize==="undefined"||this.region.length()<this.visibleRegionSize){this.setLoading(true);var data=this.dataAdapter.getData({dataType:dataType,region:new Region({chromosome:this.region.chromosome,start:this.region.start-this.svgCanvasOffset*2,end:this.region.end+this.svgCanvasOffset*2}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval,exclude:this.exclude},done:function(event){_this.getDataHandler(event);_this.setLoading(false)}})}else{}this.updateHeight()};GeneTrack.prototype.move=function(disp){var _this=this;this.dataType="features";if(!_.isUndefined(this.exclude)){dataType="features"+this.exclude}if(this.histogram){this.dataType="histogram"}_this.region.center();var pixelDisplacement=disp*_this.pixelBase;this.pixelPosition-=pixelDisplacement;var move=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+pixelDisplacement;this.svgCanvasFeatures.setAttribute("x",move);var virtualStart=parseInt(this.region.start-this.svgCanvasOffset);var virtualEnd=parseInt(this.region.end+this.svgCanvasOffset);if(typeof this.visibleRegionSize==="undefined"||this.region.length()<this.visibleRegionSize){if(disp>0&&virtualStart<this.svgCanvasLeftLimit){this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:_this.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval,exclude:this.exclude},done:function(event){_this.getDataHandler(event)}});this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)}if(disp<0&&virtualEnd>this.svgCanvasRightLimit){this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:_this.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval,exclude:this.exclude},done:function(event){_this.getDataHandler(event)}});this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}}if(this.autoHeight==true){this.updateHeight()}};AlignmentTrack.prototype=new Track({});function AlignmentTrack(args){Track.call(this,args);_.extend(this,Backbone.Events);this.defaultRenderer=this.renderer;this.histogramRenderer=new HistogramRenderer;this.dataType="features";_.extend(this,args)}AlignmentTrack.prototype.clean=function(){this._clean();while(this.svgCanvasFeatures.firstChild){this.svgCanvasFeatures.removeChild(this.svgCanvasFeatures.firstChild)}};AlignmentTrack.prototype.updateHeight=function(){var renderedHeight=this.svgCanvasFeatures.getBoundingClientRect().height;this.main.setAttribute("height",renderedHeight)};AlignmentTrack.prototype.setWidth=function(width){this._setWidth(width);this.main.setAttribute("width",this.width)};AlignmentTrack.prototype.initializeDom=function(targetId){this._initializeDom(targetId);this.main=SVG.addChild(this.contentDiv,"svg",{class:"trackSvg",x:0,y:0,width:this.width});this.svgCanvasFeatures=SVG.addChild(this.main,"svg",{class:"features",x:-this.pixelPosition,width:this.svgCanvasWidth});this.updateHeight()};AlignmentTrack.prototype.render=function(targetId){this.initializeDom(targetId);this.svgCanvasOffset=this.width*3/2/this.pixelBase;this.svgCanvasLeftLimit=this.region.start-this.svgCanvasOffset*2;this.svgCanvasRightLimit=this.region.start+this.svgCanvasOffset*2};AlignmentTrack.prototype.getDataHandler=function(event){var features;if(event.dataType=="histogram"){this.renderer=this.histogramRenderer;features=event.items}else{this.renderer=this.defaultRenderer;features=this._removeDisplayedChunks(event)}this.renderer.render(features,{cacheItems:event.items,svgCanvasFeatures:this.svgCanvasFeatures,featureTypes:this.featureTypes,renderedArea:this.renderedArea,pixelBase:this.pixelBase,position:this.region.center(),regionSize:this.region.length(),maxLabelRegionSize:this.maxLabelRegionSize,width:this.width,pixelPosition:this.pixelPosition,region:this.region,trackListPanel:this.trackListPanel});this.updateHeight()};AlignmentTrack.prototype.draw=function(){var _this=this;this.svgCanvasOffset=this.width*3/2/this.pixelBase;this.svgCanvasLeftLimit=this.region.start-this.svgCanvasOffset*2;this.svgCanvasRightLimit=this.region.start+this.svgCanvasOffset*2;this.updateHistogramParams();this.clean();this.dataType="features";if(this.histogram){this.dataType="histogram"}if(typeof this.visibleRegionSize==="undefined"||this.region.length()<this.visibleRegionSize){this.setLoading(true);this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:this.region.chromosome,start:this.region.start-this.svgCanvasOffset*2,end:this.region.end+this.svgCanvasOffset*2}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(event){_this.getDataHandler(event);_this.setLoading(false)}})}else{}_this.updateHeight()};AlignmentTrack.prototype.move=function(disp){var _this=this;this.dataType="features";if(this.histogram){this.dataType="histogram"}_this.region.center();var pixelDisplacement=disp*_this.pixelBase;this.pixelPosition-=pixelDisplacement;var move=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+pixelDisplacement;this.svgCanvasFeatures.setAttribute("x",move);var virtualStart=parseInt(this.region.start-this.svgCanvasOffset);var virtualEnd=parseInt(this.region.end+this.svgCanvasOffset);if(typeof this.visibleRegionSize==="undefined"||this.region.length()<this.visibleRegionSize){if(disp>0&&virtualStart<this.svgCanvasLeftLimit){this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:_this.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(event){_this.getDataHandler(event)}})
;this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)}if(disp<0&&virtualEnd>this.svgCanvasRightLimit){this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:_this.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(event){_this.getDataHandler(event)}});this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}}};AlignmentTrack.prototype._removeDisplayedChunks=function(response){var getChunkId=function(position){return Math.floor(position/response.chunkSize)};var getChunkKey=function(chromosome,chunkId){return chromosome+":"+chunkId+"_"+response.dataType+"_"+response.chunkSize};var chunks=response.items;var newChunks=[];var feature,displayed,featureFirstChunk,featureLastChunk,features=[];for(var i=0,leni=chunks.length;i<leni;i++){if(this.chunksDisplayed[chunks[i].chunkKey]!=true){features=[];for(var j=0,lenj=chunks[i].value.alignments.length;j<lenj;j++){feature=chunks[i].value.alignments[j];displayed=false;featureFirstChunk=getChunkId(feature.start);featureLastChunk=getChunkId(feature.end);for(var chunkId=featureFirstChunk;chunkId<=featureLastChunk;chunkId++){var chunkKey=getChunkKey(feature.chromosome,chunkId);if(this.chunksDisplayed[chunkKey]==true){displayed=true;break}}if(!displayed){features.push(feature)}}this.chunksDisplayed[chunks[i].chunkKey]=true;chunks[i].value.alignments=features;newChunks.push(chunks[i])}}response.items=newChunks;return response};function Renderer(args){}Renderer.prototype={render:function(items){},getFeatureX:function(start,args){var middle=args.width/2;var x=args.pixelPosition+middle-(args.position-start)*args.pixelBase;return x},getDefaultConfig:function(type){return FEATURE_TYPES[type]},getLabelWidth:function(label,args){var svgLabel=SVG.create("text",{"font-weight":400,class:this.fontClass});svgLabel.textContent=label;$(args.svgCanvasFeatures).append(svgLabel);var svgLabelWidth=$(svgLabel).width();$(svgLabel).remove();return svgLabelWidth}};FeatureRenderer.prototype=new Renderer({});function FeatureRenderer(args){Renderer.call(this,args);_.extend(this,Backbone.Events);this.fontClass="ocb-font-roboto ocb-font-size-11";this.toolTipfontClass="ocb-tooltip-font";if(args==null){args=FEATURE_TYPES.undefined}if(_.isObject(args)){_.extend(this,args)}this.on(this.handlers)}FeatureRenderer.prototype.render=function(features,args){var _this=this;var draw=function(feature,svgGroup){if("featureType"in feature){_.extend(_this,FEATURE_TYPES[feature.featureType])}if("featureClass"in feature){_.extend(_this,FEATURE_TYPES[feature.featureClass])}if(args.featureType=="clinical"){if("clinvarSet"in feature){_.extend(_this,FEATURE_TYPES["Clinvar"])}else if("mutationID"in feature){_.extend(_this,FEATURE_TYPES["Cosmic"])}else{_.extend(_this,FEATURE_TYPES["GWAS"])}}var color=_.isFunction(_this.color)?_this.color(feature):_this.color;var label=_.isFunction(_this.label)?_this.label(feature):_this.label;var height=_.isFunction(_this.height)?_this.height(feature):_this.height;var tooltipTitle=_.isFunction(_this.tooltipTitle)?_this.tooltipTitle(feature):_this.tooltipTitle;var tooltipText=_.isFunction(_this.tooltipText)?_this.tooltipText(feature):_this.tooltipText;var infoWidgetId=_.isFunction(_this.infoWidgetId)?_this.infoWidgetId(feature):_this.infoWidgetId;var start=feature.start;var end=feature.end;var length=end-start+1;length=length<0?Math.abs(length):length;length=length==0?1:length;var width=length*args.pixelBase;var svgLabelWidth=label.length*6.4;var x=_this.getFeatureX(start,args);var maxWidth=Math.max(width,2);var textHeight=0;if(args.maxLabelRegionSize>args.regionSize){textHeight=9;maxWidth=Math.max(width,svgLabelWidth)}var rowY=0;var textY=textHeight+height;var rowHeight=textHeight+height+2;while(true){if(!(rowY in args.renderedArea)){args.renderedArea[rowY]=new FeatureBinarySearchTree}var foundArea=args.renderedArea[rowY].add({start:x,end:x+maxWidth-1});if(foundArea){var featureGroup=SVG.addChild(svgGroup,"g",{feature_id:feature.id});var rect=SVG.addChild(featureGroup,"rect",{x:x,y:rowY,width:width,height:height,stroke:"#3B0B0B","stroke-width":1,"stroke-opacity":.7,fill:color,cursor:"pointer"});if(args.maxLabelRegionSize>args.regionSize){var text=SVG.addChild(featureGroup,"text",{i:i,x:x,y:textY,"font-weight":400,opacity:null,fill:"black",cursor:"pointer",class:_this.fontClass});text.textContent=label}if("tooltipText"in _this){$(featureGroup).qtip({content:{text:tooltipText,title:tooltipTitle},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:true,classes:_this.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}})}$(featureGroup).mouseover(function(event){_this.trigger("feature:mouseover",{query:feature[infoWidgetId],feature:feature,featureType:feature.featureType,mouseoverEvent:event})});$(featureGroup).click(function(event){_this.trigger("feature:click",{query:feature[infoWidgetId],feature:feature,featureType:feature.featureType,clickEvent:event})});break}rowY+=rowHeight;textY+=rowHeight}};var timeId="write dom "+Utils.randomString(4);console.time(timeId);console.log(features.length);var svgGroup=SVG.create("g");for(var i=0,leni=features.length;i<leni;i++){draw(features[i],svgGroup)}args.svgCanvasFeatures.appendChild(svgGroup);console.timeEnd(timeId)};SequenceRenderer.prototype=new Renderer({});function SequenceRenderer(args){Renderer.call(this,args);_.extend(this,Backbone.Events);this.fontClass="ocb-font-ubuntumono ocb-font-size-16";this.toolTipfontClass="ocb-tooltip-font";_.extend(this,args)}SequenceRenderer.prototype.render=function(chunks,args){for(var i=0;i<chunks.length;i++){this._paintSequenceChunk(chunks[i],args)}};SequenceRenderer.prototype._paintSequenceChunk=function(chunk,args){var timeId=new Region(chunk).toString();console.time("Sequence render "+timeId);var middle=args.width/2;var start=chunk.start;var seqStart=chunk.start;var seqString=chunk.sequence;for(var i=0;i<seqString.length;i++){var x=args.pixelPosition+middle-(args.position-start)*args.pixelBase;var text=SVG.addChild(args.svgCanvasFeatures,"text",{x:x+1,y:12,fill:SEQUENCE_COLORS[seqString.charAt(i)],"data-pos":start,class:this.fontClass});start++;text.textContent=seqString.charAt(i);$(text).qtip({content:seqString.charAt(i)+" "+(seqStart+i).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),position:{target:"mouse",adjust:{x:25,y:15}},style:{width:true,classes:this.toolTipfontClass+" qtip-light qtip-shadow"},show:{delay:300},hide:{delay:300}})}console.timeEnd("Sequence render "+timeId)};ConservedRenderer.prototype=new Renderer({});function ConservedRenderer(args){Renderer.call(this,args);_.extend(this,Backbone.Events);_.extend(this,args)}ConservedRenderer.prototype.render=function(chunks,args){for(var i=0;i<chunks.length;i++){this._paintChunk(chunks[i],args)}};ConservedRenderer.prototype._paintChunk=function(chunk,args){var middle=args.width/2;var multiplier=15;var histogramHeight=75;var points="";var width=args.pixelBase;var x=args.pixelPosition+middle-(args.position-parseInt(chunk.start))*args.pixelBase;for(var i=0,len=chunk.values.length;i<len;i++){var value=chunk.values[i];var height=value*multiplier;var s=chunk.start+i;var x=args.pixelPosition+middle-(args.position-s)*args.pixelBase;points+=x+","+0+" ";points+=x+","+(histogramHeight-height)+" ";points+=x+width+","+(histogramHeight-height)+" ";points+=x+width+","+0+" "}var pol=SVG.addChild(args.svgCanvasFeatures,"polyline",{points:points,stroke:"#000000","stroke-width":.2,fill:"salmon",cursor:"pointer"})};FeatureClusterRenderer.prototype=new Renderer({});function FeatureClusterRenderer(args){Renderer.call(this,args);_.extend(this,Backbone.Events);this.histogramHeight=75;this.multiplier=7;this.fontClass="ocb-font-roboto ocb-font-size-11";this.toolTipfontClass="ocb-tooltip-font";_.extend(this,args)}FeatureClusterRenderer.prototype.render=function(features,args){var _this=this;var middle=args.width/2;var maxValue=0;var drawFeature=function(feature){var d="";feature.start=parseInt(feature.start);feature.end=parseInt(feature.end);var width=feature.end-feature.start;width=width*args.pixelBase;var x=_this.getFeatureX(feature.start,args);if(feature.features_count==null){if(feature.absolute!=0){feature.features_count=Math.log(features[i].absolute)}else{feature.features_count=0}}var height=feature.features_count*_this.multiplier;var rect=SVG.addChild(args.svgCanvasFeatures,"rect",{x:x+1,y:0,width:width-1,height:height,stroke:"smokewhite","stroke-width":1,fill:"#9493b1",cursor:"pointer"});var getInfo=function(feature){var resp="";return resp+=Math.round(Math.exp(feature.features_count))};var url=CellBaseManager.url({species:args.species,category:"genomic",subCategory:"region",query:new Region(feature).toString(),resource:args.resource,params:{include:"chromosome,start,end,id",limit:20},async:false});$(rect).qtip({content:{text:"Loading...",ajax:{url:url,type:"GET",success:function(data,status){var items=data.response[0].result;var ids="";for(var i=0;i<items.length;i++){var f=items[i];var r=new Region(f);ids+='<span class="emph">'+f.id+'</span> <span class="info">'+r.toString()+"</span><br>"}var fc=Math.round(Math.exp(feature.features_count));if(fc<=20){this.set("content.title","Count: "+items.length);this.set("content.text",ids)}else{this.set("content.title","Count: "+fc);this.set("content.text",ids+"...")}}}},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:true,classes:_this.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}})};for(var i=0,len=features.length;i<len;i++){drawFeature(features[i].value)}};HistogramRenderer.prototype=new Renderer({});function HistogramRenderer(args){Renderer.call(this,args);_.extend(this,Backbone.Events);this.histogramHeight=75;this.maxValue=10;this.updateScale(args);_.extend(this,args)}HistogramRenderer.prototype._checkFeatureValue=function(feature){if(feature.features_count==null){if(feature.absolute!=0&&feature.absolute>0){feature.features_count=Math.max(.2,Math.log(feature.absolute))}else{feature.features_count=0}}};HistogramRenderer.prototype.updateScale=function(args){if(args!=null){if(args.height!=null){this.histogramHeight=args.height*.95}if(args.histogramMaxFreqValue!=null){this.maxValue=args.histogramMaxFreqValue}}this.multiplier=this.histogramHeight/this.maxValue};HistogramRenderer.prototype.render=function(features,args){features.sort(function(a,b){return a.value.start-b.value.start});var middle=args.width/2;var points="";this.updateScale(args);if(features.length>0){var firstFeature=features[0].value;var width=(firstFeature.end-firstFeature.start+1)*args.pixelBase;var x=args.pixelPosition+middle-(args.position-parseInt(firstFeature.start))*args.pixelBase;this._checkFeatureValue(firstFeature);var height=firstFeature.features_count*this.multiplier;points=(x-width/2).toFixed(1)+","+this.histogramHeight.toFixed(1)+" ";points+=(x-width/2).toFixed(1)+","+(this.histogramHeight-height).toFixed(1)+" "}for(var i=0,len=features.length;i<len;i++){var feature=features[i].value;feature.start=parseInt(feature.start);feature.end=parseInt(feature.end);var width=(feature.end-feature.start+1)*args.pixelBase;var x=args.pixelPosition+middle-(args.position-feature.start)*args.pixelBase;this._checkFeatureValue(feature);var height=feature.features_count*this.multiplier;points+=(x+width/2).toFixed(1)+","+(this.histogramHeight-height).toFixed(1)+" "}if(features.length>0){var lastFeature=features[features.length-1].value;var width=(lastFeature.end-lastFeature.start+1)*args.pixelBase;var x=args.pixelPosition+middle-(args.position-parseInt(lastFeature.start))*args.pixelBase;this._checkFeatureValue(lastFeature);var height=lastFeature.features_count*this.multiplier;points+=(x+width).toFixed(1)+","+(this.histogramHeight-height).toFixed(1)+" ";points+=(x+width).toFixed(1)+","+this.histogramHeight.toFixed(1)+" "}if(points!==""){SVG.addChild(args.svgCanvasFeatures,"polyline",{points:points,fill:"#428bca",cursor:"pointer"})}};GeneRenderer.prototype=new Renderer({});function GeneRenderer(args){Renderer.call(this,args);_.extend(this,Backbone.Events);this.fontClass="ocb-font-roboto ocb-font-size-11";this.toolTipfontClass="ocb-tooltip-font";if(_.isObject(args)){_.extend(this,args)}this.on(this.handlers)}GeneRenderer.prototype.setFeatureConfig=function(configObject){_.extend(this,configObject)};GeneRenderer.prototype.render=function(features,args){var _this=this;var draw=function(feature){_this.setFeatureConfig(FEATURE_TYPES.gene);var color=_.isFunction(_this.color)?_this.color(feature):_this.color;var label=_.isFunction(_this.label)?_this.label(feature):_this.label;var height=_.isFunction(_this.height)?_this.height(feature):_this.height;var tooltipTitle=_.isFunction(_this.tooltipTitle)?_this.tooltipTitle(feature):_this.tooltipTitle;var tooltipText=_.isFunction(_this.tooltipText)?_this.tooltipText(feature):_this.tooltipText;var infoWidgetId=_.isFunction(_this.infoWidgetId)?_this.infoWidgetId(feature):_this.infoWidgetId;var start=feature.start;var end=feature.end;var length=end-start+1;var width=length*args.pixelBase;var svgLabelWidth=label.length*6.4;var x=_this.getFeatureX(start,args);var maxWidth=Math.max(width,2);var textHeight=0;if(args.maxLabelRegionSize>args.regionSize){textHeight=9;maxWidth=Math.max(width,svgLabelWidth)}var rowY=0;var textY=textHeight+height+1;var rowHeight=textHeight+height+5;while(true){if(!(rowY in args.renderedArea)){args.renderedArea[rowY]=new FeatureBinarySearchTree}var foundArea;var checkRowY=rowY;var foundTranscriptsArea=true;if(!_.isEmpty(feature.transcripts)){for(var i=0,leni=feature.transcripts.length+1;i<leni;i++){if(!(checkRowY in args.renderedArea)){args.renderedArea[checkRowY]=new FeatureBinarySearchTree}if(args.renderedArea[checkRowY].contains({start:x,end:x+maxWidth-1})){foundTranscriptsArea=false;break}checkRowY+=rowHeight}if(foundTranscriptsArea==true){foundArea=args.renderedArea[rowY].add({start:x,end:x+maxWidth-1})}}else{foundArea=args.renderedArea[rowY].add({start:x,end:x+maxWidth-1})}if(foundArea){var featureGroup=SVG.addChild(args.svgCanvasFeatures,"g",{feature_id:feature.id});var rect=SVG.addChild(featureGroup,"rect",{x:x,y:rowY,width:width,height:height,stroke:"#3B0B0B","stroke-width":.5,fill:color,cursor:"pointer"});if(args.maxLabelRegionSize>args.regionSize){var text=SVG.addChild(featureGroup,"text",{i:i,x:x,y:textY,fill:"black",cursor:"pointer",class:_this.fontClass});text.textContent=label}$(featureGroup).qtip({content:{text:tooltipText,title:tooltipTitle},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:true,classes:_this.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}});featureGroup.addEventListener("click",function(e){_this.trigger("feature:click",{query:feature[infoWidgetId],feature:feature,featureType:"gene",clickEvent:e})});var checkRowY=rowY+rowHeight;var checkTextY=textY+rowHeight;if(!_.isEmpty(feature.transcripts)){for(var i=0,leni=feature.transcripts.length;i<leni;i++){if(!(checkRowY in args.renderedArea)){args.renderedArea[checkRowY]=new FeatureBinarySearchTree}var transcript=feature.transcripts[i];var transcriptX=_this.getFeatureX(transcript.start,args);var transcriptWidth=(transcript.end-transcript.start+1)*args.pixelBase;_this.setFeatureConfig(FEATURE_TYPES.transcript);var transcriptColor=_.isFunction(_this.color)?_this.color(transcript):_this.color;var label=_.isFunction(_this.label)?_this.label(transcript):_this.label;var height=_.isFunction(_this.height)?_this.height(transcript):_this.height;var tooltipTitle=_.isFunction(_this.tooltipTitle)?_this.tooltipTitle(transcript):_this.tooltipTitle;var tooltipText=_.isFunction(_this.tooltipText)?_this.tooltipText(transcript):_this.tooltipText;var infoWidgetId=_.isFunction(_this.infoWidgetId)?_this.infoWidgetId(transcript):_this.infoWidgetId;var svgLabelWidth=label.length*6.4;var maxWidth=Math.max(width,width-(feature.end-transcript.start)*args.pixelBase+svgLabelWidth);args.renderedArea[checkRowY].add({start:x,end:x+maxWidth-1});var transcriptGroup=SVG.addChild(args.svgCanvasFeatures,"g",{"data-widget-id":transcript[infoWidgetId],"data-transcript-idx":i});var rect=SVG.addChild(transcriptGroup,"rect",{x:transcriptX,y:checkRowY+1,width:transcriptWidth,height:height,fill:"gray",cursor:"pointer",feature_id:transcript.id});var text=SVG.addChild(transcriptGroup,"text",{x:transcriptX,y:checkTextY,fill:"black",cursor:"pointer",class:_this.fontClass});text.textContent=label;$(transcriptGroup).qtip({content:{text:tooltipText,title:tooltipTitle},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:true,classes:_this.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}});transcriptGroup.addEventListener("click",function(e){var query=this.getAttribute("data-widget-id");var idx=this.getAttribute("data-transcript-idx");_this.trigger("feature:click",{query:query,feature:feature.transcripts[idx],featureType:"transcript",clickEvent:event})});for(var e=0,lene=feature.transcripts[i].exons.length;e<lene;e++){var exon=feature.transcripts[i].exons[e];var exonStart=parseInt(exon.start);var exonEnd=parseInt(exon.end);var middle=args.width/2;var exonX=args.pixelPosition+middle-(args.position-exonStart)*args.pixelBase;var exonWidth=(exonEnd-exonStart+1)*args.pixelBase;_this.setFeatureConfig(FEATURE_TYPES.exon);var color=_.isFunction(_this.color)?_this.color(exon):_this.color;var label=_.isFunction(_this.label)?_this.label(exon):_this.label;var height=_.isFunction(_this.height)?_this.height(exon):_this.height;var tooltipTitle=_.isFunction(_this.tooltipTitle)?_this.tooltipTitle(exon):_this.tooltipTitle;var tooltipText=_.isFunction(_this.tooltipText)?_this.tooltipText(exon,transcript):_this.tooltipText;var infoWidgetId=_.isFunction(_this.infoWidgetId)?_this.infoWidgetId(exon):_this.infoWidgetId;var exonGroup=SVG.addChild(args.svgCanvasFeatures,"g",{class:"ocb-coding","data-id":exon.id});$(exonGroup).qtip({content:{text:tooltipText,title:tooltipTitle},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:true,classes:_this.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}});exonGroup.addEventListener("click",function(e){console.log(this.dataset.id)});var eRect=SVG.addChild(exonGroup,"rect",{i:i,x:exonX,y:checkRowY-1,width:exonWidth,height:height,stroke:"gray","stroke-width":1,fill:"white",cursor:"pointer"});var codingLength=exon.genomicCodingEnd-exon.genomicCodingStart;var codingX=args.pixelPosition+middle-(args.position-exon.genomicCodingStart)*args.pixelBase;var codingReverseX=args.pixelPosition+middle-(args.position-exon.genomicCodingEnd)*args.pixelBase;var codingWidth=(codingLength+1)*args.pixelBase;if(codingLength>0){var cRect=SVG.addChild(exonGroup,"rect",{i:i,x:codingX,y:checkRowY-1,width:codingWidth,height:height,stroke:transcriptColor,"stroke-width":1,fill:transcriptColor,cursor:"pointer"});if(args.pixelBase>9.5&&transcript.proteinSequence!=null){if(exon.strand=="+"){var proteinString=transcript.proteinSequence.substring(Math.floor(exon.cdsStart/3),Math.floor(exon.cdsEnd/3));var proteinPhaseOffset=codingX-(3-exon.phase)%3*args.pixelBase;var sign=1}else if(exon.strand=="-"){var proteinString=transcript.proteinSequence.substring(Math.floor(exon.cdsStart/3),Math.ceil(exon.cdsEnd/3));var proteinPhaseOffset=codingReverseX-args.pixelBase*2-exon.phase*args.pixelBase;var sign=-1}for(var j=0;j<proteinString.length;j++){var codonRect=SVG.addChild(exonGroup,"rect",{x:proteinPhaseOffset+sign*args.pixelBase*3*j,y:checkRowY-1,width:args.pixelBase*3,height:height,stroke:"#3B0B0B","stroke-width":.5,fill:CODON_CONFIG[proteinString.charAt(j)].color,class:"ocb-codon"});var codonText=SVG.addChild(exonGroup,"text",{x:proteinPhaseOffset+sign*args.pixelBase*j*3+args.pixelBase/3,y:checkRowY-3,width:args.pixelBase*3,class:"ocb-font-ubuntumono ocb-font-size-16 ocb-codon"});codonText.textContent=CODON_CONFIG[proteinString.charAt(j)].text}}}}checkRowY+=rowHeight;checkTextY+=rowHeight}}break}rowY+=rowHeight;textY+=rowHeight}};for(var i=0,leni=features.length;i<leni;i++){draw(features[i])}};VcfMultisampleRenderer.prototype=new Renderer({});function VcfMultisampleRenderer(args){Renderer.call(this,args);_.extend(this,Backbone.Events);this.fontClass="ocb-font-roboto ocb-font-size-11";this.toolTipfontClass="ocb-tooltip-font";_.extend(this,FEATURE_TYPES.variant);this.on(this.handlers)}VcfMultisampleRenderer.prototype.render=function(features,args){for(var i=0,leni=features.length;i<leni;i++){this._drawFeature(features[i],args)}};VcfMultisampleRenderer.prototype._drawFeature=function(feature,args){var _this=this;var color=_.isFunction(_this.color)?_this.color(feature):_this.color;var label=_.isFunction(_this.label)?_this.label(feature):_this.label;var height=_.isFunction(_this.height)?_this.height(feature):_this.height;var tooltipTitle=_.isFunction(_this.tooltipTitle)?_this.tooltipTitle(feature):_this.tooltipTitle;var tooltipText=_.isFunction(_this.tooltipText)?_this.tooltipText(feature):_this.tooltipText;var infoWidgetId=_.isFunction(_this.infoWidgetId)?_this.infoWidgetId(feature):_this.infoWidgetId;var start=feature.start;var end=feature.end;var length=end-start+1;length=length<0?Math.abs(length):length;length=length==0?1:length;var width=length*args.pixelBase;var svgLabelWidth=label.length*6.4;var x=_this.getFeatureX(start,args);var maxWidth=Math.max(width,2);var textHeight=0;if(args.maxLabelRegionSize>args.regionSize){textHeight=9;maxWidth=Math.max(width,svgLabelWidth)}var rowY=0;var textY=textHeight+height;var rowHeight=textHeight+height+2;while(true){if(!(rowY in args.renderedArea)){args.renderedArea[rowY]=new FeatureBinarySearchTree}var foundArea=args.renderedArea[rowY].add({start:x,end:x+maxWidth-1});if(foundArea){var featureGroup=SVG.addChild(args.svgCanvasFeatures,"g",{feature_id:feature.id});var rect=SVG.addChild(featureGroup,"rect",{x:x,y:rowY,width:width,height:height,stroke:"#3B0B0B","stroke-width":1,"stroke-opacity":.7,fill:color,cursor:"pointer"});if(args.maxLabelRegionSize>args.regionSize){var text=SVG.addChild(featureGroup,"text",{x:x,y:textY,"font-weight":400,opacity:null,fill:"black",cursor:"pointer",class:_this.fontClass});text.textContent=label}if("tooltipText"in _this){$(featureGroup).qtip({content:{text:tooltipText,title:tooltipTitle},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:true,classes:_this.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}})}$(featureGroup).mouseover(function(event){_this.trigger("feature:mouseover",{query:feature[infoWidgetId],feature:feature,featureType:feature.featureType,mouseoverEvent:event})});$(featureGroup).click(function(event){_this.trigger("feature:click",{query:feature[infoWidgetId],feature:feature,featureType:feature.featureType,clickEvent:event})});break}rowY+=rowHeight;textY+=rowHeight}};VcfMultisampleRenderer.prototype._drawFeatureMultiSample=function(feature,args){var _this=this;var color=_.isFunction(_this.color)?_this.color(feature):_this.color;var label=_.isFunction(_this.label)?_this.label(feature):_this.label;var height=_.isFunction(_this.height)?_this.height(feature):_this.height;var tooltipTitle=_.isFunction(_this.tooltipTitle)?_this.tooltipTitle(feature):_this.tooltipTitle;var tooltipText=_.isFunction(_this.tooltipText)?_this.tooltipText(feature):_this.tooltipText;var infoWidgetId=_.isFunction(_this.infoWidgetId)?_this.infoWidgetId(feature):_this.infoWidgetId;var start=feature.start;var end=feature.end;var length=end-start+1;length=length<0?Math.abs(length):length;length=length==0?1:length;var width=length*args.pixelBase;var svgLabelWidth=_this.getLabelWidth(label,args);var x=_this.getFeatureX(start,args);var maxWidth=Math.max(width,2);var textHeight=0;if(args.regionSize<args.maxLabelRegionSize){textHeight=9;maxWidth=Math.max(width,svgLabelWidth)}var rowY=0;var textY=textHeight+height;var rowHeight=textHeight+height+2;var d00="";var dDD="";var d11="";var d01="";var xs=x;var xe=x+width;var ys=1;var yi=6;var yi2=10;for(var i=0,leni=feature.samples.length;i<leni;i++){args.renderedArea[ys]=new FeatureBinarySearchTree;args.renderedArea[ys].add({start:xs,end:xe});var genotype=feature.samples[i].split(":")[0];switch(genotype){case"0|0":case"0/0":d00+="M"+xs+","+ys+" L"+xe+","+ys+" ";d00+="L"+xe+","+(ys+yi)+" L"+xs+","+(ys+yi)+" z ";break;case".|.":case"./.":dDD+="M"+xs+","+ys+" L"+xe+","+ys+" ";dDD+="L"+xe+","+(ys+yi)+" L"+xs+","+(ys+yi)+" z ";break;case"1|1":case"1/1":d11+="M"+xs+","+ys+" L"+xe+","+ys+" ";d11+="L"+xe+","+(ys+yi)+" L"+xs+","+(ys+yi)+" z ";break;case"0|1":case"0/1":case"1|0":case"1/0":d01+="M"+xs+","+ys+" L"+xe+","+ys+" ";d01+="L"+xe+","+(ys+yi)+" L"+xs+","+(ys+yi)+" z ";break}ys+=yi2}var featureGroup=SVG.addChild(args.svgCanvasFeatures,"g",{feature_id:feature.id});var dummyRect=SVG.addChild(featureGroup,"rect",{x:xs,y:1,width:width,height:ys,fill:"transparent",cursor:"pointer"});if(d00!=""){var path=SVG.addChild(featureGroup,"path",{d:d00,fill:"blue",cursor:"pointer"})}if(dDD!=""){var path=SVG.addChild(featureGroup,"path",{d:dDD,fill:"black",cursor:"pointer"})}if(d11!=""){var path=SVG.addChild(featureGroup,"path",{d:d11,fill:"red",cursor:"pointer"})}if(d01!=""){var path=SVG.addChild(featureGroup,"path",{d:d01,fill:"orange",cursor:"pointer"})}var lastSampleIndex=0;$(featureGroup).qtip({content:{text:tooltipText+"<br>"+feature.samples[lastSampleIndex],title:tooltipTitle},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:true,classes:_this.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}});$(featureGroup).mousemove(function(event){var sampleIndex=parseInt(event.offsetY/yi2);if(sampleIndex!=lastSampleIndex){console.log(sampleIndex);$(featureGroup).qtip("option","content.text",tooltipText+"<br>"+feature.samples[sampleIndex])}lastSampleIndex=sampleIndex})};AlignmentRenderer.prototype=new Renderer({});function AlignmentRenderer(args){Renderer.call(this,args);_.extend(this,Backbone.Events);this.fontClass="ocb-font-roboto ocb-font-size-11";this.toolTipfontClass="ocb-tooltip-font";if(_.isObject(args)){_.extend(this,args)}this.on(this.handlers)}AlignmentRenderer.prototype.render=function(response,args){var _this=this;var sequenceDataAdapter=args.trackListPanel.getSequenceTrack().dataAdapter;if(_.isUndefined(response.params)){response.params={}}var viewAsPairs=false;if(response.params["view_as_pairs"]!=null){viewAsPairs=true}console.log("viewAsPairs "+viewAsPairs);var insertSizeMin=0;var insertSizeMax=0;var variantColor="orangered";if(response.params["insert_size_interval"]!=null){insertSizeMin=response.params["insert_size_interval"].split(",")[0];insertSizeMax=response.params["insert_size_interval"].split(",")[1]}console.log("insertSizeMin "+insertSizeMin);console.log("insertSizeMin "+insertSizeMax);$(args.svgCanvasFeatures).contextmenu(function(e){console.log("click derecho")});console.time("BamRender "+response.params.resource);var chunkList=response.items;var bamCoverGroup=SVG.addChild(args.svgCanvasFeatures,"g",{class:"bamCoverage",cursor:"pointer"});var bamReadGroup=SVG.addChild(args.svgCanvasFeatures,"g",{class:"bamReads",cursor:"pointer"});var drawCoverage=function(chunk){var coverageList=chunk.coverage.all;var coverageListA=chunk.coverage.a;var coverageListC=chunk.coverage.c;var coverageListG=chunk.coverage.g;var coverageListT=chunk.coverage.t;var start=parseInt(chunk.start);var end=parseInt(chunk.end);var pixelWidth=(end-start+1)*args.pixelBase;var middle=args.width/2;var points="",pointsA="",pointsC="",pointsG="",pointsT="";var baseMid=args.pixelBase/2-.5;var x,y,p=parseInt(chunk.start);var lineA="",lineC="",lineG="",lineT="";var coverageNorm=200,covHeight=50;for(var i=0;i<coverageList.length;i++){x=args.pixelPosition+middle-(args.position-p)*args.pixelBase;xx=args.pixelPosition+middle-(args.position-p)*args.pixelBase+args.pixelBase;lineA+=x+","+coverageListA[i]/coverageNorm*covHeight+" ";lineA+=xx+","+coverageListA[i]/coverageNorm*covHeight+" ";lineC+=x+","+(coverageListC[i]+coverageListA[i])/coverageNorm*covHeight+" ";lineC+=xx+","+(coverageListC[i]+coverageListA[i])/coverageNorm*covHeight+" ";lineG+=x+","+(coverageListG[i]+coverageListC[i]+coverageListA[i])/coverageNorm*covHeight+" ";lineG+=xx+","+(coverageListG[i]+coverageListC[i]+coverageListA[i])/coverageNorm*covHeight+" ";lineT+=x+","+(coverageListT[i]+coverageListG[i]+coverageListC[i]+coverageListA[i])/coverageNorm*covHeight+" ";lineT+=xx+","+(coverageListT[i]+coverageListG[i]+coverageListC[i]+coverageListA[i])/coverageNorm*covHeight+" ";p++}var rlineC=lineC.split(" ").reverse().join(" ").trim();var rlineG=lineG.split(" ").reverse().join(" ").trim();var rlineT=lineT.split(" ").reverse().join(" ").trim();var firstPoint=args.pixelPosition+middle-(args.position-parseInt(chunk.start))*args.pixelBase+baseMid;var lastPoint=args.pixelPosition+middle-(args.position-parseInt(chunk.end))*args.pixelBase+baseMid;var polA=SVG.addChild(bamCoverGroup,"polyline",{points:firstPoint+",0 "+lineA+lastPoint+",0",fill:"green"});var polC=SVG.addChild(bamCoverGroup,"polyline",{points:lineA+" "+rlineC,fill:"blue"});var polG=SVG.addChild(bamCoverGroup,"polyline",{points:lineC+" "+rlineG,fill:"gold"});var polT=SVG.addChild(bamCoverGroup,"polyline",{points:lineG+" "+rlineT,fill:"red"});var dummyRect=SVG.addChild(bamCoverGroup,"rect",{x:args.pixelPosition+middle-(args.position-start)*args.pixelBase,y:0,width:pixelWidth,height:covHeight,opacity:"0.5",fill:"lightgray",cursor:"pointer"});$(dummyRect).qtip({content:" ",position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:false},style:{width:true,classes:_this.toolTipfontClass+" ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}});args.trackListPanel.on("mousePosition:change",function(e){var pos=e.mousePos-parseInt(chunk.start);var str='depth: <span class="ssel">'+coverageList[pos]+"</span><br>"+'<span style="color:green">A</span>: <span class="ssel">'+chunk.coverage.a[pos]+"</span><br>"+'<span style="color:blue">C</span>: <span class="ssel">'+chunk.coverage.c[pos]+"</span><br>"+'<span style="color:darkgoldenrod">G</span>: <span class="ssel">'+chunk.coverage.g[pos]+"</span><br>"+'<span style="color:red">T</span>: <span class="ssel">'+chunk.coverage.t[pos]+"</span><br>";$(dummyRect).qtip("option","content.text",str)})};var drawSingleRead=function(feature){var start=feature.unclippedStart;var end=feature.unclippedEnd;if(feature.end==0){end=start+feature.length-1}var length=end-start+1;var differences=feature.differences;var color=_.isFunction(_this.color)?_this.color(feature,args.region.chromosome):_this.color;var strokeColor=_.isFunction(_this.strokeColor)?_this.strokeColor(feature,args.region.chromosome):_this.strokeColor;var label=_.isFunction(_this.label)?_this.label(feature):_this.label;var height=_.isFunction(_this.height)?_this.height(feature):_this.height;var tooltipTitle=_.isFunction(_this.tooltipTitle)?_this.tooltipTitle(feature):_this.tooltipTitle;var tooltipText=_.isFunction(_this.tooltipText)?_this.tooltipText(feature):_this.tooltipText;var strand=_.isFunction(_this.strand)?_this.strand(feature):_this.strand;var mateUnmappedFlag=_.isFunction(_this.mateUnmappedFlag)?_this.mateUnmappedFlag(feature):_this.mateUnmappedFlag;var infoWidgetId=_.isFunction(_this.infoWidgetId)?_this.infoWidgetId(feature):_this.infoWidgetId;if(insertSizeMin!=0&&insertSizeMax!=0&&!mateUnmappedFlag){if(Math.abs(feature.inferredInsertSize)>insertSizeMax){color="maroon"}if(Math.abs(feature.inferredInsertSize)<insertSizeMin){color="navy"}}var width=length*args.pixelBase;var x=_this.getFeatureX(start,args);maxWidth=width;console.log(length+" in px: "+width);var rowHeight=16;var rowY=70;while(true){if(args.renderedArea[rowY]==null){args.renderedArea[rowY]=new FeatureBinarySearchTree}var enc=args.renderedArea[rowY].add({start:x,end:x+maxWidth-1});if(enc){
var featureGroup=SVG.addChild(bamReadGroup,"g",{feature_id:feature.name});var points={Reverse:x+","+(rowY+height/2)+" "+(x+5)+","+rowY+" "+(x+width)+","+rowY+" "+(x+width)+","+(rowY+height)+" "+(x+5)+","+(rowY+height),Forward:x-1+","+rowY+" "+(x+width-5)+","+rowY+" "+(x+width)+","+(rowY+height/2)+" "+(x+width-5)+","+(rowY+height)+" "+(x-1)+","+(rowY+height)};var poly=SVG.addChild(featureGroup,"polygon",{points:points[strand],stroke:color,"stroke-width":1,fill:color,cursor:"pointer"});$(featureGroup).qtip({content:{text:tooltipText,title:tooltipTitle},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:300,classes:_this.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"mouseenter",hide:"mousedown mouseup mouseleave"});featureGroup.addEventListener("click",function(event){console.log(feature);_this.trigger("feature:click",{query:feature[infoWidgetId],feature:feature,featureType:feature.featureType,clickEvent:event})});if(differences!=null&&args.regionSize<400){var region=new Region({chromosome:args.region.chromosome,start:start,end:end});sequenceDataAdapter.getData({region:region,done:function(event){var referenceString=AlignmentRenderer._getReferenceString(event.items,region);featureGroup.appendChild(AlignmentRenderer.drawBamDifferences(referenceString,differences,args.pixelBase,x,rowY+height))}})}break}rowY+=rowHeight}};var drawPairedReads=function(read,mate){var readStart=read.unclippedStart;var readEnd=read.unclippedEnd;var mateStart=mate.unclippedStart;var mateEnd=mate.unclippedEnd;var readDiff=read.diff;var mateDiff=mate.diff;var readSettings=_this.types[read.featureType];var mateSettings=_this.types[mate.featureType];var readColor=readSettings.getColor(read,_this.region.chromosome);var mateColor=mateSettings.getColor(mate,_this.region.chromosome);var readStrand=readSettings.getStrand(read);var matestrand=mateSettings.getStrand(mate);if(insertSizeMin!=0&&insertSizeMax!=0){if(Math.abs(read.inferredInsertSize)>insertSizeMax){readColor="maroon";mateColor="maroon"}if(Math.abs(read.inferredInsertSize)<insertSizeMin){readColor="navy";mateColor="navy"}}var pairStart=readStart;var pairEnd=mateEnd;if(mateStart<=readStart){pairStart=mateStart}if(readEnd>=mateEnd){pairEnd=readEnd}var pairWidth=(pairEnd-pairStart+1)*_this.pixelBase;var pairX=_this.pixelPosition+middle-(_this.position-pairStart)*_this.pixelBase;var readWidth=(readEnd-readStart+1)*_this.pixelBase;var readX=_this.pixelPosition+middle-(_this.position-readStart)*_this.pixelBase;var mateWidth=(mateEnd-mateStart+1)*_this.pixelBase;var mateX=_this.pixelPosition+middle-(_this.position-mateStart)*_this.pixelBase;var rowHeight=12;var rowY=70;while(true){if(args.renderedArea[rowY]==null){args.renderedArea[rowY]=new FeatureBinarySearchTree}var enc=args.renderedArea[rowY].add({start:pairX,end:pairX+pairWidth-1});if(enc){var readEls=[];var mateEls=[];var readPoints={Reverse:readX+","+(rowY+readSettings.height/2)+" "+(readX+5)+","+rowY+" "+(readX+readWidth-5)+","+rowY+" "+(readX+readWidth-5)+","+(rowY+readSettings.height)+" "+(readX+5)+","+(rowY+readSettings.height),Forward:readX+","+rowY+" "+(readX+readWidth-5)+","+rowY+" "+(readX+readWidth)+","+(rowY+readSettings.height/2)+" "+(readX+readWidth-5)+","+(rowY+readSettings.height)+" "+readX+","+(rowY+readSettings.height)};var readPoly=SVG.addChild(bamReadGroup,"polygon",{points:readPoints[readStrand],stroke:readSettings.getStrokeColor(read),"stroke-width":1,fill:readColor,cursor:"pointer"});readEls.push(readPoly);var matePoints={Reverse:mateX+","+(rowY+mateSettings.height/2)+" "+(mateX+5)+","+rowY+" "+(mateX+mateWidth-5)+","+rowY+" "+(mateX+mateWidth-5)+","+(rowY+mateSettings.height)+" "+(mateX+5)+","+(rowY+mateSettings.height),Forward:mateX+","+rowY+" "+(mateX+mateWidth-5)+","+rowY+" "+(mateX+mateWidth)+","+(rowY+mateSettings.height/2)+" "+(mateX+mateWidth-5)+","+(rowY+mateSettings.height)+" "+mateX+","+(rowY+mateSettings.height)};var matePoly=SVG.addChild(bamReadGroup,"polygon",{points:matePoints[matestrand],stroke:mateSettings.getStrokeColor(mate),"stroke-width":1,fill:mateColor,cursor:"pointer"});mateEls.push(matePoly);var line=SVG.addChild(bamReadGroup,"line",{x1:readX+readWidth,y1:rowY+readSettings.height/2,x2:mateX,y2:rowY+readSettings.height/2,"stroke-width":"1",stroke:"gray",cursor:"pointer"});if(args.regionSize<400){if(readDiff!=null){var readPath=SVG.addChild(bamReadGroup,"path",{d:Utils.genBamVariants(readDiff,_this.pixelBase,readX,rowY),fill:variantColor});readEls.push(readPath)}if(mateDiff!=null){var matePath=SVG.addChild(bamReadGroup,"path",{d:Utils.genBamVariants(mateDiff,_this.pixelBase,mateX,rowY),fill:variantColor});mateEls.push(matePath)}}$(readEls).qtip({content:{text:readSettings.getTipText(read),title:readSettings.getTipTitle(read)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:false},style:{width:280,classes:_this.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"});$(readEls).click(function(event){console.log(read);_this.showInfoWidget({query:read[readSettings.infoWidgetId],feature:read,featureType:read.featureType,adapter:_this.trackData.adapter})});$(mateEls).qtip({content:{text:mateSettings.getTipText(mate),title:mateSettings.getTipTitle(mate)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:false},style:{width:280,classes:_this.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"});$(mateEls).click(function(event){console.log(mate);_this.showInfoWidget({query:mate[mateSettings.infoWidgetId],feature:mate,featureType:mate.featureType,adapter:_this.trackData.adapter})});break}rowY+=rowHeight}};var drawChunk=function(chunk){drawCoverage(chunk.value);var alignments=chunk.value.alignments;for(var i=0,li=alignments.length;i<li;i++){var alignment=alignments[i];if(viewAsPairs){var nextRead=alignments[i+1];if(nextRead!=null){if(alignment.name==nextRead.name){drawPairedReads(alignment,nextRead);i++}else{drawSingleRead(alignment)}}}else{drawSingleRead(alignment)}}};if(chunkList.length>0){for(var i=0,li=chunkList.length;i<li;i++){drawChunk(chunkList[i])}}console.timeEnd("BamRender "+response.params.resource)};AlignmentRenderer.genBamVariants=function(differences,size,mainX,y){var s=size/6;var d="";for(var i=0;i<differences.length;i++){var difference=differences[i];switch(difference.op){case"S":var x=mainX+size*difference.pos;for(var j=0;j<difference.length;j++){var char=difference.seq[j];switch(char){case"A":d+="M"+(2.5*s+x)+","+y+"l-"+2.5*s+","+6*s+"l"+s+",0"+"l"+.875*s+",-"+2*s+"l"+2.25*s+",0"+"l"+.875*s+","+2*s+"l"+s+",0"+"l-"+2.5*s+",-"+6*s+"l-"+.5*s+",0"+"l0,"+s+"l"+.75*s+","+2*s+"l-"+1.5*s+",0"+"l"+.75*s+",-"+2*s+"l0,-"+s+" ";break;case"T":d+="M"+(.5*s+x)+","+y+"l0,"+s+"l"+2*s+",0"+"l0,"+5*s+"l"+s+",0"+"l0,-"+5*s+"l"+2*s+",0"+"l0,-"+s+" ";break;case"C":d+="M"+(5*s+x)+","+(0*s+y)+"l-"+2*s+",0"+"l-"+1.5*s+","+.5*s+"l-"+.5*s+","+1.5*s+"l0,"+2*s+"l"+.5*s+","+1.5*s+"l"+1.5*s+","+.5*s+"l"+2*s+",0"+"l0,-"+s+"l-"+2*s+",0"+"l-"+.75*s+",-"+.25*s+"l-"+.25*s+",-"+.75*s+"l0,-"+2*s+"l"+.25*s+",-"+.75*s+"l"+.75*s+",-"+.25*s+"l"+2*s+",0"+" ";break;case"G":d+="M"+(5*s+x)+","+(0*s+y)+"l-"+2*s+",0"+"l-"+1.5*s+","+.5*s+"l-"+.5*s+","+1.5*s+"l0,"+2*s+"l"+.5*s+","+1.5*s+"l"+1.5*s+","+.5*s+"l"+2*s+",0"+"l0,-"+3*s+"l-"+s+",0"+"l0,"+2*s+"l-"+s+",0"+"l-"+.75*s+",-"+.25*s+"l-"+.25*s+",-"+.75*s+"l0,-"+2*s+"l"+.25*s+",-"+.75*s+"l"+.75*s+",-"+.25*s+"l"+2*s+",0"+" ";break;case"N":d+="M"+(.5*s+x)+","+(0*s+y)+"l0,"+6*s+"l"+s+",0"+"l0,-"+4.5*s+"l"+3*s+","+4.5*s+"l"+s+",0"+"l0,-"+6*s+"l-"+s+",0"+"l0,"+4.5*s+"l-"+3*s+",-"+4.5*s+" ";break;case"d":d+="M"+(0*s+x)+","+(2.5*s+y)+"l"+6*s+",0"+"l0,"+s+"l-"+6*s+",0"+"l0,-"+s+" ";break;default:d+="M0,0";break}x+=size}break}}return d};AlignmentRenderer.drawBamDifferences=function(refString,differences,size,mainX,y){var text=SVG.create("text",{x:mainX,y:y-2,class:"ocb-font-ubuntumono ocb-font-size-15"});for(var i=0;i<differences.length;i++){var difference=differences[i];switch(difference.op){case"I":var x=mainX+size*difference.pos-size/2;var t=SVG.addChild(text,"tspan",{x:x,"font-weight":"bold",textLength:size});t.textContent="·";$(t).qtip({content:{text:difference.seq,title:"Insertion"},position:{target:"mouse",adjust:{x:25,y:15}},style:{classes:this.toolTipfontClass+" qtip-dark qtip-shadow"}});break;case"D":var x=mainX+size*difference.pos;for(var j=0;j<difference.length;j++){var t=SVG.addChild(text,"tspan",{x:x,"font-weight":"bold",textLength:size});t.textContent="—";x+=size}break;case"N":var x=mainX+size*difference.pos;for(var j=0;j<difference.length;j++){var t=SVG.addChild(text,"tspan",{x:x,fill:"#888",textLength:size});t.textContent="—";x+=size}break;case"S":var x=mainX+size*difference.pos;for(var j=0;j<difference.length;j++){var char=difference.seq[j];var t=SVG.addChild(text,"tspan",{x:x,fill:"#aaa",textLength:size});t.textContent=char;x+=size}break;case"H":var x=mainX+size*difference.pos;for(var j=0;j<difference.length;j++){var t=SVG.addChild(text,"tspan",{x:x,fill:"#aaa",textLength:size});t.textContent="H";x+=size}break;case"X":case"M":var x=mainX+size*difference.pos;for(var j=0;j<difference.length;j++){var char=difference.seq[j];var refPos=difference.pos+j;console.log("ref:"+refString.charAt(refPos)+" - "+"seq:"+char);if(char!=refString.charAt(refPos)){var t=SVG.addChild(text,"tspan",{x:x,fill:SEQUENCE_COLORS[char],textLength:size});t.textContent=char}x+=size}break}}return text};AlignmentRenderer._getReferenceString=function(chunks,region){var sequenceItems=[];var chunk;for(var i=0;i<chunks.length;i++){chunk=chunks[i];for(var j=0;j<chunk.value.length;j++){sequenceItems.push(chunk.value[j])}}sequenceItems.sort(function(a,b){return a.start-b.start});var aux=[];var s=sequenceItems[0].start;var e=sequenceItems[sequenceItems.length-1].end;for(var i=0;i<sequenceItems.length;i++){aux.push(sequenceItems[i].sequence)}var str=aux.join("");var i1=region.start-s;var i2=i1+region.length();var substr=str.substring(i1,i2);return substr};function UrlWidget(args){var _this=this;_.extend(this,Backbone.Events);this.id=Utils.genId("UrlWidget");this.targetId=null;this.title="Custom url";this.width=500;this.height=400;_.extend(this,args);this.on(this.handlers)}UrlWidget.prototype.draw=function(){if(this.panel==null){this.render()}this.panel.show()};UrlWidget.prototype.render=function(){var _this=this;this.urlField=Ext.create("Ext.form.field.Text",{margin:"0 2 2 0",labelWidth:30,width:this.width-55,fieldLabel:"URL",emptyText:"enter a valid url",value:"http://www.ensembl.org/das/Homo_sapiens.GRCh37.gene/features",listeners:{change:{fn:function(){var dasName=this.value.split("/das/")[1].split("/")[0];_this.trackNameField.setValue(dasName)}}}});this.checkButton=Ext.create("Ext.button.Button",{text:"Check",handler:function(){_this.form.setLoading();var dasAdapter=new DasAdapter({url:_this.urlField.getValue(),featureCache:{gzip:false,chunkSize:1e4},handlers:{"url:check":function(event){console.log(event.data);_this.contentArea.setValue(event.data);_this.form.setLoading(false)},error:function(){_this.contentArea.setValue("XMLHttpRequest cannot load. This server is not allowed by Access-Control-Allow-Origin");_this.form.setLoading(false)}}});dasAdapter.checkUrl()}});this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",allowBlank:false,value:_this.urlField.value.split("/das/")[1].split("/")[0],emptyText:"Choose a name",flex:1});this.panelSettings=Ext.create("Ext.panel.Panel",{layout:"hbox",border:false,title:"Track name",cls:"panel-border-top",bodyPadding:10,width:this.width-2,items:[this.trackNameField]});this.contentArea=Ext.create("Ext.form.field.TextArea",{margin:"-1",width:this.width,height:this.height});this.infobar=Ext.create("Ext.toolbar.Toolbar",{height:28,cls:"bio-border-false",items:[this.urlField,this.checkButton]});this.form=Ext.create("Ext.panel.Panel",{border:false,items:[this.infobar,this.contentArea,this.panelSettings]});this.panel=Ext.create("Ext.ux.Window",{title:this.title,layout:"fit",resizable:false,items:[this.form],buttons:[{text:"Add",handler:function(){_this.trigger("addButton:click",{name:_this.trackNameField.getValue(),url:_this.urlField.getValue()});_this.panel.close()}},{text:"Cancel",handler:function(){_this.panel.close()}}],listeners:{destroy:function(){delete _this.panel}}})};function FileWidget(args){var _this=this;_.extend(this,Backbone.Events);this.id=Utils.genId("FileWidget");this.targetId;this.wum=true;this.tags=[];this.viewer;this.title;this.dataAdapter;this.args=args;_.extend(this,args);this.on(this.handlers)}FileWidget.prototype.getTitleName=function(){return this.trackNameField.getValue()};FileWidget.prototype.getFileFromServer=function(){};FileWidget.prototype.loadFileFromLocal=function(){};FileWidget.prototype.getFileUpload=function(){var _this=this;this.uploadField=Ext.create("Ext.form.field.File",{msgTarget:"side",flex:1,padding:1,emptyText:"Choose a file",allowBlank:false,anchor:"100%",buttonText:"Browse local",listeners:{change:{fn:function(){_this.panel.setLoading();var file=document.getElementById(_this.uploadField.fileInputEl.id).files[0];_this.trackNameField.setValue(file.name);_this.fileNameLabel.setText('<span class="emph">'+file.name+'</span> <span class="info">(local)</span>',false);_this.loadFileFromLocal(file);_this.panel.setLoading(false)}}}});return this.uploadField};FileWidget.prototype.draw=function(){var _this=this;if(this.openDialog==null){var featureCountBar=Ext.create("Ext.toolbar.Toolbar");this.featureCountLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="dis">No file loaded</span>'});featureCountBar.add([this.featureCountLabel]);var browseBar=Ext.create("Ext.toolbar.Toolbar");browseBar.add(this.getFileUpload());this.panel=Ext.create("Ext.panel.Panel",{border:false,height:230,title:"Previsualization",bbar:featureCountBar});this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",fieldLabel:"Track Name",allowBlank:false,value:"New track from "+this.title+" file",emptyText:"Choose a name",flex:1});var panelSettings=Ext.create("Ext.panel.Panel",{border:false,layout:"hbox",bodyPadding:10,items:[this.trackNameField]});if(this.wum){if(Cookies("bioinfo_sid")!=null){this.sessionInitiated()}else{this.sessionFinished()}}this.fileNameLabel=Ext.create("Ext.toolbar.TextItem",{});this.btnOk=Ext.create("Ext.button.Button",{text:"Ok",disabled:true,handler:function(){_this.trigger("okButton:click",{fileName:_this.file.name,adapter:_this.adapter});_this.openDialog.close()}});this.openDialog=Ext.create("Ext.window.Window",{title:"Open "+this.title+" file",width:600,resizable:false,items:[browseBar,panelSettings],buttons:[this.btnOk,{text:"Cancel",handler:function(){_this.openDialog.close()}}],listeners:{scope:this,minimize:function(){this.openDialog.hide()},destroy:function(){delete this.openDialog}}})}this.openDialog.show()};FileWidget.prototype.sessionInitiated=function(){};FileWidget.prototype.sessionFinished=function(){};VCFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;VCFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;VCFFileWidget.prototype.draw=FileWidget.prototype.draw;VCFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;VCFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;VCFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems;VCFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo;function VCFFileWidget(args){if(args==null){args=new Object}args.title="VCF";args.tags=["vcf"];FileWidget.prototype.constructor.call(this,args)}VCFFileWidget.prototype.loadFileFromLocal=function(file){var _this=this;this.file=file;this.adapter=new VCFDataAdapter(new FileDataSource({file:file}),{species:this.viewer.species});this.adapter.on("file:load",function(sender){console.log(_this.adapter.featuresByChromosome)});_this.btnOk.enable()};VCFFileWidget.prototype.loadFileFromServer=function(data){this.file={name:data.filename};this.adapter=new VCFDataAdapter(new StringDataSource(data.data),{async:false,species:this.viewer.species});this.btnOk.enable()};GFFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;GFFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;GFFFileWidget.prototype.draw=FileWidget.prototype.draw;GFFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;GFFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;GFFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems;GFFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo;function GFFFileWidget(args){if(args==null){args={}}this.version="2";if(args.version!=null){this.version=args.version}args.title="GFF"+this.version;args.tags=["gff"];FileWidget.prototype.constructor.call(this,args)}GFFFileWidget.prototype.loadFileFromLocal=function(file){var _this=this;this.file=file;switch(this.version){case"2":case 2:this.adapter=new GFF2DataAdapter(new FileDataSource({file:file}),{species:this.viewer.species});break;case"3":case 3:this.adapter=new GFF3DataAdapter(new FileDataSource({file:file}),{species:this.viewer.species});break;default:this.adapter=new GFF2DataAdapter(new FileDataSource({file:file}),{species:this.viewer.species});break}this.adapter.on("file:load",function(e){});_this.btnOk.enable()};GFFFileWidget.prototype.loadFileFromServer=function(data){this.file={name:data.filename};switch(this.version){case"2":case 2:this.adapter=new GFF2DataAdapter(new StringDataSource(data.data),{async:false,species:this.viewer.species});break;case"3":case 3:this.adapter=new GFF3DataAdapter(new StringDataSource(data.data),{async:false,species:this.viewer.species});break;default:this.adapter=new GFF2DataAdapter(new StringDataSource(data.data),{async:false,species:this.viewer.species});break}this._loadChartInfo();this.btnOk.enable()};BEDFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;BEDFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;BEDFileWidget.prototype.draw=FileWidget.prototype.draw;BEDFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;BEDFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;BEDFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems;BEDFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo;function BEDFileWidget(args){if(args==null){args=new Object}args.title="BED";args.tags=["bed"];FileWidget.prototype.constructor.call(this,args)}BEDFileWidget.prototype.loadFileFromLocal=function(file){var _this=this;this.file=file;this.adapter=new BEDDataAdapter(new FileDataSource({file:file}),{species:this.viewer.species});this.adapter.on("file:load",function(e){});_this.btnOk.enable()};BEDFileWidget.prototype.loadFileFromServer=function(data){this.file={name:data.filename};this.adapter=new BEDDataAdapter(new StringDataSource(data.data),{async:false,species:this.viewer.species});this._loadChartInfo();this.btnOk.enable()};function GenomeViewer(args){_.extend(this,Backbone.Events);var _this=this;this.id=Utils.genId("GenomeViewer");this.autoRender=true;this.version='Powered by <a target="_blank" href="http://www.genomemaps.org/">Genome Maps</a>';this.target;this.width;this.height;this.cellBaseHost="http://bioinfo.hpc.cam.ac.uk/cellbase";this.cellBaseVersion="v3";this.quickSearchResultFn;this.quickSearchDisplayKey="name";this.drawNavigationBar=true;this.drawKaryotypePanel=true;this.drawChromosomePanel=true;this.drawOverviewTrackListPanel=true;this.overviewZoomMultiplier=8;this.karyotypePanelConfig={hidden:false,collapsed:false,collapsible:true};this.chromosomePanelConfig={hidden:false,collapsed:false,collapsible:true};this.regionPanelConfig={hidden:false,collapsed:false,collapsible:true};this.navigationBarConfig={};this.drawStatusBar=true;this.resizable=true;this.sidePanel=true;this.trackListTitle="Detailed information";this.trackPanelScrollWidth=18;this.zoom;this.chromosomes;this.chromosomeList;_.extend(this,args);this.chromosomes=this.getChromosomes();this.species.chromosomes=this.chromosomes;this.defaultRegion=new Region(this.region);this.sidePanelWidth=this.sidePanel?25:0;this.on(this.handlers);this.fullscreen=false;this.resizing=false;this.changingRegion=false;this.rendered=false;if(this.autoRender){this.render()}}GenomeViewer.prototype={render:function(){console.log("Initializing Genome Viewer");this.div=document.createElement("div");this.div.setAttribute("id",this.id);this.div.setAttribute("class","ocb-gv ocb-box-vertical");this.navigationbarDiv=document.createElement("div");this.navigationbarDiv.setAttribute("class","ocb-gv-navigation");this.div.appendChild(this.navigationbarDiv);this.centerPanelDiv=document.createElement("div");this.centerPanelDiv.setAttribute("class","ocb-gv-center");this.div.appendChild(this.centerPanelDiv);this.statusbarDiv=document.createElement("div");this.statusbarDiv.setAttribute("class","ocb-gv-status");this.div.appendChild(this.statusbarDiv);this.rightSidebarDiv=document.createElement("div");this.rightSidebarDiv.setAttribute("class","ocb-gv-right-side");this.centerPanelDiv.appendChild(this.rightSidebarDiv);this.leftSidebarDiv=document.createElement("div");this.leftSidebarDiv.setAttribute("class","ocb-gv-left-side");this.centerPanelDiv.appendChild(this.leftSidebarDiv);this.karyotypeDiv=document.createElement("div");this.karyotypeDiv.setAttribute("class","ocb-gv-karyotype");this.centerPanelDiv.appendChild(this.karyotypeDiv);this.chromosomeDiv=document.createElement("div");this.chromosomeDiv.setAttribute("class","ocb-gv-chromosome");this.centerPanelDiv.appendChild(this.chromosomeDiv);this.trackListPanelsDiv=document.createElement("div");this.trackListPanelsDiv.setAttribute("class","ocb-gv-tracklist-target");this.centerPanelDiv.appendChild(this.trackListPanelsDiv);this.regionDiv=document.createElement("div");this.regionDiv.setAttribute("class","ocb-gv-overview");this.trackListPanelsDiv.appendChild(this.regionDiv);this.tracksDiv=document.createElement("div");this.tracksDiv.setAttribute("class","ocb-gv-detailed");this.trackListPanelsDiv.appendChild(this.tracksDiv);this._init();this.rendered=true},_init:function(){var _this=this;this._checkAndSetMinimumRegion(this.region,this.getSVGCanvasWidth());this.zoom=this._calculateZoomByRegion(this.region);if(this.drawNavigationBar){this.navigationBar=this._createNavigationBar(this.navigationbarDiv)}if(this.drawKaryotypePanel){this.karyotypePanel=this._drawKaryotypePanel(this.karyotypeDiv)}if(this.drawChromosomePanel){this.chromosomePanel=this._drawChromosomePanel(this.chromosomeDiv)}if(this.drawOverviewTrackListPanel){this.overviewTrackListPanel=this._createOverviewTrackListPanel(this.regionDiv)}this.trackListPanel=this._createTrackListPanel(this.tracksDiv);if(this.drawStatusBar){this.statusBar=this._createStatusBar(this.statusbarDiv)}this.on("region:change region:move",function(event){if(event.sender!=_this){_this.region.load(event.region)}});this.on("width:change",function(event){if(event.sender!=_this){_this.width=event.width;$(_this.div).width(event.width);$(_this.targetDiv).width(event.width)}});$("html").bind("keydown.genomeViewer",function(e){switch(e.keyCode){case 40:case 109:if(e.shiftKey){_this.increaseZoom(-10)}break;case 38:case 107:if(e.shiftKey){_this.increaseZoom(10)}break}})},draw:function(){this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target);if(!this.targetDiv){console.log("target not found");return}this.targetDiv.appendChild(this.div)},destroy:function(){$(this.div).remove();this.off();this.rendered=false;$("html").unbind(".genomeViewer");$("body").unbind(".genomeViewer");delete this},getChromosomes:function(){var saveChromosomes=function(chromsomeList){var chromosomes={};for(var i=0;i<chromsomeList.length;i++){var chromosome=chromsomeList[i];chromosomes[chromosome.name]=chromosome}return chromosomes};var chromosomes;if(typeof this.chromosomeList!=="undefined"){chromosomes=saveChromosomes(this.chromosomeList)}else{CellBaseManager.get({host:this.cellBaseHost,version:this.cellBaseVersion,species:this.species,category:"genomic",subCategory:"chromosome",resource:"all",async:false,success:function(data){chromosomes=saveChromosomes(data.response[0].result[0].chromosomes);for(var i=0;i<chromosomes.length;i++){var chr=chromosomes[i];debugger}},error:function(data){console.log("Could not get chromosome list")}})}return chromosomes},_createNavigationBar:function(target){var _this=this;if(!$.isFunction(this.quickSearchResultFn)){this.quickSearchResultFn=function(query){var results=[];var speciesCode=Utils.getSpeciesCode(this.species.scientificName);CellBaseManager.get({host:_this.cellBaseHost,version:_this.cellBaseVersion,species:speciesCode,category:"feature",subCategory:"id",query:query,resource:"starts_with",params:{limit:10},async:false,success:function(data,textStatus,jqXHR){results=data.response[0].result}});return results}}var goFeature=function(feature){_this._regionChangeHandler({region:new Region(feature)})};var navigationBar=new NavigationBar({target:target,cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,availableSpecies:this.availableSpecies,species:this.species,region:this.region,width:this.width,svgCanvasWidthOffset:this.trackPanelScrollWidth+this.sidePanelWidth,zoom:this.zoom,quickSearchResultFn:this.quickSearchResultFn,quickSearchDisplayKey:this.quickSearchDisplayKey,componentsConfig:this.navigationBarConfig.componentsConfig,karyotypePanelConfig:this.karyotypePanelConfig,chromosomePanelConfig:this.chromosomePanelConfig,regionPanelConfig:this.regionPanelConfig,handlers:{"region:change":function(event){_this._regionChangeHandler(event)},"region:move":function(event){_this._regionMoveHandler(event)},"zoom:change":function(event){_this._zoomChangeHandler(event)},"species:change":function(event){_this._speciesChangeHandler(event)},"karyotype-button:change":function(event){if(event.selected){_this.karyotypePanel.show()}else{_this.karyotypePanel.hide()}},"chromosome-button:change":function(event){if(event.selected){_this.chromosomePanel.show()}else{_this.chromosomePanel.hide()}},"region-button:change":function(event){if(event.selected){_this.overviewTrackListPanel.show()}else{_this.overviewTrackListPanel.hide()}},"fullscreen:click":function(event){if(_this.fullscreen){$(_this.div).css({width:"auto"});Utils.cancelFullscreen();_this.fullscreen=false}else{$(_this.div).css({width:screen.width});Utils.launchFullScreen(_this.div);_this.fullscreen=true}},"restoreDefaultRegion:click":function(event){event.region=_this.defaultRegion;_this._regionChangeHandler(event)},"autoHeight-button:change":function(event){_this.toggleAutoHeight(event.selected)},"quickSearch:select":function(event){goFeature(event.item);_this.trigger("quickSearch:select",event)},"quickSearch:go":function(event){goFeature(event.item)}}});this.on("region:change",function(event){_this.navigationBar.setRegion(event.region,_this.zoom)});this.on("region:move",function(event){if(event.sender!=navigationBar){_this.navigationBar.moveRegion(event.region)}});this.on("width:change",function(event){_this.navigationBar.setWidth(event.width)});navigationBar.draw();return navigationBar},_drawKaryotypePanel:function(target){var _this=this;var karyotypePanel=new KaryotypePanel({target:target,cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,width:this.width-this.sidePanelWidth,height:125,species:this.species,title:"Karyotype",collapsed:this.karyotypePanelConfig.collapsed,collapsible:this.karyotypePanelConfig.collapsible,hidden:this.karyotypePanelConfig.hidden,region:this.region,autoRender:true,handlers:{"region:change":function(event){_this._regionChangeHandler(event)}}});this.on("region:change region:move",function(event){karyotypePanel.setRegion(event.region)});this.on("width:change",function(event){karyotypePanel.setWidth(event.width-_this.sidePanelWidth)});karyotypePanel.draw();return karyotypePanel},_drawChromosomePanel:function(target){var _this=this;var chromosomePanel=new ChromosomePanel({target:target,cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,autoRender:true,width:this.width-this.sidePanelWidth,height:65,species:this.species,title:"Chromosome",collapsed:this.chromosomePanelConfig.collapsed,collapsible:this.chromosomePanelConfig.collapsible,hidden:this.chromosomePanelConfig.hidden,region:this.region,handlers:{"region:change":function(event){_this._regionChangeHandler(event)}}});this.on("region:change region:move",function(event){chromosomePanel.setRegion(event.region)});this.on("width:change",function(event){chromosomePanel.setWidth(event.width-_this.sidePanelWidth)});chromosomePanel.draw();return chromosomePanel},_createOverviewTrackListPanel:function(target){var _this=this;var trackListPanel=new TrackListPanel({cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,target:target,autoRender:true,width:this.width-this.sidePanelWidth,zoomMultiplier:this.overviewZoomMultiplier,title:"Region overview",showRegionOverviewBox:true,collapsible:this.regionPanelConfig.collapsible,region:this.region,species:this.species,handlers:{"region:change":function(event){event.sender=undefined;_this._regionChangeHandler(event)},"region:move":function(event){_this._regionMoveHandler(event)}}});this.on("region:change",function(event){if(event.sender!=trackListPanel){trackListPanel.setRegion(event.region)}});this.on("region:move",function(event){if(event.sender!=trackListPanel){trackListPanel.moveRegion(event)}});this.on("width:change",function(event){trackListPanel.setWidth(event.width-_this.sidePanelWidth)});trackListPanel.draw();return trackListPanel},_createTrackListPanel:function(target){var _this=this;var trackListPanel=new TrackListPanel({target:target,cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,autoRender:true,width:this.width-this.sidePanelWidth,title:this.trackListTitle,region:this.region,species:this.species,hidden:this.regionPanelConfig.hidden,handlers:{"region:change":function(event){event.sender=undefined;_this._regionChangeHandler(event)},"region:move":function(event){_this._regionMoveHandler(event)}}});this.on("region:change",function(event){if(event.sender!=trackListPanel){trackListPanel.setRegion(event.region)}});this.on("region:move",function(event){if(event.sender!=trackListPanel){trackListPanel.moveRegion(event)}});this.on("width:change",function(event){trackListPanel.setWidth(event.width-_this.sidePanelWidth)});this.on("feature:highlight",function(event){trackListPanel.highlight(event)});trackListPanel.draw();return trackListPanel},_createStatusBar:function(target){var _this=this;var statusBar=new StatusBar({target:target,autoRender:true,region:this.region,width:this.width,version:this.version});this.on("region:change",function(event){statusBar.setRegion(event)});this.trackListPanel.on("mousePosition:change",function(event){statusBar.setMousePosition(event)});statusBar.draw();return statusBar},_checkAndSetNewChromosomeRegion:function(region){var newChr=this.chromosomes[region.chromosome];if(region.chromosome!==this.region.chromosome){if(region.start>newChr.size||region.end>newChr.size){region.start=Math.round(newChr.size/2);region.end=Math.round(newChr.size/2)}}},_checkAndSetMinimumRegion:function(region,width){var minLength=Math.floor(width/10);if(region.length()<minLength){var centerPosition=region.center();var aux=Math.ceil(minLength/2-1);region.start=Math.floor(centerPosition-aux);region.end=Math.floor(centerPosition+aux)}},_calculateRegionByZoom:function(zoom){var minNtPixels=10;var chr=this.chromosomes[this.region.chromosome];var minRegionLength=this.getSVGCanvasWidth()/minNtPixels;var zoomLevelMultiplier=Math.pow(chr.size/minRegionLength,.01);var regionLength=minRegionLength*Math.pow(zoomLevelMultiplier,100-zoom);var centerPosition=this.region.center();var aux=Math.ceil(regionLength/2-1);var start=Math.floor(centerPosition-aux);var end=Math.floor(centerPosition+aux);return{start:start,end:end}},
_calculateZoomByRegion:function(region){var minNtPixels=10;var chr=this.chromosomes[region.chromosome];var minRegionLength=this.getSVGCanvasWidth()/minNtPixels;var zoomLevelMultiplier=Math.pow(chr.size/minRegionLength,.01);var regionLength=region.length();var zoom=Math.log(regionLength/minRegionLength)/Math.log(zoomLevelMultiplier);return 100-Math.round(zoom)},_checkChangingRegion:function(){if(typeof this.overviewTrackListPanel!=="undefined"){if(!this.overviewTrackListPanel.checkTracksReady()){return false}}if(typeof this.trackListPanel!=="undefined"){if(!this.trackListPanel.checkTracksReady()){return false}}return true},_regionChangeHandler:function(event){if(this._checkChangingRegion()){this._checkAndSetNewChromosomeRegion(event.region);this._checkAndSetMinimumRegion(event.region,this.getSVGCanvasWidth());this.zoom=this._calculateZoomByRegion(event.region);this.trigger("region:change",event);return true}else{if(event.sender){if(event.sender.updateRegionControls){event.sender.updateRegionControls()}}console.log("****************************");console.log("**************************** region change already in progress");console.log("****************************");return false}},_regionMoveHandler:function(event){this.trigger("region:move",event)},_zoomChangeHandler:function(event){event.zoom=Math.min(100,event.zoom);event.zoom=Math.max(0,event.zoom);this.zoom=event.zoom;this.region.load(this._calculateRegionByZoom(event.zoom));this.setRegion(this.region)},_speciesChangeHandler:function(event){this.trigger("species:change",event);this._updateSpecies(event.species);var firstGeneRegion;CellBaseManager.get({host:this.cellBaseHost,async:false,category:"feature",subCategory:"gene",resource:"first",species:event.species,params:{include:"chromosome,start,end"},success:function(r){firstGeneRegion=r.response[0].result[0]}});var region=new Region(firstGeneRegion);this.setRegion(region)},_updateSpecies:function(species){this.species=species;this.chromosomes=this.getChromosomes();this.species.chromosomes=this.chromosomes;if(this.overviewTrackListPanel){this.overviewTrackListPanel.setSpecies(species)}if(this.trackListPanel){this.trackListPanel.setSpecies(species)}if(this.chromosomePanel){this.chromosomePanel.setSpecies(species)}if(this.karyotypePanel){this.karyotypePanel.setSpecies(species)}if(this.navigationBar){this.navigationBar.setSpecies(species)}},_getSpeciesByTaxonomy:function(taxonomyCode){var speciesObject=null;for(var i=0;i<this.availableSpecies.items.length;i++){for(var j=0;j<this.availableSpecies.items[i].items.length;j++){var species=this.availableSpecies.items[i].items[j];var taxonomy=Utils.getSpeciesCode(species.scientificName);if(taxonomy===taxonomyCode){speciesObject=species;break}}}return speciesObject},setSpeciesByTaxonomy:function(taxonomyCode){var species=this._getSpeciesByTaxonomy(taxonomyCode);if(species!=null){this._speciesChangeHandler({species:species})}else{console.log("Species taxonomy not found on availableSpecies.")}},setRegion:function(region,taxonomy){if(taxonomy!=null){var species=this._getSpeciesByTaxonomy(taxonomy);this._updateSpecies(species)}return this._regionChangeHandler({region:new Region(region)})},moveRegion:function(disp){this.region.start+=disp;this.region.end+=disp;this.trigger("region:move",{region:this.region,disp:-disp,sender:this})},setWidth:function(width){var me=this;var newRegion=new Region(this.region);var newLength=width*this.region.length()/this.width;var centerPosition=this.region.center();var aux=Math.ceil(newLength/2-1);newRegion.start=Math.floor(centerPosition-aux);newRegion.end=Math.floor(centerPosition+aux);this.width=width;if(this.overviewTrackListPanel){this.overviewTrackListPanel.setWidth(width)}if(this.trackListPanel){this.trackListPanel.setWidth(width)}if(this.chromosomePanel){this.chromosomePanel.setWidth(width)}if(this.karyotypePanel){this.karyotypePanel.setWidth(width)}if(this.navigationBar){this.navigationBar.setWidth(width)}var hasChanged=this._regionChangeHandler({region:newRegion})},setZoom:function(zoom){zoom=Math.min(100,zoom);zoom=Math.max(0,zoom);this.zoom=zoom;this.region.load(this._calculateRegionByZoom(zoom));this.setRegion(this.region)},increaseZoom:function(zoomToIncrease){var zoom=this.zoom+zoomToIncrease;this.setZoom(zoom)},setCellBaseHost:function(host){if(host!=this.cellBaseHost){this.cellBaseHost=host;this.navigationBar.setCellBaseHost(this.cellBaseHost);this.chromosomePanel.setCellBaseHost(this.cellBaseHost);this.karyotypePanel.setCellBaseHost(this.cellBaseHost);this.trackListPanel.setCellBaseHost(this.cellBaseHost);this.overviewTrackListPanel.setCellBaseHost(this.cellBaseHost);this._updateSpecies(this.species);this.setRegion(new Region(this.region))}},getSVGCanvasWidth:function(){return this.width-this.trackPanelScrollWidth-this.sidePanelWidth},mark:function(args){var attrName=args.attrName||"feature_id";var cssClass=args.class||"ocb-feature-mark";if("attrValues"in args){args.attrValues=$.isArray(args.attrValues)?args.attrValues:[args.attrValues];for(var key in args.attrValues){$("rect["+attrName+"~="+args.attrValues[key]+"]").attr("class",cssClass)}}},unmark:function(args){var attrName=args.attrName||"feature_id";if("attrValues"in args){args.attrValues=$.isArray(args.attrValues)?args.attrValues:[args.attrValues];for(var key in args.attrValues){$("rect["+attrName+"~="+args.attrValues[key]+"]").attr("class","")}}},highlight:function(args){this.trigger("feature:highlight",args)},getRightSidePanelId:function(){return $(this.rightSidebarDiv).attr("id")},getLeftSidePanelId:function(){return $(this.leftSidebarDiv).attr("id")},getNavigationPanelId:function(){return $(this.navigationbarDiv).attr("id")},getStatusPanelId:function(){return $(this.statusbarDiv).attr("id")},setNavigationBar:function(navigationBar){this.navigationBar=navigationBar;var config={availableSpecies:this.availableSpecies,species:this.species,region:this.region,width:this.width,svgCanvasWidthOffset:this.trackPanelScrollWidth+this.sidePanelWidth};_.extend(this.navigationBar,config);navigationBar.render(this.getNavigationPanelId())},toggleAutoHeight:function(bool){this.trackListPanel.toggleAutoHeight(bool);this.overviewTrackListPanel.toggleAutoHeight(bool)},updateHeight:function(){this.trackListPanel.updateHeight();this.overviewTrackListPanel.updateHeight()},setSpeciesVisible:function(bool){this.navigationBar.setSpeciesVisible(bool)},setChromosomesVisible:function(bool){this.navigationBar.setChromosomeMenuVisible(bool)},setKaryotypePanelVisible:function(bool){this.karyotypePanel.setVisible(bool);this.navigationBar.setVisible({karyotype:bool})},setChromosomePanelVisible:function(bool){this.chromosomePanel.setVisible(bool);this.navigationBar.setVisible({chromosome:bool})},setRegionOverviewPanelVisible:function(bool){this.overviewTrackListPanel.setVisible(bool);this.navigationBar.setVisible({region:bool})},setRegionTextBoxVisible:function(bool){this.navigationBar.setRegionTextBoxVisible(bool)},setSearchVisible:function(bool){this.navigationBar.setSearchVisible(bool)},setFullScreenVisible:function(bool){this.navigationBar.setFullScreenButtonVisible(bool)},addOverviewTrack:function(track){this.overviewTrackListPanel.addTrack(track)},addTrack:function(track){this.trackListPanel.addTrack(track)},getTrackById:function(trackId){return this.trackListPanel.getTrackById(trackId)},removeTrack:function(track){return this.trackListPanel.removeTrack(track)},restoreTrack:function(track,index){return this.trackListPanel.restoreTrack(track,index)},setTrackIndex:function(track,newIndex){return this.trackListPanel.setTrackIndex(track,newIndex)},scrollToTrack:function(track){return this.trackListPanel.scrollToTrack(track)},showTrack:function(track){this.trackListPanel.showTrack(track)},hideTrack:function(track){this.trackListPanel.hideTrack(track)},containsTrack:function(track){return this.trackListPanel.containsTrack(track)},checkRenderedTrack:function(trackId){console.log("DEPRECATED METHOD");console.log(this.checkRenderedTrack);this.trackExists(trackId)}};Polymer({is:"jso-feature-info-menu",properties:{options:{type:Array,observer:"optionsChanged"},selected:{type:Object}},optionsChanged:function(neo,old){if(neo){for(var i=0;i<neo.length;i++){var entry=neo[i];if("option"in entry){this.set("selected",entry);break}}}},handleOptionClick:function(e){this.set("selected",e.model.entry);this.fire("option-click",e.currentTarget.textContent)},isSelected:function(entry,selected){return entry==selected}});Polymer({is:"jso-gene-info",properties:{gene:{type:Object},ensemblUrl:{type:String,computed:"computeEnsemblUrl(gene)"},wikipathwaysUrl:{type:String,computed:"computeWikipathwayslUrl(gene)"}},computeEnsemblUrl:function(gene){return"http://www.ensembl.org/Multi/Search/Results?q="+gene.name},computeWikipathwayslUrl:function(gene){return"http://wikipathways.org//index.php?query="+gene.name+"&title=Special%3ASearchPathways&doSearch=1&sa=Search"}});Polymer({is:"jso-transcript-info",properties:{transcript:{type:Object},ensemblUrl:{type:String,computed:"computeEnsemblUrl(transcript)"}},computeEnsemblUrl:function(transcript){return"http://www.ensembl.org/Multi/Search/Results?q="+transcript.name}});Polymer({is:"jso-xref-info",properties:{xref:{type:Object},url:{type:String,computed:"computeUrl(xref)"}},dbs:{go:"http://amigo.geneontology.org/amigo/term/",interpro:"http://www.ebi.ac.uk/interpro/entry/"},computeUrl:function(xref){return this.dbs[xref.dbName]+xref.id}});Polymer({is:"jso-transcript-xrefs-info",properties:{transcript:{type:Object,observer:"transcriptChanged"},count:{type:Number,value:0},dbname:{type:String}},transcriptChanged:function(neo,old){if(neo){this.count=0}},filter:function(item){if(item.dbName==this.dbname){this.count++;return true}else{return false}}});Polymer({is:"jso-proteins-3d",properties:{proteins:{type:Array,observer:"proteinsChanged"},selected:{type:Object}},proteinsChanged:function(neo,old){if(neo&&neo.length>0){this.loadProtein(neo[0].id);this.set("selected",neo[0])}},handleClick:function(e){this.set("selected",e.model.protein);this.loadProtein(this.selected.id)},isSelected:function(protein,selected){return protein==selected},loadProtein:function(pdb_name){ChemDoodle.default_backgroundColor="#fafafa";ChemDoodle.default_border="1px solid transparent";var pdb=new ChemDoodle.TransformCanvas3D("canvas",440,330);if(!pdb.gl){pdb.emptyMessage="Your browser does not support WebGL";pdb.displayMessage()}else{pdb.specs.set3DRepresentation("Ball and Stick");pdb.specs.proteins_ribbonCartoonize=true;$.get("http://www.rcsb.org/pdb/files/"+pdb_name+".pdb",function(data){var mol=ChemDoodle.readPDB(data);pdb.loadMolecule(mol)})}}});JsoGeneInfoPanel=Polymer({is:"jso-gene-info-panel",factoryImpl:function(query,feature,host,species){this.feature=feature;this.host=host;this.species=species;this.query=query},properties:{query:{type:String,observer:"queryChanged"},feature:{type:Object},host:{type:String},species:{type:Object},gene:{type:Object},proteins:{type:Array},options:{type:Array,value:[{section:"Genomic"},{option:"Information"},{option:"Transcripts"},{section:"Functional information"},{option:"GO"},{option:"Interpro"},{section:"Protein"},{option:"3D structure"}]},option:{type:String}},handlePanelHidden:function(){this.parentNode.removeChild(this)},queryChanged:function(neo,old){if(neo){this.getInfo()}},getInfo:function(){var me=this;CellBaseManager.get({host:this.host,species:this.species,category:"feature",subCategory:"gene",query:this.query,resource:"info",success:function(response){me.set("gene",response.response[0].result[0]);console.log(me.gene)},error:function(){console.log("Server error")}});CellBaseManager.get({host:this.host,species:this.species,category:"feature",subCategory:"id",query:this.query,resource:"xref",params:{dbname:"pdb"},success:function(response){me.set("proteins",response.response[0].result)},error:function(){console.log("Server error")}})},handleOption:function(e){var option=e.detail;var els=Polymer.dom(this.$.right).querySelectorAll("[option]");for(var i=0;i<els.length;i++){var el=els[i];if(el.getAttribute("option")==option){el.removeAttribute("hidden")}else{el.setAttribute("hidden","")}}}});Polymer({is:"jso-exon-info",properties:{exon:{type:Object},ensemblUrl:{type:String,computed:"computeEnsemblUrl(exon)"}},computeEnsemblUrl:function(exon){return"http://www.ensembl.org/Multi/Search/Results?q="+exon.name}});Polymer({is:"jso-snp-info",properties:{snp:{type:Object},ensemblUrl:{type:String,computed:"computeEnsemblUrl(snp)"}},computeEnsemblUrl:function(snp){return"http://www.ensembl.org/Multi/Search/Results?q="+snp.id}});JsoTranscriptInfoPanel=Polymer({is:"jso-transcript-info-panel",factoryImpl:function(query,feature,host,species){this.feature=feature;this.host=host;this.species=species;this.query=query},properties:{query:{type:String,observer:"queryChanged"},feature:{type:Object},host:{type:String},species:{type:Object},gene:{type:Object},transcript:{type:Object},snps:{type:Array},snpcols:{type:Array,value:[{name:"id",title:"Id"},{name:"alleleString",title:"Alleles"},{name:"displayConsequenceType",width:170,title:"SO term"},{title:"Location (strand)",name:"location",width:180,formula:function(row){return new Region(row).toString()+" ("+row.strand+")"},type:"none"}]},variants:{type:Array},variantcols:{type:Array,value:[{name:"reference",title:"Reference"},{name:"alternate",title:"Alternate"},{title:"Location",name:"location",width:180,formula:function(row){return new Region(row).toString()},type:"none"}]},tfbss:{type:Array},tfbscols:{type:Array,value:[{name:"name",title:"Name"},{name:"cellTypes",title:"Cell types"},{name:"score",title:"Score"},{title:"Location",name:"location",width:180,formula:function(row){return new Region(row).toString()},type:"none"}]},mirnas:{type:Array},mirnacols:{type:Array,value:[{name:"name",title:"Name"},{name:"score",title:"Score"},{name:"source",title:"Source"},{title:"Location (strand)",name:"location",width:190,formula:function(row){return new Region(row).toString()+" ("+row.strand+")"},type:"none"}]},proteins:{type:Array},options:{type:Array,value:[{section:"Genomic"},{option:"Information"},{option:"Gene"},{option:"Exons"},{section:"Functional information"},{option:"GO"},{option:"Interpro"},{section:"Variation"},{option:"SNPs"},{option:"Clinical"},{section:"Regulatory"},{option:"TFBS"},{option:"miRNA Targets"},{section:"Protein"},{option:"3D structure"}]},option:{type:String}},handlePanelHidden:function(){this.parentNode.removeChild(this)},queryChanged:function(neo,old){if(neo){this.getInfo()}},getInfo:function(){var me=this;CellBaseManager.get({host:this.host,species:this.species,category:"feature",subCategory:"transcript",query:this.query,resource:"info",success:function(response){me.set("gene",response.response[0].result[0]);me.set("transcript",response.response[0].result[0].transcripts);console.log(me.gene);console.log(me.transcript)},error:function(){console.log("Server error")}});CellBaseManager.get({host:this.host,species:this.species,category:"feature",subCategory:"id",query:this.query,resource:"xref",params:{dbname:"pdb"},success:function(response){me.set("proteins",response.response[0].result)},error:function(){console.log("Server error")}});CellBaseManager.get({host:this.host,species:this.species,category:"genomic",subCategory:"region",query:new Region(this.feature),resource:"snp",params:{exclude:"consequenceTypes,transcriptVariations,populationFrequencies,xrefs,_chunkIds"},success:function(response){me.set("snps",response.response[0].result)},error:function(){console.log("Server error")}});CellBaseManager.get({host:this.host,species:this.species,category:"genomic",subCategory:"region",query:new Region(this.feature),resource:"clinical",params:{include:"chromosome,start,end,reference,alternate"},success:function(response){me.set("variants",response.response[0].result)},error:function(){console.log("Server error")}});CellBaseManager.get({host:this.host,species:this.species,category:"genomic",subCategory:"region",query:new Region(this.feature),resource:"regulatory",params:{type:"TF_binding_site"},success:function(response){me.set("tfbss",response.response[0].result)},error:function(){console.log("Server error")}});CellBaseManager.get({host:this.host,species:this.species,category:"genomic",subCategory:"region",query:new Region(this.feature),resource:"regulatory",params:{type:"mirna_target"},success:function(response){me.set("mirnas",response.response[0].result)},error:function(){console.log("Server error")}})},handleOption:function(e){var option=e.detail;var els=Polymer.dom(this.$.right).querySelectorAll("[option]");for(var i=0;i<els.length;i++){var el=els[i];if(el.getAttribute("option")==option){el.removeAttribute("hidden")}else{el.setAttribute("hidden","")}}}});JsoSnpInfoPanel=Polymer({is:"jso-snp-info-panel",factoryImpl:function(query,feature,host,species){this.feature=feature;this.host=host;this.species=species;this.query=query},properties:{query:{type:String,observer:"queryChanged"},feature:{type:Object},host:{type:String},species:{type:Object},snp:{type:Object},transcripts:{type:Array},options:{type:Array,value:[{section:"Genomic"},{option:"Information"},{option:"Transcripts"},{section:"Annotation"},{option:"Consequence Type"},{option:"Clinical"}]},option:{type:String}},handlePanelHidden:function(){this.parentNode.removeChild(this)},queryChanged:function(neo,old){if(neo){this.getInfo()}},getInfo:function(){var me=this;CellBaseManager.get({host:this.host,species:this.species,category:"feature",subCategory:"snp",query:this.query,resource:"info",success:function(response){me.set("snp",response.response[0].result[0]);console.log(me.snp)},error:function(){console.log("Server error")}});CellBaseManager.get({host:this.host,species:this.species,category:"genomic",subCategory:"region",query:new Region(this.feature),resource:"gene",success:function(response){var genes=response.response[0].result;var transcripts=[];for(var i=0;i<genes.length;i++){var gene=genes[i];for(var j=0;j<gene.transcripts.length;j++){var transcript=gene.transcripts[j];if(me.feature.start<=transcript.end&&me.feature.end>=transcript.start){transcripts.push(transcript)}}}me.set("transcripts",transcripts);console.log(me.transcripts)},error:function(){console.log("Server error")}})},handleOption:function(e){var option=e.detail;var els=Polymer.dom(this.$.right).querySelectorAll("[option]");for(var i=0;i<els.length;i++){var el=els[i];if(el.getAttribute("option")==option){el.removeAttribute("hidden")}else{el.setAttribute("hidden","")}}}});Polymer({is:"jso-genome-viewer-element",properties:{selectedSpecies:{type:Object,value:function(){return DEFAULT_SPECIES}},region:{type:Object,value:function(){var region=new Region;region.load("1:1004608-1004608");return region}},width:{type:Number,value:800},hidden:{type:Boolean,reflectToAttribute:true,observer:"hiddenChanged",nofity:true}},_resizing:false,hiddenChanged:function(neo,old){if(neo==false&&this.genomeViewer==null){this.createGenomeViewer();this.genomeViewer.draw();this.genomeViewer.toggleAutoHeight(true)}},created:function(){var me=this;var after_resize=function(){var timer=0;return function(callback,ms){clearTimeout(timer);timer=setTimeout(callback,ms)}}();window.addEventListener("resize",function(e){after_resize(function(){console.log(" new Size ----------\x3e "+me.getBoundingClientRect().width);me.genomeViewer.setWidth(me.getBoundingClientRect().width)},300)})},createGenomeViewer:function(config){if(config!=null){config.target=this.$.gv;this.genomeViewer=new GenomeViewer(config);this.addOverviewTracks()}else{var w=this.getBoundingClientRect().width;if(w==0){w=this.width}this.genomeViewer=new GenomeViewer({cellBaseHost:CELLBASE_HOST,cellBaseVersion:"v3",target:this.$.gv,width:w,region:this.region,availableSpecies:AVAILABLE_SPECIES,species:this.selectedSpecies,sidePanel:false,resizable:false,karyotypePanelConfig:{hidden:true,collapsed:false,collapsible:true},chromosomePanelConfig:{hidden:true,collapsed:false,collapsible:true},regionPanelConfig:{hidden:false,collapsed:false,collapsible:true},drawStatusBar:true,navigationBarConfig:{componentsConfig:{menuButton:false,leftSideButton:false,restoreDefaultRegionButton:false,regionHistoryButton:false,speciesButton:false,chromosomesButton:false,karyotypeButton:false,chromosomeButton:false,searchControl:false}}});this.addOverviewTracks();this.addDefaultTracks()}this.fire("created");return this.genomeViewer},addOverviewTracks:function(){var me=this;var renderer=new FeatureRenderer(FEATURE_TYPES.gene);renderer.on({"feature:click":function(event){console.log(event)}});var gene=new FeatureTrack({minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,height:100,renderer:renderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",params:{exclude:"transcripts,chunkIds"},species:this.genomeViewer.species,cacheConfig:{chunkSize:1e5}})});this.genomeViewer.addOverviewTrack(gene)},addDefaultTracks:function(){var sequenceTrack=new FeatureTrack({title:"Sequence",height:25,visibleRegionSize:200,renderer:new SequenceRenderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"sequence",params:{},species:this.genomeViewer.species,cacheConfig:{chunkSize:100}})});this.genomeViewer.addTrack(sequenceTrack);var geneTrack=new GeneTrack({title:"Gene",minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,minTranscriptRegionSize:2e5,height:100,renderer:new GeneRenderer({handlers:{"feature:click":function(e){console.log(e);console.log(e.feature);switch(e.featureType){case"gene":me.$.content.appendChild(new JsoGeneInfoPanel(e.query,e.feature,CELLBASE_HOST,me.genomeViewer.species));break;case"transcript":me.$.content.appendChild(new JsoTranscriptInfoPanel(e.query,e.feature,CELLBASE_HOST,me.genomeViewer.species));break;default:break}}}}),dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",species:this.genomeViewer.species,params:{exclude:"transcripts.tfbs,transcripts.xrefs,transcripts.exons.sequence"},cacheConfig:{chunkSize:1e5}})});this.genomeViewer.addTrack(geneTrack);var renderer=new FeatureRenderer(FEATURE_TYPES.snp);renderer.on("feature:click",function(e){me.$.content.appendChild(new JsoSnpInfoPanel(e.query,e.feature,CELLBASE_HOST,me.genomeViewer.species))});snpTrack=new FeatureTrack({title:"SNP",featureType:"SNP",minHistogramRegionSize:12e3,maxLabelRegionSize:3e3,height:120,renderer:renderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"snp",params:{exclude:"transcriptVariations,xrefs,samples"},species:this.genomeViewer.species,cacheConfig:{chunkSize:1e4}})});this.genomeViewer.addTrack(snpTrack)}});Polymer({is:"jso-help-menu"});Polymer({is:"jso-opencga-input-text",properties:{label:{type:String},value:{type:String},placeholder:{type:String},required:{type:Boolean,reflectToAttribute:true,value:false},pattern:{type:String},message:{type:String},tooltip:{type:String,value:""},_hideTooltip:{type:Boolean}},ready:function(){this._hideTooltip=this.tooltip==""},getValue:function(){return this.value}});(function(){var lastWindow_;JsoPanel=Polymer({is:"jso-panel",properties:{fixed:{type:Boolean,reflectToAttribute:true,value:false},closable:{type:Boolean,reflectToAttribute:true,value:false},collapsible:{type:Boolean,reflectToAttribute:true,value:false},collapsed:{type:Boolean,reflectToAttribute:true,value:false},movable:{type:Boolean,reflectToAttribute:true,value:false},expandible:{type:Boolean,reflectToAttribute:true,value:false},expanded:{type:Boolean,reflectToAttribute:true,value:false},modal:{type:Boolean,reflectToAttribute:true,value:false},constraint:{type:Boolean,reflectToAttribute:true,value:false},moved:{type:Boolean,reflectToAttribute:true,value:false},loading:{type:Boolean,value:false},lightHeader:{type:Boolean,reflectToAttribute:true,value:false},hidden:{type:Boolean,reflectToAttribute:true,observer:"hiddenChanged"},_hasfooter:{type:Boolean,reflectToAttribute:true,value:false},_firstHidden:{type:Boolean,value:false}},listeners:{mousedown:"_updateLastWindow"},hostAttributes:{class:"vertical layout flex"},ready:function(){this.async(function(){if(this.fixed){this._center()}},50);this._hasfooter=this.$.footer.childElementCount>0;var child=this.$.container.querySelector(".container");child._parentJsoPanel=this},hiddenChanged:function(neo,old){if(neo==false){if(this.modal){this._center()}if(this.fixed&&!this._firstHidden){this._center()}this._firstHidden=true;this._updateLastWindow()}this.fire("hidden",this.hidden)},isContainerHidden:function(collapsible,collapsed){if(collapsible&&collapsed){return true}return false},isFooterHidden:function(_hasfooter,collapsible,collapsed){if(_hasfooter){if(collapsible&&collapsed&&_hasfooter){return true}else{return false}}else{return true}},isPinHidden:function(movable,moved,fixed){if(fixed){return true}if(this.modal){return true}if(!movable){return true}return!moved},setLoading:function(loading){this.loading=loading},toggleCollapse:function(){if(this.collapsible){this.collapsed=!this.collapsed}},handleHeaderDblclick:function(e){this.toggleCollapse()},handleCollapseAction:function(e){this.toggleCollapse()},handleCloseAction:function(){this.hidden=true;this.fire("close")},handlePinAction:function(e){this.style.position="";this.style.left="";this.style.top="";this.style.top="";this.style["z-index"]="";this.moved=false},handleExpandAction:function(e){e.stopPropagation();var currentZIndex=-1;if(!isNaN(this.style["z-index"])){currentZIndex=parseInt(this.style["z-index"])}if(this.expandible){this.expanded=!this.expanded;if(this.expanded){this.style.position="fixed";this.style.width="100%";this.style.height="100%";this.style.top="0";this.style.left="0";this.style["z-index"]=currentZIndex+100}else{this.style.width="";this.style.height="";this.style.position="";this.style.top="";this.style.left="";if(currentZIndex>=-1){this.style["z-index"]=currentZIndex-100}else{this.style["z-index"]=""}this._center()}}this.fire("expand")},handleActionsMouseDown:function(e){e.stopPropagation()},handleHeaderMouseDown:function(e){if(this.movable&&!this.expanded){document.body.classList.add("jso-nosel");var me=this;var bcr=this.$.header.getBoundingClientRect();this.headerOffsetX=e.clientX-bcr.left;this.headerOffsetY=e.clientY-bcr.top;window.removeEventListener("mousemove",this.mouseMoveHandler,true);this.mouseMoveHandler=function(moveEvent){me.handleMouseMove(moveEvent)};window.addEventListener("mousemove",this.mouseMoveHandler,true)}},handleHeaderMouseUp:function(){if(this.movable){window.removeEventListener("mousemove",this.mouseMoveHandler,true);document.body.classList.remove("jso-nosel")}},handleMouseMove:function(e){if(this.movable){this.moved=true;this.style.position="fixed";var left=e.clientX-this.headerOffsetX;var top=e.clientY-this.headerOffsetY;if(this.constraint){var bcr=this.getBoundingClientRect();var bcrHeader=this.$.header.getBoundingClientRect();var rightLimit=window.innerWidth-bcr.width;var bottomLimit=window.innerHeight-bcrHeader.height;if(left>0&&left<rightLimit){this.style.left=left+"px"}if(top>0&&top<bottomLimit){this.style.top=top+"px"}}else{this.style.left=left+"px";this.style.top=top+"px"}}},_center:function(){var bcr=this.getBoundingClientRect();this.style.left=window.innerWidth/2-bcr.width/2+"px";this.style.top=window.innerHeight/2-bcr.height/2+"px"},_updateLastWindow:function(){if(lastWindow_){if(!lastWindow_.expanded){lastWindow_.style["z-index"]="1"}}lastWindow_=this;if(lastWindow_){if(!lastWindow_.expanded){lastWindow_.style["z-index"]="2"}}}})})();Polymer({is:"jso-table",properties:{columns:{type:Array,notify:true,value:function(){return[]}},data:{type:Array,notify:true,value:function(){return[]}},viewData:{type:Array,notify:true,value:function(){return[]}},request:{type:Object,observer:"requestChanged"},enableRemote:{type:Boolean,observer:"enableRemoteChanged",value:false},enablePaging:{type:Boolean,observer:"enablePagingChanged",value:false},enableResize:{type:Boolean,value:false},pageSize:{type:Number,observer:"pageSizeChanged",value:10},currentPage:{type:Number,observer:"currentPageChanged",value:1},pageFirstItem:{type:Number,computed:"computePageFirstItem(currentPage, pageSize, itemCount)",value:0},pageLastItem:{type:Number,computed:"computePageLastItem(currentPage, pageSize, itemCount)",value:0},selected:{type:Array,notify:true,value:function(){return[]}},enableSelect:{type:Boolean,value:false,reflectToAttribute:true},disableTooltip:{type:Boolean,value:false,reflectToAttribute:true},lastSelectedRow:{type:Object,value:null},enableFilter:{type:Boolean,value:false,reflectToAttribute:true},filters:{type:Object,value:function(){return{}}},itemCount:{type:Number,value:0},pageCount:{type:Number,value:0},loading:{type:Boolean,value:false,observer:"handleLoading"},loadingMsg:{type:String,value:"Loading"},draggable:{type:Boolean,reflectToAttribute:true,value:false},enableEdit:{type:Boolean,reflectToAttribute:true,value:false}},observers:["dataChanged(data.splices)","selectedChanged(selected.splices)","viewDataChanged(viewData.splices)","columnsChanged(columns.splices)"],listeners:{wheel:"handleScroll",mouseleave:"handleColumnsMenuLeave"},isColumnVisible:function(v){return v.visible!==false},handleColumnVisibilityClick:function(e){var columnIndex=this.columns.indexOf(e.model.item);this.set("columns."+columnIndex+".visible",e.currentTarget.checked);this.columnsChanged()},handleScroll:function(e){e.preventDefault();if(e.deltaY>0){this.handleNextClick()}if(e.deltaY<0){this.handlePreviousClick()}},handleColumnsMenu:function(e){e.preventDefault();e.stopPropagation();this.$.columnsMenu.style.opacity="1";this.$.columnsMenu.style.visibility="visible";this.$.columnsMenu.style.top=e.clientY+10+"px";this.$.columnsMenu.style.left=e.clientX+"px"},handleColumnsMenuLeave:function(e){e.preventDefault();e.stopPropagation();this.$.columnsMenu.style.opacity="";this.$.columnsMenu.style.visibility=""},selectedChanged:function(changeRecord){this._updateSelected();this.fire("selected",this.selected)},_updateSelected:function(){var els=Polymer.dom(this.$.list).querySelectorAll(".table-row");for(var i=0;i<els.length;i++){var el=els[i];var index=this.selected.indexOf(el._rowData);if(index>=0){el.classList.add("selected")}else{el.classList.remove("selected")}}},dataChanged:function(neo,old){for(var i=0;i<this.data.length;i++){var row=this.data[i];delete row._filtered}this.refreshPagination()},refreshPagination:function(){this.currentPage=1;var count=0;if(this.data){this.data.forEach(function(row){if(row._filtered||row._filtered==null){count++}})}this.itemCount=count;this.pageCount=Math.ceil(count/this.pageSize);this.filterPage()},filterPage:function(){var filteredRows=this.enableFilter?this.data.filter(function(r){if(r._filtered==undefined){return true}return r._filtered}):this.data;if(this.enablePaging){var from=(this.currentPage-1)*this.pageSize;var to=from+this.pageSize;if(this.request){this.checkRemote()}else{this.set("viewData",filteredRows.slice(from,to));this._updateSelected()}}else{var viewData=[];for(var i=0;filteredRows&&i<filteredRows.length;i++){var row=filteredRows[i];viewData.push(row)}this.set("viewData",viewData)}},viewDataChanged:function(neo,old){while(this.$.list.firstChild){this.$.list.removeChild(this.$.list.firstChild)}for(var i=0;this.viewData&&i<this.viewData.length;i++){var rowData=this.viewData[i];this._createRow(rowData)}},handleFirstClick:function(){this.currentPage=1},handlePreviousClick:function(){if(this.currentPage>1){this.currentPage--}},handleNextClick:function(){if(this.currentPage<this.pageCount){this.currentPage++}},handleLastClick:function(){this.currentPage=this.pageCount},currentPageChanged:function(neo,old){this.currentPage=this.currentPage?parseInt(this.currentPage):0;this.currentPage=this.currentPage<1?1:this.currentPage;this.currentPage=this.pageCount>0&&this.currentPage>this.pageCount?this.pageCount:this.currentPage;this.filterPage()},pageSizeChanged:function(){this.pagesize=parseInt(this.pagesize)
;this.refreshPagination()},computePageFirstItem:function(currentPage,pageSize,itemCount){return(currentPage-1)*pageSize+1},computePageLastItem:function(currentPage,pageSize,itemCount){var end=currentPage*pageSize;if(itemCount<end){return itemCount}return end},computePageTotal:function(pageSize,itemCount){return Math.ceil(itemCount/pageSize)},enablePagingChanged:function(neo,old){this.refreshPagination()},enableRemoteChanged:function(neo,old){if(this.request){this.checkRemote()}},requestChanged:function(neo,old){if(this.currentPage!=1){this.currentPage=1}else if(this.request){this.checkRemote()}},columnsChanged:function(neo,old){this.updateColumns();this.viewDataChanged()},clear:function(){this.data=[];this.viewData=[];this.currentPage=1;this.columns=[]},refresh:function(){this.dataChanged()},checkRemote:function(){var me=this;if(this.enableRemote){this._callRemote(function(resp){me.itemCount=me.request.parseTotal(resp);me.pageCount=Math.ceil(me.itemCount/me.pageSize);me.viewData=me.request.parse(resp)})}else{}},_callRemote:function(callback){var method="GET";if(typeof this.request.method!=="undefined"&&this.request.method!=null){method=this.request.method}var request=new XMLHttpRequest;request.onload=function(){var contentType=this.getResponseHeader("Content-Type");var resp;if(contentType==="application/json"){resp=JSON.parse(this.response,this)}else{resp=this.response}callback(resp)};request.onerror=function(){};var url=Utils.addQueryParamtersToUrl({skip:(this.currentPage-1)*this.pageSize,limit:this.pageSize},this.request.url);request.open(method,url,true);request.send();console.log(url)},updateColumns:function(){var els=this.$.headerRow.querySelectorAll(".table-header-row");for(var i=0;i<els.length;i++){this.$.headerRow.removeChild(els[i])}els=this.$.filterRow.children;for(var i=0;i<els.length;i++){this.$.filterRow.removeChild(els[i])}var totalColWidth=0;for(var i=0;i<this.columns.length;i++){var x=[];var column=this.columns[i];if(isNaN(column.width)){column.width=100}this._processColumn(column,x);column.plainColumns=x;if(column.visible!==false){totalColWidth+=column.width}}this._createHeaderRow();this._createFilterRow();this.$.header.style.width=totalColWidth+"px";this.$.filter.style.width=totalColWidth+"px";this.$.list.style.width=totalColWidth+"px";if(totalColWidth===0){this.$.list.setAttribute("hidden","")}else{this.$.list.removeAttribute("hidden")}},_createFilterRow:function(){var el=document.createElement("div");el.classList.add("horizontal","layout","style-scope","jso-table");for(var i=0;i<this.columns.length;i++){var column=this.columns[i];if(column.visible!==false){this._createFilterField(el,column)}}this.$.filterRow.appendChild(el)},_createFilterField:function(rowEl,column,rowData){var me=this;var el=document.createElement("div");el.classList.add("table-filter-field","horizontal","layout","style-scope","jso-table");if(isNaN(column.width)){el.classList.add("flex")}else{el.style.width=column.width+"px";el.style.minWidth=column.width+"px"}if(column.plainColumns.length>0){}else{if(!column.type){column.type="text"}switch(column.type){case"text":var input=document.createElement("input");input.setAttribute("type","text");input.setAttribute("placeholder","filter by "+column.title);input.classList.add("style-scope","jso-table");if(isNaN(column.width)){input.classList.add("flex")}else{input.style.width=column.width+"px"}input._col=column.name;input.addEventListener("input",function(e){var query=this.value;var filter={};if(input._col in me.filters){filter=me.filters[input._col]}if(query!=""){filter.type="text";filter.colName=input._col;filter.query=query;filter.func=null;me.filters[input._col]=filter}else{delete me.filters[input._col]}me._applyFilters()});el.appendChild(input);break;case"select":var selwrap=document.createElement("div");selwrap.classList.add("style-scope","jso-table","select");if(isNaN(column.width)){selwrap.classList.add("flex")}else{selwrap.style.width=column.width+"px"}var input=document.createElement("select");input.classList.add("style-scope","jso-table");selwrap.appendChild(input);input._col=column.name;var option=document.createElement("option");var optVal="";option.value=optVal;option.text=optVal;input.appendChild(option);for(var i=0;i<column.options.length;i++){option=document.createElement("option");optVal=column.options[i];option.value=optVal;option.text=optVal;input.appendChild(option)}input.addEventListener("click",function(e){var query=this.value;var filter={};if(input._col in me.filters){filter=me.filters[input._col]}if(query!=""){filter.type="select";filter.colName=input._col;filter.query=query;filter.func=null;me.filters[input._col]=filter}else{delete me.filters[input._col]}me._applyFilters()});el.appendChild(selwrap);break;default:var input=document.createElement("div");el.appendChild(input);break}}rowEl.appendChild(el)},_applyFilters:function(){for(var i=0;i<this.data.length;i++){var row=this.data[i];var filtered=true;for(var key in this.filters){var filter=this.filters[key];var match=false;switch(filter.type){case"text":var value=row[filter.colName].toLowerCase();match=value.indexOf(filter.query.toLowerCase())>=0;break;case"select":var value=row[filter.colName].toLowerCase();match=value===filter.query.toLowerCase();break}filtered&=match}row._filtered=filtered}this.refreshPagination()},_processColumn:function(column,x){if(column.columns&&column.columns.length>0){for(var i=0;i<column.columns.length;i++){var col=column.columns[i];col._parentColumn=column;if(column.ak){col.ak=column.ak+"."+col.name}else{col.ak=column.name+"."+col.name}if(col.columns==null){x.push(col)}this._processColumn(col,x)}}},_createHeaderRow:function(){var el=document.createElement("div");el.classList.add("table-header-row","horizontal","layout","style-scope","jso-table");for(var i=0;i<this.columns.length;i++){var column=this.columns[i];if(column.visible!==false){this._createHeaderField(el,column)}}this.$.headerRow.appendChild(el)},_setResizable:function(elem){var me=this;var columnName=".column-"+elem._column.name;var resizer=document.createElement("div");resizer.classList.add("resizer","style-scope","jso-table");elem.appendChild(resizer);var startX,startWidth;function initDrag(e){startX=e.clientX;startWidth=parseInt(document.defaultView.getComputedStyle(elem).width,10);document.documentElement.addEventListener("mousemove",doDrag,false);document.documentElement.addEventListener("mouseup",stopDrag,false)}function doDrag(e){elem.style.width=startWidth+e.clientX-startX+"px";elem.style.minWidth=startWidth+e.clientX-startX+"px"}function stopDrag(e){document.documentElement.removeEventListener("mousemove",doDrag,false);document.documentElement.removeEventListener("mouseup",stopDrag,false);var dif=e.clientX-startX;elem.style.width=startWidth+dif+"px";elem._column.width=startWidth+dif;var parentColumn=elem._column._parentColumn;while(parentColumn!=null){parentColumn.width+=dif;parentColumn=parentColumn._parentColumn}function resizeChildren(columns,d){if(Array.isArray(columns)){for(var i=0;i<columns.length;i++){var col=columns[i];col.width+=d/columns.length;resizeChildren(col.columns,d/columns.length)}}}resizeChildren(elem._column.columns,dif);me.updateColumns();me.viewDataChanged()}resizer.addEventListener("mousedown",initDrag,false)},_createHeaderField:function(rowEl,column){var me=this;var el=document.createElement("div");el.classList.add("table-header-field","vertical","layout","center-justified","style-scope","jso-table","column-"+column.name.replace(/\s/g,"_"));if(isNaN(column.width)){el.classList.add("flex")}else{el.style.width=column.width+"px";el.style.minWidth=column.width+"px"}el._column=column;var nameEl=document.createElement("div");nameEl.classList.add("name","style-scope","jso-table");nameEl.innerHTML=column.title;el.appendChild(nameEl);if(this.enableResize){this._setResizable(el)}if(column.columns&&column.columns.length>0){var subColumnsEl=document.createElement("div");subColumnsEl.classList.add("sub","horizontal","layout","style-scope","jso-table");for(var i=0;i<column.columns.length;i++){var subColumn=column.columns[i];this._createHeaderField(subColumnsEl,subColumn)}el.appendChild(subColumnsEl)}else{el.addEventListener("click",this.handleHeaderFieldClick.bind(this))}rowEl.appendChild(el)},handleHeaderFieldClick:function(e){var els=this.querySelectorAll(".table-header-field");var column=e.currentTarget._column;var sortedData=this.data.slice(0);if(e.currentTarget.classList.contains("sort-down")){for(var i=0;i<els.length;i++){var el=els[i];el.classList.remove("sort-down");el.classList.remove("sort-up")}sortedData.sort(function(b,a){if(!isNaN(b[column.name])&&!isNaN(a[column.name])){return a[column.name]-b[column.name]}else{return(a[column.name]>b[column.name])-(a[column.name]<b[column.name])}});e.currentTarget.classList.add("sort-up")}else{for(var i=0;i<els.length;i++){var el=els[i];el.classList.remove("sort-down");el.classList.remove("sort-up")}sortedData.sort(function(a,b){if(!isNaN(b[column.name])&&!isNaN(a[column.name])){return a[column.name]-b[column.name]}else{return(a[column.name]>b[column.name])-(a[column.name]<b[column.name])}});e.currentTarget.classList.add("sort-down")}this.data=sortedData},_getPos:function(row){for(var i=0;i<this.viewData.length;i++){var elem=this.viewData[i];if(elem===row){return i}}return-1},_createRow:function(rowData){var me=this;var el=document.createElement("div");el.classList.add("table-row","horizontal","layout","style-scope","jso-table");el._rowData=rowData;var id="idRow_"+this._getPos(rowData);el.setAttribute("id",id);if(this.draggable){el.setAttribute("draggable","true");el.addEventListener("dragstart",this.drag)}el.addEventListener("click",function(e){me.fire("rowclick",{row:rowData});var currentTarget=e.currentTarget;console.log("Position: "+me._getPos(currentTarget._rowData));if(me.enableSelect){if(e.ctrlKey){me._toggleSelected(currentTarget,rowData)}if(e.button===0){if(!e.ctrlKey&&!e.shiftKey){me._clearSelection();me._toggleSelected(currentTarget,rowData)}if(e.shiftKey){var first=me._getPos(me.lastSelectedRow._rowData);var last=me._getPos(currentTarget._rowData);if(last<first){var tmp=last;last=first;first=tmp}me._selectRowsBetweenIndexes(first,last)}}}});for(var i=0;i<this.columns.length;i++){var column=this.columns[i];if(column.visible!==false){this._createField(el,column,rowData)}}this.$.list.appendChild(el)},_toggleSelected:function(domElem,rowData){if(domElem.classList.contains("selected")){var index=this.selected.indexOf(rowData);if(index>=0){this.splice("selected",index,1);domElem.classList.remove("selected")}}else{if(this.selected.indexOf(rowData)<0){this.push("selected",rowData);domElem.classList.add("selected")}}this.lastSelectedRow=domElem},_selectRowsBetweenIndexes:function(first,last){var rows=this.$.list.getElementsByClassName("table-row");for(var i=0;i<rows.length;i++){var obj=rows[i];var pos=this._getPos(obj._rowData);var index=this.selected.indexOf(obj._rowData);if(pos>=first&&pos<=last){obj.classList.add("selected");if(index<0){this.push("selected",obj._rowData)}}else{if(index>=0){this.splice("selected",index,1)}}}},_clearSelection:function(){var rows=this.$.list.getElementsByClassName("table-row");for(var i=0;i<rows.length;i++){var obj=rows[i];obj.classList.remove("selected")}this.splice("selected",0,this.selected.length)},_createField:function(rowEl,column,rowData){var me=this;var el=document.createElement("div");el.classList.add("table-field","horizontal","layout","center","style-scope","jso-table");if(isNaN(column.width)){el.classList.add("flex")}else{el.style.width=column.width+"px";el.style.minWidth=column.width+"px"}if(column.type==="action"){var remove=document.createElement("i");remove.classList.add("fa","fa-remove");remove.addEventListener("click",function(e){me.fire("removerow",{row:rowData});var pos=me._getPos(rowData);if(pos>=0){me.splice("data",pos,1)}});el.appendChild(remove)}else if(column.plainColumns.length>0){for(var i=0;i<column.plainColumns.length;i++){var c=column.plainColumns[i];this._createTypeField(el,c,rowData,true)}}else{this._createTypeField(el,column,rowData)}rowEl.appendChild(el)},_createTypeField:function(el,column,rowData,isSubCol){var me=this;var defValue=column.defaultValue!=null?column.defaultValue:"";var value;if(column.formula){value=column.formula(rowData)}else{if(isSubCol==true){value=this._deepValue(rowData,column.ak)}else{value=rowData[column.name]}}if(this.enableEdit&&column.editable!=false){if(!column.type){column.type="text"}switch(column.type){case"text":var input=document.createElement("input");input.setAttribute("type","text");input.setAttribute("placeholder","");input.classList.add("style-scope","jso-table");input.style.width="100%";input._col=column.name;input.addEventListener("blur",function(e){var val=this.value;rowData.attributes[column.name]=val;me.fire("update-row",rowData)});input.value=value;el.appendChild(input);break;case"select":el.classList.add("table-field-nopadding");var selwrap=document.createElement("div");selwrap.classList.add("style-scope","jso-table","select");if(isNaN(column.width)){selwrap.classList.add("flex")}else{selwrap.style.width=column.width+"px"}var input=document.createElement("select");input.classList.add("style-scope","jso-table");selwrap.appendChild(input);input._col=column.name;var option=document.createElement("option");var optVal="";option.value=optVal;option.text=optVal;input.appendChild(option);for(var i=0;i<column.options.length;i++){option=document.createElement("option");optVal=column.options[i];option.value=optVal;option.text=optVal;input.appendChild(option)}input.addEventListener("click",function(e){var val=this.value;rowData.attributes[column.name]=val});input.value=value;el.appendChild(selwrap);break}}else{var cEl=document.createElement("div");cEl.classList.add("style-scope","jso-table");if(isNaN(column.width)){cEl.classList.add("flex")}else{cEl.style.width=column.width+"px"}cEl.innerHTML=value!=null?value:defValue;if(!this.disableTooltip){var tooltipValue=value==null?"":value;cEl.setAttribute("title",tooltipValue)}cEl.classList.add("column-"+column.name.replace(/\s/g,"_"));el.appendChild(cEl)}},_deepValue:function(obj,path){for(var i=0,path=path.split("."),len=path.length;i<len;i++){var auxPath=path[i];if(auxPath==="undefined"){continue}obj=auxPath}return obj},contains:function(searchElem,compareFunction){var cmp=function(a,b){return a===b};if(compareFunction&&typeof compareFunction==="function"){cmp=compareFunction}for(var i=0;i<this.data.length;i++){var elem=this.data[i];if(cmp(searchElem,elem)){return true}}return false},setLoading:function(loading){this.loading=loading},allowDrop:function(e){console.log("drag!!!");e.preventDefault()},drop:function(e){e.preventDefault();var data=JSON.parse(e.dataTransfer.getData("rowData"));this.push("data",data)},drag:function(e){e.dataTransfer.setData("rowData",JSON.stringify(e.currentTarget._rowData))},handleLoading:function(neo,old){},selectElem:function(elem,compareFunction){var selected=null;for(var i=0;i<this.viewData.length&&selected==null;i++){var obj=this.viewData[i];if(compareFunction(elem,obj)){selected=obj}}if(selected!=null){this.selected=[selected]}else{this._clearSelection()}}});Polymer({is:"jso-opencga-study-tree",properties:{study:{type:Object},selected:{type:Boolean,reflectToAttribute:true},open:{type:Boolean,value:false}},isEmpty:function(study){return study.files.length<=0},handleClick:function(e){},handleArrowClick:function(e){if(this.study.files.length>0){this.open=!this.open}}});Polymer({is:"jso-opencga-project-tree",properties:{project:{type:Object},selected:{type:Boolean,reflectToAttribute:true},selectedStudy:{type:Object},open:{type:Boolean,value:true}},isEmpty:function(project){return project.studies.length<=0},handleClick:function(e){this.fire("clickproject")},handleDblclick:function(e){this.toggleOpen()},handleArrowClick:function(e){this.toggleOpen()},handleStudyClick:function(e){this.selectedStudy=e.currentTarget;this.fire("clickstudy")},toggleOpen:function(){if(this.project.studies.length!=0){this.open=!this.open}}});Polymer({is:"jso-opencga-study-select",properties:{projects:{type:Array,observer:"projectsChanged"},selectedStudy:{type:Object,observer:"selectedStudyChanged"}},handleStudyClick:function(e){this.selectedStudy=e.model.study;this._cleanStudiesSelection();e.currentTarget.setAttribute("data-checked","")},projectsChanged:function(neo,old){},_cleanStudiesSelection:function(){var sel=this.querySelectorAll(".study-item");for(var i=0;i<sel.length;i++){var el=sel[i];el.removeAttribute("data-checked")}},selectedStudyChanged:function(neo,old){if(neo!=null){var sel=this.querySelectorAll(".study-item");for(var i=0;i<sel.length;i++){var el=sel[i];el.removeAttribute("data-checked");if(this.selectedStudy.id==el.dataset.id){el.setAttribute("data-checked","")}}}}});Polymer({is:"jso-opencga-bioformat",properties:{bioformats:{type:Array,observer:"selectedBioformatChanged"},hideBioformats:{type:Boolean,value:false},selectedBioformat:{type:Object}},isChecked:function(bioformats){if(Array.isArray(bioformats)&&bioformats.length===1){return true}else{return false}},selectedBioformatChanged:function(neo,old){var radios=Polymer.dom(this).querySelectorAll('input[name="bioformat"]');for(var i=0;i<radios.length;i++){var radio=radios[i];if(this.bioformats==null){radio.disabled=false}else{if(this.bioformats.indexOf(radio.value)>=0){console.log(radio.value);radio.disabled=false}else{radio.disabled=true}}}},handleRadioChange:function(e){this.set("selectedBioformat",e.model.bioformat)},getSelected:function(){return this.selectedBioformat}});Polymer({is:"jso-opencga-upload-file",properties:{fileName:{type:String,value:"None"},projects:{type:Array,notify:true},selectedProject:{type:Object,observer:"selectedProjectChanged"},selectedStudy:{type:Object,value:null,observer:"selectedStudyChanged"},selectedFolder:{type:Object,observer:"selectedFolderChanged"},disableIndex:{type:Boolean,value:false,reflectToAttribute:true},bioformats:{type:Array,value:function(){return[]}},uploading:{type:Boolean,value:false},percentProgress:{type:Number,value:0,observer:"percentProgressChanged"},message:{type:String,value:""},hideBioformats:{type:Boolean,value:false},showSelectStudy:{type:Boolean,value:true}},ready:function(e){if(this.bioformats.length==0){console.log("No bioformats selected");this.checkBioformats()}},checkBioformats:function(){var numberOfBioformats=0;var bioformatIdx;for(var i=0;i<this.bioformats.length;i++){var format=this.bioformats[i];if(format.key){numberOfBioformats++;bioformatIdx=i}}if(numberOfBioformats==1){this.hideBioformats=true;this.selectedBioformat=this.bioformats[bioformatIdx].value}},handleBrowseClick:function(e){if(this.uploading==false){this.$.fileInput.click()}},handleInputChange:function(){if(this.uploading==false){var inputFile=this.$.fileInput.files[0];this.fileName=inputFile.name}},handleForm:function(){var me=this;if(this.uploading==false){var selStudy;if(this.$.studySelect.selectedStudy!=null){selStudy=this.$.studySelect.selectedStudy}if(this.selectedStudy!=null){selStudy=this.selectedStudy}if(selStudy==null){alert("Please select a study");return}var selBioformat;if(this.$.bioformatSelect.selectedBioformat!=null){selBioformat=this.$.bioformatSelect.selectedBioformat}if(this.selectedBioformat!=null){selBioformat=this.selectedBiormat}if(selBioformat==null){alert("Please select a bioformat");return}var folder="";if(this.selectedFolder!=null){folder=this.selectedFolder.path}if(this.$.form.checkValidity()){this.uploading=true;this.message="";var config={inputFile:this.$.fileInput.files[0],fileName:this.fileName,userId:Cookies("bioinfo_user"),sid:Cookies("bioinfo_sid"),studyId:selStudy.id,relativeFilePath:folder+this.fileName,fileFormat:"PLAIN",bioFormat:selBioformat.value,description:"",callbackProgress:function(chunk,total,response){me.percentProgress=Math.round(chunk.id/total*100);if(chunk.last){me.percentProgress=100;me.uploading=false;me.message="Done";me.$.fileInput.value=null;me.fileName="";me.fire("need-refresh");me.fire("file-uploaded");var uploadedFile=response.response[0].result[0]}},error:function(msg){me.$.fileInput.value=null;me.fileName="";me.uploading=false;me.message=msg}};OpencgaManager.files.upload2(config)}else{alert("Please select a file");return}}},percentProgressChanged:function(neo,old){this.$.progressBar.style.width=neo+"%"},selectedProjectChanged:function(neo,old){},selectedStudyChanged:function(neo,old){this.fileName="None";if(this.selectedStudy==null)this.showSelectStudy=true;else this.showSelectStudy=false},selectedFolderChanged:function(neo,old){this.fileName="None"},_indexFile:function(file){console.log(file.id);if(!this.disableIndex){OpencgaManager.files.index({id:file.id,query:{sid:Cookies("bioinfo_sid"),storageEngine:"mongodb"},request:{success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){console.log("index");console.log(response)}else{}},error:function(){alert("Server error, try again later.")}}})}else{console.log("Disabled Index")}}});Polymer({is:"jso-opencga-create-folder",properties:{folder:{type:Object,notify:true,value:null},study:{type:Object},message:{type:String,value:""},newFolderName:{type:String,value:""}},handleFormKey:function(e){if(e.which==13){e.preventDefault();this.handleForm()}},handleForm:function(e){var me=this;this.message="";if(this.$.form.checkValidity()){OpencgaManager.files.createFolder({query:{sid:Cookies("bioinfo_sid"),folder:this.folder.path+this.newFolderName,studyId:this.study.id},request:{success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){me.message="";me.name="";me.fire("need-refresh");me.fire("folder-created")}else{me.message=response.response[0].errorMsg}},error:function(){alert("Server error, try again later.")}}})}else{this.message="Only letters, numbers or slash(-,_) admitted"}}});Polymer({is:"jso-opencga-folder-list-item",properties:{file:{type:Object,notify:true},indexableBioFormats:{type:Array,value:["VARIANT","ALIGNMENT"]}},computeDate:function(file){var date=new Date(Date.parse(Utils.parseDate(file.creationDate)));return date.toLocaleString("en-us",{month:"short"})+" "+date.getDate()+", "+date.getFullYear()},computeIcon:function(file){var iconMap={FOLDER:"fa fa-folder",FILE:"fa fa-file-o"};return iconMap[file.type]},computeStatusIcon:function(file){var iconMap={INDEXING:"fa fa-cog fa-spin",READY:"fa fa-check",NONE:"fa fa-check"};if(file.index){return iconMap[file.index.status]}return""},computeStatus:function(file){if(file.index&&this.indexableBioFormats.indexOf(file.bioformat)!=-1){return file.index.status}return"--"}});Polymer({is:"jso-opencga-folder-list",properties:{folder:{type:Object,notify:true,value:null},files:{type:Array,notify:true,value:function(){return[]}},selected:{type:Object,notify:true,value:function(){return null}},study:{type:Object},mode:{type:String,reflectToAttribute:true}},handleUploadFile:function(e){this.fire("upload-file")},handleCreateFolder:function(e){if(this.$.createFolderModal.hasAttribute("hidden")){this.$.createFolderModal.removeAttribute("hidden")}else{this.$.createFolderModal.setAttribute("hidden","")}},handleFolderCreated:function(e){this.$.createFolderModal.setAttribute("hidden","")},handleDeleteFile:function(e){if(confirm("Are you sure?")){this._deleteFile()}},handleIndexFile:function(e){this._indexFile()},handleFileClick:function(e){this.selected=e.currentTarget.file;var sel=this.querySelector("jso-opencga-folder-list-item[selected]");if(sel){sel.removeAttribute("selected")}e.currentTarget.setAttribute("selected","");this.fire("fileselect",this.selected)},handleFileDblClick:function(e){var file=e.currentTarget.file;if(file.type=="FOLDER"){this.fire("openfolder",file)}else if(file.type=="FILE"){this.fire("previewfile",file)}},handlePreviewFile:function(e){if(this.selected){this.fire("previewfile",this.selected)}},handleBack:function(){this.fire("back")},checkFolder:function(folder){return folder==null},checkBack:function(folder){if(folder==null){return true}else{if(folder.name=="."){return true}}return false},checkSelected:function(selected){return selected==null},checkSelectedFile:function(selected){return selected==null||selected.type!="FILE"},handleHiddenIndex:function(selected){if(selected==null){return true}else{if(selected.type=="FOLDER"){return true}}return selected.index!=null},checkFilters:function(item){return true},isFolderMode:function(mode){return mode==="folder"},_deleteFile:function(){var me=this;if(this.selected){OpencgaManager.files.delete({id:this.selected.id,query:{sid:Cookies("bioinfo_sid")},request:{success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){console.log("delete");console.log(response);me.fire("need-refresh")}else{console.log(response.response[0].errorMsg)}},error:function(){alert("Server error, try again later.")}}})}},_indexFile:function(){var me=this;if(this.selected){OpencgaManager.files.index({id:this.selected.id,query:{sid:Cookies("bioinfo_sid"),storageEngine:"mongodb"},request:{success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){console.log("index");console.log(response);me.fire("need-refresh")}else{console.log(response.response[0].errorMsg)}},error:function(){alert("Server error, try again later.")}}})}}});Polymer({is:"jso-opencga-project-select",properties:{projects:{type:Array,observer:"projectsChanged"},selectedProject:{type:String}},handleProjectClick:function(e){var sel=this.querySelectorAll(".project-item");for(var i=0;i<sel.length;i++){var el=sel[i];el.removeAttribute("data-checked")}this.selectedProject=e.currentTarget.dataset.id;e.currentTarget.setAttribute("data-checked","")},projectsChanged:function(neo,old){var found=false;for(var i=0;i<neo.length;i++){var p=neo[i];if(p.id==parseInt(this.selectedProject)){found=true;break}}if(!found){this.selectedProject=null}}});Polymer({is:"jso-opencga-create-study",properties:{projects:{type:Array,notify:true},name:{type:String}},handleForm:function(){var me=this;if(this.$.projectSelect.selectedProject==null){alert("Please select a Project");return}if(this.$.form.checkValidity()){OpencgaManager.studies.create({query:{sid:Cookies("bioinfo_sid"),name:this.$.input.value,alias:this.$.input.value.replace(/ /gi,""),description:"",organization:"",type:this.querySelector('input[name="type"]:checked').value,projectId:this.$.projectSelect.selectedProject},request:{async:true,success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){me.name="";me.fire("need-refresh");me.fire("study-created")}else{alert("Server error, try again later.")}},error:function(){alert("Server error, try again later.")}}})}}});Polymer({is:"jso-opencga-create-project",handleForm:function(){var me=this;if(this.$.form.checkValidity()){OpencgaManager.projects.create({query:{userId:Cookies("bioinfo_user"),sid:Cookies("bioinfo_sid"),name:this.$.input.value,alias:this.$.input.value.replace(/ /gi,""),description:"",organization:""},request:{async:true,success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){me.$.input.name="";me.fire("need-refresh");me.fire("project-created")}else{alert("Server error, try again later.")}},error:function(){alert("Server error, try again later.")}}})}}});Polymer({is:"jso-opencga-browser",properties:{projects:{type:Array,notify:true,observer:"projectsChanged"},selectedProject:{type:Object,notify:true,observer:"selectedProjectChanged"},selectedStudy:{type:Object,notify:true,observer:"selectedStudyChanged"},selectedFile:{type:Object,notify:true,value:function(){return null}},folder:{type:Object,notify:true},folders:{type:Array,notify:true,value:function(){return[]}},files:{type:Array,notify:true},bioformats:{type:Array,value:function(){return[]},notify:true},showHidden:{type:Boolean,value:false,reflectToAttribute:true},disableNewProject:{type:Boolean,value:false,reflectToAttribute:true},disableNewStudy:{type:Boolean,value:false,reflectToAttribute:true},contentData:{type:String,value:""},mode:{type:String,reflectToAttribute:true,value:""},loading:{type:Boolean,value:false}},ready:function(){var me=this;if(this._parentJsoPanel!=null){this._parentJsoPanel.addEventListener("hidden",function(e){if(e.detail==false){me._setInitialSelection()}})}},check:function(a,b){return a===b},checkFileModeOk:function(mode,selectedFile){if(mode==="file"&&selectedFile!=null&&selectedFile.id!=null&&selectedFile.type=="FILE"){return true}if(mode==="folder"&&selectedFile!=null&&selectedFile.id!=null&&selectedFile.type=="FOLDER"){return true}return false},handleFileModeOk:function(e){this._parentJsoPanel.hidden=true;this.fire("ok-click")},projectsChanged:function(neo,old){this.async(function(){this._setInitialSelection()},100)},_setInitialSelection:function(){if(this._parentJsoPanel!=null&&this._parentJsoPanel.hidden===false){if(this.selectedProject==null){var el=Polymer.dom(this.root).querySelector("jso-opencga-project-tree");this.set("selectedProject",el)}if(this.selectedProject!=null&&this.selectedStudy==null){var el=Polymer.dom(this.selectedProject.root).querySelector("jso-opencga-study-tree");this.set("selectedStudy",el)}if(this.folder&&this.selectedStudy){this.refreshFolderFiles()}}},selectedStudyChanged:function(neo,old){if(old)old.selected=false;if(neo)neo.selected=true;if(!neo){this.files=[]}this.selectedFile=null;this.files=[];this._showStudyFolder()},selectedProjectChanged:function(neo,old){if(old)old.selected=false;if(neo)neo.selected=true},handleStudyClick:function(e){this.files=[];this.set("selectedProject",e.currentTarget);this.set("selectedStudy",e.currentTarget.selectedStudy)},handleFileSelect:function(e){this.selectedFile=e.detail},handleOpenFolder:function(e){var me=this;this.folder=e.detail;this.push("folders",this.folder);this.files=[];this.refreshFolderFiles()},refreshFolderFiles:function(){var me=this;this.loading=true;this._getFilesInFolder(this.selectedStudy.study.id,this.folder.id,function(files){me.files=files;me.loading=false})},handleStudyBreadcrum:function(e){this.files=[];this._showStudyFolder()},handleBreadcrumClick:function(e){var me=this;this.folder=e.currentTarget.folder;while(this.folder!==this.folders[this.folders.length-1]){this.pop("folders")}this.files=[];this.refreshFolderFiles()},handleBackFolder:function(e){var me=this;this.pop("folders");this.files=[];if(this.folders.length>0){this.set("folder",this.folders[this.folders.length-1]);this.refreshFolderFiles()}else{this._showStudyFolder()}},handleUploadFile:function(e){this.$.uploadFilePanel.hidden=!this.$.uploadFilePanel.hidden},handleCreateProject:function(e){this.$.createProjectPanel.hidden=!this.$.createProjectPanel.hidden},handleCreateStudy:function(e){this.$.createStudyPanel.hidden=!this.$.createProjectPanel.hidden},handleFileUploaded:function(e){this.refreshFolderFiles();this.$.uploadFilePanel.hidden=true},handleProjectCreated:function(e){this.$.createProjectPanel.hidden=true},handleStudyCreated:function(e){this.$.createStudyPanel.hidden=true},handleLoading:function(e){this.fire("loading")},computeAngleIcon:function(el){if(el){return false}return true},_showStudyFolder:function(){var me=this;this.loading=true;this._getStudyFolder(this.selectedStudy.study.id,function(folder){me.set("folders",[]);me.folder=folder;me._getFilesInFolder(me.selectedStudy.study.id,me.folder.id,function(files){me.files=files;me.loading=false})})},_getStudyFolder:function(studyId,callback){var me=this;this.message="";var folder;OpencgaManager.files.search({query:{sid:Cookies("bioinfo_sid"),studyId:studyId,name:"."},request:{async:true,success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){folder=response.response[0].result[0];callback(folder)}else{console.log(response.response[0].errorMsg)}},error:function(){console.log("Server error, try again later.")}}})},
_getFilesInFolder:function(studyId,folderId,callback){var me=this;var files;var bfList=[];for(var i=0;i<this.bioformats.length;i++){var bf=this.bioformats[i];bfList.push(bf.value)}OpencgaManager.files.list({id:folderId,query:{sid:Cookies("bioinfo_sid"),status:"READY",bioformat:bfList.join(",")+",NONE",type:"FILE,FOLDER",studyId:studyId},request:{async:true,success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){files=me._filterFiles(response.response[0].result);callback(files)}else{console.log(response.response[0].errorMsg)}},error:function(){console.log("Server error, try again later.")}}})},_filterFiles:function(files){var bfList=[];for(var i=0;i<this.bioformats.length;i++){var bf=this.bioformats[i];bfList.push(bf.value)}files.sort(function(a,b){return b.creationDate.localeCompare(a.creationDate)});var filesFiltered=[];for(var i=0;i<files.length;i++){var file=files[i];if(this.mode=="folder"){if(file.type=="FILE"){continue}filesFiltered.push(file)}else{if(file.name.charAt(0)=="."){continue}if(file.type=="FILE"&&bfList.indexOf(file.bioformat)==-1){continue}if(Utils.endsWith(file.name,".snappy")){continue}if(file.bioformat=="ALIGNMENT"&&(Utils.endsWith(file.name,".bam.bai")||Utils.endsWith(file.name,".bam.coverage.json.gz"))){continue}filesFiltered.push(file)}}return filesFiltered},isHidden:function(project){if(this.showHidden){return true}else{return project.name.charAt(0)!="."}},handlePreviewFile:function(e){var file=e.detail;var data;OpencgaManager.files.content({id:file.id,query:{sid:Cookies("bioinfo_sid"),limit:100},request:{async:false,success:function(response){data=response},error:function(){}}});if(data){this.contentData=data;this.$.filePreview.hidden=false}}});Polymer({is:"jso-opencga-job-list-item",properties:{job:{type:Object,notify:true},visitsHidden:{type:Boolean,value:false}},created:function(){},computeDate:function(job){return Utils.parseDate(job.date)},computeIcon:function(job){var iconMap={READY:"check fa fa-check",FILE:"fa fa-file-o"};return iconMap[job.status]},computeStatusIcon:function(job){var iconMap={PREPARED:"PREPARED fa fa-clock-o",READY:"READY fa fa-check",ERROR:"ERROR fa fa-times",QUEUED:"QUEUED fa fa-clock-o",RUNNING:"RUNNING fa fa-circle-o-notch fa-spin"};return iconMap[job.status]},computeStatus:function(job){if(job.status==="DONE"){return"Finishing"}return job.status.toLowerCase()},computeStatusClass:function(job){return"capitalize "+job.status},computeToolName:function(job){return job.toolName+" - "+job.execution},handleBarClick:function(e){e.stopPropagation()},handleVisits:function(job){return job.visits>0},isRunning:function(job){return job.status=="RUNNING"},handleDeleteJob:function(e){var jobId=e.currentTarget.dataJob;e.stopPropagation();if(confirm("Are you sure?")){var aux=OpencgaManager.jobs.delete({id:jobId,query:{sid:Cookies("bioinfo_sid")},request:{success:function(response){},error:function(){console.log("Server error, try again later.")}}})}}});Polymer({is:"jso-opencga-job-list",properties:{folder:{type:Object,notify:true,value:null},jobs:{type:Array,notify:true,observer:"jobsChanged"},filteredJobs:{type:Array,notify:true},selected:{type:Object,notify:true},allowedTools:{type:Array},toolFilterValue:{type:String,value:"all"}},handleSelect:function(e){this.selected=e.currentTarget.job;var sel=this.querySelector("jso-opencga-job-list-item[selected]");if(sel){sel.removeAttribute("selected")}e.currentTarget.setAttribute("selected","");console.log(this.selected);this.fire("jobselect",this.selected)},checkFolder:function(folder){return folder==null},jobsChanged:function(neo,old){var me=this;var jobs;if(this.toolFilterValue=="all"){var jobs=this.jobs.filter(function(item){return me.allowedTools.indexOf(item.toolName)!=-1})}else{var jobs=this.jobs.filter(function(item){return item.toolName===me.toolFilterValue})}this.set("filteredJobs",jobs)},handleFilterSelect:function(e){this.set("toolFilterValue",e.currentTarget.value);this.jobsChanged()}});Polymer({is:"jso-opencga-job-browser",properties:{projects:{type:Array,notify:true,observer:"projectsChanged"},selectedProject:{type:Object,notify:true,observer:"selectedProjectChanged"},selectedStudy:{type:Object,notify:true,observer:"selectedStudyChanged"},selectedJob:{type:Object,notify:true,value:function(){return null}},folder:{type:Object,notify:true},jobs:{type:Array,notify:true},allowedTools:{type:Array,value:function(){return[]}}},ready:function(){var me=this;this.async(function(){setInterval(function(){me.refreshJobs()},5e3)})},projectsChanged:function(neo,old){this.async(function(){if(this.selectedProject==null){var el=Polymer.dom(this.root).querySelector("jso-opencga-project-tree");this.set("selectedProject",el)}if(this.selectedProject!=null&&this.selectedStudy==null){var el=Polymer.dom(this.selectedProject.root).querySelector("jso-opencga-study-tree");this.set("selectedStudy",el)}if(this.selectedStudy){this.refreshJobs()}},100)},selectedStudyChanged:function(neo,old){if(old)old.selected=false;if(neo)neo.selected=true;var me=this;if(!neo){this.jobs=[]}this.selectedJob=null;this.refreshJobs()},selectedProjectChanged:function(neo,old){if(old)old.selected=false;if(neo)neo.selected=true},handleProjectTreeClick:function(e){this.set("selectedProject",e.currentTarget);this.set("selectedStudy",e.currentTarget.selectedStudy)},handleJobSelect:function(e){this.selectedJob=e.detail},computeAngleIcon:function(el){if(el){return false}return true},refreshJobs:function(){console.log("refreshJobs");if(this.selectedStudy!=null){this._getJobs(this.selectedStudy.study.id)}},_getJobs:function(studyId){var me=this;OpencgaManager.studies.jobs({id:studyId,query:{sid:Cookies("bioinfo_sid")},request:{async:true,success:function(response){console.log(response);if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){var jobList=response.response[0].result;if(me.allowedTools!=null&&me.allowedTools.length>0){jobList=jobList.filter(function(item){return me.allowedTools.indexOf(item.toolName)!=-1})}jobList.sort(function(a,b){return b.date.localeCompare(a.date)});me.set("jobs",jobList)}else{console.log(response.response[0].errorMsg)}},error:function(){console.log("Server error, try again later.")}}})},isHidden:function(project){if(this.showHidden){return true}else{return project.name.charAt(0)!="."}}});Polymer({is:"jso-opencga-footer"});Polymer({is:"jso-opencga-login",properties:{user:{type:String,value:""},password:{type:String,value:""},message:{type:String,value:""},hideSignup:{type:Boolean,value:false,reflectToAttribute:true}},handleFormKey:function(e){if(e.which==13){this.handleForm()}},handleRemember:function(e){this.fire("remember",{})},handleSignup:function(e){this.fire("signup",{})},handleForm:function(e){this.message="";if(this.$.form.checkValidity()){this._login()}},_login:function(){var me=this;console.log(this.user);console.log(this.password);OpencgaManager.users.login({id:this.user,query:{password:CryptoJS.SHA1(this.password).toString()},request:{success:function(response){console.log(response);if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){Cookies.set("bioinfo_sid",response.response[0].result[0].sessionId);Cookies.set("bioinfo_user",response.response[0].result[0].userId);me.fire("login",{status:true})}else{me.message=response.response[0].errorMsg;Cookies.expire("bioinfo_sid");Cookies.expire("bioinfo_user")}me.user=null;me.password=null},error:function(){me.message="Server error, try again later."}}})}});Polymer({is:"jso-opencga-signup",properties:{user:{type:String,value:""},email:{type:String,value:""},password:{type:String,value:""},passwordCheck:{type:String,value:""},message:{type:String,value:""}},handleFormKey:function(e){if(e.which==13){this.handleForm()}},handleForm:function(e){this.message="";if(this.$.form.checkValidity()){if(this.password===this.passwordCheck){this._signup()}else{alert("Sorry, your password does not match")}}else{alert("Please, you should fill all the fields. If error persist, contact crew at "+CONTACT_MAIL+".")}},_signup:function(){var me=this;OpencgaManager.users.create({query:{userId:this.user,name:this.user,email:this.email,organization:"",password:CryptoJS.SHA1(this.password).toString()},request:{async:false,success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){var userId=response.response[0].result[0].id;me.message=userId+" created";me.login()}else{me.message=response.response[0].errorMsg;Cookies.expire("bioinfo_sid");Cookies.expire("bioinfo_user")}},error:function(){me.message="Server error, try again later."}}})},login:function(e){var me=this;this.message="";OpencgaManager.users.login({id:this.user,query:{password:CryptoJS.SHA1(this.password).toString()},request:{async:false,success:function(response){console.log(response);if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){me.sid=response.response[0].result[0].sessionId;Cookies.set("bioinfo_sid",response.response[0].result[0].sessionId);Cookies.set("bioinfo_user",response.response[0].result[0].userId);me.createProject(me.userId,me.sid);me.createMetaProject(me.userId,me.sid)}else{me.message=response.response[0].errorMsg;Cookies.expire("bioinfo_sid");Cookies.expire("bioinfo_user")}},error:function(){me.message="Server error, try again later."}}})},createProject:function(userId,sid){var me=this;this.message="";OpencgaManager.projects.create({query:{userId:me.user,sid:me.sid,name:"Default project",alias:"defaultPr",description:"default project",organization:this.organization},request:{async:false,success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){me.projectId=response.response[0].result[0].id;me.createStudy()}else{me.message=response.response[0].errorMsg}},error:function(){alert("Server error, try again later.")}}})},createMetaProject:function(userId,sid){var me=this;this.message="";OpencgaManager.projects.create({query:{userId:me.user,sid:me.sid,name:".meta",alias:"meta",description:"meta",organization:this.organization},request:{async:false,success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){var projectId=response.response[0].result[0].id;me.createMetaStudy(projectId)}else{me.message=response.response[0].errorMsg}},error:function(){alert("Server error, try again later.")}}})},createMetaStudy:function(projectId){var me=this;this.message="";OpencgaManager.studies.create({query:{sid:me.sid,name:".meta",alias:"meta",description:"meta",organization:this.organization,type:"FAMILY",projectId:projectId},request:{async:false,success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){me.user="";me.name="";me.email="";me.organization="";me.password="";me.check=""}else{me.message=response.response[0].errorMsg}},error:function(){alert("Server error, try again later.")}}})},createStudy:function(e){var me=this;this.message="";OpencgaManager.studies.create({query:{sid:me.sid,name:"Default study",alias:"defaultSt",description:"default study",organization:this.organization,type:"FAMILY",projectId:me.projectId},request:{async:false,success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){me.studyId=response.response[0].result[0].id;me.fire("login",{status:true})}else{me.message=response.response[0].errorMsg}},error:function(){alert("Server error, try again later.")}}})}});Polymer({is:"jso-opencga-profile",properties:{email:{type:String,value:""},oldpassword:{type:String,value:""},password:{type:String,value:""},passwordCheck:{type:String,value:""},message:{type:String,value:""}},handleChangePasswordForm:function(e){var me=this;this.message="";if(this.$.formPassword.checkValidity()&&this.password===this.passwordCheck){OpencgaManager.users.updatePassword({id:Cookies("bioinfo_user"),query:{password:CryptoJS.SHA1(this.oldpassword).toString(),npassword:CryptoJS.SHA1(this.password).toString(),sid:Cookies("bioinfo_sid")},request:{success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){me.message="Password updated"}else{me.message=response.response[0].errorMsg}},error:function(){me.message="Server error, try again later."}}})}},handleChangeEmailForm:function(e){var me=this;this.message="";if(this.$.formEmail.checkValidity()){OpencgaManager.users.updateEmail({id:Cookies("bioinfo_user"),query:{nemail:this.email,sid:Cookies("bioinfo_sid")},request:{success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){me.message="E-mail updated"}else{me.message=response.response[0].errorMsg}},error:function(){me.message="Server error, try again later."}}})}}});Polymer({is:"jso-opencga-remember",properties:{email:{type:String,value:""},user:{type:String,value:""},message:{type:String,value:""}},handleFormKey:function(e){if(e.which==13){this.handleForm()}},handleForm:function(e){var me=this;this.message="";if(this.$.form.checkValidity()){OpencgaManager.users.resetPassword({id:this.user,query:{email:this.email},request:{success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){var userId=response.response[0].result[0].id;me.message="An email was sent with a new password"}else{me.message=response.response[0].errorMsg}},error:function(){me.message="Server error, try again later."}}})}}});Polymer({is:"jso-opencga-header",properties:{checkTimeInterval:{type:Number,value:5e3,reflectToAttribute:true},selectedOption:{type:String,value:"home",notify:true,reflectToAttribute:true,observer:"selectedOptionChanged"},hideLogin:{type:Boolean,value:false,reflectToAttribute:true},hideSignup:{type:Boolean,value:false,reflectToAttribute:true},showMenuOnLogin:{type:Boolean,value:false,reflectToAttribute:true},isLogged:{type:Boolean,value:false},hideJobs:{type:Boolean,value:false,reflectToAttribute:true},hideBrowse:{type:Boolean,value:false,reflectToAttribute:true},showJobs:{type:Boolean,value:true},userData:{type:Object,notify:true},userText:{type:String,value:""},jobItem:{type:Object},selectedStudy:{type:Object},allowedTools:{type:Array}},computeMenu:function(showMenuOnLogin,isLogged){if(showMenuOnLogin){return!isLogged}return false},computeUser:function(hideLogin,isLogged){if(hideLogin){return true}return!isLogged},computeBrowse:function(hideBrowse,hideLogin,isLogged){if(hideLogin||hideBrowse){return true}return!isLogged},computeJobs:function(hideJobs,hideLogin,isLogged){if(hideLogin||hideJobs){return true}return!isLogged},computeProfile:function(userText,hideSignup,hideLogin,isLogged){if(hideSignup||hideLogin||userText=="anonymous"){return true}return!isLogged},computeLogout:function(hideLogin,isLogged){if(hideLogin){return true}return!isLogged},computeSignup:function(hideSignup,hideLogin,isLogged){if(hideLogin||hideSignup){return true}return isLogged},computeLogin:function(hideLogin,isLogged){if(hideLogin){return true}return isLogged},selectedOptionChanged:function(neo,old){var menuItems=Polymer.dom(this.root).querySelectorAll("[menu-option]");for(var i=0;i<menuItems.length;i++){var item=menuItems[i];var currentItemValue=item.getAttribute("menu-option");if(neo==currentItemValue){item.removeAttribute("hidden")}else{item.setAttribute("hidden","")}}},ready:function(){if(!this.hideLogin){if(Cookies("bioinfo_sid")&&Cookies("bioinfo_user")){this.sessionInitiated()}else{this.logout()}}},handleRemember:function(e){this.selectedOption="remember"},handleSignup:function(e){this.selectedOption="signup"},handleMenu:function(e){var option=e.currentTarget.dataset["option"];console.log(option);if(option){this.selectedOption=option}},handleJobClick:function(e){this.showJobs=!this.showJobs},handleLogoutClick:function(e){this.sessionFinished()},handleSupportMenu:function(e){this.$.helpMenu.classList.toggle("help-menu-shown")},handleHelpMenuMouseOut:function(){this.$.helpMenu.classList.remove("help-menu-shown")},handleLogin:function(e){if(e.detail.status){this.sessionInitiated()}else{this.sessionFinished()}this.fire("session-change")},demoLogin:function(username){this.$.jsoLogin.user=username;this.$.jsoLogin.password="demo";this.$.jsoLogin._login()},anonymousSign:function(){this.$.jsoSignup.user="anonymous"+Utils.randomString(40);this.$.jsoSignup.name="anonymous";this.$.jsoSignup.email="anonymous@anonymous.anonymous";this.$.jsoSignup.organization="none";this.$.jsoSignup.password="anonymous";this.$.jsoSignup._signup()},sessionInitiated:function(e){var me=this;this.isLogged=true;this.selectedOption="home";if(!this.userInfoInterval){this.getUserInfo();this.userInfoInterval=setInterval(function(){me.getUserInfo()},this.checkTimeInterval)}this.fire("login")},sessionFinished:function(e){this.userData=null;this.showJobs=false;this.selectedOption="home";this.isLogged=false;Cookies.expire("bioinfo_sid");Cookies.expire("bioinfo_user");clearInterval(this.userInfoInterval);this.userInfoInterval=null;this.fire("logout")},getUserInfo:function(force){var me=this;var lastActivity=null;if(force!=true){if(this.userData!=null){lastActivity=this.userData.lastActivity}}var user=Cookies("bioinfo_user");if(!user){console.log("cookie: bioinfo_user, is not set, session will be finished...");this.sessionFinished()}else{OpencgaManager.users.read({id:user,query:{sid:Cookies("bioinfo_sid"),lastActivity:lastActivity},request:{success:function(response){if((response.response[0].errorMsg===""||response.response[0].errorMsg==null)&&response.response[0].result.length>0){me.userData=response.response[0].result[0];me.userText=me.userData.name;console.log("userData has been modified since last call")}if(response.response[0].errorMsg!=null&&response.response[0].errorMsg.indexOf("Invalid sessionId for user")!==-1){me.sessionFinished()}},error:function(){console.log("Server error, try again later.")}}})}},logout:function(){var me=this;var user=Cookies("bioinfo_user");if(!user){console.log("cookie: bioinfo_user, is not set, session will be finished...");this.sessionFinished()}else{OpencgaManager.users.logout({id:user,query:{sid:Cookies("bioinfo_sid")},request:{success:function(response){console.log(response)},error:function(){console.log("Server error, try again later.")}}})}},handleJobItemClick:function(e){this.showJobs=false}});Polymer({is:"jso-opencga-button-tooltip",properties:{message:{type:String}}});Polymer({is:"gm-add-track",handleClickTrack:function(e){if(e.target.classList.contains("add")){this.fire("addtrack",e.currentTarget.querySelector("div").innerHTML)}}});Polymer({is:"gm-search-result",properties:{response:{type:Object}},titleDblClick:function(e){this.collapsed=!this.collapsed},handleResultClick:function(e){this.fire("feature",e.currentTarget.feature)}});Polymer({is:"gm-search-feature",properties:{feature:{type:Object}}});Polymer({is:"gm-search",properties:{selectedSpecies:{type:Object},resultTypes:{type:Array,value:["Genes","SNPs"]},selectedResultType:{type:String,value:"Genes"},response:{type:Array,value:null}},computeLabelHidden:function(response){if(response){return response.length<1}return true},handleResultTypeChange:function(e){this.selectedResultType=e.currentTarget.value},handleSearch:function(){var me=this;var features=this.$.textarea.value.trim().toUpperCase().split("\n");if(features[0]!=""&&this.selectedResultType){var params={};var resource;switch(this.selectedResultType){case"Genes":params["exclude"]="transcripts";resource="info";break;case"SNPs":params["exclude"]="transcriptVariations,xrefs,samples";resource="snp";break;case"Transcripts":params["exclude"]="transcripts.exons,transcripts.xrefs,transcripts.tfbs";resource="transcript";break;case"Exons":params["exclude"]="transcripts.exons";resource="exon";break}CellBaseManager.get({species:this.selectedSpecies,category:"feature",subCategory:"gene",query:features,resource:resource,params:params,success:function(response){me.set("response",response.response)}})}}});Polymer({is:"gm-status-bar",properties:{version:{type:String},mousePosition:{type:Object}},ready:function(){this._setLegend(GENE_BIOTYPE_COLORS,this.$.geneLegend);this._setLegend(SNP_BIOTYPE_COLORS,this.$.snpLegend)},computeMousePosition:function(mousePosition){return mousePosition.chromosome+":"+Utils.formatNumber(mousePosition.mousePos)},computeBase:function(mousePosition){return mousePosition.base},computeBaseColor:function(mousePosition){return"color:"+SEQUENCE_COLORS[mousePosition.base]},_setLegend:function(biotypeColors,menu){for(biotype in biotypeColors){var color=biotypeColors[biotype];var li=document.createElement("li");li.setAttribute("data-text","true");var colorEl=document.createElement("div");colorEl.style.display="inline-block";colorEl.style.height="12px";colorEl.style.width="12px";colorEl.style.marginRight="4px";colorEl.style.backgroundColor=color;var biotypeEl=document.createElement("span");biotypeEl.textContent=biotype;li.appendChild(colorEl);li.appendChild(biotypeEl);menu.appendChild(li)}}});Polymer({is:"gm-track-menu-item",properties:{track:{type:Object,observer:"trackChanged"},visible:{type:Boolean}},attached:function(){},ready:function(){},trackChanged:function(neo,old){this.visible=neo.visible},handleVisible:function(){this.track.toggle();this.visible=this.track.visible},handleRemoveTrack:function(e){this.fire("removetrack",this.track)}});Polymer({is:"gm-track-menu",properties:{tracks:{type:Array}},dragSrcEl:null,handleDragStart:function(e){e.dataTransfer.effectAllowed="move";e.currentTarget.style.opacity="0.4";this.dragSrcEl=e.currentTarget},handleDragOver:function(e){if(e.preventDefault){e.preventDefault()}e.dataTransfer.dropEffect="move";return false},handleDragEnter:function(e){e.currentTarget.style.opacity="0.4"},handleDragLeave:function(e){if(e.currentTarget!==this.dragSrcEl){e.currentTarget.style.opacity="inherit"}},handleDrop:function(e){if(e.stopPropagation){e.stopPropagation()}if(this.dragSrcEl!=e.currentTarget){this.fire("swap",{t1:this.dragSrcEl.track,t2:e.currentTarget.track})}this.dragSrcEl.style.opacity="inherit";e.currentTarget.style.opacity="inherit";return false},handleDragEnd:function(e){var els=this.querySelectorAll("gm-track-menu-item");for(var i=0;i<els.length;i++){var el=els[i];el.style.opacity=""}}});Polymer({is:"genome-maps-element",properties:{version:{type:String,reflectToAttribute:true},selectedOption:{type:String,value:"home",notify:true,reflectToAttribute:true,observer:"selectedOptionChanged"},selectedSpecies:{type:Object},userData:{type:Object,notify:true,observer:"userDataChanged"},projects:{type:Array,notify:true},bioformats:{type:Array,notify:true,value:[{value:"ALIGNMENT",text:"Alignment"},{value:"VARIANT",text:"Variant"}]},cellBaseHost:{type:String,value:CellBaseManager.host},opencgaHost:{type:String,value:OpencgaManager.host}},ready:function(){var panels=Polymer.dom(this.root).querySelectorAll("jso-panel");for(var i=0;i<panels.length;i++){var panEl=panels[i];var id=panEl.getAttribute("id");var el=Polymer.dom(this.$.menu).querySelector("[data-panel="+id+"]");if(el){if(panEl.hidden){el.removeAttribute("active")}else{el.setAttribute("active","")}}}this._init()},selectedOptionChanged:function(neo,old){var menuItems=Polymer.dom(this.root).querySelectorAll("[menu-option]");for(var i=0;i<menuItems.length;i++){var item=menuItems[i];var currentItemValue=item.getAttribute("menu-option");if(neo==currentItemValue){item.removeAttribute("hidden")}else{item.setAttribute("hidden","")}}},handleMenu:function(e){var option=e.currentTarget.dataset["option"];this.setMenu(option)},setMenu:function(option){if(option){this.selectedOption=option}},handleMenuPanel:function(e){var panel=this.$[e.currentTarget.dataset.panel];panel.hidden=!panel.hidden},handleLoggedOnlyMenuPanel:function(e){var panel=this.$[e.currentTarget.dataset.panel];if(this.$.jsoHeader.isLogged){panel.hidden=!panel.hidden}else{this.selectedOption="login";this._lastLogedRequest=panel}},handlePanelHidden:function(e){var id=e.currentTarget.getAttribute("id");var sel="[data-panel="+id+"]";var el=Polymer.dom(this.$.menu).querySelector(sel);if(e.currentTarget.hidden){el.removeAttribute("active")}else{el.setAttribute("active","")}},handleRemoveTrack:function(e){this.genomeViewer.removeTrack(e.detail)},handleFileSelect:function(e){console.log("file");console.log(e.detail);var file=e.detail;if(file.index&&file.index.status=="READY"){var track=this.addTrack(file.bioformat,file.name,file);this._updateTrackMenu()}},_updateTrackMenu:function(){var tracks=[];for(var i=0;i<this.genomeViewer.trackListPanel.tracks.length;i++){var t=this.genomeViewer.trackListPanel.tracks[i];tracks.push(t)}this.$.trackMenu.set("tracks",tracks)},_init:function(){var me=this;this.region=new Region;var url=$.url();var url_cbhost=url.param("CELLBASE_HOST");if(url_cbhost!=null){CELLBASE_HOST=url_cbhost}this.speciesObj=DEFAULT_SPECIES;var urlSpecies=url.param("species");if(typeof urlSpecies!=="undefined"&&urlSpecies!=""){this.speciesObj=Utils.getSpeciesFromAvailable(AVAILABLE_SPECIES,urlSpecies)||this.speciesObj}this.species=this.speciesObj;var firstGeneRegion;CellBaseManager.get({host:CELLBASE_HOST,async:false,category:"feature",subCategory:"gene",resource:"first",species:this.speciesObj,params:{include:"chromosome,start,end"},success:function(r){firstGeneRegion=r.response[0].result[0]}});this.region.load(firstGeneRegion);this.selectedSpecies=this.species;var regionStr=url.param("region");if(regionStr!=null){this.region.parse(regionStr)}var urlGene=url.param("gene");if(urlGene!=null&&urlGene!=""){this.region.load(this._getRegionByFeature(urlGene,"gene"))}var urlSnp=url.param("snp");if(urlSnp!=null&&urlSnp!=""){this.region.load(this._getRegionByFeature(urlSnp,"snp"))}var gvConfig={cellBaseHost:CELLBASE_HOST,cellBaseVersion:"v3",width:window.innerWidth,region:this.region,version:this.version,availableSpecies:AVAILABLE_SPECIES,species:this.speciesObj,sidePanel:false,resizable:false,karyotypePanelConfig:{hidden:true,collapsed:false,collapsible:true},chromosomePanelConfig:{hidden:false,collapsed:false,collapsible:true},regionPanelConfig:{hidden:false,collapsed:false,collapsible:true},drawStatusBar:false,handlers:{"region:change":function(e){console.log(e)},"species:change":function(event){me.set("selectedSpecies",event.species)}}};this.async(function(){this.$.gv.createGenomeViewer(gvConfig);this.genomeViewer=this.$.gv.genomeViewer;this.genomeViewer.draw();this.genomeViewer.trackListPanel.on("tracks:refresh",function(e){me._updateTrackMenu()});this.genomeViewer.trackListPanel.on("mousePosition:change",function(event){me.$.statusBar.set("mousePosition",event)});this._loadInitialTracksConfig()},100)},handleLogin:function(){this.selectedOption="home";if(this._lastLogedRequest){this._lastLogedRequest.hidden=false;this._lastLogedRequest=null}},handleLogout:function(){this.$.browserPanel.hidden=true},handleUserNeedRefresh:function(){this.$.jsoHeader.getUserInfo(true)},userDataChanged:function(neo,old){var me=this;if(this.userData){var projectIds=[];for(var i=0;i<this.userData.projects.length;i++){var p=this.userData.projects[i];projectIds.push(p.id)}var projects=[];OpencgaManager.projects.studies({id:projectIds.join(","),query:{sid:Cookies("bioinfo_sid")},request:{success:function(response){if(response.response[0].errorMsg===""||response.response[0].errorMsg==null){for(var i=0;i<response.response.length;i++){var r=response.response[i];me.userData.projects[i].studies=r.result;projects.push(me.userData.projects[i])}me.projects=projects}else{console.log(response.error);console.log(response.response[0].errorMsg)}me.loading=false},error:function(){console.log("Server error, try again later.");me.loading=false}}})}else{console.log("no user data")}},handleApplyCellBaseHost:function(e){this.genomeViewer.setCellBaseHost(this.cellBaseHost)},handleResetCellBaseHost:function(e){this.set("cellBaseHost",CELLBASE_HOST);this.genomeViewer.setCellBaseHost(this.cellBaseHost)},handleApplyOpencgaHost:function(e){if(this.opencgaHost!=OpencgaManager.host){this.$.jsoHeader.sessionFinished();OpencgaManager.host=this.opencgaHost}},handleResetOpencgaHost:function(e){if(this.opencgaHost!=OPENCGA_HOST){this.$.jsoHeader.sessionFinished();this.set("opencgaHost",OPENCGA_HOST);OpencgaManager.host=OPENCGA_HOST}},handleSwapTrackMenu:function(e){this.genomeViewer.trackListPanel.swapTracks(e.detail.t1,e.detail.t2)},handleResultClick:function(e){this.genomeViewer.setRegion(new Region(e.detail))},_loadInitialTracksConfig:function(){var categories=TRACKS[SPECIES_TRACKS_GROUP[Utils.getSpeciesCode(this.genomeViewer.species.scientificName)]];for(var i=0,leni=categories.length;i<leni;i++){var category=categories[i];var tracks=category.tracks;for(var j=0,lenj=tracks.length;j<lenj;j++){var track=tracks[j];var trackType=track.id;var checked=track.checked;var disabled=track.disabled;if(checked){var track=this.addTrack(trackType,trackType)}}}this.$.trackMenu.tracks=this.genomeViewer.trackListPanel.tracks},_getRegionByFeature:function(name,feature){var data=CellBaseManager.get({species:this.species,category:"feature",subCategory:feature,query:name,resource:"info",params:{include:"chromosome,start,end"},async:false});var f=data.response[0].result[0];if(f!=null){return new Region(f)}return{}},handleAddTrack:function(e){this.addTrack(e.detail);this._updateTrackMenu()},addTrack:function(trackType,trackTitle,object,host){var me=this;var track;switch(trackType){case"Sequence":track=new FeatureTrack({title:"Sequence",height:25,visibleRegionSize:200,renderer:new SequenceRenderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"sequence",params:{},species:this.genomeViewer.species,cacheConfig:{chunkSize:100}})});this.genomeViewer.addTrack(track);break;case"Gene/Transcript":track=new GeneTrack({title:"Gene",minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,minTranscriptRegionSize:2e5,height:100,renderer:new GeneRenderer({handlers:{"feature:click":function(e){console.log(e);console.log(e.feature);switch(e.featureType){case"gene":me.$.content.appendChild(new JsoGeneInfoPanel(e.query,e.feature,me.cellBaseHost,me.genomeViewer.species));break;case"transcript":me.$.content.appendChild(new JsoTranscriptInfoPanel(e.query,e.feature,me.cellBaseHost,me.genomeViewer.species));break;default:break}}}}),dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",species:this.genomeViewer.species,params:{exclude:"transcripts.tfbs,transcripts.xrefs,transcripts.exons.sequence"},cacheConfig:{chunkSize:1e5}})});this.genomeViewer.addTrack(track);break;case"SNP":var renderer=new FeatureRenderer(FEATURE_TYPES.snp);renderer.on("feature:click",function(e){me.$.content.appendChild(new JsoSnpInfoPanel(e.query,e.feature,me.cellBaseHost,me.genomeViewer.species))});track=new FeatureTrack({title:"SNP",featureType:"SNP",minHistogramRegionSize:12e3,maxLabelRegionSize:3e3,height:120,renderer:renderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"snp",params:{exclude:"transcriptVariations,xrefs,samples"},species:this.genomeViewer.species,cacheConfig:{chunkSize:1e4}})});this.genomeViewer.addTrack(track);break;case"Clinical Variants":var renderer=new FeatureRenderer;renderer.on("feature:click",function(e){console.log(e)});track=new FeatureTrack({title:"Clinical Variants",featureType:"clinical",minHistogramRegionSize:3e4,maxLabelRegionSize:3e3,visibleRegionSize:3e4,height:120,renderer:renderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"clinical",params:{exclude:"chunkIds,annot,clinvarSet.referenceClinVarAssertion"},species:this.genomeViewer.species,cacheConfig:{chunkSize:1e4}})});this.genomeViewer.addTrack(track);break;case"EMBL-EBI EVA SNVs":track=new FeatureTrack({title:"EVA 1.0 SNVs",featureType:"eva",minHistogramRegionSize:1e4,maxLabelRegionSize:3e3,height:100,renderer:new FeatureRenderer({label:function(f){var title=f.id;if(title==""){title=f.chromosome+":"+f.start+"-"+f.end}return title},tooltipTitle:function(f){
var title=f.id;if(title==""){title=f.chromosome+":"+f.start+"-"+f.end}return f.type+' - <span style="color:#399697">'+title+"</span>"},tooltipText:function(f){var str=["Location: "+'<span style="color:#156765">'+f.chromosome+":"+f.start+"-"+f.end+"</span>","Alt. allele: "+'<span style="color:#156765">'+f.allele+"</span>","Variant class: "+'<span style="color:#156765">'+f.type+"</span>"];var hgvs=[];for(var key in f.hgvs){hgvs.push('<span style="margin-left: 10px">'+Utils.camelCase(key)+"</span>"+': <span style="color:#156765">'+f.hgvs[key]+"</span>")}if(hgvs.length>0){str.push("HGVS"+"<br><span>"+hgvs.join("<br>")+"</span>")}var files=[];for(var key in f.files){files.push('<span style="margin-left: 10px">'+f.files[key].fileId+"</span>"+' (<span style="color:#156765">'+f.files[key].studyId+"</span>)")}if(files.length>0){str.push("Files (study)"+"<br><span>"+files.join("<br>")+"</span>")}return str.join("<br>")},color:function(f){return"#399697"},infoWidgetId:"id",height:10,histogramColor:"#399697",handlers:{"feature:mouseover":function(e){console.log(e)}}}),dataAdapter:new FeatureTemplateAdapter({uriTemplate:"http://wwwdev.ebi.ac.uk/eva/webservices/rest/{version}/{category}/{region}/{resource}?species={species}",templateVariables:{version:"v1",category:"segments",resource:"variants"},params:{exclude:"sourceEntries"},species:this.genomeViewer.species,speciesParse:function(species){return Utils.getSpeciesCode(species.scientificName)+"_"+species.assembly.name.split(".")[0].toLowerCase()},cacheConfig:{chunkSize:1e4},parse:function(response,dataType){var itemsArray=[];if(dataType=="histogram"){for(var i=0;i<response.response.length;i++){var r=response.response[i];for(var j=0;j<r.result.length;j++){var interval=r.result[j];itemsArray.push(interval)}}}else{for(var i=0;i<response.response.length;i++){var r=response.response[i];itemsArray.push(r.result)}}return itemsArray}})});this.genomeViewer.addTrack(track);break;case"TFBS":var tfbs=new FeatureTrack({title:"TFBS",minHistogramRegionSize:12e3,maxLabelRegionSize:3e3,height:120,renderer:new FeatureRenderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"regulatory",species:this.genomeViewer.species,params:{type:"TF_binding_site"},cacheConfig:{chunkSize:5e4}})});this.genomeViewer.addTrack(tfbs);break;case"miRNA Targets":var mirna=new FeatureTrack({title:"miRNA targets",minHistogramRegionSize:12e3,maxLabelRegionSize:3e3,height:120,renderer:new FeatureRenderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"regulatory",species:this.genomeViewer.species,params:{type:"mirna_target"},cacheConfig:{chunkSize:5e4}})});this.genomeViewer.addTrack(mirna);break;case"Others":var others=new FeatureTrack({title:"Regulatory others",minHistogramRegionSize:12e3,maxLabelRegionSize:3e3,height:120,renderer:new FeatureRenderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"regulatory",species:this.genomeViewer.species,params:{class:"Histone,Polymerase,Open Chromatin"},cacheConfig:{chunkSize:5e4}})});this.genomeViewer.addTrack(others);break;case"PhastCons":var phastCons=new FeatureTrack({title:"PhastCons",minHistogramRegionSize:12e3,maxLabelRegionSize:3e3,height:120,renderer:new ConservedRenderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"conserved_region",species:this.genomeViewer.species,params:{type:"phastcons"},cacheConfig:{chunkSize:5e3}})});this.genomeViewer.addTrack(phastCons);break;case"PhyloP":var phylop=new FeatureTrack({title:"PhyloP",minHistogramRegionSize:12e3,maxLabelRegionSize:3e3,height:120,renderer:new ConservedRenderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"conserved_region",species:this.genomeViewer.species,params:{type:"phylop"},cacheConfig:{chunkSize:5e3}})});this.genomeViewer.addTrack(phylop);break;case"bam":case"ALIGNMENT":var adapter=new OpencgaAdapter({category:"alignments",host:host,resource:object,species:this.genomeViewer.species,params:{sid:Cookies("bioinfo_sid")},cacheConfig:{chunkSize:5e3,cacheId:Cookies("bioinfo_sid")+"opencga"+object.id}});var renderer=new AlignmentRenderer(FEATURE_TYPES.alignment);track=new AlignmentTrack({title:trackTitle,closable:true,height:150,renderer:renderer,dataAdapter:adapter});this.genomeViewer.addTrack(track);break;case"vcf":case"VARIANT":var adapter=new OpencgaAdapter({category:"variants",host:host,resource:object,species:this.genomeViewer.species,params:{sid:Cookies("bioinfo_sid"),process_differences:false,exclude:"sourceEntries.samplesData,annotation"},cacheConfig:{chunkSize:5e4,cacheId:Cookies("bioinfo_sid")+"opencga"+object.id}});var renderer=new VcfMultisampleRenderer(FEATURE_TYPES.vcf);renderer.on({"feature:click":function(event){}});renderer.file=object;track=new FeatureTrack({title:trackTitle,closable:true,height:150,renderer:renderer,dataAdapter:adapter});this.genomeViewer.addTrack(track);break;default:return null}return track}});window.addEventListener("WebComponentsReady",function(e){getSpecies(function(s){AVAILABLE_SPECIES=s;DEFAULT_SPECIES=AVAILABLE_SPECIES.vertebrates[0];var genomeMaps=document.createElement("genome-maps-element");genomeMaps.setAttribute("version","3.2.0");document.body.appendChild(genomeMaps)})});function getSpecies(callback){CellBaseManager.get({host:CELLBASE_HOST,category:"meta",subCategory:"species",success:function(r){var taxonomies=r.response[0].result[0];for(var taxonomy in taxonomies){var newSpecies=[];for(var i=0;i<taxonomies[taxonomy].length;i++){var species=taxonomies[taxonomy][i];for(var j=0;j<species.assemblies.length;j++){var s=Utils.clone(species);s.assembly=species.assemblies[j];delete s.assemblies;newSpecies.push(s)}}taxonomies[taxonomy]=newSpecies}callback(taxonomies)}})}
